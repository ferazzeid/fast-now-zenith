const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-B9I_IFZh.js","./supabase-DmvLFwnu.js","./vendor-D63tyEUO.js","./ui-4JzjGctU.js","./AdminOverview-D5zbDRjt.js","./AdminRoleTester-CQstVZBx.js","./test-tube-DyC9_ZKE.js","./AdminQuoteSettings-BfADfI8e.js","./Operations-D9KA41dV.js","./AdminSubnav-DjjmxDuT.js","./SimpleAnalyticsWidget-CjyADUOB.js","./CancellationTracker-f6hTi_xC.js","./AdminTierStats-C0LYPzUY.js","./UserRequestLimits-DZWQRQMI.js","./OpenAIApiStats-BfydEHeY.js","./Content-CWxfsIUa.js","./AdminTimelineSettings-8osABjMu.js","./PromptManagement-VX0_b8oX.js","./Branding-C8ogaTYQ.js","./BrandAssetsManager-C1fya-Yq.js","./smartphone-Cfc1d1T-.js","./ColorManagement-Cou3Y9PY.js","./AdminSEOSettings-BtcXM6KP.js","./Payments-Bizeatb2.js","./PaymentProviderSettings-De8V_gcB.js","./Dev-Bu1-D2UL.js"])))=>i.map(i=>d[i]);
import{j as t,V as Vc,R as Hc,A as Qc,C as Kc,T as Yc,D as Xc,P as Bp,a as xe,u as jt,b as Ne,c as Dt,d as St,e as ae,f as _t,g as li,S as Jc,h as Gp,i as ls,k as Gt,l as ci,m as an,n as Zc,o as ed,p as td,F as sd,q as Vp,r as rd,O as di,s as ui,t as mi,v as hi,w as ad,x as nd,y as od,z as Hp,W as Qp,B as id,E as ld,G as Kp}from"./ui-4JzjGctU.js";import{a as nn,r as c,e as re,G as Yp,R as cd}from"./vendor-D63tyEUO.js";import{c as Xp,_ as Bs}from"./supabase-DmvLFwnu.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var dd,Nl=nn;dd=Nl.createRoot,Nl.hydrateRoot;const Jp=1,Zp=5e3;let Gn=0;function eg(){return Gn=(Gn+1)%Number.MAX_SAFE_INTEGER,Gn.toString()}const Vn=new Map,Sl=e=>{if(Vn.has(e))return;const s=setTimeout(()=>{Vn.delete(e),qr({type:"REMOVE_TOAST",toastId:e})},Zp);Vn.set(e,s)},tg=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,Jp)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?Sl(r):e.toasts.forEach(a=>{Sl(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==s.toastId)}}},Ea=[];let Ta={toasts:[]};function qr(e){Ta=tg(Ta,e),Ea.forEach(s=>{s(Ta)})}function Le({...e}){try{if(document.querySelector('[data-modal-editing="true"]'))return console.log("ðŸ”‡ Toast suppressed due to active modal editing"),{id:"suppressed",dismiss:()=>{},update:()=>{}}}catch{}const s=eg(),r=n=>qr({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>qr({type:"DISMISS_TOAST",toastId:s});return qr({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function pe(){const[e,s]=c.useState(Ta);return c.useEffect(()=>(Ea.push(s),()=>{const r=Ea.indexOf(s);r>-1&&Ea.splice(r,1)}),[e]),{...e,toast:Le,dismiss:r=>qr({type:"DISMISS_TOAST",toastId:r})}}function ud(e){var s,r,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(s=0;s<n;s++)e[s]&&(r=ud(e[s]))&&(a&&(a+=" "),a+=r)}else for(r in e)e[r]&&(a&&(a+=" "),a+=r);return a}function md(){for(var e,s,r=0,a="",n=arguments.length;r<n;r++)(e=arguments[r])&&(s=ud(e))&&(a&&(a+=" "),a+=s);return a}const _l=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Cl=md,on=(e,s)=>r=>{var a;if(s?.variants==null)return Cl(e,r?.class,r?.className);const{variants:n,defaultVariants:o}=s,i=Object.keys(n).map(f=>{const u=r?.[f],m=o?.[f];if(u===null)return null;const h=_l(u)||_l(m);return n[f][h]}),l=r&&Object.entries(r).reduce((f,u)=>{let[m,h]=u;return h===void 0||(f[m]=h),f},{}),d=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((f,u)=>{let{class:m,className:h,...p}=u;return Object.entries(p).every(g=>{let[x,v]=g;return Array.isArray(v)?v.includes({...o,...l}[x]):{...o,...l}[x]===v})?[...f,m,h]:f},[]);return Cl(e,i,d,r?.class,r?.className)};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),rg=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,r,a)=>a?a.toUpperCase():r.toLowerCase()),kl=e=>{const s=rg(e);return s.charAt(0).toUpperCase()+s.slice(1)},hd=(...e)=>e.filter((s,r,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===r).join(" ").trim(),ag=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ng={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=c.forwardRef(({color:e="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,iconNode:i,...l},d)=>c.createElement("svg",{ref:d,...ng,width:s,height:s,stroke:e,strokeWidth:a?Number(r)*24/Number(s):r,className:hd("lucide",n),...!o&&!ag(l)&&{"aria-hidden":"true"},...l},[...i.map(([f,u])=>c.createElement(f,u)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=(e,s)=>{const r=c.forwardRef(({className:a,...n},o)=>c.createElement(og,{ref:o,iconNode:s,className:hd(`lucide-${sg(kl(e))}`,`lucide-${e}`,a),...n}));return r.displayName=kl(e),r};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Gr=ne("activity",ig);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],fi=ne("arrow-left",lg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],fd=ne("book-open",cg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],ug=ne("bookmark",dg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],pi=ne("brain",mg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ln=ne("calendar",hg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Wr=ne("camera",fg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Gs=ne("check",pg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Nt=ne("chevron-down",gg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],gi=ne("chevron-right",xg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vg=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],yg=ne("chevron-left",vg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],xi=ne("chevron-up",wg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],pd=ne("circle-alert",bg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],gd=ne("circle-check-big",jg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xd=ne("circle",Ng);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Vt=ne("clock",Sg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],El=ne("cloud-upload",_g);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],kg=ne("coffee",Cg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Tg=ne("credit-card",Eg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],go=ne("crown",Mg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pg=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],xo=ne("ellipsis-vertical",Pg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],Ag=ne("flame",Dg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],vd=ne("footprints",Rg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ig=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Fg=ne("heart",Ig);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Lg=ne("history",Og);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],vo=ne("house",$g);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],vi=ne("image",Ug);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],tt=ne("info",zg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],cn=ne("lightbulb",qg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wg=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],zt=ne("loader-circle",Wg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Vs=ne("lock",Bg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],yd=ne("mail",Gg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Tl=ne("map-pin",Vg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hg=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Ns=ne("mic",Hg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qg=[["path",{d:"M5 12h14",key:"1ays0h"}]],Kg=ne("minus",Qg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Xg=ne("monitor",Yg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jg=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],Zg=ne("moon",Jg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],tx=ne("palette",ex);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],wd=ne("pause",sx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rx=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ax=ne("pen-line",rx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Da=ne("play",nx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ox=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],qe=ne("plus",ox);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],lx=ne("quote",ix);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cx=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],At=ne("refresh-cw",cx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dx=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],ux=ne("refresh-ccw",dx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mx=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],hx=ne("rotate-ccw",mx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ss=ne("save",fx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const px=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],yo=ne("scale",px);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],bd=ne("search",gx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],jd=ne("send",xx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yx=ne("settings",vx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ml=ne("shield",wx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Br=ne("sparkles",bx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ut=ne("square-pen",jx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Pl=ne("star",Nx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],_x=ne("sun",Sx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Jt=ne("target",Cx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Ex=ne("timer",kx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Mx=ne("toggle-left",Tx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Px=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],Dx=ne("toggle-right",Px);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ax=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],We=ne("trash-2",Ax);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rx=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Ix=ne("trending-down",Rx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fx=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],dn=ne("trending-up",Fx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ox=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Zt=ne("triangle-alert",Ox);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lx=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],wo=ne("upload",Lx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $x=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Dl=ne("user",$x);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],is=ne("utensils",Ux);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zx=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Al=ne("volume-2",zx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qx=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Wx=ne("volume-x",qx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Rl=ne("wifi-off",Bx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gx=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Il=ne("wifi",Gx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vx=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ie=ne("x",Vx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hx=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Aa=ne("zap",Hx),yi="-",Qx=e=>{const s=Yx(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:i=>{const l=i.split(yi);return l[0]===""&&l.length!==1&&l.shift(),Nd(l,s)||Kx(i)},getConflictingClassGroupIds:(i,l)=>{const d=r[i]||[];return l&&a[i]?[...d,...a[i]]:d}}},Nd=(e,s)=>{if(e.length===0)return s.classGroupId;const r=e[0],a=s.nextPart.get(r),n=a?Nd(e.slice(1),a):void 0;if(n)return n;if(s.validators.length===0)return;const o=e.join(yi);return s.validators.find(({validator:i})=>i(o))?.classGroupId},Fl=/^\[(.+)\]$/,Kx=e=>{if(Fl.test(e)){const s=Fl.exec(e)[1],r=s?.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},Yx=e=>{const{theme:s,prefix:r}=e,a={nextPart:new Map,validators:[]};return Jx(Object.entries(e.classGroups),r).forEach(([o,i])=>{bo(i,a,o,s)}),a},bo=(e,s,r,a)=>{e.forEach(n=>{if(typeof n=="string"){const o=n===""?s:Ol(s,n);o.classGroupId=r;return}if(typeof n=="function"){if(Xx(n)){bo(n(a),s,r,a);return}s.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([o,i])=>{bo(i,Ol(s,o),r,a)})})},Ol=(e,s)=>{let r=e;return s.split(yi).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},Xx=e=>e.isThemeGetter,Jx=(e,s)=>s?e.map(([r,a])=>{const n=a.map(o=>typeof o=="string"?s+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,l])=>[s+i,l])):o);return[r,n]}):e,Zx=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const n=(o,i)=>{r.set(o,i),s++,s>e&&(s=0,a=r,r=new Map)};return{get(o){let i=r.get(o);if(i!==void 0)return i;if((i=a.get(o))!==void 0)return n(o,i),i},set(o,i){r.has(o)?r.set(o,i):n(o,i)}}},Sd="!",ev=e=>{const{separator:s,experimentalParseClassName:r}=e,a=s.length===1,n=s[0],o=s.length,i=l=>{const d=[];let f=0,u=0,m;for(let v=0;v<l.length;v++){let w=l[v];if(f===0){if(w===n&&(a||l.slice(v,v+o)===s)){d.push(l.slice(u,v)),u=v+o;continue}if(w==="/"){m=v;continue}}w==="["?f++:w==="]"&&f--}const h=d.length===0?l:l.substring(u),p=h.startsWith(Sd),g=p?h.substring(1):h,x=m&&m>u?m-u:void 0;return{modifiers:d,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:x}};return r?l=>r({className:l,parseClassName:i}):i},tv=e=>{if(e.length<=1)return e;const s=[];let r=[];return e.forEach(a=>{a[0]==="["?(s.push(...r.sort(),a),r=[]):r.push(a)}),s.push(...r.sort()),s},sv=e=>({cache:Zx(e.cacheSize),parseClassName:ev(e),...Qx(e)}),rv=/\s+/,av=(e,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:n}=s,o=[],i=e.trim().split(rv);let l="";for(let d=i.length-1;d>=0;d-=1){const f=i[d],{modifiers:u,hasImportantModifier:m,baseClassName:h,maybePostfixModifierPosition:p}=r(f);let g=!!p,x=a(g?h.substring(0,p):h);if(!x){if(!g){l=f+(l.length>0?" "+l:l);continue}if(x=a(h),!x){l=f+(l.length>0?" "+l:l);continue}g=!1}const v=tv(u).join(":"),w=m?v+Sd:v,y=w+x;if(o.includes(y))continue;o.push(y);const b=n(x,g);for(let j=0;j<b.length;++j){const N=b[j];o.push(w+N)}l=f+(l.length>0?" "+l:l)}return l};function nv(){let e=0,s,r,a="";for(;e<arguments.length;)(s=arguments[e++])&&(r=_d(s))&&(a&&(a+=" "),a+=r);return a}const _d=e=>{if(typeof e=="string")return e;let s,r="";for(let a=0;a<e.length;a++)e[a]&&(s=_d(e[a]))&&(r&&(r+=" "),r+=s);return r};function ov(e,...s){let r,a,n,o=i;function i(d){const f=s.reduce((u,m)=>m(u),e());return r=sv(f),a=r.cache.get,n=r.cache.set,o=l,l(d)}function l(d){const f=a(d);if(f)return f;const u=av(d,r);return n(d,u),u}return function(){return o(nv.apply(null,arguments))}}const Pe=e=>{const s=r=>r[e]||[];return s.isThemeGetter=!0,s},Cd=/^\[(?:([a-z-]+):)?(.+)\]$/i,iv=/^\d+\/\d+$/,lv=new Set(["px","full","screen"]),cv=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,dv=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,uv=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,mv=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,hv=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,os=e=>ir(e)||lv.has(e)||iv.test(e),gs=e=>vr(e,"length",bv),ir=e=>!!e&&!Number.isNaN(Number(e)),Hn=e=>vr(e,"number",ir),Dr=e=>!!e&&Number.isInteger(Number(e)),fv=e=>e.endsWith("%")&&ir(e.slice(0,-1)),we=e=>Cd.test(e),xs=e=>cv.test(e),pv=new Set(["length","size","percentage"]),gv=e=>vr(e,pv,kd),xv=e=>vr(e,"position",kd),vv=new Set(["image","url"]),yv=e=>vr(e,vv,Nv),wv=e=>vr(e,"",jv),Ar=()=>!0,vr=(e,s,r)=>{const a=Cd.exec(e);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):r(a[2]):!1},bv=e=>dv.test(e)&&!uv.test(e),kd=()=>!1,jv=e=>mv.test(e),Nv=e=>hv.test(e),Sv=()=>{const e=Pe("colors"),s=Pe("spacing"),r=Pe("blur"),a=Pe("brightness"),n=Pe("borderColor"),o=Pe("borderRadius"),i=Pe("borderSpacing"),l=Pe("borderWidth"),d=Pe("contrast"),f=Pe("grayscale"),u=Pe("hueRotate"),m=Pe("invert"),h=Pe("gap"),p=Pe("gradientColorStops"),g=Pe("gradientColorStopPositions"),x=Pe("inset"),v=Pe("margin"),w=Pe("opacity"),y=Pe("padding"),b=Pe("saturate"),j=Pe("scale"),N=Pe("sepia"),E=Pe("skew"),S=Pe("space"),_=Pe("translate"),C=()=>["auto","contain","none"],k=()=>["auto","hidden","clip","visible","scroll"],T=()=>["auto",we,s],D=()=>[we,s],W=()=>["",os,gs],$=()=>["auto",ir,we],X=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],V=()=>["solid","dashed","dotted","double","none"],G=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],L=()=>["start","end","center","between","around","evenly","stretch"],B=()=>["","0",we],de=()=>["auto","avoid","all","avoid-page","page","left","right","column"],te=()=>[ir,we];return{cacheSize:500,separator:":",theme:{colors:[Ar],spacing:[os,gs],blur:["none","",xs,we],brightness:te(),borderColor:[e],borderRadius:["none","","full",xs,we],borderSpacing:D(),borderWidth:W(),contrast:te(),grayscale:B(),hueRotate:te(),invert:B(),gap:D(),gradientColorStops:[e],gradientColorStopPositions:[fv,gs],inset:T(),margin:T(),opacity:te(),padding:D(),saturate:te(),scale:te(),sepia:B(),skew:te(),space:D(),translate:D()},classGroups:{aspect:[{aspect:["auto","square","video",we]}],container:["container"],columns:[{columns:[xs]}],"break-after":[{"break-after":de()}],"break-before":[{"break-before":de()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...X(),we]}],overflow:[{overflow:k()}],"overflow-x":[{"overflow-x":k()}],"overflow-y":[{"overflow-y":k()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Dr,we]}],basis:[{basis:T()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",we]}],grow:[{grow:B()}],shrink:[{shrink:B()}],order:[{order:["first","last","none",Dr,we]}],"grid-cols":[{"grid-cols":[Ar]}],"col-start-end":[{col:["auto",{span:["full",Dr,we]},we]}],"col-start":[{"col-start":$()}],"col-end":[{"col-end":$()}],"grid-rows":[{"grid-rows":[Ar]}],"row-start-end":[{row:["auto",{span:[Dr,we]},we]}],"row-start":[{"row-start":$()}],"row-end":[{"row-end":$()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",we]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",we]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...L()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...L(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...L(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",we,s]}],"min-w":[{"min-w":[we,s,"min","max","fit"]}],"max-w":[{"max-w":[we,s,"none","full","min","max","fit","prose",{screen:[xs]},xs]}],h:[{h:[we,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[we,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[we,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[we,s,"auto","min","max","fit"]}],"font-size":[{text:["base",xs,gs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Hn]}],"font-family":[{font:[Ar]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",we]}],"line-clamp":[{"line-clamp":["none",ir,Hn]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",os,we]}],"list-image":[{"list-image":["none",we]}],"list-style-type":[{list:["none","disc","decimal",we]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",os,gs]}],"underline-offset":[{"underline-offset":["auto",os,we]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:D()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",we]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",we]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...X(),xv]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",gv]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},yv]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...V(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:V()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...V()]}],"outline-offset":[{"outline-offset":[os,we]}],"outline-w":[{outline:[os,gs]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:W()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[os,gs]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",xs,wv]}],"shadow-color":[{shadow:[Ar]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...G(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":G()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[a]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",xs,we]}],grayscale:[{grayscale:[f]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[m]}],saturate:[{saturate:[b]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[f]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",we]}],duration:[{duration:te()}],ease:[{ease:["linear","in","out","in-out",we]}],delay:[{delay:te()}],animate:[{animate:["none","spin","ping","pulse","bounce",we]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Dr,we]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",we]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",we]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":D()}],"scroll-mx":[{"scroll-mx":D()}],"scroll-my":[{"scroll-my":D()}],"scroll-ms":[{"scroll-ms":D()}],"scroll-me":[{"scroll-me":D()}],"scroll-mt":[{"scroll-mt":D()}],"scroll-mr":[{"scroll-mr":D()}],"scroll-mb":[{"scroll-mb":D()}],"scroll-ml":[{"scroll-ml":D()}],"scroll-p":[{"scroll-p":D()}],"scroll-px":[{"scroll-px":D()}],"scroll-py":[{"scroll-py":D()}],"scroll-ps":[{"scroll-ps":D()}],"scroll-pe":[{"scroll-pe":D()}],"scroll-pt":[{"scroll-pt":D()}],"scroll-pr":[{"scroll-pr":D()}],"scroll-pb":[{"scroll-pb":D()}],"scroll-pl":[{"scroll-pl":D()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",we]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[os,gs,Hn]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},_v=ov(Sv);function Z(...e){return _v(md(e))}const Cv=Bp,Ed=c.forwardRef(({className:e,...s},r)=>t.jsx(Vc,{ref:r,className:Z("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));Ed.displayName=Vc.displayName;const kv=on("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Td=c.forwardRef(({className:e,variant:s,...r},a)=>t.jsx(Hc,{ref:a,className:Z(kv({variant:s}),e),...r}));Td.displayName=Hc.displayName;const Ev=c.forwardRef(({className:e,...s},r)=>t.jsx(Qc,{ref:r,className:Z("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...s}));Ev.displayName=Qc.displayName;const Md=c.forwardRef(({className:e,...s},r)=>t.jsx(Kc,{ref:r,className:Z("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:t.jsx(Ie,{className:"h-4 w-4"})}));Md.displayName=Kc.displayName;const Pd=c.forwardRef(({className:e,...s},r)=>t.jsx(Yc,{ref:r,className:Z("text-sm font-semibold",e),...s}));Pd.displayName=Yc.displayName;const Dd=c.forwardRef(({className:e,...s},r)=>t.jsx(Xc,{ref:r,className:Z("text-sm opacity-90",e),...s}));Dd.displayName=Xc.displayName;function Tv(){const{toasts:e,dismiss:s}=pe();return t.jsxs(Cv,{children:[e.map(function({id:r,title:a,description:n,action:o,...i}){return t.jsxs(Td,{...i,className:`${i.className||""} cursor-pointer`,onClick:l=>{const d=l.target;d.closest("button")||d.closest('[role="button"]')||s(r)},children:[t.jsxs("div",{className:"grid gap-1",children:[a&&t.jsx(Pd,{children:a}),n&&t.jsx(Dd,{children:n})]}),o,t.jsx(Md,{})]},r)}),t.jsx(Ed,{})]})}var Ll=["light","dark"],Mv="(prefers-color-scheme: dark)",Pv=c.createContext(void 0),Dv={setTheme:e=>{},themes:[]},Av=()=>{var e;return(e=c.useContext(Pv))!=null?e:Dv};c.memo(({forcedTheme:e,storageKey:s,attribute:r,enableSystem:a,enableColorScheme:n,defaultTheme:o,value:i,attrs:l,nonce:d})=>{let f=o==="system",u=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(g=>`'${g}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,m=n?Ll.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(g,x=!1,v=!0)=>{let w=i?i[g]:g,y=x?g+"|| ''":`'${w}'`,b="";return n&&v&&!x&&Ll.includes(g)&&(b+=`d.style.colorScheme = '${g}';`),r==="class"?x||w?b+=`c.add(${y})`:b+="null":w&&(b+=`d[s](n,${y})`),b},p=e?`!function(){${u}${h(e)}}()`:a?`!function(){try{${u}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${f})){var t='${Mv}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${i?`var x=${JSON.stringify(i)};`:""}${h(i?"x[e]":"e",!0)}}${f?"":"else{"+h(o,!1,!1)+"}"}${m}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${s}');if(e){${i?`var x=${JSON.stringify(i)};`:""}${h(i?"x[e]":"e",!0)}}else{${h(o,!1,!1)};}${m}}catch(t){}}();`;return c.createElement("script",{nonce:d,dangerouslySetInnerHTML:{__html:p}})});var Rv=e=>{switch(e){case"success":return Ov;case"info":return $v;case"warning":return Lv;case"error":return Uv;default:return null}},Iv=Array(12).fill(0),Fv=({visible:e})=>re.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},re.createElement("div",{className:"sonner-spinner"},Iv.map((s,r)=>re.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),Ov=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Lv=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),$v=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Uv=re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},re.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),zv=()=>{let[e,s]=re.useState(document.hidden);return re.useEffect(()=>{let r=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},jo=1,qv=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let s=this.subscribers.indexOf(e);this.subscribers.splice(s,1)}),this.publish=e=>{this.subscribers.forEach(s=>s(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var s;let{message:r,...a}=e,n=typeof e?.id=="number"||((s=e.id)==null?void 0:s.length)>0?e.id:jo++,o=this.toasts.find(l=>l.id===n),i=e.dismissible===void 0?!0:e.dismissible;return o?this.toasts=this.toasts.map(l=>l.id===n?(this.publish({...l,...e,id:n,title:r}),{...l,...e,id:n,dismissible:i,title:r}):l):this.addToast({title:r,...a,dismissible:i,id:n}),n},this.dismiss=e=>(e||this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:e,dismiss:!0})),e),this.message=(e,s)=>this.create({...s,message:e}),this.error=(e,s)=>this.create({...s,message:e,type:"error"}),this.success=(e,s)=>this.create({...s,type:"success",message:e}),this.info=(e,s)=>this.create({...s,type:"info",message:e}),this.warning=(e,s)=>this.create({...s,type:"warning",message:e}),this.loading=(e,s)=>this.create({...s,type:"loading",message:e}),this.promise=(e,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:e,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let a=e instanceof Promise?e:e(),n=r!==void 0;return a.then(async o=>{if(Bv(o)&&!o.ok){n=!1;let i=typeof s.error=="function"?await s.error(`HTTP error! status: ${o.status}`):s.error,l=typeof s.description=="function"?await s.description(`HTTP error! status: ${o.status}`):s.description;this.create({id:r,type:"error",message:i,description:l})}else if(s.success!==void 0){n=!1;let i=typeof s.success=="function"?await s.success(o):s.success,l=typeof s.description=="function"?await s.description(o):s.description;this.create({id:r,type:"success",message:i,description:l})}}).catch(async o=>{if(s.error!==void 0){n=!1;let i=typeof s.error=="function"?await s.error(o):s.error,l=typeof s.description=="function"?await s.description(o):s.description;this.create({id:r,type:"error",message:i,description:l})}}).finally(()=>{var o;n&&(this.dismiss(r),r=void 0),(o=s.finally)==null||o.call(s)}),r},this.custom=(e,s)=>{let r=s?.id||jo++;return this.create({jsx:e(r),id:r,...s}),r},this.subscribers=[],this.toasts=[]}},xt=new qv,Wv=(e,s)=>{let r=s?.id||jo++;return xt.addToast({title:e,...s,id:r}),r},Bv=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",Gv=Wv,Vv=()=>xt.toasts,va=Object.assign(Gv,{success:xt.success,info:xt.info,warning:xt.warning,error:xt.error,custom:xt.custom,message:xt.message,promise:xt.promise,dismiss:xt.dismiss,loading:xt.loading},{getHistory:Vv});function Hv(e,{insertAt:s}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",s==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}Hv(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function ya(e){return e.label!==void 0}var Qv=3,Kv="32px",Yv=4e3,Xv=356,Jv=14,Zv=20,ey=200;function ty(...e){return e.filter(Boolean).join(" ")}var sy=e=>{var s,r,a,n,o,i,l,d,f,u;let{invert:m,toast:h,unstyled:p,interacting:g,setHeights:x,visibleToasts:v,heights:w,index:y,toasts:b,expanded:j,removeToast:N,defaultRichColors:E,closeButton:S,style:_,cancelButtonStyle:C,actionButtonStyle:k,className:T="",descriptionClassName:D="",duration:W,position:$,gap:X,loadingIcon:V,expandByDefault:G,classNames:L,icons:B,closeButtonAriaLabel:de="Close toast",pauseWhenPageIsHidden:te,cn:Y}=e,[oe,O]=re.useState(!1),[Q,R]=re.useState(!1),[M,H]=re.useState(!1),[U,ee]=re.useState(!1),[ue,be]=re.useState(0),[je,Ue]=re.useState(0),me=re.useRef(null),ve=re.useRef(null),z=y===0,he=y+1<=v,le=h.type,J=h.dismissible!==!1,ce=h.className||"",it=h.descriptionClassName||"",at=re.useMemo(()=>w.findIndex(ye=>ye.toastId===h.id)||0,[w,h.id]),Er=re.useMemo(()=>{var ye;return(ye=h.closeButton)!=null?ye:S},[h.closeButton,S]),fa=re.useMemo(()=>h.duration||W||Yv,[h.duration,W]),Tr=re.useRef(0),fs=re.useRef(0),pa=re.useRef(0),ps=re.useRef(null),[ga,zn]=$.split("-"),xa=re.useMemo(()=>w.reduce((ye,Ee,ke)=>ke>=at?ye:ye+Ee.height,0),[w,at]),Mr=zv(),qn=h.invert||m,Pr=le==="loading";fs.current=re.useMemo(()=>at*X+xa,[at,xa]),re.useEffect(()=>{O(!0)},[]),re.useLayoutEffect(()=>{if(!oe)return;let ye=ve.current,Ee=ye.style.height;ye.style.height="auto";let ke=ye.getBoundingClientRect().height;ye.style.height=Ee,Ue(ke),x(Et=>Et.find(Tt=>Tt.toastId===h.id)?Et.map(Tt=>Tt.toastId===h.id?{...Tt,height:ke}:Tt):[{toastId:h.id,height:ke,position:h.position},...Et])},[oe,h.title,h.description,x,h.id]);let Yt=re.useCallback(()=>{R(!0),be(fs.current),x(ye=>ye.filter(Ee=>Ee.toastId!==h.id)),setTimeout(()=>{N(h)},ey)},[h,N,x,fs]);re.useEffect(()=>{if(h.promise&&le==="loading"||h.duration===1/0||h.type==="loading")return;let ye,Ee=fa;return j||g||te&&Mr?(()=>{if(pa.current<Tr.current){let ke=new Date().getTime()-Tr.current;Ee=Ee-ke}pa.current=new Date().getTime()})():Ee!==1/0&&(Tr.current=new Date().getTime(),ye=setTimeout(()=>{var ke;(ke=h.onAutoClose)==null||ke.call(h,h),Yt()},Ee)),()=>clearTimeout(ye)},[j,g,G,h,fa,Yt,h.promise,le,te,Mr]),re.useEffect(()=>{let ye=ve.current;if(ye){let Ee=ye.getBoundingClientRect().height;return Ue(Ee),x(ke=>[{toastId:h.id,height:Ee,position:h.position},...ke]),()=>x(ke=>ke.filter(Et=>Et.toastId!==h.id))}},[x,h.id]),re.useEffect(()=>{h.delete&&Yt()},[Yt,h.delete]);function Wn(){return B!=null&&B.loading?re.createElement("div",{className:"sonner-loader","data-visible":le==="loading"},B.loading):V?re.createElement("div",{className:"sonner-loader","data-visible":le==="loading"},V):re.createElement(Fv,{visible:le==="loading"})}return re.createElement("li",{"aria-live":h.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:ve,className:Y(T,ce,L?.toast,(s=h?.classNames)==null?void 0:s.toast,L?.default,L?.[le],(r=h?.classNames)==null?void 0:r[le]),"data-sonner-toast":"","data-rich-colors":(a=h.richColors)!=null?a:E,"data-styled":!(h.jsx||h.unstyled||p),"data-mounted":oe,"data-promise":!!h.promise,"data-removed":Q,"data-visible":he,"data-y-position":ga,"data-x-position":zn,"data-index":y,"data-front":z,"data-swiping":M,"data-dismissible":J,"data-type":le,"data-invert":qn,"data-swipe-out":U,"data-expanded":!!(j||G&&oe),style:{"--index":y,"--toasts-before":y,"--z-index":b.length-y,"--offset":`${Q?ue:fs.current}px`,"--initial-height":G?"auto":`${je}px`,..._,...h.style},onPointerDown:ye=>{Pr||!J||(me.current=new Date,be(fs.current),ye.target.setPointerCapture(ye.pointerId),ye.target.tagName!=="BUTTON"&&(H(!0),ps.current={x:ye.clientX,y:ye.clientY}))},onPointerUp:()=>{var ye,Ee,ke,Et;if(U||!J)return;ps.current=null;let Tt=Number(((ye=ve.current)==null?void 0:ye.style.getPropertyValue("--swipe-amount").replace("px",""))||0),sr=new Date().getTime()-((Ee=me.current)==null?void 0:Ee.getTime()),Bn=Math.abs(Tt)/sr;if(Math.abs(Tt)>=Zv||Bn>.11){be(fs.current),(ke=h.onDismiss)==null||ke.call(h,h),Yt(),ee(!0);return}(Et=ve.current)==null||Et.style.setProperty("--swipe-amount","0px"),H(!1)},onPointerMove:ye=>{var Ee;if(!ps.current||!J)return;let ke=ye.clientY-ps.current.y,Et=ye.clientX-ps.current.x,Tt=(ga==="top"?Math.min:Math.max)(0,ke),sr=ye.pointerType==="touch"?10:2;Math.abs(Tt)>sr?(Ee=ve.current)==null||Ee.style.setProperty("--swipe-amount",`${ke}px`):Math.abs(Et)>sr&&(ps.current=null)}},Er&&!h.jsx?re.createElement("button",{"aria-label":de,"data-disabled":Pr,"data-close-button":!0,onClick:Pr||!J?()=>{}:()=>{var ye;Yt(),(ye=h.onDismiss)==null||ye.call(h,h)},className:Y(L?.closeButton,(n=h?.classNames)==null?void 0:n.closeButton)},re.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},re.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),re.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,h.jsx||re.isValidElement(h.title)?h.jsx||h.title:re.createElement(re.Fragment,null,le||h.icon||h.promise?re.createElement("div",{"data-icon":"",className:Y(L?.icon,(o=h?.classNames)==null?void 0:o.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||Wn():null,h.type!=="loading"?h.icon||B?.[le]||Rv(le):null):null,re.createElement("div",{"data-content":"",className:Y(L?.content,(i=h?.classNames)==null?void 0:i.content)},re.createElement("div",{"data-title":"",className:Y(L?.title,(l=h?.classNames)==null?void 0:l.title)},h.title),h.description?re.createElement("div",{"data-description":"",className:Y(D,it,L?.description,(d=h?.classNames)==null?void 0:d.description)},h.description):null),re.isValidElement(h.cancel)?h.cancel:h.cancel&&ya(h.cancel)?re.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||C,onClick:ye=>{var Ee,ke;ya(h.cancel)&&J&&((ke=(Ee=h.cancel).onClick)==null||ke.call(Ee,ye),Yt())},className:Y(L?.cancelButton,(f=h?.classNames)==null?void 0:f.cancelButton)},h.cancel.label):null,re.isValidElement(h.action)?h.action:h.action&&ya(h.action)?re.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||k,onClick:ye=>{var Ee,ke;ya(h.action)&&(ye.defaultPrevented||((ke=(Ee=h.action).onClick)==null||ke.call(Ee,ye),Yt()))},className:Y(L?.actionButton,(u=h?.classNames)==null?void 0:u.actionButton)},h.action.label):null))};function $l(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var ry=e=>{let{invert:s,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:n,closeButton:o,className:i,offset:l,theme:d="light",richColors:f,duration:u,style:m,visibleToasts:h=Qv,toastOptions:p,dir:g=$l(),gap:x=Jv,loadingIcon:v,icons:w,containerAriaLabel:y="Notifications",pauseWhenPageIsHidden:b,cn:j=ty}=e,[N,E]=re.useState([]),S=re.useMemo(()=>Array.from(new Set([r].concat(N.filter(te=>te.position).map(te=>te.position)))),[N,r]),[_,C]=re.useState([]),[k,T]=re.useState(!1),[D,W]=re.useState(!1),[$,X]=re.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),V=re.useRef(null),G=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),L=re.useRef(null),B=re.useRef(!1),de=re.useCallback(te=>{var Y;(Y=N.find(oe=>oe.id===te.id))!=null&&Y.delete||xt.dismiss(te.id),E(oe=>oe.filter(({id:O})=>O!==te.id))},[N]);return re.useEffect(()=>xt.subscribe(te=>{if(te.dismiss){E(Y=>Y.map(oe=>oe.id===te.id?{...oe,delete:!0}:oe));return}setTimeout(()=>{Yp.flushSync(()=>{E(Y=>{let oe=Y.findIndex(O=>O.id===te.id);return oe!==-1?[...Y.slice(0,oe),{...Y[oe],...te},...Y.slice(oe+1)]:[te,...Y]})})})}),[]),re.useEffect(()=>{if(d!=="system"){X(d);return}d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?X("dark"):X("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:te})=>{X(te?"dark":"light")})},[d]),re.useEffect(()=>{N.length<=1&&T(!1)},[N]),re.useEffect(()=>{let te=Y=>{var oe,O;a.every(Q=>Y[Q]||Y.code===Q)&&(T(!0),(oe=V.current)==null||oe.focus()),Y.code==="Escape"&&(document.activeElement===V.current||(O=V.current)!=null&&O.contains(document.activeElement))&&T(!1)};return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[a]),re.useEffect(()=>{if(V.current)return()=>{L.current&&(L.current.focus({preventScroll:!0}),L.current=null,B.current=!1)}},[V.current]),N.length?re.createElement("section",{"aria-label":`${y} ${G}`,tabIndex:-1},S.map((te,Y)=>{var oe;let[O,Q]=te.split("-");return re.createElement("ol",{key:te,dir:g==="auto"?$l():g,tabIndex:-1,ref:V,className:i,"data-sonner-toaster":!0,"data-theme":$,"data-y-position":O,"data-x-position":Q,style:{"--front-toast-height":`${((oe=_[0])==null?void 0:oe.height)||0}px`,"--offset":typeof l=="number"?`${l}px`:l||Kv,"--width":`${Xv}px`,"--gap":`${x}px`,...m},onBlur:R=>{B.current&&!R.currentTarget.contains(R.relatedTarget)&&(B.current=!1,L.current&&(L.current.focus({preventScroll:!0}),L.current=null))},onFocus:R=>{R.target instanceof HTMLElement&&R.target.dataset.dismissible==="false"||B.current||(B.current=!0,L.current=R.relatedTarget)},onMouseEnter:()=>T(!0),onMouseMove:()=>T(!0),onMouseLeave:()=>{D||T(!1)},onPointerDown:R=>{R.target instanceof HTMLElement&&R.target.dataset.dismissible==="false"||W(!0)},onPointerUp:()=>W(!1)},N.filter(R=>!R.position&&Y===0||R.position===te).map((R,M)=>{var H,U;return re.createElement(sy,{key:R.id,icons:w,index:M,toast:R,defaultRichColors:f,duration:(H=p?.duration)!=null?H:u,className:p?.className,descriptionClassName:p?.descriptionClassName,invert:s,visibleToasts:h,closeButton:(U=p?.closeButton)!=null?U:o,interacting:D,position:te,style:p?.style,unstyled:p?.unstyled,classNames:p?.classNames,cancelButtonStyle:p?.cancelButtonStyle,actionButtonStyle:p?.actionButtonStyle,removeToast:de,toasts:N.filter(ee=>ee.position==R.position),heights:_.filter(ee=>ee.position==R.position),setHeights:C,expandByDefault:n,gap:x,loadingIcon:v,expanded:k,pauseWhenPageIsHidden:b,cn:j})}))})):null};const ay=({...e})=>{const{theme:s="system"}=Av();return t.jsx(ry,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},ny=["top","right","bottom","left"],Ss=Math.min,vt=Math.max,Ra=Math.round,wa=Math.floor,_s=e=>({x:e,y:e}),oy={left:"right",right:"left",bottom:"top",top:"bottom"},iy={start:"end",end:"start"};function No(e,s,r){return vt(e,Ss(s,r))}function cs(e,s){return typeof e=="function"?e(s):e}function ds(e){return e.split("-")[0]}function yr(e){return e.split("-")[1]}function wi(e){return e==="x"?"y":"x"}function bi(e){return e==="y"?"height":"width"}function Cs(e){return["top","bottom"].includes(ds(e))?"y":"x"}function ji(e){return wi(Cs(e))}function ly(e,s,r){r===void 0&&(r=!1);const a=yr(e),n=ji(e),o=bi(n);let i=n==="x"?a===(r?"end":"start")?"right":"left":a==="start"?"bottom":"top";return s.reference[o]>s.floating[o]&&(i=Ia(i)),[i,Ia(i)]}function cy(e){const s=Ia(e);return[So(e),s,So(s)]}function So(e){return e.replace(/start|end/g,s=>iy[s])}function dy(e,s,r){const a=["left","right"],n=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(e){case"top":case"bottom":return r?s?n:a:s?a:n;case"left":case"right":return s?o:i;default:return[]}}function uy(e,s,r,a){const n=yr(e);let o=dy(ds(e),r==="start",a);return n&&(o=o.map(i=>i+"-"+n),s&&(o=o.concat(o.map(So)))),o}function Ia(e){return e.replace(/left|right|bottom|top/g,s=>oy[s])}function my(e){return{top:0,right:0,bottom:0,left:0,...e}}function Ad(e){return typeof e!="number"?my(e):{top:e,right:e,bottom:e,left:e}}function Fa(e){const{x:s,y:r,width:a,height:n}=e;return{width:a,height:n,top:r,left:s,right:s+a,bottom:r+n,x:s,y:r}}function Ul(e,s,r){let{reference:a,floating:n}=e;const o=Cs(s),i=ji(s),l=bi(i),d=ds(s),f=o==="y",u=a.x+a.width/2-n.width/2,m=a.y+a.height/2-n.height/2,h=a[l]/2-n[l]/2;let p;switch(d){case"top":p={x:u,y:a.y-n.height};break;case"bottom":p={x:u,y:a.y+a.height};break;case"right":p={x:a.x+a.width,y:m};break;case"left":p={x:a.x-n.width,y:m};break;default:p={x:a.x,y:a.y}}switch(yr(s)){case"start":p[i]-=h*(r&&f?-1:1);break;case"end":p[i]+=h*(r&&f?-1:1);break}return p}const hy=async(e,s,r)=>{const{placement:a="bottom",strategy:n="absolute",middleware:o=[],platform:i}=r,l=o.filter(Boolean),d=await(i.isRTL==null?void 0:i.isRTL(s));let f=await i.getElementRects({reference:e,floating:s,strategy:n}),{x:u,y:m}=Ul(f,a,d),h=a,p={},g=0;for(let x=0;x<l.length;x++){const{name:v,fn:w}=l[x],{x:y,y:b,data:j,reset:N}=await w({x:u,y:m,initialPlacement:a,placement:h,strategy:n,middlewareData:p,rects:f,platform:i,elements:{reference:e,floating:s}});u=y??u,m=b??m,p={...p,[v]:{...p[v],...j}},N&&g<=50&&(g++,typeof N=="object"&&(N.placement&&(h=N.placement),N.rects&&(f=N.rects===!0?await i.getElementRects({reference:e,floating:s,strategy:n}):N.rects),{x:u,y:m}=Ul(f,h,d)),x=-1)}return{x:u,y:m,placement:h,strategy:n,middlewareData:p}};async function Vr(e,s){var r;s===void 0&&(s={});const{x:a,y:n,platform:o,rects:i,elements:l,strategy:d}=e,{boundary:f="clippingAncestors",rootBoundary:u="viewport",elementContext:m="floating",altBoundary:h=!1,padding:p=0}=cs(s,e),g=Ad(p),v=l[h?m==="floating"?"reference":"floating":m],w=Fa(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(v)))==null||r?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(l.floating)),boundary:f,rootBoundary:u,strategy:d})),y=m==="floating"?{x:a,y:n,width:i.floating.width,height:i.floating.height}:i.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l.floating)),j=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},N=Fa(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:y,offsetParent:b,strategy:d}):y);return{top:(w.top-N.top+g.top)/j.y,bottom:(N.bottom-w.bottom+g.bottom)/j.y,left:(w.left-N.left+g.left)/j.x,right:(N.right-w.right+g.right)/j.x}}const fy=e=>({name:"arrow",options:e,async fn(s){const{x:r,y:a,placement:n,rects:o,platform:i,elements:l,middlewareData:d}=s,{element:f,padding:u=0}=cs(e,s)||{};if(f==null)return{};const m=Ad(u),h={x:r,y:a},p=ji(n),g=bi(p),x=await i.getDimensions(f),v=p==="y",w=v?"top":"left",y=v?"bottom":"right",b=v?"clientHeight":"clientWidth",j=o.reference[g]+o.reference[p]-h[p]-o.floating[g],N=h[p]-o.reference[p],E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(f));let S=E?E[b]:0;(!S||!await(i.isElement==null?void 0:i.isElement(E)))&&(S=l.floating[b]||o.floating[g]);const _=j/2-N/2,C=S/2-x[g]/2-1,k=Ss(m[w],C),T=Ss(m[y],C),D=k,W=S-x[g]-T,$=S/2-x[g]/2+_,X=No(D,$,W),V=!d.arrow&&yr(n)!=null&&$!==X&&o.reference[g]/2-($<D?k:T)-x[g]/2<0,G=V?$<D?$-D:$-W:0;return{[p]:h[p]+G,data:{[p]:X,centerOffset:$-X-G,...V&&{alignmentOffset:G}},reset:V}}}),py=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(s){var r,a;const{placement:n,middlewareData:o,rects:i,initialPlacement:l,platform:d,elements:f}=s,{mainAxis:u=!0,crossAxis:m=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:x=!0,...v}=cs(e,s);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const w=ds(n),y=Cs(l),b=ds(l)===l,j=await(d.isRTL==null?void 0:d.isRTL(f.floating)),N=h||(b||!x?[Ia(l)]:cy(l)),E=g!=="none";!h&&E&&N.push(...uy(l,x,g,j));const S=[l,...N],_=await Vr(s,v),C=[];let k=((a=o.flip)==null?void 0:a.overflows)||[];if(u&&C.push(_[w]),m){const $=ly(n,i,j);C.push(_[$[0]],_[$[1]])}if(k=[...k,{placement:n,overflows:C}],!C.every($=>$<=0)){var T,D;const $=(((T=o.flip)==null?void 0:T.index)||0)+1,X=S[$];if(X)return{data:{index:$,overflows:k},reset:{placement:X}};let V=(D=k.filter(G=>G.overflows[0]<=0).sort((G,L)=>G.overflows[1]-L.overflows[1])[0])==null?void 0:D.placement;if(!V)switch(p){case"bestFit":{var W;const G=(W=k.filter(L=>{if(E){const B=Cs(L.placement);return B===y||B==="y"}return!0}).map(L=>[L.placement,L.overflows.filter(B=>B>0).reduce((B,de)=>B+de,0)]).sort((L,B)=>L[1]-B[1])[0])==null?void 0:W[0];G&&(V=G);break}case"initialPlacement":V=l;break}if(n!==V)return{reset:{placement:V}}}return{}}}};function zl(e,s){return{top:e.top-s.height,right:e.right-s.width,bottom:e.bottom-s.height,left:e.left-s.width}}function ql(e){return ny.some(s=>e[s]>=0)}const gy=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(s){const{rects:r}=s,{strategy:a="referenceHidden",...n}=cs(e,s);switch(a){case"referenceHidden":{const o=await Vr(s,{...n,elementContext:"reference"}),i=zl(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:ql(i)}}}case"escaped":{const o=await Vr(s,{...n,altBoundary:!0}),i=zl(o,r.floating);return{data:{escapedOffsets:i,escaped:ql(i)}}}default:return{}}}}};async function xy(e,s){const{placement:r,platform:a,elements:n}=e,o=await(a.isRTL==null?void 0:a.isRTL(n.floating)),i=ds(r),l=yr(r),d=Cs(r)==="y",f=["left","top"].includes(i)?-1:1,u=o&&d?-1:1,m=cs(s,e);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return l&&typeof g=="number"&&(p=l==="end"?g*-1:g),d?{x:p*u,y:h*f}:{x:h*f,y:p*u}}const vy=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(s){var r,a;const{x:n,y:o,placement:i,middlewareData:l}=s,d=await xy(s,e);return i===((r=l.offset)==null?void 0:r.placement)&&(a=l.arrow)!=null&&a.alignmentOffset?{}:{x:n+d.x,y:o+d.y,data:{...d,placement:i}}}}},yy=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(s){const{x:r,y:a,placement:n}=s,{mainAxis:o=!0,crossAxis:i=!1,limiter:l={fn:v=>{let{x:w,y}=v;return{x:w,y}}},...d}=cs(e,s),f={x:r,y:a},u=await Vr(s,d),m=Cs(ds(n)),h=wi(m);let p=f[h],g=f[m];if(o){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",y=p+u[v],b=p-u[w];p=No(y,p,b)}if(i){const v=m==="y"?"top":"left",w=m==="y"?"bottom":"right",y=g+u[v],b=g-u[w];g=No(y,g,b)}const x=l.fn({...s,[h]:p,[m]:g});return{...x,data:{x:x.x-r,y:x.y-a,enabled:{[h]:o,[m]:i}}}}}},wy=function(e){return e===void 0&&(e={}),{options:e,fn(s){const{x:r,y:a,placement:n,rects:o,middlewareData:i}=s,{offset:l=0,mainAxis:d=!0,crossAxis:f=!0}=cs(e,s),u={x:r,y:a},m=Cs(n),h=wi(m);let p=u[h],g=u[m];const x=cs(l,s),v=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(d){const b=h==="y"?"height":"width",j=o.reference[h]-o.floating[b]+v.mainAxis,N=o.reference[h]+o.reference[b]-v.mainAxis;p<j?p=j:p>N&&(p=N)}if(f){var w,y;const b=h==="y"?"width":"height",j=["top","left"].includes(ds(n)),N=o.reference[m]-o.floating[b]+(j&&((w=i.offset)==null?void 0:w[m])||0)+(j?0:v.crossAxis),E=o.reference[m]+o.reference[b]+(j?0:((y=i.offset)==null?void 0:y[m])||0)-(j?v.crossAxis:0);g<N?g=N:g>E&&(g=E)}return{[h]:p,[m]:g}}}},by=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(s){var r,a;const{placement:n,rects:o,platform:i,elements:l}=s,{apply:d=()=>{},...f}=cs(e,s),u=await Vr(s,f),m=ds(n),h=yr(n),p=Cs(n)==="y",{width:g,height:x}=o.floating;let v,w;m==="top"||m==="bottom"?(v=m,w=h===(await(i.isRTL==null?void 0:i.isRTL(l.floating))?"start":"end")?"left":"right"):(w=m,v=h==="end"?"top":"bottom");const y=x-u.top-u.bottom,b=g-u.left-u.right,j=Ss(x-u[v],y),N=Ss(g-u[w],b),E=!s.middlewareData.shift;let S=j,_=N;if((r=s.middlewareData.shift)!=null&&r.enabled.x&&(_=b),(a=s.middlewareData.shift)!=null&&a.enabled.y&&(S=y),E&&!h){const k=vt(u.left,0),T=vt(u.right,0),D=vt(u.top,0),W=vt(u.bottom,0);p?_=g-2*(k!==0||T!==0?k+T:vt(u.left,u.right)):S=x-2*(D!==0||W!==0?D+W:vt(u.top,u.bottom))}await d({...s,availableWidth:_,availableHeight:S});const C=await i.getDimensions(l.floating);return g!==C.width||x!==C.height?{reset:{rects:!0}}:{}}}};function un(){return typeof window<"u"}function wr(e){return Rd(e)?(e.nodeName||"").toLowerCase():"#document"}function wt(e){var s;return(e==null||(s=e.ownerDocument)==null?void 0:s.defaultView)||window}function as(e){var s;return(s=(Rd(e)?e.ownerDocument:e.document)||window.document)==null?void 0:s.documentElement}function Rd(e){return un()?e instanceof Node||e instanceof wt(e).Node:!1}function Ht(e){return un()?e instanceof Element||e instanceof wt(e).Element:!1}function rs(e){return un()?e instanceof HTMLElement||e instanceof wt(e).HTMLElement:!1}function Wl(e){return!un()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof wt(e).ShadowRoot}function na(e){const{overflow:s,overflowX:r,overflowY:a,display:n}=Qt(e);return/auto|scroll|overlay|hidden|clip/.test(s+a+r)&&!["inline","contents"].includes(n)}function jy(e){return["table","td","th"].includes(wr(e))}function mn(e){return[":popover-open",":modal"].some(s=>{try{return e.matches(s)}catch{return!1}})}function Ni(e){const s=Si(),r=Ht(e)?Qt(e):e;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!s&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!s&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(a=>(r.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(r.contain||"").includes(a))}function Ny(e){let s=ks(e);for(;rs(s)&&!dr(s);){if(Ni(s))return s;if(mn(s))return null;s=ks(s)}return null}function Si(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function dr(e){return["html","body","#document"].includes(wr(e))}function Qt(e){return wt(e).getComputedStyle(e)}function hn(e){return Ht(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function ks(e){if(wr(e)==="html")return e;const s=e.assignedSlot||e.parentNode||Wl(e)&&e.host||as(e);return Wl(s)?s.host:s}function Id(e){const s=ks(e);return dr(s)?e.ownerDocument?e.ownerDocument.body:e.body:rs(s)&&na(s)?s:Id(s)}function Hr(e,s,r){var a;s===void 0&&(s=[]),r===void 0&&(r=!0);const n=Id(e),o=n===((a=e.ownerDocument)==null?void 0:a.body),i=wt(n);if(o){const l=_o(i);return s.concat(i,i.visualViewport||[],na(n)?n:[],l&&r?Hr(l):[])}return s.concat(n,Hr(n,[],r))}function _o(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Fd(e){const s=Qt(e);let r=parseFloat(s.width)||0,a=parseFloat(s.height)||0;const n=rs(e),o=n?e.offsetWidth:r,i=n?e.offsetHeight:a,l=Ra(r)!==o||Ra(a)!==i;return l&&(r=o,a=i),{width:r,height:a,$:l}}function _i(e){return Ht(e)?e:e.contextElement}function lr(e){const s=_i(e);if(!rs(s))return _s(1);const r=s.getBoundingClientRect(),{width:a,height:n,$:o}=Fd(s);let i=(o?Ra(r.width):r.width)/a,l=(o?Ra(r.height):r.height)/n;return(!i||!Number.isFinite(i))&&(i=1),(!l||!Number.isFinite(l))&&(l=1),{x:i,y:l}}const Sy=_s(0);function Od(e){const s=wt(e);return!Si()||!s.visualViewport?Sy:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function _y(e,s,r){return s===void 0&&(s=!1),!r||s&&r!==wt(e)?!1:s}function Os(e,s,r,a){s===void 0&&(s=!1),r===void 0&&(r=!1);const n=e.getBoundingClientRect(),o=_i(e);let i=_s(1);s&&(a?Ht(a)&&(i=lr(a)):i=lr(e));const l=_y(o,r,a)?Od(o):_s(0);let d=(n.left+l.x)/i.x,f=(n.top+l.y)/i.y,u=n.width/i.x,m=n.height/i.y;if(o){const h=wt(o),p=a&&Ht(a)?wt(a):a;let g=h,x=_o(g);for(;x&&a&&p!==g;){const v=lr(x),w=x.getBoundingClientRect(),y=Qt(x),b=w.left+(x.clientLeft+parseFloat(y.paddingLeft))*v.x,j=w.top+(x.clientTop+parseFloat(y.paddingTop))*v.y;d*=v.x,f*=v.y,u*=v.x,m*=v.y,d+=b,f+=j,g=wt(x),x=_o(g)}}return Fa({width:u,height:m,x:d,y:f})}function Cy(e){let{elements:s,rect:r,offsetParent:a,strategy:n}=e;const o=n==="fixed",i=as(a),l=s?mn(s.floating):!1;if(a===i||l&&o)return r;let d={scrollLeft:0,scrollTop:0},f=_s(1);const u=_s(0),m=rs(a);if((m||!m&&!o)&&((wr(a)!=="body"||na(i))&&(d=hn(a)),rs(a))){const h=Os(a);f=lr(a),u.x=h.x+a.clientLeft,u.y=h.y+a.clientTop}return{width:r.width*f.x,height:r.height*f.y,x:r.x*f.x-d.scrollLeft*f.x+u.x,y:r.y*f.y-d.scrollTop*f.y+u.y}}function ky(e){return Array.from(e.getClientRects())}function Co(e,s){const r=hn(e).scrollLeft;return s?s.left+r:Os(as(e)).left+r}function Ey(e){const s=as(e),r=hn(e),a=e.ownerDocument.body,n=vt(s.scrollWidth,s.clientWidth,a.scrollWidth,a.clientWidth),o=vt(s.scrollHeight,s.clientHeight,a.scrollHeight,a.clientHeight);let i=-r.scrollLeft+Co(e);const l=-r.scrollTop;return Qt(a).direction==="rtl"&&(i+=vt(s.clientWidth,a.clientWidth)-n),{width:n,height:o,x:i,y:l}}function Ty(e,s){const r=wt(e),a=as(e),n=r.visualViewport;let o=a.clientWidth,i=a.clientHeight,l=0,d=0;if(n){o=n.width,i=n.height;const f=Si();(!f||f&&s==="fixed")&&(l=n.offsetLeft,d=n.offsetTop)}return{width:o,height:i,x:l,y:d}}function My(e,s){const r=Os(e,!0,s==="fixed"),a=r.top+e.clientTop,n=r.left+e.clientLeft,o=rs(e)?lr(e):_s(1),i=e.clientWidth*o.x,l=e.clientHeight*o.y,d=n*o.x,f=a*o.y;return{width:i,height:l,x:d,y:f}}function Bl(e,s,r){let a;if(s==="viewport")a=Ty(e,r);else if(s==="document")a=Ey(as(e));else if(Ht(s))a=My(s,r);else{const n=Od(e);a={...s,x:s.x-n.x,y:s.y-n.y}}return Fa(a)}function Ld(e,s){const r=ks(e);return r===s||!Ht(r)||dr(r)?!1:Qt(r).position==="fixed"||Ld(r,s)}function Py(e,s){const r=s.get(e);if(r)return r;let a=Hr(e,[],!1).filter(l=>Ht(l)&&wr(l)!=="body"),n=null;const o=Qt(e).position==="fixed";let i=o?ks(e):e;for(;Ht(i)&&!dr(i);){const l=Qt(i),d=Ni(i);!d&&l.position==="fixed"&&(n=null),(o?!d&&!n:!d&&l.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||na(i)&&!d&&Ld(e,i))?a=a.filter(u=>u!==i):n=l,i=ks(i)}return s.set(e,a),a}function Dy(e){let{element:s,boundary:r,rootBoundary:a,strategy:n}=e;const i=[...r==="clippingAncestors"?mn(s)?[]:Py(s,this._c):[].concat(r),a],l=i[0],d=i.reduce((f,u)=>{const m=Bl(s,u,n);return f.top=vt(m.top,f.top),f.right=Ss(m.right,f.right),f.bottom=Ss(m.bottom,f.bottom),f.left=vt(m.left,f.left),f},Bl(s,l,n));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function Ay(e){const{width:s,height:r}=Fd(e);return{width:s,height:r}}function Ry(e,s,r){const a=rs(s),n=as(s),o=r==="fixed",i=Os(e,!0,o,s);let l={scrollLeft:0,scrollTop:0};const d=_s(0);if(a||!a&&!o)if((wr(s)!=="body"||na(n))&&(l=hn(s)),a){const p=Os(s,!0,o,s);d.x=p.x+s.clientLeft,d.y=p.y+s.clientTop}else n&&(d.x=Co(n));let f=0,u=0;if(n&&!a&&!o){const p=n.getBoundingClientRect();u=p.top+l.scrollTop,f=p.left+l.scrollLeft-Co(n,p)}const m=i.left+l.scrollLeft-d.x-f,h=i.top+l.scrollTop-d.y-u;return{x:m,y:h,width:i.width,height:i.height}}function Qn(e){return Qt(e).position==="static"}function Gl(e,s){if(!rs(e)||Qt(e).position==="fixed")return null;if(s)return s(e);let r=e.offsetParent;return as(e)===r&&(r=r.ownerDocument.body),r}function $d(e,s){const r=wt(e);if(mn(e))return r;if(!rs(e)){let n=ks(e);for(;n&&!dr(n);){if(Ht(n)&&!Qn(n))return n;n=ks(n)}return r}let a=Gl(e,s);for(;a&&jy(a)&&Qn(a);)a=Gl(a,s);return a&&dr(a)&&Qn(a)&&!Ni(a)?r:a||Ny(e)||r}const Iy=async function(e){const s=this.getOffsetParent||$d,r=this.getDimensions,a=await r(e.floating);return{reference:Ry(e.reference,await s(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function Fy(e){return Qt(e).direction==="rtl"}const Oy={convertOffsetParentRelativeRectToViewportRelativeRect:Cy,getDocumentElement:as,getClippingRect:Dy,getOffsetParent:$d,getElementRects:Iy,getClientRects:ky,getDimensions:Ay,getScale:lr,isElement:Ht,isRTL:Fy};function Ly(e,s){let r=null,a;const n=as(e);function o(){var l;clearTimeout(a),(l=r)==null||l.disconnect(),r=null}function i(l,d){l===void 0&&(l=!1),d===void 0&&(d=1),o();const{left:f,top:u,width:m,height:h}=e.getBoundingClientRect();if(l||s(),!m||!h)return;const p=wa(u),g=wa(n.clientWidth-(f+m)),x=wa(n.clientHeight-(u+h)),v=wa(f),y={rootMargin:-p+"px "+-g+"px "+-x+"px "+-v+"px",threshold:vt(0,Ss(1,d))||1};let b=!0;function j(N){const E=N[0].intersectionRatio;if(E!==d){if(!b)return i();E?i(!1,E):a=setTimeout(()=>{i(!1,1e-7)},1e3)}b=!1}try{r=new IntersectionObserver(j,{...y,root:n.ownerDocument})}catch{r=new IntersectionObserver(j,y)}r.observe(e)}return i(!0),o}function $y(e,s,r,a){a===void 0&&(a={});const{ancestorScroll:n=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:d=!1}=a,f=_i(e),u=n||o?[...f?Hr(f):[],...Hr(s)]:[];u.forEach(w=>{n&&w.addEventListener("scroll",r,{passive:!0}),o&&w.addEventListener("resize",r)});const m=f&&l?Ly(f,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[y]=w;y&&y.target===f&&p&&(p.unobserve(s),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(s)})),r()}),f&&!d&&p.observe(f),p.observe(s));let g,x=d?Os(e):null;d&&v();function v(){const w=Os(e);x&&(w.x!==x.x||w.y!==x.y||w.width!==x.width||w.height!==x.height)&&r(),x=w,g=requestAnimationFrame(v)}return r(),()=>{var w;u.forEach(y=>{n&&y.removeEventListener("scroll",r),o&&y.removeEventListener("resize",r)}),m?.(),(w=p)==null||w.disconnect(),p=null,d&&cancelAnimationFrame(g)}}const Uy=vy,zy=yy,qy=py,Wy=by,By=gy,Vl=fy,Gy=wy,Vy=(e,s,r)=>{const a=new Map,n={platform:Oy,...r},o={...n.platform,_c:a};return hy(e,s,{...n,platform:o})};var Ma=typeof document<"u"?c.useLayoutEffect:c.useEffect;function Oa(e,s){if(e===s)return!0;if(typeof e!=typeof s)return!1;if(typeof e=="function"&&e.toString()===s.toString())return!0;let r,a,n;if(e&&s&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==s.length)return!1;for(a=r;a--!==0;)if(!Oa(e[a],s[a]))return!1;return!0}if(n=Object.keys(e),r=n.length,r!==Object.keys(s).length)return!1;for(a=r;a--!==0;)if(!{}.hasOwnProperty.call(s,n[a]))return!1;for(a=r;a--!==0;){const o=n[a];if(!(o==="_owner"&&e.$$typeof)&&!Oa(e[o],s[o]))return!1}return!0}return e!==e&&s!==s}function Ud(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Hl(e,s){const r=Ud(e);return Math.round(s*r)/r}function Kn(e){const s=c.useRef(e);return Ma(()=>{s.current=e}),s}function Hy(e){e===void 0&&(e={});const{placement:s="bottom",strategy:r="absolute",middleware:a=[],platform:n,elements:{reference:o,floating:i}={},transform:l=!0,whileElementsMounted:d,open:f}=e,[u,m]=c.useState({x:0,y:0,strategy:r,placement:s,middlewareData:{},isPositioned:!1}),[h,p]=c.useState(a);Oa(h,a)||p(a);const[g,x]=c.useState(null),[v,w]=c.useState(null),y=c.useCallback(L=>{L!==E.current&&(E.current=L,x(L))},[]),b=c.useCallback(L=>{L!==S.current&&(S.current=L,w(L))},[]),j=o||g,N=i||v,E=c.useRef(null),S=c.useRef(null),_=c.useRef(u),C=d!=null,k=Kn(d),T=Kn(n),D=Kn(f),W=c.useCallback(()=>{if(!E.current||!S.current)return;const L={placement:s,strategy:r,middleware:h};T.current&&(L.platform=T.current),Vy(E.current,S.current,L).then(B=>{const de={...B,isPositioned:D.current!==!1};$.current&&!Oa(_.current,de)&&(_.current=de,nn.flushSync(()=>{m(de)}))})},[h,s,r,T,D]);Ma(()=>{f===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,m(L=>({...L,isPositioned:!1})))},[f]);const $=c.useRef(!1);Ma(()=>($.current=!0,()=>{$.current=!1}),[]),Ma(()=>{if(j&&(E.current=j),N&&(S.current=N),j&&N){if(k.current)return k.current(j,N,W);W()}},[j,N,W,k,C]);const X=c.useMemo(()=>({reference:E,floating:S,setReference:y,setFloating:b}),[y,b]),V=c.useMemo(()=>({reference:j,floating:N}),[j,N]),G=c.useMemo(()=>{const L={position:r,left:0,top:0};if(!V.floating)return L;const B=Hl(V.floating,u.x),de=Hl(V.floating,u.y);return l?{...L,transform:"translate("+B+"px, "+de+"px)",...Ud(V.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:B,top:de}},[r,l,V.floating,u.x,u.y]);return c.useMemo(()=>({...u,update:W,refs:X,elements:V,floatingStyles:G}),[u,W,X,V,G])}const Qy=e=>{function s(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:a,padding:n}=typeof e=="function"?e(r):e;return a&&s(a)?a.current!=null?Vl({element:a.current,padding:n}).fn(r):{}:a?Vl({element:a,padding:n}).fn(r):{}}}},Ky=(e,s)=>({...Uy(e),options:[e,s]}),Yy=(e,s)=>({...zy(e),options:[e,s]}),Xy=(e,s)=>({...Gy(e),options:[e,s]}),Jy=(e,s)=>({...qy(e),options:[e,s]}),Zy=(e,s)=>({...Wy(e),options:[e,s]}),ew=(e,s)=>({...By(e),options:[e,s]}),tw=(e,s)=>({...Qy(e),options:[e,s]});var sw="Arrow",zd=c.forwardRef((e,s)=>{const{children:r,width:a=10,height:n=5,...o}=e;return t.jsx(xe.svg,{...o,ref:s,width:a,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:t.jsx("polygon",{points:"0,0 30,0 15,10"})})});zd.displayName=sw;var rw=zd;function aw(e,s=[]){let r=[];function a(o,i){const l=c.createContext(i),d=r.length;r=[...r,i];function f(m){const{scope:h,children:p,...g}=m,x=h?.[e][d]||l,v=c.useMemo(()=>g,Object.values(g));return t.jsx(x.Provider,{value:v,children:p})}function u(m,h){const p=h?.[e][d]||l,g=c.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${o}\``)}return f.displayName=o+"Provider",[f,u]}const n=()=>{const o=r.map(i=>c.createContext(i));return function(l){const d=l?.[e]||o;return c.useMemo(()=>({[`__scope${e}`]:{...l,[e]:d}}),[l,d])}};return n.scopeName=e,[a,nw(n,...s)]}function nw(...e){const s=e[0];if(e.length===1)return s;const r=()=>{const a=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(o){const i=a.reduce((l,{useScope:d,scopeName:f})=>{const m=d(o)[`__scope${f}`];return{...l,...m}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}function oa(e){const[s,r]=c.useState(void 0);return jt(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const o=n[0];let i,l;if("borderBoxSize"in o){const d=o.borderBoxSize,f=Array.isArray(d)?d[0]:d;i=f.inlineSize,l=f.blockSize}else i=e.offsetWidth,l=e.offsetHeight;r({width:i,height:l})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else r(void 0)},[e]),s}var Ci="Popper",[qd,br]=aw(Ci),[ow,Wd]=qd(Ci),Bd=e=>{const{__scopePopper:s,children:r}=e,[a,n]=c.useState(null);return t.jsx(ow,{scope:s,anchor:a,onAnchorChange:n,children:r})};Bd.displayName=Ci;var Gd="PopperAnchor",Vd=c.forwardRef((e,s)=>{const{__scopePopper:r,virtualRef:a,...n}=e,o=Wd(Gd,r),i=c.useRef(null),l=Ne(s,i);return c.useEffect(()=>{o.onAnchorChange(a?.current||i.current)}),a?null:t.jsx(xe.div,{...n,ref:l})});Vd.displayName=Gd;var ki="PopperContent",[iw,lw]=qd(ki),Hd=c.forwardRef((e,s)=>{const{__scopePopper:r,side:a="bottom",sideOffset:n=0,align:o="center",alignOffset:i=0,arrowPadding:l=0,avoidCollisions:d=!0,collisionBoundary:f=[],collisionPadding:u=0,sticky:m="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:g,...x}=e,v=Wd(ki,r),[w,y]=c.useState(null),b=Ne(s,M=>y(M)),[j,N]=c.useState(null),E=oa(j),S=E?.width??0,_=E?.height??0,C=a+(o!=="center"?"-"+o:""),k=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},T=Array.isArray(f)?f:[f],D=T.length>0,W={padding:k,boundary:T.filter(dw),altBoundary:D},{refs:$,floatingStyles:X,placement:V,isPositioned:G,middlewareData:L}=Hy({strategy:"fixed",placement:C,whileElementsMounted:(...M)=>$y(...M,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[Ky({mainAxis:n+_,alignmentAxis:i}),d&&Yy({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?Xy():void 0,...W}),d&&Jy({...W}),Zy({...W,apply:({elements:M,rects:H,availableWidth:U,availableHeight:ee})=>{const{width:ue,height:be}=H.reference,je=M.floating.style;je.setProperty("--radix-popper-available-width",`${U}px`),je.setProperty("--radix-popper-available-height",`${ee}px`),je.setProperty("--radix-popper-anchor-width",`${ue}px`),je.setProperty("--radix-popper-anchor-height",`${be}px`)}}),j&&tw({element:j,padding:l}),uw({arrowWidth:S,arrowHeight:_}),h&&ew({strategy:"referenceHidden",...W})]}),[B,de]=Yd(V),te=Dt(g);jt(()=>{G&&te?.()},[G,te]);const Y=L.arrow?.x,oe=L.arrow?.y,O=L.arrow?.centerOffset!==0,[Q,R]=c.useState();return jt(()=>{w&&R(window.getComputedStyle(w).zIndex)},[w]),t.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...X,transform:G?X.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[L.transformOrigin?.x,L.transformOrigin?.y].join(" "),...L.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:t.jsx(iw,{scope:r,placedSide:B,onArrowChange:N,arrowX:Y,arrowY:oe,shouldHideArrow:O,children:t.jsx(xe.div,{"data-side":B,"data-align":de,...x,ref:b,style:{...x.style,animation:G?void 0:"none"}})})})});Hd.displayName=ki;var Qd="PopperArrow",cw={top:"bottom",right:"left",bottom:"top",left:"right"},Kd=c.forwardRef(function(s,r){const{__scopePopper:a,...n}=s,o=lw(Qd,a),i=cw[o.placedSide];return t.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:t.jsx(rw,{...n,ref:r,style:{...n.style,display:"block"}})})});Kd.displayName=Qd;function dw(e){return e!==null}var uw=e=>({name:"transformOrigin",options:e,fn(s){const{placement:r,rects:a,middlewareData:n}=s,i=n.arrow?.centerOffset!==0,l=i?0:e.arrowWidth,d=i?0:e.arrowHeight,[f,u]=Yd(r),m={start:"0%",center:"50%",end:"100%"}[u],h=(n.arrow?.x??0)+l/2,p=(n.arrow?.y??0)+d/2;let g="",x="";return f==="bottom"?(g=i?m:`${h}px`,x=`${-d}px`):f==="top"?(g=i?m:`${h}px`,x=`${a.floating.height+d}px`):f==="right"?(g=`${-d}px`,x=i?m:`${p}px`):f==="left"&&(g=`${a.floating.width+d}px`,x=i?m:`${p}px`),{data:{x:g,y:x}}}});function Yd(e){const[s,r="center"]=e.split("-");return[s,r]}var Ei=Bd,Ti=Vd,Mi=Hd,Pi=Kd,[fn,I2]=St("Tooltip",[br]),pn=br(),Xd="TooltipProvider",mw=700,ko="tooltip.open",[hw,Di]=fn(Xd),Jd=e=>{const{__scopeTooltip:s,delayDuration:r=mw,skipDelayDuration:a=300,disableHoverableContent:n=!1,children:o}=e,[i,l]=c.useState(!0),d=c.useRef(!1),f=c.useRef(0);return c.useEffect(()=>{const u=f.current;return()=>window.clearTimeout(u)},[]),t.jsx(hw,{scope:s,isOpenDelayed:i,delayDuration:r,onOpen:c.useCallback(()=>{window.clearTimeout(f.current),l(!1)},[]),onClose:c.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>l(!0),a)},[a]),isPointerInTransitRef:d,onPointerInTransitChange:c.useCallback(u=>{d.current=u},[]),disableHoverableContent:n,children:o})};Jd.displayName=Xd;var gn="Tooltip",[fw,xn]=fn(gn),Zd=e=>{const{__scopeTooltip:s,children:r,open:a,defaultOpen:n=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:l}=e,d=Di(gn,e.__scopeTooltip),f=pn(s),[u,m]=c.useState(null),h=ls(),p=c.useRef(0),g=i??d.disableHoverableContent,x=l??d.delayDuration,v=c.useRef(!1),[w=!1,y]=Gt({prop:a,defaultProp:n,onChange:S=>{S?(d.onOpen(),document.dispatchEvent(new CustomEvent(ko))):d.onClose(),o?.(S)}}),b=c.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),j=c.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,y(!0)},[y]),N=c.useCallback(()=>{window.clearTimeout(p.current),p.current=0,y(!1)},[y]),E=c.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,y(!0),p.current=0},x)},[x,y]);return c.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),t.jsx(Ei,{...f,children:t.jsx(fw,{scope:s,contentId:h,open:w,stateAttribute:b,trigger:u,onTriggerChange:m,onTriggerEnter:c.useCallback(()=>{d.isOpenDelayed?E():j()},[d.isOpenDelayed,E,j]),onTriggerLeave:c.useCallback(()=>{g?N():(window.clearTimeout(p.current),p.current=0)},[N,g]),onOpen:j,onClose:N,disableHoverableContent:g,children:r})})};Zd.displayName=gn;var Eo="TooltipTrigger",eu=c.forwardRef((e,s)=>{const{__scopeTooltip:r,...a}=e,n=xn(Eo,r),o=Di(Eo,r),i=pn(r),l=c.useRef(null),d=Ne(s,l,n.onTriggerChange),f=c.useRef(!1),u=c.useRef(!1),m=c.useCallback(()=>f.current=!1,[]);return c.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),t.jsx(Ti,{asChild:!0,...i,children:t.jsx(xe.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...a,ref:d,onPointerMove:ae(e.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!o.isPointerInTransitRef.current&&(n.onTriggerEnter(),u.current=!0)}),onPointerLeave:ae(e.onPointerLeave,()=>{n.onTriggerLeave(),u.current=!1}),onPointerDown:ae(e.onPointerDown,()=>{f.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:ae(e.onFocus,()=>{f.current||n.onOpen()}),onBlur:ae(e.onBlur,n.onClose),onClick:ae(e.onClick,n.onClose)})})});eu.displayName=Eo;var pw="TooltipPortal",[F2,gw]=fn(pw,{forceMount:void 0}),ur="TooltipContent",tu=c.forwardRef((e,s)=>{const r=gw(ur,e.__scopeTooltip),{forceMount:a=r.forceMount,side:n="top",...o}=e,i=xn(ur,e.__scopeTooltip);return t.jsx(_t,{present:a||i.open,children:i.disableHoverableContent?t.jsx(su,{side:n,...o,ref:s}):t.jsx(xw,{side:n,...o,ref:s})})}),xw=c.forwardRef((e,s)=>{const r=xn(ur,e.__scopeTooltip),a=Di(ur,e.__scopeTooltip),n=c.useRef(null),o=Ne(s,n),[i,l]=c.useState(null),{trigger:d,onClose:f}=r,u=n.current,{onPointerInTransitChange:m}=a,h=c.useCallback(()=>{l(null),m(!1)},[m]),p=c.useCallback((g,x)=>{const v=g.currentTarget,w={x:g.clientX,y:g.clientY},y=bw(w,v.getBoundingClientRect()),b=jw(w,y),j=Nw(x.getBoundingClientRect()),N=_w([...b,...j]);l(N),m(!0)},[m]);return c.useEffect(()=>()=>h(),[h]),c.useEffect(()=>{if(d&&u){const g=v=>p(v,u),x=v=>p(v,d);return d.addEventListener("pointerleave",g),u.addEventListener("pointerleave",x),()=>{d.removeEventListener("pointerleave",g),u.removeEventListener("pointerleave",x)}}},[d,u,p,h]),c.useEffect(()=>{if(i){const g=x=>{const v=x.target,w={x:x.clientX,y:x.clientY},y=d?.contains(v)||u?.contains(v),b=!Sw(w,i);y?h():b&&(h(),f())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[d,u,i,f,h]),t.jsx(su,{...e,ref:o})}),[vw,yw]=fn(gn,{isInside:!1}),su=c.forwardRef((e,s)=>{const{__scopeTooltip:r,children:a,"aria-label":n,onEscapeKeyDown:o,onPointerDownOutside:i,...l}=e,d=xn(ur,r),f=pn(r),{onClose:u}=d;return c.useEffect(()=>(document.addEventListener(ko,u),()=>document.removeEventListener(ko,u)),[u]),c.useEffect(()=>{if(d.trigger){const m=h=>{h.target?.contains(d.trigger)&&u()};return window.addEventListener("scroll",m,{capture:!0}),()=>window.removeEventListener("scroll",m,{capture:!0})}},[d.trigger,u]),t.jsx(li,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:m=>m.preventDefault(),onDismiss:u,children:t.jsxs(Mi,{"data-state":d.stateAttribute,...f,...l,ref:s,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[t.jsx(Jc,{children:a}),t.jsx(vw,{scope:r,isInside:!0,children:t.jsx(Gp,{id:d.contentId,role:"tooltip",children:n||a})})]})})});tu.displayName=ur;var ru="TooltipArrow",ww=c.forwardRef((e,s)=>{const{__scopeTooltip:r,...a}=e,n=pn(r);return yw(ru,r).isInside?null:t.jsx(Pi,{...n,...a,ref:s})});ww.displayName=ru;function bw(e,s){const r=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),n=Math.abs(s.right-e.x),o=Math.abs(s.left-e.x);switch(Math.min(r,a,n,o)){case o:return"left";case n:return"right";case r:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function jw(e,s,r=5){const a=[];switch(s){case"top":a.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":a.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":a.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":a.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return a}function Nw(e){const{top:s,right:r,bottom:a,left:n}=e;return[{x:n,y:s},{x:r,y:s},{x:r,y:a},{x:n,y:a}]}function Sw(e,s){const{x:r,y:a}=e;let n=!1;for(let o=0,i=s.length-1;o<s.length;i=o++){const l=s[o].x,d=s[o].y,f=s[i].x,u=s[i].y;d>a!=u>a&&r<(f-l)*(a-d)/(u-d)+l&&(n=!n)}return n}function _w(e){const s=e.slice();return s.sort((r,a)=>r.x<a.x?-1:r.x>a.x?1:r.y<a.y?-1:r.y>a.y?1:0),Cw(s)}function Cw(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const n=e[a];for(;s.length>=2;){const o=s[s.length-1],i=s[s.length-2];if((o.x-i.x)*(n.y-i.y)>=(o.y-i.y)*(n.x-i.x))s.pop();else break}s.push(n)}s.pop();const r=[];for(let a=e.length-1;a>=0;a--){const n=e[a];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(n.y-i.y)>=(o.y-i.y)*(n.x-i.x))r.pop();else break}r.push(n)}return r.pop(),s.length===1&&r.length===1&&s[0].x===r[0].x&&s[0].y===r[0].y?s:s.concat(r)}var kw=Jd,Ew=Zd,Tw=eu,au=tu;const Hs=kw,De=Ew,Ae=Tw,Me=c.forwardRef(({className:e,sideOffset:s=4,...r},a)=>t.jsx(au,{ref:a,sideOffset:s,className:Z("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));Me.displayName=au.displayName;var jr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Ls=typeof window>"u"||"Deno"in globalThis;function dt(){}function Mw(e,s){return typeof e=="function"?e(s):e}function To(e){return typeof e=="number"&&e>=0&&e!==1/0}function nu(e,s){return Math.max(e+(s||0)-Date.now(),0)}function ys(e,s){return typeof e=="function"?e(s):e}function Pt(e,s){return typeof e=="function"?e(s):e}function Ql(e,s){const{type:r="all",exact:a,fetchStatus:n,predicate:o,queryKey:i,stale:l}=e;if(i){if(a){if(s.queryHash!==Ai(i,s.options))return!1}else if(!Qr(s.queryKey,i))return!1}if(r!=="all"){const d=s.isActive();if(r==="active"&&!d||r==="inactive"&&d)return!1}return!(typeof l=="boolean"&&s.isStale()!==l||n&&n!==s.state.fetchStatus||o&&!o(s))}function Kl(e,s){const{exact:r,status:a,predicate:n,mutationKey:o}=e;if(o){if(!s.options.mutationKey)return!1;if(r){if($s(s.options.mutationKey)!==$s(o))return!1}else if(!Qr(s.options.mutationKey,o))return!1}return!(a&&s.state.status!==a||n&&!n(s))}function Ai(e,s){return(s?.queryKeyHashFn||$s)(e)}function $s(e){return JSON.stringify(e,(s,r)=>Mo(r)?Object.keys(r).sort().reduce((a,n)=>(a[n]=r[n],a),{}):r)}function Qr(e,s){return e===s?!0:typeof e!=typeof s?!1:e&&s&&typeof e=="object"&&typeof s=="object"?Object.keys(s).every(r=>Qr(e[r],s[r])):!1}function ou(e,s){if(e===s)return e;const r=Yl(e)&&Yl(s);if(r||Mo(e)&&Mo(s)){const a=r?e:Object.keys(e),n=a.length,o=r?s:Object.keys(s),i=o.length,l=r?[]:{},d=new Set(a);let f=0;for(let u=0;u<i;u++){const m=r?u:o[u];(!r&&d.has(m)||r)&&e[m]===void 0&&s[m]===void 0?(l[m]=void 0,f++):(l[m]=ou(e[m],s[m]),l[m]===e[m]&&e[m]!==void 0&&f++)}return n===i&&f===n?e:l}return s}function La(e,s){if(!s||Object.keys(e).length!==Object.keys(s).length)return!1;for(const r in e)if(e[r]!==s[r])return!1;return!0}function Yl(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Mo(e){if(!Xl(e))return!1;const s=e.constructor;if(s===void 0)return!0;const r=s.prototype;return!(!Xl(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function Xl(e){return Object.prototype.toString.call(e)==="[object Object]"}function Pw(e){return new Promise(s=>{setTimeout(s,e)})}function Po(e,s,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,s):r.structuralSharing!==!1?ou(e,s):s}function Dw(e,s,r=0){const a=[...e,s];return r&&a.length>r?a.slice(1):a}function Aw(e,s,r=0){const a=[s,...e];return r&&a.length>r?a.slice(0,-1):a}var Ri=Symbol();function iu(e,s){return!e.queryFn&&s?.initialPromise?()=>s.initialPromise:!e.queryFn||e.queryFn===Ri?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function lu(e,s){return typeof e=="function"?e(...s):!!e}var Rw=class extends jr{#t;#e;#s;constructor(){super(),this.#s=e=>{if(!Ls&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(e){this.#s=e,this.#e?.(),this.#e=e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()})}setFocused(e){this.#t!==e&&(this.#t=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){return typeof this.#t=="boolean"?this.#t:globalThis.document?.visibilityState!=="hidden"}},Ii=new Rw,Iw=class extends jr{#t=!0;#e;#s;constructor(){super(),this.#s=e=>{if(!Ls&&window.addEventListener){const s=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(e){this.#s=e,this.#e?.(),this.#e=e(this.setOnline.bind(this))}setOnline(e){this.#t!==e&&(this.#t=e,this.listeners.forEach(r=>{r(e)}))}isOnline(){return this.#t}},$a=new Iw;function Do(){let e,s;const r=new Promise((n,o)=>{e=n,s=o});r.status="pending",r.catch(()=>{});function a(n){Object.assign(r,n),delete r.resolve,delete r.reject}return r.resolve=n=>{a({status:"fulfilled",value:n}),e(n)},r.reject=n=>{a({status:"rejected",reason:n}),s(n)},r}function Fw(e){let s;if(e.then(r=>(s=r,r),dt)?.catch(dt),s!==void 0)return{data:s}}function Ow(e){return Math.min(1e3*2**e,3e4)}function cu(e){return(e??"online")==="online"?$a.isOnline():!0}var du=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function Yn(e){return e instanceof du}function uu(e){let s=!1,r=0,a=!1,n;const o=Do(),i=x=>{a||(h(new du(x)),e.abort?.())},l=()=>{s=!0},d=()=>{s=!1},f=()=>Ii.isFocused()&&(e.networkMode==="always"||$a.isOnline())&&e.canRun(),u=()=>cu(e.networkMode)&&e.canRun(),m=x=>{a||(a=!0,e.onSuccess?.(x),n?.(),o.resolve(x))},h=x=>{a||(a=!0,e.onError?.(x),n?.(),o.reject(x))},p=()=>new Promise(x=>{n=v=>{(a||f())&&x(v)},e.onPause?.()}).then(()=>{n=void 0,a||e.onContinue?.()}),g=()=>{if(a)return;let x;const v=r===0?e.initialPromise:void 0;try{x=v??e.fn()}catch(w){x=Promise.reject(w)}Promise.resolve(x).then(m).catch(w=>{if(a)return;const y=e.retry??(Ls?0:3),b=e.retryDelay??Ow,j=typeof b=="function"?b(r,w):b,N=y===!0||typeof y=="number"&&r<y||typeof y=="function"&&y(r,w);if(s||!N){h(w);return}r++,e.onFail?.(r,w),Pw(j).then(()=>f()?void 0:p()).then(()=>{s?h(w):g()})})};return{promise:o,cancel:i,continue:()=>(n?.(),o),cancelRetry:l,continueRetry:d,canStart:u,start:()=>(u()?g():p().then(g),o)}}var Lw=e=>setTimeout(e,0);function $w(){let e=[],s=0,r=l=>{l()},a=l=>{l()},n=Lw;const o=l=>{s?e.push(l):n(()=>{r(l)})},i=()=>{const l=e;e=[],l.length&&n(()=>{a(()=>{l.forEach(d=>{r(d)})})})};return{batch:l=>{let d;s++;try{d=l()}finally{s--,s||i()}return d},batchCalls:l=>(...d)=>{o(()=>{l(...d)})},schedule:o,setNotifyFunction:l=>{r=l},setBatchNotifyFunction:l=>{a=l},setScheduler:l=>{n=l}}}var Ze=$w(),mu=class{#t;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),To(this.gcTime)&&(this.#t=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Ls?1/0:5*60*1e3))}clearGcTimeout(){this.#t&&(clearTimeout(this.#t),this.#t=void 0)}},Uw=class extends mu{#t;#e;#s;#r;#a;#o;#i;constructor(e){super(),this.#i=!1,this.#o=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#r=e.client,this.#s=this.#r.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#t=zw(this.options),this.state=e.state??this.#t,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#a?.promise}setOptions(e){this.options={...this.#o,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(e,s){const r=Po(this.state.data,e,this.options);return this.#n({data:r,type:"success",dataUpdatedAt:s?.updatedAt,manual:s?.manual}),r}setState(e,s){this.#n({type:"setState",state:e,setStateOptions:s})}cancel(e){const s=this.#a?.promise;return this.#a?.cancel(e),s?s.then(dt).catch(dt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#t)}isActive(){return this.observers.some(e=>Pt(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ri||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>ys(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!nu(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(s=>s.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#a?.continue()}onOnline(){this.observers.find(s=>s.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#a?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(s=>s!==e),this.observers.length||(this.#a&&(this.#i?this.#a.cancel({revert:!0}):this.#a.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#n({type:"invalidate"})}fetch(e,s){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&s?.cancelRefetch)this.cancel({silent:!0});else if(this.#a)return this.#a.continueRetry(),this.#a.promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,a=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(this.#i=!0,r.signal)})},n=()=>{const d=iu(this.options,s),u=(()=>{const m={client:this.#r,queryKey:this.queryKey,meta:this.meta};return a(m),m})();return this.#i=!1,this.options.persister?this.options.persister(d,u,this):d(u)},i=(()=>{const d={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:n};return a(d),d})();this.options.behavior?.onFetch(i,this),this.#e=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==i.fetchOptions?.meta)&&this.#n({type:"fetch",meta:i.fetchOptions?.meta});const l=d=>{Yn(d)&&d.silent||this.#n({type:"error",error:d}),Yn(d)||(this.#s.config.onError?.(d,this),this.#s.config.onSettled?.(this.state.data,d,this)),this.scheduleGc()};return this.#a=uu({initialPromise:s?.initialPromise,fn:i.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{if(d===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(f){l(f);return}this.#s.config.onSuccess?.(d,this),this.#s.config.onSettled?.(d,this.state.error,this),this.scheduleGc()},onError:l,onFail:(d,f)=>{this.#n({type:"failed",failureCount:d,error:f})},onPause:()=>{this.#n({type:"pause"})},onContinue:()=>{this.#n({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0}),this.#a.start()}#n(e){const s=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...hu(r.data,this.options),fetchMeta:e.meta??null};case"success":return this.#e=void 0,{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return Yn(a)&&a.revert&&this.#e?{...this.#e,fetchStatus:"idle"}:{...r,error:a,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=s(this.state),Ze.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:e})})}};function hu(e,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:cu(s.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function zw(e){const s=typeof e.initialData=="function"?e.initialData():e.initialData,r=s!==void 0,a=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:r?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var fu=class extends jr{constructor(e={}){super(),this.config=e,this.#t=new Map}#t;build(e,s,r){const a=s.queryKey,n=s.queryHash??Ai(a,s);let o=this.get(n);return o||(o=new Uw({client:e,queryKey:a,queryHash:n,options:e.defaultQueryOptions(s),state:r,defaultOptions:e.getQueryDefaults(a)}),this.add(o)),o}add(e){this.#t.has(e.queryHash)||(this.#t.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=this.#t.get(e.queryHash);s&&(e.destroy(),s===e&&this.#t.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ze.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#t.get(e)}getAll(){return[...this.#t.values()]}find(e){const s={exact:!0,...e};return this.getAll().find(r=>Ql(s,r))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter(r=>Ql(e,r)):s}notify(e){Ze.batch(()=>{this.listeners.forEach(s=>{s(e)})})}onFocus(){Ze.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ze.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},qw=class extends mu{#t;#e;#s;constructor(e){super(),this.mutationId=e.mutationId,this.#e=e.mutationCache,this.#t=[],this.state=e.state||pu(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(s=>s!==e),this.scheduleGc(),this.#e.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#e.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const s=()=>{this.#r({type:"continue"})};this.#s=uu({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(n,o)=>{this.#r({type:"failed",failureCount:n,error:o})},onPause:()=>{this.#r({type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#e.canRun(this)});const r=this.state.status==="pending",a=!this.#s.canStart();try{if(r)s();else{this.#r({type:"pending",variables:e,isPaused:a}),await this.#e.config.onMutate?.(e,this);const o=await this.options.onMutate?.(e);o!==this.state.context&&this.#r({type:"pending",context:o,variables:e,isPaused:a})}const n=await this.#s.start();return await this.#e.config.onSuccess?.(n,e,this.state.context,this),await this.options.onSuccess?.(n,e,this.state.context),await this.#e.config.onSettled?.(n,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(n,null,e,this.state.context),this.#r({type:"success",data:n}),n}catch(n){try{throw await this.#e.config.onError?.(n,e,this.state.context,this),await this.options.onError?.(n,e,this.state.context),await this.#e.config.onSettled?.(void 0,n,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,n,e,this.state.context),n}finally{this.#r({type:"error",error:n})}}finally{this.#e.runNext(this)}}#r(e){const s=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=s(this.state),Ze.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#e.notify({mutation:this,type:"updated",action:e})})}};function pu(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var gu=class extends jr{constructor(e={}){super(),this.config=e,this.#t=new Set,this.#e=new Map,this.#s=0}#t;#e;#s;build(e,s,r){const a=new qw({mutationCache:this,mutationId:++this.#s,options:e.defaultMutationOptions(s),state:r});return this.add(a),a}add(e){this.#t.add(e);const s=ba(e);if(typeof s=="string"){const r=this.#e.get(s);r?r.push(e):this.#e.set(s,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#t.delete(e)){const s=ba(e);if(typeof s=="string"){const r=this.#e.get(s);if(r)if(r.length>1){const a=r.indexOf(e);a!==-1&&r.splice(a,1)}else r[0]===e&&this.#e.delete(s)}}this.notify({type:"removed",mutation:e})}canRun(e){const s=ba(e);if(typeof s=="string"){const a=this.#e.get(s)?.find(n=>n.state.status==="pending");return!a||a===e}else return!0}runNext(e){const s=ba(e);return typeof s=="string"?this.#e.get(s)?.find(a=>a!==e&&a.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ze.batch(()=>{this.#t.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#t.clear(),this.#e.clear()})}getAll(){return Array.from(this.#t)}find(e){const s={exact:!0,...e};return this.getAll().find(r=>Kl(s,r))}findAll(e={}){return this.getAll().filter(s=>Kl(e,s))}notify(e){Ze.batch(()=>{this.listeners.forEach(s=>{s(e)})})}resumePausedMutations(){const e=this.getAll().filter(s=>s.state.isPaused);return Ze.batch(()=>Promise.all(e.map(s=>s.continue().catch(dt))))}};function ba(e){return e.options.scope?.id}function Jl(e){return{onFetch:(s,r)=>{const a=s.options,n=s.fetchOptions?.meta?.fetchMore?.direction,o=s.state.data?.pages||[],i=s.state.data?.pageParams||[];let l={pages:[],pageParams:[]},d=0;const f=async()=>{let u=!1;const m=g=>{Object.defineProperty(g,"signal",{enumerable:!0,get:()=>(s.signal.aborted?u=!0:s.signal.addEventListener("abort",()=>{u=!0}),s.signal)})},h=iu(s.options,s.fetchOptions),p=async(g,x,v)=>{if(u)return Promise.reject();if(x==null&&g.pages.length)return Promise.resolve(g);const y=(()=>{const E={client:s.client,queryKey:s.queryKey,pageParam:x,direction:v?"backward":"forward",meta:s.options.meta};return m(E),E})(),b=await h(y),{maxPages:j}=s.options,N=v?Aw:Dw;return{pages:N(g.pages,b,j),pageParams:N(g.pageParams,x,j)}};if(n&&o.length){const g=n==="backward",x=g?Ww:Zl,v={pages:o,pageParams:i},w=x(a,v);l=await p(v,w,g)}else{const g=e??o.length;do{const x=d===0?i[0]??a.initialPageParam:Zl(a,l);if(d>0&&x==null)break;l=await p(l,x),d++}while(d<g)}return l};s.options.persister?s.fetchFn=()=>s.options.persister?.(f,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},r):s.fetchFn=f}}}function Zl(e,{pages:s,pageParams:r}){const a=s.length-1;return s.length>0?e.getNextPageParam(s[a],s,r[a],r):void 0}function Ww(e,{pages:s,pageParams:r}){return s.length>0?e.getPreviousPageParam?.(s[0],s,r[0],r):void 0}var Bw=class{#t;#e;#s;#r;#a;#o;#i;#n;constructor(e={}){this.#t=e.queryCache||new fu,this.#e=e.mutationCache||new gu,this.#s=e.defaultOptions||{},this.#r=new Map,this.#a=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#i=Ii.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#t.onFocus())}),this.#n=$a.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#t.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#i?.(),this.#i=void 0,this.#n?.(),this.#n=void 0)}isFetching(e){return this.#t.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#e.findAll({...e,status:"pending"}).length}getQueryData(e){const s=this.defaultQueryOptions({queryKey:e});return this.#t.get(s.queryHash)?.state.data}ensureQueryData(e){const s=this.defaultQueryOptions(e),r=this.#t.build(this,s),a=r.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(ys(s.staleTime,r))&&this.prefetchQuery(s),Promise.resolve(a))}getQueriesData(e){return this.#t.findAll(e).map(({queryKey:s,state:r})=>{const a=r.data;return[s,a]})}setQueryData(e,s,r){const a=this.defaultQueryOptions({queryKey:e}),o=this.#t.get(a.queryHash)?.state.data,i=Mw(s,o);if(i!==void 0)return this.#t.build(this,a).setData(i,{...r,manual:!0})}setQueriesData(e,s,r){return Ze.batch(()=>this.#t.findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,s,r)]))}getQueryState(e){const s=this.defaultQueryOptions({queryKey:e});return this.#t.get(s.queryHash)?.state}removeQueries(e){const s=this.#t;Ze.batch(()=>{s.findAll(e).forEach(r=>{s.remove(r)})})}resetQueries(e,s){const r=this.#t;return Ze.batch(()=>(r.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},s)))}cancelQueries(e,s={}){const r={revert:!0,...s},a=Ze.batch(()=>this.#t.findAll(e).map(n=>n.cancel(r)));return Promise.all(a).then(dt).catch(dt)}invalidateQueries(e,s={}){return Ze.batch(()=>(this.#t.findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},s)))}refetchQueries(e,s={}){const r={...s,cancelRefetch:s.cancelRefetch??!0},a=Ze.batch(()=>this.#t.findAll(e).filter(n=>!n.isDisabled()&&!n.isStatic()).map(n=>{let o=n.fetch(void 0,r);return r.throwOnError||(o=o.catch(dt)),n.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(a).then(dt)}fetchQuery(e){const s=this.defaultQueryOptions(e);s.retry===void 0&&(s.retry=!1);const r=this.#t.build(this,s);return r.isStaleByTime(ys(s.staleTime,r))?r.fetch(s):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(dt).catch(dt)}fetchInfiniteQuery(e){return e.behavior=Jl(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(dt).catch(dt)}ensureInfiniteQueryData(e){return e.behavior=Jl(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return $a.isOnline()?this.#e.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#t}getMutationCache(){return this.#e}getDefaultOptions(){return this.#s}setDefaultOptions(e){this.#s=e}setQueryDefaults(e,s){this.#r.set($s(e),{queryKey:e,defaultOptions:s})}getQueryDefaults(e){const s=[...this.#r.values()],r={};return s.forEach(a=>{Qr(e,a.queryKey)&&Object.assign(r,a.defaultOptions)}),r}setMutationDefaults(e,s){this.#a.set($s(e),{mutationKey:e,defaultOptions:s})}getMutationDefaults(e){const s=[...this.#a.values()],r={};return s.forEach(a=>{Qr(e,a.mutationKey)&&Object.assign(r,a.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const s={...this.#s.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return s.queryHash||(s.queryHash=Ai(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===Ri&&(s.enabled=!1),s}defaultMutationOptions(e){return e?._defaulted?e:{...this.#s.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#t.clear(),this.#e.clear()}},Gw=class extends jr{constructor(e,s){super(),this.options=s,this.#t=e,this.#n=null,this.#i=Do(),this.options.experimental_prefetchInRender||this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}#t;#e=void 0;#s=void 0;#r=void 0;#a;#o;#i;#n;#p;#m;#h;#c;#d;#l;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),ec(this.#e,this.options)?this.#u():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ao(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ao(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#b(),this.#e.removeObserver(this)}setOptions(e){const s=this.options,r=this.#e;if(this.options=this.#t.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Pt(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#e.setOptions(this.options),s._defaulted&&!La(this.options,s)&&this.#t.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const a=this.hasListeners();a&&tc(this.#e,r,this.options,s)&&this.#u(),this.updateResult(),a&&(this.#e!==r||Pt(this.options.enabled,this.#e)!==Pt(s.enabled,this.#e)||ys(this.options.staleTime,this.#e)!==ys(s.staleTime,this.#e))&&this.#g();const n=this.#x();a&&(this.#e!==r||Pt(this.options.enabled,this.#e)!==Pt(s.enabled,this.#e)||n!==this.#l)&&this.#v(n)}getOptimisticResult(e){const s=this.#t.getQueryCache().build(this.#t,e),r=this.createResult(s,e);return Hw(this,r)&&(this.#r=r,this.#o=this.options,this.#a=this.#e.state),r}getCurrentResult(){return this.#r}trackResult(e,s){return new Proxy(e,{get:(r,a)=>(this.trackProp(a),s?.(a),Reflect.get(r,a))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=this.#t.defaultQueryOptions(e),r=this.#t.getQueryCache().build(this.#t,s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#u(e){this.#j();let s=this.#e.fetch(this.options,e);return e?.throwOnError||(s=s.catch(dt)),s}#g(){this.#w();const e=ys(this.options.staleTime,this.#e);if(Ls||this.#r.isStale||!To(e))return;const r=nu(this.#r.dataUpdatedAt,e)+1;this.#c=setTimeout(()=>{this.#r.isStale||this.updateResult()},r)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#v(e){this.#b(),this.#l=e,!(Ls||Pt(this.options.enabled,this.#e)===!1||!To(this.#l)||this.#l===0)&&(this.#d=setInterval(()=>{(this.options.refetchIntervalInBackground||Ii.isFocused())&&this.#u()},this.#l))}#y(){this.#g(),this.#v(this.#x())}#w(){this.#c&&(clearTimeout(this.#c),this.#c=void 0)}#b(){this.#d&&(clearInterval(this.#d),this.#d=void 0)}createResult(e,s){const r=this.#e,a=this.options,n=this.#r,o=this.#a,i=this.#o,d=e!==r?e.state:this.#s,{state:f}=e;let u={...f},m=!1,h;if(s._optimisticResults){const _=this.hasListeners(),C=!_&&ec(e,s),k=_&&tc(e,r,s,a);(C||k)&&(u={...u,...hu(f.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:p,errorUpdatedAt:g,status:x}=u;h=u.data;let v=!1;if(s.placeholderData!==void 0&&h===void 0&&x==="pending"){let _;n?.isPlaceholderData&&s.placeholderData===i?.placeholderData?(_=n.data,v=!0):_=typeof s.placeholderData=="function"?s.placeholderData(this.#h?.state.data,this.#h):s.placeholderData,_!==void 0&&(x="success",h=Po(n?.data,_,s),m=!0)}if(s.select&&h!==void 0&&!v)if(n&&h===o?.data&&s.select===this.#p)h=this.#m;else try{this.#p=s.select,h=s.select(h),h=Po(n?.data,h,s),this.#m=h,this.#n=null}catch(_){this.#n=_}this.#n&&(p=this.#n,h=this.#m,g=Date.now(),x="error");const w=u.fetchStatus==="fetching",y=x==="pending",b=x==="error",j=y&&w,N=h!==void 0,S={status:x,fetchStatus:u.fetchStatus,isPending:y,isSuccess:x==="success",isError:b,isInitialLoading:j,isLoading:j,data:h,dataUpdatedAt:u.dataUpdatedAt,error:p,errorUpdatedAt:g,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>d.dataUpdateCount||u.errorUpdateCount>d.errorUpdateCount,isFetching:w,isRefetching:w&&!y,isLoadingError:b&&!N,isPaused:u.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:b&&N,isStale:Fi(e,s),refetch:this.refetch,promise:this.#i,isEnabled:Pt(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const _=T=>{S.status==="error"?T.reject(S.error):S.data!==void 0&&T.resolve(S.data)},C=()=>{const T=this.#i=S.promise=Do();_(T)},k=this.#i;switch(k.status){case"pending":e.queryHash===r.queryHash&&_(k);break;case"fulfilled":(S.status==="error"||S.data!==k.value)&&C();break;case"rejected":(S.status!=="error"||S.error!==k.reason)&&C();break}}return S}updateResult(){const e=this.#r,s=this.createResult(this.#e,this.options);if(this.#a=this.#e.state,this.#o=this.options,this.#a.data!==void 0&&(this.#h=this.#e),La(s,e))return;this.#r=s;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:a}=this.options,n=typeof a=="function"?a():a;if(n==="all"||!n&&!this.#f.size)return!0;const o=new Set(n??this.#f);return this.options.throwOnError&&o.add("error"),Object.keys(this.#r).some(i=>{const l=i;return this.#r[l]!==e[l]&&o.has(l)})};this.#N({listeners:r()})}#j(){const e=this.#t.getQueryCache().build(this.#t,this.options);if(e===this.#e)return;const s=this.#e;this.#e=e,this.#s=e.state,this.hasListeners()&&(s?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#N(e){Ze.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(this.#r)}),this.#t.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function Vw(e,s){return Pt(s.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&s.retryOnMount===!1)}function ec(e,s){return Vw(e,s)||e.state.data!==void 0&&Ao(e,s,s.refetchOnMount)}function Ao(e,s,r){if(Pt(s.enabled,e)!==!1&&ys(s.staleTime,e)!=="static"){const a=typeof r=="function"?r(e):r;return a==="always"||a!==!1&&Fi(e,s)}return!1}function tc(e,s,r,a){return(e!==s||Pt(a.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&Fi(e,r)}function Fi(e,s){return Pt(s.enabled,e)!==!1&&e.isStaleByTime(ys(s.staleTime,e))}function Hw(e,s){return!La(e.getCurrentResult(),s)}var Qw=class extends jr{#t;#e=void 0;#s;#r;constructor(s,r){super(),this.#t=s,this.setOptions(r),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const r=this.options;this.options=this.#t.defaultMutationOptions(s),La(this.options,r)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),r?.mutationKey&&this.options.mutationKey&&$s(r.mutationKey)!==$s(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(s){this.#a(),this.#o(s)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#o()}mutate(s,r){return this.#r=r,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(s)}#a(){const s=this.#s?.state??pu();this.#e={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#o(s){Ze.batch(()=>{if(this.#r&&this.hasListeners()){const r=this.#e.variables,a=this.#e.context;s?.type==="success"?(this.#r.onSuccess?.(s.data,r,a),this.#r.onSettled?.(s.data,null,r,a)):s?.type==="error"&&(this.#r.onError?.(s.error,r,a),this.#r.onSettled?.(void 0,s.error,r,a))}this.listeners.forEach(r=>{r(this.#e)})})}};function xu(e){return e}function Kw(e){return{mutationKey:e.options.mutationKey,state:e.state,...e.options.scope&&{scope:e.options.scope},...e.meta&&{meta:e.meta}}}function Yw(e,s,r){return{dehydratedAt:Date.now(),state:{...e.state,...e.state.data!==void 0&&{data:s(e.state.data)}},queryKey:e.queryKey,queryHash:e.queryHash,...e.state.status==="pending"&&{promise:e.promise?.then(s).catch(a=>r(a)?Promise.reject(new Error("redacted")):Promise.reject(a))},...e.meta&&{meta:e.meta}}}function Xw(e){return e.state.isPaused}function Jw(e){return e.state.status==="success"}function Zw(e){return!0}function eb(e,s={}){const r=s.shouldDehydrateMutation??e.getDefaultOptions().dehydrate?.shouldDehydrateMutation??Xw,a=e.getMutationCache().getAll().flatMap(d=>r(d)?[Kw(d)]:[]),n=s.shouldDehydrateQuery??e.getDefaultOptions().dehydrate?.shouldDehydrateQuery??Jw,o=s.shouldRedactErrors??e.getDefaultOptions().dehydrate?.shouldRedactErrors??Zw,i=s.serializeData??e.getDefaultOptions().dehydrate?.serializeData??xu,l=e.getQueryCache().getAll().flatMap(d=>n(d)?[Yw(d,i,o)]:[]);return{mutations:a,queries:l}}function tb(e,s,r){if(typeof s!="object"||s===null)return;const a=e.getMutationCache(),n=e.getQueryCache(),o=r?.defaultOptions?.deserializeData??e.getDefaultOptions().hydrate?.deserializeData??xu,i=s.mutations||[],l=s.queries||[];i.forEach(({state:d,...f})=>{a.build(e,{...e.getDefaultOptions().hydrate?.mutations,...r?.defaultOptions?.mutations,...f},d)}),l.forEach(({queryKey:d,state:f,queryHash:u,meta:m,promise:h,dehydratedAt:p})=>{const g=h?Fw(h):void 0,x=f.data===void 0?g?.data:f.data,v=x===void 0?x:o(x);let w=n.get(u);const y=w?.state.status==="pending",b=w?.state.fetchStatus==="fetching";if(w){const j=g&&p!==void 0&&p>w.state.dataUpdatedAt;if(f.dataUpdatedAt>w.state.dataUpdatedAt||j){const{fetchStatus:N,...E}=f;w.setState({...E,data:v})}}else w=n.build(e,{...e.getDefaultOptions().hydrate?.queries,...r?.defaultOptions?.queries,queryKey:d,queryHash:u,meta:m},{...f,data:v,fetchStatus:"idle",status:v!==void 0?"success":f.status});h&&!y&&!b&&(p===void 0||p>w.state.dataUpdatedAt)&&w.fetch(void 0,{initialPromise:Promise.resolve(h).then(o)})})}var vu=c.createContext(void 0),Ct=e=>{const s=c.useContext(vu);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},sb=({client:e,children:s})=>(c.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),t.jsx(vu.Provider,{value:e,children:s})),yu=c.createContext(!1),rb=()=>c.useContext(yu);yu.Provider;function ab(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var nb=c.createContext(ab()),ob=()=>c.useContext(nb),ib=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},lb=e=>{c.useEffect(()=>{e.clearReset()},[e])},cb=({result:e,errorResetBoundary:s,throwOnError:r,query:a,suspense:n})=>e.isError&&!s.isReset()&&!e.isFetching&&a&&(n&&e.data===void 0||lu(r,[e.error,a])),db=e=>{if(e.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>s(r(...a)):s(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},ub=(e,s)=>e.isLoading&&e.isFetching&&!s,mb=(e,s)=>e?.suspense&&s.isPending,sc=(e,s,r)=>s.fetchOptimistic(e).catch(()=>{r.clearReset()});function hb(e,s,r){const a=rb(),n=ob(),o=Ct(),i=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(i),i._optimisticResults=a?"isRestoring":"optimistic",db(i),ib(i,n),lb(n);const l=!o.getQueryCache().get(i.queryHash),[d]=c.useState(()=>new s(o,i)),f=d.getOptimisticResult(i),u=!a&&e.subscribed!==!1;if(c.useSyncExternalStore(c.useCallback(m=>{const h=u?d.subscribe(Ze.batchCalls(m)):dt;return d.updateResult(),h},[d,u]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),c.useEffect(()=>{d.setOptions(i)},[i,d]),mb(i,f))throw sc(i,d,n);if(cb({result:f,errorResetBoundary:n,throwOnError:i.throwOnError,query:o.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(i,f),i.experimental_prefetchInRender&&!Ls&&ub(f,a)&&(l?sc(i,d,n):o.getQueryCache().get(i.queryHash)?.promise)?.catch(dt).finally(()=>{d.updateResult()}),i.notifyOnChangeProps?f:d.trackResult(f)}function bt(e,s){return hb(e,Gw)}function yt(e,s){const r=Ct(),[a]=c.useState(()=>new Qw(r,e));c.useEffect(()=>{a.setOptions(e)},[a,e]);const n=c.useSyncExternalStore(c.useCallback(i=>a.subscribe(Ze.batchCalls(i)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),o=c.useCallback((i,l)=>{a.mutate(i,l).catch(dt)},[a]);if(n.error&&lu(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}const Rs=new Bw({queryCache:new fu({onError:(e,s)=>{console.error("Query error:",e,"Query key:",s.queryKey),(e?.message?.includes("Missing queryFn")||e?.message?.includes("auth")||e?.message?.includes("token"))&&(console.warn("âš ï¸ Auth-related query error detected, invalidating query:",s.queryKey),s.cancel())}}),mutationCache:new gu({onError:(e,s,r,a)=>{console.error("Mutation error:",e,"Variables:",s)}}),defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:"always",refetchOnMount:!0,retry:(e,s)=>s?.status>=400&&s?.status<500?!1:e<3,retryDelay:e=>Math.min(1e3*2**e,3e4),networkMode:"offlineFirst"},mutations:{retry:1,networkMode:"online"}}});var fb=["added","removed","updated"];function rc(e){return fb.includes(e)}async function pb({queryClient:e,persister:s,maxAge:r=1e3*60*60*24,buster:a="",hydrateOptions:n}){try{const o=await s.restoreClient();if(o)if(o.timestamp){const i=Date.now()-o.timestamp>r,l=o.buster!==a;if(i||l)return s.removeClient();tb(e,o.clientState,n)}else return s.removeClient()}catch(o){throw await s.removeClient(),o}}async function ac({queryClient:e,persister:s,buster:r="",dehydrateOptions:a}){const n={buster:r,timestamp:Date.now(),clientState:eb(e,a)};await s.persistClient(n)}function gb(e){const s=e.queryClient.getQueryCache().subscribe(a=>{rc(a.type)&&ac(e)}),r=e.queryClient.getMutationCache().subscribe(a=>{rc(a.type)&&ac(e)});return()=>{s(),r()}}function xb(e){let s=!1,r;const a=()=>{s=!0,r?.()},n=pb(e).then(()=>{s||(r=gb(e))});return[a,n]}function Xn(){}function vb({storage:e,key:s="REACT_QUERY_OFFLINE_CACHE",throttleTime:r=1e3,serialize:a=JSON.stringify,deserialize:n=JSON.parse,retry:o}){if(e){const i=l=>{try{e.setItem(s,a(l));return}catch(d){return d}};return{persistClient:yb(l=>{let d=l,f=i(d),u=0;for(;f&&d;)u++,d=o?.({persistedClient:d,error:f,errorCount:u}),d&&(f=i(d))},r),restoreClient:()=>{const l=e.getItem(s);if(l)return n(l)},removeClient:()=>{e.removeItem(s)}}}return{persistClient:Xn,restoreClient:Xn,removeClient:Xn}}function yb(e,s=100){let r=null,a;return function(...n){a=n,r===null&&(r=setTimeout(()=>{e(...a),r=null},s))}}/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kr(){return Kr=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Kr.apply(this,arguments)}var Rt;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Rt||(Rt={}));const nc="popstate";function wb(e){e===void 0&&(e={});let{initialEntries:s=["/"],initialIndex:r,v5Compat:a=!1}=e,n;n=s.map((p,g)=>u(p,typeof p=="string"?null:p.state,g===0?"default":void 0));let o=d(r??n.length-1),i=Rt.Pop,l=null;function d(p){return Math.min(Math.max(p,0),n.length-1)}function f(){return n[o]}function u(p,g,x){g===void 0&&(g=null);let v=Ua(n?f().pathname:"/",p,g,x);return Oi(v.pathname.charAt(0)==="/","relative pathnames are not supported in memory history: "+JSON.stringify(p)),v}function m(p){return typeof p=="string"?p:Yr(p)}return{get index(){return o},get action(){return i},get location(){return f()},createHref:m,createURL(p){return new URL(m(p),"http://localhost")},encodeLocation(p){let g=typeof p=="string"?Qs(p):p;return{pathname:g.pathname||"",search:g.search||"",hash:g.hash||""}},push(p,g){i=Rt.Push;let x=u(p,g);o+=1,n.splice(o,n.length,x),a&&l&&l({action:i,location:x,delta:1})},replace(p,g){i=Rt.Replace;let x=u(p,g);n[o]=x,a&&l&&l({action:i,location:x,delta:0})},go(p){i=Rt.Pop;let g=d(o+p),x=n[g];o=g,l&&l({action:i,location:x,delta:p})},listen(p){return l=p,()=>{l=null}}}}function bb(e){e===void 0&&(e={});function s(a,n){let{pathname:o,search:i,hash:l}=a.location;return Ua("",{pathname:o,search:i,hash:l},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(a,n){return typeof n=="string"?n:Yr(n)}return Nb(s,r,null,e)}function Oe(e,s){if(e===!1||e===null||typeof e>"u")throw new Error(s)}function Oi(e,s){if(!e){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function jb(){return Math.random().toString(36).substr(2,8)}function oc(e,s){return{usr:e.state,key:e.key,idx:s}}function Ua(e,s,r,a){return r===void 0&&(r=null),Kr({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof s=="string"?Qs(s):s,{state:r,key:s&&s.key||a||jb()})}function Yr(e){let{pathname:s="/",search:r="",hash:a=""}=e;return r&&r!=="?"&&(s+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function Qs(e){let s={};if(e){let r=e.indexOf("#");r>=0&&(s.hash=e.substr(r),e=e.substr(0,r));let a=e.indexOf("?");a>=0&&(s.search=e.substr(a),e=e.substr(0,a)),e&&(s.pathname=e)}return s}function Nb(e,s,r,a){a===void 0&&(a={});let{window:n=document.defaultView,v5Compat:o=!1}=a,i=n.history,l=Rt.Pop,d=null,f=u();f==null&&(f=0,i.replaceState(Kr({},i.state,{idx:f}),""));function u(){return(i.state||{idx:null}).idx}function m(){l=Rt.Pop;let v=u(),w=v==null?null:v-f;f=v,d&&d({action:l,location:x.location,delta:w})}function h(v,w){l=Rt.Push;let y=Ua(x.location,v,w);f=u()+1;let b=oc(y,f),j=x.createHref(y);try{i.pushState(b,"",j)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;n.location.assign(j)}o&&d&&d({action:l,location:x.location,delta:1})}function p(v,w){l=Rt.Replace;let y=Ua(x.location,v,w);f=u();let b=oc(y,f),j=x.createHref(y);i.replaceState(b,"",j),o&&d&&d({action:l,location:x.location,delta:0})}function g(v){let w=n.location.origin!=="null"?n.location.origin:n.location.href,y=typeof v=="string"?v:Yr(v);return y=y.replace(/ $/,"%20"),Oe(w,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,w)}let x={get action(){return l},get location(){return e(n,i)},listen(v){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(nc,m),d=v,()=>{n.removeEventListener(nc,m),d=null}},createHref(v){return s(n,v)},createURL:g,encodeLocation(v){let w=g(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:h,replace:p,go(v){return i.go(v)}};return x}var ic;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ic||(ic={}));function Sb(e,s,r){return r===void 0&&(r="/"),_b(e,s,r,!1)}function _b(e,s,r,a){let n=typeof s=="string"?Qs(s):s,o=mr(n.pathname||"/",r);if(o==null)return null;let i=wu(e);Cb(i);let l=null;for(let d=0;l==null&&d<i.length;++d){let f=Ob(o);l=Ib(i[d],f,a)}return l}function wu(e,s,r,a){s===void 0&&(s=[]),r===void 0&&(r=[]),a===void 0&&(a="");let n=(o,i,l)=>{let d={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};d.relativePath.startsWith("/")&&(Oe(d.relativePath.startsWith(a),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(a.length));let f=ws([a,d.relativePath]),u=r.concat(d);o.children&&o.children.length>0&&(Oe(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),wu(o.children,s,u,f)),!(o.path==null&&!o.index)&&s.push({path:f,score:Ab(f,o.index),routesMeta:u})};return e.forEach((o,i)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))n(o,i);else for(let d of bu(o.path))n(o,i,d)}),s}function bu(e){let s=e.split("/");if(s.length===0)return[];let[r,...a]=s,n=r.endsWith("?"),o=r.replace(/\?$/,"");if(a.length===0)return n?[o,""]:[o];let i=bu(a.join("/")),l=[];return l.push(...i.map(d=>d===""?o:[o,d].join("/"))),n&&l.push(...i),l.map(d=>e.startsWith("/")&&d===""?"/":d)}function Cb(e){e.sort((s,r)=>s.score!==r.score?r.score-s.score:Rb(s.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const kb=/^:[\w-]+$/,Eb=3,Tb=2,Mb=1,Pb=10,Db=-2,lc=e=>e==="*";function Ab(e,s){let r=e.split("/"),a=r.length;return r.some(lc)&&(a+=Db),s&&(a+=Tb),r.filter(n=>!lc(n)).reduce((n,o)=>n+(kb.test(o)?Eb:o===""?Mb:Pb),a)}function Rb(e,s){return e.length===s.length&&e.slice(0,-1).every((a,n)=>a===s[n])?e[e.length-1]-s[s.length-1]:0}function Ib(e,s,r){let{routesMeta:a}=e,n={},o="/",i=[];for(let l=0;l<a.length;++l){let d=a[l],f=l===a.length-1,u=o==="/"?s:s.slice(o.length)||"/",m=za({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},u),h=d.route;if(!m&&f&&r&&!a[a.length-1].route.index&&(m=za({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},u)),!m)return null;Object.assign(n,m.params),i.push({params:n,pathname:ws([o,m.pathname]),pathnameBase:zb(ws([o,m.pathnameBase])),route:h}),m.pathnameBase!=="/"&&(o=ws([o,m.pathnameBase]))}return i}function za(e,s){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,a]=Fb(e.path,e.caseSensitive,e.end),n=s.match(r);if(!n)return null;let o=n[0],i=o.replace(/(.)\/+$/,"$1"),l=n.slice(1);return{params:a.reduce((f,u,m)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let x=l[m]||"";i=o.slice(0,o.length-x.length).replace(/(.)\/+$/,"$1")}const g=l[m];return p&&!g?f[h]=void 0:f[h]=(g||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:i,pattern:e}}function Fb(e,s,r){s===void 0&&(s=!1),r===void 0&&(r=!0),Oi(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,l,d)=>(a.push({paramName:l,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,s?void 0:"i"),a]}function Ob(e){try{return e.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Oi(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),e}}function mr(e,s){if(s==="/")return e;if(!e.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,a=e.charAt(r);return a&&a!=="/"?null:e.slice(r)||"/"}function Lb(e,s){s===void 0&&(s="/");let{pathname:r,search:a="",hash:n=""}=typeof e=="string"?Qs(e):e;return{pathname:r?r.startsWith("/")?r:$b(r,s):s,search:qb(a),hash:Wb(n)}}function $b(e,s){let r=s.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function Jn(e,s,r,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ub(e){return e.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function Li(e,s){let r=Ub(e);return s?r.map((a,n)=>n===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function $i(e,s,r,a){a===void 0&&(a=!1);let n;typeof e=="string"?n=Qs(e):(n=Kr({},e),Oe(!n.pathname||!n.pathname.includes("?"),Jn("?","pathname","search",n)),Oe(!n.pathname||!n.pathname.includes("#"),Jn("#","pathname","hash",n)),Oe(!n.search||!n.search.includes("#"),Jn("#","search","hash",n)));let o=e===""||n.pathname==="",i=o?"/":n.pathname,l;if(i==null)l=r;else{let m=s.length-1;if(!a&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),m-=1;n.pathname=h.join("/")}l=m>=0?s[m]:"/"}let d=Lb(n,l),f=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(f||u)&&(d.pathname+="/"),d}const ws=e=>e.join("/").replace(/\/\/+/g,"/"),zb=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),qb=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Wb=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Bb(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const ju=["post","put","patch","delete"];new Set(ju);const Gb=["get",...ju];new Set(Gb);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xr(){return Xr=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Xr.apply(this,arguments)}const vn=c.createContext(null),Nu=c.createContext(null),ms=c.createContext(null),yn=c.createContext(null),Es=c.createContext({outlet:null,matches:[],isDataRoute:!1}),Su=c.createContext(null);function Vb(e,s){let{relative:r}=s===void 0?{}:s;Nr()||Oe(!1);let{basename:a,navigator:n}=c.useContext(ms),{hash:o,pathname:i,search:l}=wn(e,{relative:r}),d=i;return a!=="/"&&(d=i==="/"?a:ws([a,i])),n.createHref({pathname:d,search:l,hash:o})}function Nr(){return c.useContext(yn)!=null}function Kt(){return Nr()||Oe(!1),c.useContext(yn).location}function _u(e){c.useContext(ms).static||c.useLayoutEffect(e)}function kt(){let{isDataRoute:e}=c.useContext(Es);return e?n0():Hb()}function Hb(){Nr()||Oe(!1);let e=c.useContext(vn),{basename:s,future:r,navigator:a}=c.useContext(ms),{matches:n}=c.useContext(Es),{pathname:o}=Kt(),i=JSON.stringify(Li(n,r.v7_relativeSplatPath)),l=c.useRef(!1);return _u(()=>{l.current=!0}),c.useCallback(function(f,u){if(u===void 0&&(u={}),!l.current)return;if(typeof f=="number"){a.go(f);return}let m=$i(f,JSON.parse(i),o,u.relative==="path");e==null&&s!=="/"&&(m.pathname=m.pathname==="/"?s:ws([s,m.pathname])),(u.replace?a.replace:a.push)(m,u.state,u)},[s,a,i,o,e])}function wn(e,s){let{relative:r}=s===void 0?{}:s,{future:a}=c.useContext(ms),{matches:n}=c.useContext(Es),{pathname:o}=Kt(),i=JSON.stringify(Li(n,a.v7_relativeSplatPath));return c.useMemo(()=>$i(e,JSON.parse(i),o,r==="path"),[e,i,o,r])}function Qb(e,s){return Kb(e,s)}function Kb(e,s,r,a){Nr()||Oe(!1);let{navigator:n}=c.useContext(ms),{matches:o}=c.useContext(Es),i=o[o.length-1],l=i?i.params:{};i&&i.pathname;let d=i?i.pathnameBase:"/";i&&i.route;let f=Kt(),u;if(s){var m;let v=typeof s=="string"?Qs(s):s;d==="/"||(m=v.pathname)!=null&&m.startsWith(d)||Oe(!1),u=v}else u=f;let h=u.pathname||"/",p=h;if(d!=="/"){let v=d.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let g=Sb(e,{pathname:p}),x=e0(g&&g.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:ws([d,n.encodeLocation?n.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?d:ws([d,n.encodeLocation?n.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,r,a);return s&&x?c.createElement(yn.Provider,{value:{location:Xr({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Rt.Pop}},x):x}function Yb(){let e=a0(),s=Bb(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return c.createElement(c.Fragment,null,c.createElement("h2",null,"Unexpected Application Error!"),c.createElement("h3",{style:{fontStyle:"italic"}},s),r?c.createElement("pre",{style:n},r):null,null)}const Xb=c.createElement(Yb,null);class Jb extends c.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,r){return r.location!==s.location||r.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:r.error,location:r.location,revalidation:s.revalidation||r.revalidation}}componentDidCatch(s,r){console.error("React Router caught the following error during render",s,r)}render(){return this.state.error!==void 0?c.createElement(Es.Provider,{value:this.props.routeContext},c.createElement(Su.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Zb(e){let{routeContext:s,match:r,children:a}=e,n=c.useContext(vn);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),c.createElement(Es.Provider,{value:s},a)}function e0(e,s,r,a){var n;if(s===void 0&&(s=[]),r===void 0&&(r=null),a===void 0&&(a=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=a)!=null&&o.v7_partialHydration&&s.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,l=(n=r)==null?void 0:n.errors;if(l!=null){let u=i.findIndex(m=>m.route.id&&l?.[m.route.id]!==void 0);u>=0||Oe(!1),i=i.slice(0,Math.min(i.length,u+1))}let d=!1,f=-1;if(r&&a&&a.v7_partialHydration)for(let u=0;u<i.length;u++){let m=i[u];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(f=u),m.route.id){let{loaderData:h,errors:p}=r,g=m.route.loader&&h[m.route.id]===void 0&&(!p||p[m.route.id]===void 0);if(m.route.lazy||g){d=!0,f>=0?i=i.slice(0,f+1):i=[i[0]];break}}}return i.reduceRight((u,m,h)=>{let p,g=!1,x=null,v=null;r&&(p=l&&m.route.id?l[m.route.id]:void 0,x=m.route.errorElement||Xb,d&&(f<0&&h===0?(g=!0,v=null):f===h&&(g=!0,v=m.route.hydrateFallbackElement||null)));let w=s.concat(i.slice(0,h+1)),y=()=>{let b;return p?b=x:g?b=v:m.route.Component?b=c.createElement(m.route.Component,null):m.route.element?b=m.route.element:b=u,c.createElement(Zb,{match:m,routeContext:{outlet:u,matches:w,isDataRoute:r!=null},children:b})};return r&&(m.route.ErrorBoundary||m.route.errorElement||h===0)?c.createElement(Jb,{location:r.location,revalidation:r.revalidation,component:x,error:p,children:y(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):y()},null)}var Cu=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Cu||{}),qa=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(qa||{});function t0(e){let s=c.useContext(vn);return s||Oe(!1),s}function s0(e){let s=c.useContext(Nu);return s||Oe(!1),s}function r0(e){let s=c.useContext(Es);return s||Oe(!1),s}function ku(e){let s=r0(),r=s.matches[s.matches.length-1];return r.route.id||Oe(!1),r.route.id}function a0(){var e;let s=c.useContext(Su),r=s0(qa.UseRouteError),a=ku(qa.UseRouteError);return s!==void 0?s:(e=r.errors)==null?void 0:e[a]}function n0(){let{router:e}=t0(Cu.UseNavigateStable),s=ku(qa.UseNavigateStable),r=c.useRef(!1);return _u(()=>{r.current=!0}),c.useCallback(function(n,o){o===void 0&&(o={}),r.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,Xr({fromRouteId:s},o)))},[e,s])}const o0="startTransition",cc=cd[o0];function i0(e){let{basename:s,children:r,initialEntries:a,initialIndex:n,future:o}=e,i=c.useRef();i.current==null&&(i.current=wb({initialEntries:a,initialIndex:n,v5Compat:!0}));let l=i.current,[d,f]=c.useState({action:l.action,location:l.location}),{v7_startTransition:u}=o||{},m=c.useCallback(h=>{u&&cc?cc(()=>f(h)):f(h)},[f,u]);return c.useLayoutEffect(()=>l.listen(m),[l,m]),c.createElement(Eu,{basename:s,children:r,location:d.location,navigationType:d.action,navigator:l,future:o})}function l0(e){let{to:s,replace:r,state:a,relative:n}=e;Nr()||Oe(!1);let{future:o,static:i}=c.useContext(ms),{matches:l}=c.useContext(Es),{pathname:d}=Kt(),f=kt(),u=$i(s,Li(l,o.v7_relativeSplatPath),d,n==="path"),m=JSON.stringify(u);return c.useEffect(()=>f(JSON.parse(m),{replace:r,state:a,relative:n}),[f,m,n,r,a]),null}function Je(e){Oe(!1)}function Eu(e){let{basename:s="/",children:r=null,location:a,navigationType:n=Rt.Pop,navigator:o,static:i=!1,future:l}=e;Nr()&&Oe(!1);let d=s.replace(/^\/*/,"/"),f=c.useMemo(()=>({basename:d,navigator:o,static:i,future:Xr({v7_relativeSplatPath:!1},l)}),[d,l,o,i]);typeof a=="string"&&(a=Qs(a));let{pathname:u="/",search:m="",hash:h="",state:p=null,key:g="default"}=a,x=c.useMemo(()=>{let v=mr(u,d);return v==null?null:{location:{pathname:v,search:m,hash:h,state:p,key:g},navigationType:n}},[d,u,m,h,p,g,n]);return x==null?null:c.createElement(ms.Provider,{value:f},c.createElement(yn.Provider,{children:r,value:x}))}function c0(e){let{children:s,location:r}=e;return Qb(Ro(s),r)}new Promise(()=>{});function Ro(e,s){s===void 0&&(s=[]);let r=[];return c.Children.forEach(e,(a,n)=>{if(!c.isValidElement(a))return;let o=[...s,n];if(a.type===c.Fragment){r.push.apply(r,Ro(a.props.children,o));return}a.type!==Je&&Oe(!1),!a.props.index||!a.props.children||Oe(!1);let i={id:a.props.id||o.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(i.children=Ro(a.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wa(){return Wa=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Wa.apply(this,arguments)}function Tu(e,s){if(e==null)return{};var r={},a=Object.keys(e),n,o;for(o=0;o<a.length;o++)n=a[o],!(s.indexOf(n)>=0)&&(r[n]=e[n]);return r}function d0(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function u0(e,s){return e.button===0&&(!s||s==="_self")&&!d0(e)}const m0=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],h0=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],f0="6";try{window.__reactRouterVersion=f0}catch{}const p0=c.createContext({isTransitioning:!1}),g0="startTransition",dc=cd[g0];function x0(e){let{basename:s,children:r,future:a,window:n}=e,o=c.useRef();o.current==null&&(o.current=bb({window:n,v5Compat:!0}));let i=o.current,[l,d]=c.useState({action:i.action,location:i.location}),{v7_startTransition:f}=a||{},u=c.useCallback(m=>{f&&dc?dc(()=>d(m)):d(m)},[d,f]);return c.useLayoutEffect(()=>i.listen(u),[i,u]),c.createElement(Eu,{basename:s,children:r,location:l.location,navigationType:l.action,navigator:i,future:a})}const v0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",y0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ia=c.forwardRef(function(s,r){let{onClick:a,relative:n,reloadDocument:o,replace:i,state:l,target:d,to:f,preventScrollReset:u,viewTransition:m}=s,h=Tu(s,m0),{basename:p}=c.useContext(ms),g,x=!1;if(typeof f=="string"&&y0.test(f)&&(g=f,v0))try{let b=new URL(window.location.href),j=f.startsWith("//")?new URL(b.protocol+f):new URL(f),N=mr(j.pathname,p);j.origin===b.origin&&N!=null?f=N+j.search+j.hash:x=!0}catch{}let v=Vb(f,{relative:n}),w=b0(f,{replace:i,state:l,target:d,preventScrollReset:u,relative:n,viewTransition:m});function y(b){a&&a(b),b.defaultPrevented||w(b)}return c.createElement("a",Wa({},h,{href:g||v,onClick:x||o?a:y,ref:r,target:d}))}),L2=c.forwardRef(function(s,r){let{"aria-current":a="page",caseSensitive:n=!1,className:o="",end:i=!1,style:l,to:d,viewTransition:f,children:u}=s,m=Tu(s,h0),h=wn(d,{relative:m.relative}),p=Kt(),g=c.useContext(Nu),{navigator:x,basename:v}=c.useContext(ms),w=g!=null&&j0(h)&&f===!0,y=x.encodeLocation?x.encodeLocation(h).pathname:h.pathname,b=p.pathname,j=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(b=b.toLowerCase(),j=j?j.toLowerCase():null,y=y.toLowerCase()),j&&v&&(j=mr(j,v)||j);const N=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let E=b===y||!i&&b.startsWith(y)&&b.charAt(N)==="/",S=j!=null&&(j===y||!i&&j.startsWith(y)&&j.charAt(y.length)==="/"),_={isActive:E,isPending:S,isTransitioning:w},C=E?a:void 0,k;typeof o=="function"?k=o(_):k=[o,E?"active":null,S?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let T=typeof l=="function"?l(_):l;return c.createElement(ia,Wa({},m,{"aria-current":C,className:k,ref:r,style:T,to:d,viewTransition:f}),typeof u=="function"?u(_):u)});var Io;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Io||(Io={}));var uc;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(uc||(uc={}));function w0(e){let s=c.useContext(vn);return s||Oe(!1),s}function b0(e,s){let{target:r,replace:a,state:n,preventScrollReset:o,relative:i,viewTransition:l}=s===void 0?{}:s,d=kt(),f=Kt(),u=wn(e,{relative:i});return c.useCallback(m=>{if(u0(m,r)){m.preventDefault();let h=a!==void 0?a:Yr(f)===Yr(u);d(e,{replace:h,state:n,preventScrollReset:o,relative:i,viewTransition:l})}},[f,d,u,a,n,r,e,o,i,l])}function j0(e,s){s===void 0&&(s={});let r=c.useContext(p0);r==null&&Oe(!1);let{basename:a}=w0(Io.useViewTransitionState),n=wn(e,{relative:s.relative});if(!r.isTransitioning)return!1;let o=mr(r.currentLocation.pathname,a)||r.currentLocation.pathname,i=mr(r.nextLocation.pathname,a)||r.nextLocation.pathname;return za(n.pathname,i)!=null||za(n.pathname,o)!=null}const Ui=on("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-muted hover:text-muted-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-muted hover:text-muted-foreground",link:"text-primary underline-offset-4 hover:underline",neutral:"bg-muted text-muted-foreground hover:bg-muted/80 border-muted","action-primary":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm","action-secondary":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm","action-compact":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm",ai:"bg-ai text-ai-foreground hover:bg-ai/90 text-sm font-medium shadow-sm"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","action-main":"h-12 px-6 py-3","action-secondary":"h-12 px-4 py-3","action-compact":"h-10 px-4 py-2","action-tall":"h-12 px-4 py-3","start-button":"h-16 px-8 py-4 text-lg"}},defaultVariants:{variant:"default",size:"default"}}),A=c.forwardRef(({className:e,variant:s,size:r,asChild:a=!1,...n},o)=>{const i=a?ci:"button";return t.jsx(i,{className:Z(Ui({variant:s,size:r,className:e})),ref:o,...n})});A.displayName="Button";const ie=c.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:Z("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));ie.displayName="Card";const pt=c.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:Z("flex flex-col space-y-1.5 p-6",e),...s}));pt.displayName="CardHeader";const us=c.forwardRef(({className:e,...s},r)=>t.jsx("h3",{ref:r,className:Z("text-2xl font-semibold leading-none tracking-tight",e),...s}));us.displayName="CardTitle";const Ba=c.forwardRef(({className:e,...s},r)=>t.jsx("p",{ref:r,className:Z("text-sm text-muted-foreground",e),...s}));Ba.displayName="CardDescription";const $e=c.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:Z("p-6 pt-0",e),...s}));$e.displayName="CardContent";const N0=c.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:Z("flex items-center p-6 pt-0",e),...s}));N0.displayName="CardFooter";class Mu extends c.Component{retryTimeout=null;constructor(s){super(s),this.state={hasError:!1,error:null,retryCount:0,autoRetrying:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ComprehensiveErrorBoundary caught an error:",s,r),this.props.onError?.(s,r),this.props.autoRetry&&this.props.level==="component"&&this.state.retryCount<(this.props.maxRetries||2)&&(this.setState({autoRetrying:!0}),this.retryTimeout=setTimeout(()=>{this.handleRetry()},2e3))}componentWillUnmount(){this.retryTimeout&&clearTimeout(this.retryTimeout)}handleRetry=()=>{this.setState(s=>({hasError:!1,error:null,retryCount:s.retryCount+1,autoRetrying:!1}))};handleGoHome=()=>{window.location.href="/"};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const{level:s="component"}=this.props,{autoRetrying:r,retryCount:a}=this.state;return r?t.jsx(ie,{className:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/20",children:t.jsx($e,{className:"p-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 text-amber-700 dark:text-amber-300",children:[t.jsx(At,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{className:"text-sm",children:"Recovering automatically..."})]})})}):s==="critical"?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsx(ie,{className:"max-w-md w-full border-destructive/20",children:t.jsxs($e,{className:"p-6 text-center space-y-4",children:[t.jsx(Zt,{className:"w-12 h-12 text-destructive mx-auto"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Critical Error"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"The application encountered a critical error and needs to be restarted."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(A,{onClick:this.handleRetry,className:"w-full",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Restart Application"]}),t.jsxs(A,{variant:"outline",onClick:this.handleGoHome,className:"w-full",children:[t.jsx(vo,{className:"w-4 h-4 mr-2"}),"Go to Home"]})]})]})})}):s==="page"?t.jsx("div",{className:"min-h-[50vh] flex items-center justify-center p-4",children:t.jsx(ie,{className:"max-w-sm w-full",children:t.jsxs($e,{className:"p-6 text-center space-y-4",children:[t.jsx(Zt,{className:"w-8 h-8 text-muted-foreground mx-auto"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-foreground",children:"Page Error"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This page couldn't load properly."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(A,{onClick:this.handleRetry,size:"sm",className:"w-full",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Try Again"]}),t.jsxs(A,{variant:"outline",onClick:this.handleGoHome,size:"sm",className:"w-full",children:[t.jsx(vo,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})]})})}):t.jsx(ie,{className:"border-muted bg-muted/5",children:t.jsxs($e,{className:"p-4 text-center space-y-3",children:[t.jsx(Zt,{className:"w-6 h-6 text-muted-foreground mx-auto"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Something went wrong with this component."}),a<(this.props.maxRetries||2)&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Attempt ",a+1," of ",(this.props.maxRetries||2)+1]})]}),t.jsxs(A,{onClick:this.handleRetry,size:"sm",variant:"outline",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Retry"]})]})})}return this.props.children}}const S0=({children:e,onError:s})=>t.jsx(Mu,{level:"critical",onError:s,children:e}),lt=({children:e,onError:s})=>t.jsx(Mu,{level:"page",onError:s,children:e}),_0=({children:e,fallback:s,onError:r})=>{const[a,n]=c.useState(null);return c.useEffect(()=>{const o=async l=>{const d=String(l.reason);if(d.includes("Extension context invalidated")||d.includes("chrome-extension://")||d.includes("moz-extension://")||d.includes("safari-extension://")||d.includes("MetaMask")||d.includes("connect to MetaMask")){console.log("Ignoring browser extension error:",d),l.preventDefault();return}if(d.includes("Authentication timeout")||d.includes("Authentication cancelled")||d.includes("OAuth")||d.includes("Browser already closed")||d.includes("Error handling auth timeout")||d.includes("Error cancelling auth")){console.log("Ignoring OAuth-related error (handled elsewhere):",d),l.preventDefault();return}if(l.reason?.name==="VersionError"||d.includes("VersionError")){console.log("VersionError detected - clearing IndexedDB");try{if("indexedDB"in window){const u=await indexedDB.databases();await Promise.all(u.map(m=>{if(m.name)return new Promise((h,p)=>{const g=indexedDB.deleteDatabase(m.name);g.onsuccess=()=>h(),g.onerror=()=>p(g.error)})}))}console.log("Database updated - refreshing page"),setTimeout(()=>{location.reload()},2e3)}catch(u){console.error("Failed to clear IndexedDB:",u),console.log("Database issue detected - please clear cache or refresh")}l.preventDefault();return}console.error("Unhandled promise rejection:",l.reason);const f=l.reason instanceof Error?l.reason:new Error(d);n(f),r?.(f),console.error("Async error occurred:",d),l.preventDefault()},i=l=>{const d=String(l.error?.message||l.message||l.error);if(d.includes("Extension context invalidated")||d.includes("chrome-extension://")||d.includes("moz-extension://")||d.includes("safari-extension://")){console.log("Ignoring browser extension error:",d);return}console.error("Global error:",l.error);const f=l.error instanceof Error?l.error:new Error(d);n(f),r?.(f)};return window.addEventListener("unhandledrejection",o),window.addEventListener("error",i),()=>{window.removeEventListener("unhandledrejection",o),window.removeEventListener("error",i)}},[r]),c.useEffect(()=>{a&&n(null)},[e]),a?s?t.jsx(t.Fragment,{children:s}):t.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 text-center",children:t.jsx("div",{className:"text-sm text-muted-foreground",children:"An error occurred. Please try again."})}):t.jsx(t.Fragment,{children:e})};function la(e){const s=c.useRef({value:e,previous:e});return c.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}var zi="Checkbox",[C0,$2]=St(zi),[k0,E0]=C0(zi),Pu=c.forwardRef((e,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:o,required:i,disabled:l,value:d="on",onCheckedChange:f,form:u,...m}=e,[h,p]=c.useState(null),g=Ne(s,j=>p(j)),x=c.useRef(!1),v=h?u||!!h.closest("form"):!0,[w=!1,y]=Gt({prop:n,defaultProp:o,onChange:f}),b=c.useRef(w);return c.useEffect(()=>{const j=h?.form;if(j){const N=()=>y(b.current);return j.addEventListener("reset",N),()=>j.removeEventListener("reset",N)}},[h,y]),t.jsxs(k0,{scope:r,state:w,disabled:l,children:[t.jsx(xe.button,{type:"button",role:"checkbox","aria-checked":bs(w)?"mixed":w,"aria-required":i,"data-state":Ru(w),"data-disabled":l?"":void 0,disabled:l,value:d,...m,ref:g,onKeyDown:ae(e.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:ae(e.onClick,j=>{y(N=>bs(N)?!0:!N),v&&(x.current=j.isPropagationStopped(),x.current||j.stopPropagation())})}),v&&t.jsx(T0,{control:h,bubbles:!x.current,name:a,value:d,checked:w,required:i,disabled:l,form:u,style:{transform:"translateX(-100%)"},defaultChecked:bs(o)?!1:o})]})});Pu.displayName=zi;var Du="CheckboxIndicator",Au=c.forwardRef((e,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=e,o=E0(Du,r);return t.jsx(_t,{present:a||bs(o.state)||o.state===!0,children:t.jsx(xe.span,{"data-state":Ru(o.state),"data-disabled":o.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...e.style}})})});Au.displayName=Du;var T0=e=>{const{control:s,checked:r,bubbles:a=!0,defaultChecked:n,...o}=e,i=c.useRef(null),l=la(r),d=oa(s);c.useEffect(()=>{const u=i.current,m=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(m,"checked").set;if(l!==r&&p){const g=new Event("click",{bubbles:a});u.indeterminate=bs(r),p.call(u,bs(r)?!1:r),u.dispatchEvent(g)}},[l,r,a]);const f=c.useRef(bs(r)?!1:r);return t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??f.current,...o,tabIndex:-1,ref:i,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function bs(e){return e==="indeterminate"}function Ru(e){return bs(e)?"indeterminate":e?"checked":"unchecked"}var Iu=Pu,M0=Au;const qi=c.forwardRef(({className:e,...s},r)=>t.jsx(Iu,{ref:r,className:Z("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:t.jsx(M0,{className:Z("flex items-center justify-center text-current"),children:t.jsx(Gs,{className:"h-4 w-4"})})}));qi.displayName=Iu.displayName;const ge=c.forwardRef(({className:e,type:s,...r},a)=>t.jsx("input",{type:s,className:Z("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));ge.displayName="Input";/*! Capacitor: https://capacitorjs.com/ - MIT License */var hr;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(hr||(hr={}));class Zn extends Error{constructor(s,r,a){super(s),this.message=s,this.code=r,this.data=a}}const P0=e=>{var s,r;return e?.androidBridge?"android":!((r=(s=e?.webkit)===null||s===void 0?void 0:s.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},D0=e=>{const s=e.CapacitorCustomPlatform||null,r=e.Capacitor||{},a=r.Plugins=r.Plugins||{},n=()=>s!==null?s.name:P0(e),o=()=>n()!=="web",i=m=>{const h=f.get(m);return!!(h?.platforms.has(n())||l(m))},l=m=>{var h;return(h=r.PluginHeaders)===null||h===void 0?void 0:h.find(p=>p.name===m)},d=m=>e.console.error(m),f=new Map,u=(m,h={})=>{const p=f.get(m);if(p)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),p.proxy;const g=n(),x=l(m);let v;const w=async()=>(!v&&g in h?v=typeof h[g]=="function"?v=await h[g]():v=h[g]:s!==null&&!v&&"web"in h&&(v=typeof h.web=="function"?v=await h.web():v=h.web),v),y=(_,C)=>{var k,T;if(x){const D=x?.methods.find(W=>C===W.name);if(D)return D.rtype==="promise"?W=>r.nativePromise(m,C.toString(),W):(W,$)=>r.nativeCallback(m,C.toString(),W,$);if(_)return(k=_[C])===null||k===void 0?void 0:k.bind(_)}else{if(_)return(T=_[C])===null||T===void 0?void 0:T.bind(_);throw new Zn(`"${m}" plugin is not implemented on ${g}`,hr.Unimplemented)}},b=_=>{let C;const k=(...T)=>{const D=w().then(W=>{const $=y(W,_);if($){const X=$(...T);return C=X?.remove,X}else throw new Zn(`"${m}.${_}()" is not implemented on ${g}`,hr.Unimplemented)});return _==="addListener"&&(D.remove=async()=>C()),D};return k.toString=()=>`${_.toString()}() { [capacitor code] }`,Object.defineProperty(k,"name",{value:_,writable:!1,configurable:!1}),k},j=b("addListener"),N=b("removeListener"),E=(_,C)=>{const k=j({eventName:_},C),T=async()=>{const W=await k;N({eventName:_,callbackId:W},C)},D=new Promise(W=>k.then(()=>W({remove:T})));return D.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await T()},D},S=new Proxy({},{get(_,C){switch(C){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?E:j;case"removeListener":return N;default:return b(C)}}});return a[m]=S,f.set(m,{name:m,proxy:S,platforms:new Set([...Object.keys(h),...x?[g]:[]])}),S};return r.convertFileSrc||(r.convertFileSrc=m=>m),r.getPlatform=n,r.handleError=d,r.isNativePlatform=o,r.isPluginAvailable=i,r.registerPlugin=u,r.Exception=Zn,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},A0=e=>e.Capacitor=D0(e),Ft=A0(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Fu=Ft.registerPlugin;class Ou{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(s,r){let a=!1;this.listeners[s]||(this.listeners[s]=[],a=!0),this.listeners[s].push(r);const o=this.windowListeners[s];o&&!o.registered&&this.addWindowListener(o),a&&this.sendRetainedArgumentsForEvent(s);const i=async()=>this.removeListener(s,r);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,r,a){const n=this.listeners[s];if(!n){if(a){let o=this.retainedEventArguments[s];o||(o=[]),o.push(r),this.retainedEventArguments[s]=o}return}n.forEach(o=>o(r))}hasListeners(s){var r;return!!(!((r=this.listeners[s])===null||r===void 0)&&r.length)}registerWindowListener(s,r){this.windowListeners[r]={registered:!1,windowEventName:s,pluginEventName:r,handler:a=>{this.notifyListeners(r,a)}}}unimplemented(s="not implemented"){return new Ft.Exception(s,hr.Unimplemented)}unavailable(s="not available"){return new Ft.Exception(s,hr.Unavailable)}async removeListener(s,r){const a=this.listeners[s];if(!a)return;const n=a.indexOf(r);this.listeners[s].splice(n,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}sendRetainedArgumentsForEvent(s){const r=this.retainedEventArguments[s];r&&(delete this.retainedEventArguments[s],r.forEach(a=>{this.notifyListeners(s,a)}))}}const mc=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),hc=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class R0 extends Ou{async getCookies(){const s=document.cookie,r={};return s.split(";").forEach(a=>{if(a.length<=0)return;let[n,o]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=hc(n).trim(),o=hc(o).trim(),r[n]=o}),r}async setCookie(s){try{const r=mc(s.key),a=mc(s.value),n=`; expires=${(s.expires||"").replace("expires=","")}`,o=(s.path||"/").replace("path=",""),i=s.url!=null&&s.url.length>0?`domain=${s.url}`:"";document.cookie=`${r}=${a||""}${n}; path=${o}; ${i};`}catch(r){return Promise.reject(r)}}async deleteCookie(s){try{document.cookie=`${s.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const s=document.cookie.split(";")||[];for(const r of s)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(s){return Promise.reject(s)}}async clearAllCookies(){try{await this.clearCookies()}catch(s){return Promise.reject(s)}}}Fu("CapacitorCookies",{web:()=>new R0});const I0=async e=>new Promise((s,r)=>{const a=new FileReader;a.onload=()=>{const n=a.result;s(n.indexOf(",")>=0?n.split(",")[1]:n)},a.onerror=n=>r(n),a.readAsDataURL(e)}),F0=(e={})=>{const s=Object.keys(e);return Object.keys(e).map(n=>n.toLocaleLowerCase()).reduce((n,o,i)=>(n[o]=e[s[i]],n),{})},O0=(e,s=!0)=>e?Object.entries(e).reduce((a,n)=>{const[o,i]=n;let l,d;return Array.isArray(i)?(d="",i.forEach(f=>{l=s?encodeURIComponent(f):f,d+=`${o}=${l}&`}),d.slice(0,-1)):(l=s?encodeURIComponent(i):i,d=`${o}=${l}`),`${a}&${d}`},"").substr(1):null,L0=(e,s={})=>{const r=Object.assign({method:e.method||"GET",headers:e.headers},s),n=F0(e.headers)["content-type"]||"";if(typeof e.data=="string")r.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[i,l]of Object.entries(e.data||{}))o.set(i,l);r.body=o.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const o=new FormData;if(e.data instanceof FormData)e.data.forEach((l,d)=>{o.append(d,l)});else for(const l of Object.keys(e.data))o.append(l,e.data[l]);r.body=o;const i=new Headers(r.headers);i.delete("content-type"),r.headers=i}else(n.includes("application/json")||typeof e.data=="object")&&(r.body=JSON.stringify(e.data));return r};class $0 extends Ou{async request(s){const r=L0(s,s.webFetchExtra),a=O0(s.params,s.shouldEncodeUrlParams),n=a?`${s.url}?${a}`:s.url,o=await fetch(n,r),i=o.headers.get("content-type")||"";let{responseType:l="text"}=o.ok?s:{};i.includes("application/json")&&(l="json");let d,f;switch(l){case"arraybuffer":case"blob":f=await o.blob(),d=await I0(f);break;case"json":d=await o.json();break;case"document":case"text":default:d=await o.text()}const u={};return o.headers.forEach((m,h)=>{u[h]=m}),{data:d,headers:u,status:o.status,url:o.url}}async get(s){return this.request(Object.assign(Object.assign({},s),{method:"GET"}))}async post(s){return this.request(Object.assign(Object.assign({},s),{method:"POST"}))}async put(s){return this.request(Object.assign(Object.assign({},s),{method:"PUT"}))}async patch(s){return this.request(Object.assign(Object.assign({},s),{method:"PATCH"}))}async delete(s){return this.request(Object.assign(Object.assign({},s),{method:"DELETE"}))}}Fu("CapacitorHttp",{web:()=>new $0});const U0="https://texnkijwcygodtywgedm.supabase.co",fc="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRleG5raWp3Y3lnb2R0eXdnZWRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxODQ3MDAsImV4cCI6MjA2ODc2MDcwMH0.xiOD9aVsKZCadtKiwPGnFQONjLQlaqk-ASUdLDZHNqI";Ft.isNativePlatform();const P=Xp(U0,fc,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{apikey:fc}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}}),fr=re.forwardRef(({onTranscription:e,isDisabled:s=!1,size:r="md",autoStart:a=!1,onRecordingStateChange:n},o)=>{const[i,l]=c.useState(!1),[d,f]=c.useState(!1),u=c.useRef(null),m=c.useRef([]),{toast:h}=pe();c.useEffect(()=>{a&&!s&&!i&&!d&&(console.log("ðŸŽ¤ Auto-starting recording..."),v())},[a,s]),re.useImperativeHandle(o,()=>({stopRecording:()=>{i&&(console.log("ðŸŽ¤ Stopping recording via ref..."),y())},cancelRecording:()=>{i&&(console.log("ðŸŽ¤ Canceling recording via ref..."),w())}}),[i]),c.useEffect(()=>{n?.(i)},[i,n]);const p={sm:"h-8 w-8",md:"h-12 w-12",lg:"h-16 w-16"},g={sm:"h-3 w-3",md:"h-5 w-5",lg:"h-6 w-6"},x=()=>{const j=["audio/webm;codecs=opus","audio/webm","audio/mp4;codecs=mp4a.40.2","audio/mp4"];try{for(const N of j)if(typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(N))return N}catch{console.warn("ðŸŽ¤ mimeType detection failed, using default")}},v=async()=>{try{console.log("ðŸŽ¤ Starting recording...");const j=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});console.log("ðŸŽ¤ MediaStream obtained, creating MediaRecorder...");const N=x();console.log("ðŸŽ¤ Selected mimeType:",N||"default"),u.current=N?new MediaRecorder(j,{mimeType:N}):new MediaRecorder(j),m.current=[],u.current.ondataavailable=S=>{console.log("ðŸŽ¤ Audio data available, size:",S.data.size),S.data.size>0&&m.current.push(S.data)},u.current.onstop=()=>{console.log("ðŸŽ¤ Recording stopped, cleaning up stream..."),j.getTracks().forEach(S=>S.stop())},u.current.onerror=S=>{console.error("ðŸŽ¤ MediaRecorder error:",S)};const E=setTimeout(()=>{i&&u.current?.state==="recording"&&(console.log("ðŸŽ¤ Recording timeout reached"),h({title:"â±ï¸ Recording Timeout",description:"Recording automatically stopped after 60 seconds.",variant:"destructive"}),y())},6e4);u.current.start(100),l(!0),console.log("ðŸŽ¤ Recording started successfully"),u.current.timeout=E}catch(j){console.error("ðŸŽ¤ Error starting recording:",j),h({title:"Error",description:"Could not access microphone. Please check permissions.",variant:"destructive"})}},w=()=>{console.log("ðŸŽ¤ Canceling recording..."),u.current&&u.current.timeout&&clearTimeout(u.current.timeout),i&&u.current&&(console.log("ðŸŽ¤ Stopping MediaRecorder (canceling)..."),u.current.stop(),l(!1)),m.current=[],console.log("ðŸŽ¤ Recording canceled, no processing will occur")},y=async()=>{if(console.log("ðŸŽ¤ Stopping and processing recording..."),u.current&&u.current.timeout&&clearTimeout(u.current.timeout),i&&u.current&&(console.log("ðŸŽ¤ Stopping MediaRecorder..."),u.current.stop(),l(!1),await new Promise(j=>setTimeout(j,200))),console.log("ðŸŽ¤ Audio chunks collected:",m.current.length),m.current.length===0){console.error("ðŸŽ¤ No audio chunks available"),h({title:"No Recording",description:"Please try recording again",variant:"destructive"});return}f(!0);try{console.log("ðŸŽ¤ Creating audio blob...");const j=new Blob(m.current,{type:"audio/webm"});if(console.log("ðŸŽ¤ Audio blob size:",j.size,"bytes"),j.size===0)throw new Error("Audio blob is empty");console.log("ðŸŽ¤ Converting to base64...");const N=await j.arrayBuffer(),E=new Uint8Array(N);let S="";const _=32768;for(let D=0;D<E.length;D+=_){const W=E.subarray(D,Math.min(D+_,E.length));S+=String.fromCharCode.apply(null,Array.from(W))}const C=btoa(S);console.log("ðŸŽ¤ Base64 length:",C.length),console.log("ðŸŽ¤ Sending to transcribe function...");const{data:k,error:T}=await P.functions.invoke("transcribe",{body:{audio:C}});if(T)throw console.error("ðŸŽ¤ Supabase function error:",T),T;if(console.log("ðŸŽ¤ Transcription response:",k),k?.text)console.log("ðŸŽ¤ Transcription successful:",k.text),e(k.text),h({title:"âœ“",description:"",className:"w-16 h-8 p-2 text-center bg-green-600 text-white border-0 fixed bottom-4 right-4 text-xs",duration:1500}),m.current=[];else throw new Error("No transcription received")}catch(j){console.error("ðŸŽ¤ Transcription error:",j),h({title:"Failed to Process",description:"Please try recording again",variant:"destructive"})}finally{f(!1)}},b=()=>{d||(i?y():v())};return t.jsx(A,{onClick:b,disabled:s||d,className:`
        ${p[r]} 
        rounded-full 
        transition-all 
        duration-200 
        ${i?"bg-orange-500 hover:bg-orange-600 recording-pulse":"bg-green-500 hover:bg-green-600"}
        text-white
      `,children:d?t.jsx("div",{className:`animate-spin rounded-full border-2 border-white border-t-transparent ${g[r]}`}):i?t.jsx(jd,{className:`${g[r]}`}):t.jsx(Ns,{className:g[r]})})}),pc=e=>{let s;const r=new Set,a=(f,u)=>{const m=typeof f=="function"?f(s):f;if(!Object.is(m,s)){const h=s;s=u??(typeof m!="object"||m===null)?m:Object.assign({},s,m),r.forEach(p=>p(s,h))}},n=()=>s,l={setState:a,getState:n,getInitialState:()=>d,subscribe:f=>(r.add(f),()=>r.delete(f))},d=s=e(a,n,l);return l},z0=e=>e?pc(e):pc,q0=e=>e;function W0(e,s=q0){const r=re.useSyncExternalStore(e.subscribe,re.useCallback(()=>s(e.getState()),[e,s]),re.useCallback(()=>s(e.getInitialState()),[e,s]));return re.useDebugValue(r),r}const gc=e=>{const s=z0(e),r=a=>W0(s,a);return Object.assign(r,s),r},Wi=e=>e?gc(e):gc;function B0(e,s){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const i=d=>d===null?null:JSON.parse(d,void 0),l=(o=r.getItem(n))!=null?o:null;return l instanceof Promise?l.then(i):i(l)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const Fo=e=>s=>{try{const r=e(s);return r instanceof Promise?r:{then(a){return Fo(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return Fo(a)(r)}}}},G0=(e,s)=>(r,a,n)=>{let o={storage:B0(()=>localStorage),partialize:x=>x,version:0,merge:(x,v)=>({...v,...x}),...s},i=!1;const l=new Set,d=new Set;let f=o.storage;if(!f)return e((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...x)},a,n);const u=()=>{const x=o.partialize({...a()});return f.setItem(o.name,{state:x,version:o.version})},m=n.setState;n.setState=(x,v)=>{m(x,v),u()};const h=e((...x)=>{r(...x),u()},a,n);n.getInitialState=()=>h;let p;const g=()=>{var x,v;if(!f)return;i=!1,l.forEach(y=>{var b;return y((b=a())!=null?b:h)});const w=((v=o.onRehydrateStorage)==null?void 0:v.call(o,(x=a())!=null?x:h))||void 0;return Fo(f.getItem.bind(f))(o.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==o.version){if(o.migrate){const b=o.migrate(y.state,y.version);return b instanceof Promise?b.then(j=>[!0,j]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var b;const[j,N]=y;if(p=o.merge(N,(b=a())!=null?b:h),r(p,!0),j)return u()}).then(()=>{w?.(p,void 0),p=a(),i=!0,d.forEach(y=>y(p))}).catch(y=>{w?.(void 0,y)})};return n.persist={setOptions:x=>{o={...o,...x},x.storage&&(f=x.storage)},clearStorage:()=>{f?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>g(),hasHydrated:()=>i,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(d.add(x),()=>{d.delete(x)})},o.skipHydration||g(),p||h},V0=G0,ct={info:(e,s)=>console.log(`ðŸ” Auth: ${e}`,s||""),warn:(e,s)=>console.warn(`âš ï¸ Auth: ${e}`,s||""),error:(e,s)=>console.error(`âŒ Auth: ${e}`,s||"")},ft=Wi()(V0((e,s)=>({user:null,session:null,loading:!0,oauthCompleting:!1,initialize:async()=>{if(!s().loading){ct.info("Already initialized, skipping");return}ct.info("Starting auth initialization");try{const{data:{subscription:a}}=P.auth.onAuthStateChange(async(i,l)=>{if(ct.info(`ðŸ”” Auth state changed: ${i}`,{hasSession:!!l,userId:l?.user?.id,email:l?.user?.email}),i==="TOKEN_REFRESHED"&&!l){ct.warn("ðŸ”„ Token refresh failed - clearing session"),e({session:null,user:null,loading:!1,oauthCompleting:!1});return}e({session:l,user:l?.user??null,loading:!1}),i==="SIGNED_IN"&&l&&(ct.info("âœ… Sign in detected via auth state change"),e({oauthCompleting:!1}))}),{data:{session:n},error:o}=await P.auth.getSession();o&&ct.error("Error getting session:",o),ct.info("Session initialization complete",{hasSession:!!n,userId:n?.user?.id}),e({session:n,user:n?.user??null,loading:!1}),window.__authSubscription=a,window.__authInitialized=!0}catch(a){ct.error("Auth initialization failed:",a),e({loading:!1}),window.__authInitialized=!0}},signIn:async(r,a)=>{ct.info("Attempting sign in",{email:r});const{error:n}=await P.auth.signInWithPassword({email:r,password:a});return n?ct.error("Sign in failed:",n):ct.info("Sign in successful"),{error:n}},signUp:async(r,a)=>{const n=`${window.location.origin}/`,{error:o}=await P.auth.signUp({email:r,password:a,options:{emailRedirectTo:n}});return{error:o}},signInWithGoogle:async()=>{const r=Ft.isNativePlatform();ct.info(`Initiating ${r?"native":"web"} OAuth flow`);const a=r?"com.fastnow.zenith://oauth/callback":`${window.location.origin}/auth/callback`,{error:n}=await P.auth.signInWithOAuth({provider:"google",options:{redirectTo:a}});return n?ct.error("Google OAuth initiation failed:",n):ct.info(`${r?"Native":"Web"} OAuth redirect initiated`),{error:n}},signInWithGoogleNative:async()=>s().signInWithGoogle(),resetPassword:async r=>{const a=`${window.location.origin}/update-password`,{error:n}=await P.auth.resetPasswordForEmail(r,{redirectTo:a});return{error:n}},updatePassword:async r=>{const{error:a}=await P.auth.updateUser({password:r});return{error:a}},signOut:async()=>{ct.info("Signing out");const{error:r}=await P.auth.signOut();return r?ct.error("Sign out failed:",r):(e({user:null,session:null}),typeof window<"u"&&Object.keys(localStorage).forEach(n=>{(n.startsWith("cache_profile_")||n.startsWith("dedupe_profile_")||n.startsWith("cache_access_")||n.startsWith("dedupe_access_"))&&localStorage.removeItem(n)}),ct.info("Sign out successful")),{error:r}},setLoading:r=>e({loading:r}),setOAuthCompleting:r=>{console.log("ðŸ”„ Setting OAuth completing:",r),e({oauthCompleting:r})},forceRefresh:async()=>{console.log("ðŸ”„ Force refreshing auth state...");try{const{data:{session:r},error:a}=await P.auth.getSession();if(a){console.error("âŒ Error getting session during force refresh:",a);return}console.log("âœ… Force refresh session result:",{hasSession:!!r,userId:r?.user?.id,email:r?.user?.email}),e({session:r,user:r?.user??null,loading:!1,oauthCompleting:!1})}catch(r){console.error("âŒ Force refresh error:",r)}}}),{name:"auth-storage",partialize:e=>({user:e.user,session:e.session})})),Lu=c.createContext(null),H0=({children:e})=>{const s=ft(p=>p.user),r=ft(p=>p.session),a=ft(p=>p.loading),n=ft(p=>p.signIn),o=ft(p=>p.signUp),i=ft(p=>p.signOut),l=ft(p=>p.signInWithGoogle),d=ft(p=>p.signInWithGoogleNative),f=ft(p=>p.resetPassword),u=ft(p=>p.updatePassword),m=ft(p=>p.initialize);re.useEffect(()=>{m()},[m]);const h={user:s,session:r,loading:a,signIn:n,signUp:o,signOut:i,signInWithGoogle:l,signInWithGoogleNative:d,resetPassword:f,updatePassword:u};return t.jsx(Lu.Provider,{value:h,children:e})},Ks=()=>{const e=c.useContext(Lu);if(!e)throw new Error("useAuthContext must be used within AuthContextProvider");return e},bn=Wi((e,s)=>({isOnline:typeof navigator<"u"?navigator.onLine:!0,lastChecked:Date.now(),isTestingConnection:!1,testConnection:async()=>{const r=s();if(r.isTestingConnection)return r.isOnline;e({isTestingConnection:!0});try{const a=new AbortController,n=setTimeout(()=>a.abort(),5e3);if(typeof window<"u"&&window.Capacitor)return clearTimeout(n),e({isOnline:!0,lastChecked:Date.now(),isTestingConnection:!1}),!0;const i=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:a.signal});clearTimeout(n);const l=i.ok;return e({isOnline:l,lastChecked:Date.now(),isTestingConnection:!1}),l}catch{const n=typeof window<"u"&&window.Capacitor;return e({isOnline:n||navigator.onLine,lastChecked:Date.now(),isTestingConnection:!1}),n||navigator.onLine}},startMonitoring:()=>{const{testConnection:r}=s(),a=()=>{e({isOnline:!0,lastChecked:Date.now()}),setTimeout(()=>r(),1e3)},n=()=>{e({isOnline:!1,lastChecked:Date.now()})};if(typeof window<"u"){window.addEventListener("online",a),window.addEventListener("offline",n);const o=setInterval(()=>{const i=s();i.isOnline&&Date.now()-i.lastChecked>3e4&&r()},3e4);window.__connectionListeners={handleOnline:a,handleOffline:n,intervalId:o},setTimeout(()=>r(),500)}},stopMonitoring:()=>{const r=window.__connectionListeners;r&&(window.removeEventListener("online",r.handleOnline),window.removeEventListener("offline",r.handleOffline),r.intervalId&&clearInterval(r.intervalId),delete window.__connectionListeners)}})),Q0=()=>{const e=Ct(),s=c.useCallback(()=>{e.invalidateQueries({queryKey:["access"]}),e.invalidateQueries({queryKey:["profile"]}),typeof window<"u"&&Object.keys(localStorage).forEach(o=>{(o.startsWith("cache_profile_")||o.startsWith("dedupe_profile_")||o.startsWith("cache_access_")||o.startsWith("dedupe_access_"))&&localStorage.removeItem(o)}),console.log("ðŸ§¹ Cleared all authentication caches")},[e]),r=c.useCallback(n=>{e.invalidateQueries({queryKey:["access",n]}),e.invalidateQueries({queryKey:["profile",n]}),typeof window<"u"&&(localStorage.removeItem(`cache_profile_${n}`),localStorage.removeItem(`dedupe_profile_${n}`),localStorage.removeItem(`cache_access_${n}`),localStorage.removeItem(`dedupe_access_${n}`)),console.log(`ðŸ§¹ Cleared caches for user: ${n}`)},[e]),a=c.useCallback(n=>{n?(e.refetchQueries({queryKey:["access",n]}),e.refetchQueries({queryKey:["profile",n]})):(e.refetchQueries({queryKey:["access"]}),e.refetchQueries({queryKey:["profile"]})),console.log("ðŸ”„ Refreshed authentication data")},[e]);return{clearAllAuthCaches:s,clearUserSpecificCaches:r,refreshAuthData:a}},Se=()=>{const{toast:e}=pe(),s=Ks(),{isOnline:r}=bn(),{clearAllAuthCaches:a,refreshAuthData:n}=Q0(),o=async(h,p)=>{const g=async()=>{const x=await s.signIn(h,p);return x.error?e({title:"Sign In Failed",description:x.error.message,variant:"destructive"}):(a(),setTimeout(()=>{s.user?.id&&n(s.user.id)},100),e({title:"Welcome back!",description:"You have successfully signed in."})),x};try{return await g()}catch(x){return(!r||x?.message?.includes("fetch"))&&e({title:"Connection issue",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:x}}},i=async(h,p)=>{const g=async()=>{const x=await s.signUp(h,p);return x.error?e({title:"Sign Up Failed",description:x.error.message,variant:"destructive"}):e({title:"Account Created!",description:"Please check your email to verify your account."}),x};try{return await g()}catch(x){return(!r||x?.message?.includes("fetch"))&&e({title:"Connection issue",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:x}}},l=async()=>{const h=await s.signInWithGoogle();return h.error&&e({title:"Google Sign In Failed",description:h.error.message,variant:"destructive"}),h},d=async h=>{const p=async()=>{const g=await s.resetPassword(h);return g.error?e({title:"Password Reset Failed",description:g.error.message,variant:"destructive"}):e({title:"Reset Link Sent",description:"Check your email for a password reset link."}),g};try{return await p()}catch(g){return(!r||g?.message?.includes("fetch"))&&e({title:"Connection issue",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:g}}},f=async h=>{const p=async()=>{const g=await s.updatePassword(h);return g.error?e({title:"Password Update Failed",description:g.error.message,variant:"destructive"}):e({title:"Password Updated",description:"Your password has been successfully updated."}),g};try{return await p()}catch(g){return(!r||g?.message?.includes("fetch"))&&e({title:"Connection issue",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:g}}},u=async()=>await(async()=>{a();const p=await s.signOut();p?.error?e({title:"Sign Out Failed",description:p.error.message,variant:"destructive"}):e({title:"Signed Out",description:"You have been successfully signed out."})})(),m=async()=>s.session?!!(s.session.expires_at&&new Date(s.session.expires_at*1e3)>new Date):!1;return{user:s.user,session:s.session,loading:s.loading,signIn:o,signUp:i,signOut:u,signInWithGoogle:l,resetPassword:d,updatePassword:f,checkSessionHealth:m}},K0=async e=>{const{data:s,error:r}=await P.from("profiles").select("access_level, premium_expires_at").eq("user_id",e).single();if(r)return console.log("ðŸ”’ RLS blocked profiles query (likely auth.uid() is null) - returning safe defaults"),{access_level:"free",premium_expires_at:null,hasAccess:!1,hasPremiumFeatures:!1,isAdmin:!1,isTrial:!1,isPremium:!1,isFree:!0,daysRemaining:null};const a=s?.access_level||"free",n=s?.premium_expires_at,i=(n?new Date(n)<new Date:!1)&&a!=="admin"?"free":a,l=n?Math.max(0,Math.ceil((new Date(n).getTime()-new Date().getTime())/(1e3*60*60*24))):null;return{access_level:i,premium_expires_at:n,hasAccess:i!=="free",hasPremiumFeatures:i!=="free",isAdmin:i==="admin",isTrial:i==="trial",isPremium:i==="premium",isFree:i==="free",daysRemaining:l}},Xe=()=>{const{user:e}=Se(),[s,r]=c.useState(()=>{if(typeof window<"u"){const m=localStorage.getItem("admin_role_testing");return m||null}return null}),a=m=>{r(m),typeof window<"u"&&(m?localStorage.setItem("admin_role_testing",m):localStorage.removeItem("admin_role_testing"))},n=s!==null,{data:o,isLoading:i,error:l,refetch:d}=bt({queryKey:["access",e?.id],queryFn:()=>K0(e.id),enabled:!!e?.id,staleTime:1*60*1e3,gcTime:5*60*1e3,retry:!1,retryOnMount:!1,refetchOnWindowFocus:!1,throwOnError:!1}),u={...{access_level:"free",premium_expires_at:null,hasAccess:!1,hasPremiumFeatures:!1,isAdmin:!1,isTrial:!1,isPremium:!1,isFree:!0,daysRemaining:null},...o,loading:i,error:l,refetch:d};if(n&&s){const m=s==="admin"?"admin":s==="paid_user"?"premium":"free";return{...u,access_level:m,hasAccess:m!=="free",hasPremiumFeatures:m!=="free",isAdmin:m==="admin",originalIsAdmin:u.isAdmin,isTrial:!1,isPremium:m==="premium",isFree:m==="free",setTestRole:a,testRole:s,isTestingMode:n,createSubscription:async()=>{const{data:h,error:p}=await P.functions.invoke("create-subscription");return h?.url&&window.open(h.url,"_blank"),{data:h,error:p}},openCustomerPortal:async()=>{const{data:h,error:p}=await P.functions.invoke("customer-portal");return h?.url&&window.open(h.url,"_blank"),{data:h,error:p}}}}return{...u,originalIsAdmin:u.isAdmin,setTestRole:a,testRole:s,isTestingMode:n,createSubscription:async()=>{const{data:m,error:h}=await P.functions.invoke("create-subscription");return m?.url&&window.open(m.url,"_blank"),{data:m,error:h}},openCustomerPortal:async()=>{const{data:m,error:h}=await P.functions.invoke("customer-portal");return m?.url&&window.open(m.url,"_blank"),{data:m,error:h}}}},$u=(e,s,r)=>{if(e.message?.includes("Monthly request limit")||e.limit_reached){const a=e.current_tier||"free_user";return s(a==="free_user"?{title:"AI Features Unavailable",description:"AI features are only available to premium users. Upgrade now to unlock unlimited AI assistance!",variant:"default",action:t.jsx(A,{onClick:r,size:"sm",className:"ml-2",children:"Upgrade Now"}),duration:8e3}:{title:"Monthly Limit Reached",description:"You've reached your monthly AI request limit. Your limit will reset next month.",variant:"destructive",duration:6e3}),!0}return!1},Y0=(e,s)=>{e({title:"Food Tracking Unavailable",description:"Food tracking is only available to premium users. Upgrade now to unlock unlimited food logging!",variant:"default",action:t.jsx(A,{onClick:s,size:"sm",className:"ml-2",children:"Upgrade Now"}),duration:8e3})},X0=e=>{const{access_level:s,hasPremiumFeatures:r,createSubscription:a,testRole:n,isTestingMode:o}=Xe(),{toast:i}=pe(),f=(o?n:s)==="admin"||(o?n==="paid_user"||n==="admin":r),u={sm:"h-8 w-8",md:"h-12 w-12",lg:"h-16 w-16"},m={sm:"h-3 w-3",md:"h-5 w-5",lg:"h-6 w-6"},h=e.size||"md";return f?t.jsx(fr,{...e}):t.jsx(A,{onClick:()=>{$u({current_tier:"free",limit_reached:!0},i,a)},disabled:e.isDisabled,className:`
          ${u[h]} 
          rounded-full 
          transition-all 
          duration-200 
          bg-green-500 hover:bg-green-600
          text-white
          opacity-50
        `,title:"Voice Input (Premium Feature)",children:t.jsx(Vs,{className:m[h]})})},J0=({content:e,role:s,index:r})=>{const[a,n]=c.useState(!1);c.useEffect(()=>{const i=setTimeout(()=>n(!0),r*200);return()=>clearTimeout(i)},[r]);const o=s==="user";return t.jsx("div",{className:Z("w-full mb-6 transition-all duration-500 ease-out px-4","flex",o?"justify-end":"justify-start",a?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:t.jsxs("div",{className:Z("max-w-[85%] p-4 rounded-2xl shadow-lg relative","border",o?"bg-ai/90 border-ai/50 text-white rounded-tr-sm":"bg-primary/90 border-primary/50 text-white rounded-tl-sm"),children:[t.jsx("p",{className:"text-sm leading-relaxed font-medium",children:e}),t.jsx("div",{className:Z("absolute w-2 h-2 rounded-full",o?"bg-ai -bottom-1 -right-1":"bg-primary -bottom-1 -left-1","animate-pulse")})]})})};var Z0=c.createContext(void 0);function Ys(e){const s=c.useContext(Z0);return e||s||"ltr"}function Jr(e,[s,r]){return Math.min(r,Math.max(s,e))}function ej(e,s){return c.useReducer((r,a)=>s[r][a]??r,e)}var Bi="ScrollArea",[Uu,U2]=St(Bi),[tj,Ot]=Uu(Bi),zu=c.forwardRef((e,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:o=600,...i}=e,[l,d]=c.useState(null),[f,u]=c.useState(null),[m,h]=c.useState(null),[p,g]=c.useState(null),[x,v]=c.useState(null),[w,y]=c.useState(0),[b,j]=c.useState(0),[N,E]=c.useState(!1),[S,_]=c.useState(!1),C=Ne(s,T=>d(T)),k=Ys(n);return t.jsx(tj,{scope:r,type:a,dir:k,scrollHideDelay:o,scrollArea:l,viewport:f,onViewportChange:u,content:m,onContentChange:h,scrollbarX:p,onScrollbarXChange:g,scrollbarXEnabled:N,onScrollbarXEnabledChange:E,scrollbarY:x,onScrollbarYChange:v,scrollbarYEnabled:S,onScrollbarYEnabledChange:_,onCornerWidthChange:y,onCornerHeightChange:j,children:t.jsx(xe.div,{dir:k,...i,ref:C,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":b+"px",...e.style}})})});zu.displayName=Bi;var qu="ScrollAreaViewport",Wu=c.forwardRef((e,s)=>{const{__scopeScrollArea:r,children:a,asChild:n,nonce:o,...i}=e,l=Ot(qu,r),d=c.useRef(null),f=Ne(s,d,l.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:o}),t.jsx(xe.div,{"data-radix-scroll-area-viewport":"",...i,asChild:n,ref:f,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:uj({asChild:n,children:a},u=>t.jsx("div",{"data-radix-scroll-area-content":"",ref:l.onContentChange,style:{minWidth:l.scrollbarXEnabled?"fit-content":void 0},children:u}))})]})});Wu.displayName=qu;var ns="ScrollAreaScrollbar",Gi=c.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Ot(ns,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:i}=n,l=e.orientation==="horizontal";return c.useEffect(()=>(l?o(!0):i(!0),()=>{l?o(!1):i(!1)}),[l,o,i]),n.type==="hover"?t.jsx(sj,{...a,ref:s,forceMount:r}):n.type==="scroll"?t.jsx(rj,{...a,ref:s,forceMount:r}):n.type==="auto"?t.jsx(Bu,{...a,ref:s,forceMount:r}):n.type==="always"?t.jsx(Vi,{...a,ref:s}):null});Gi.displayName=ns;var sj=c.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Ot(ns,e.__scopeScrollArea),[o,i]=c.useState(!1);return c.useEffect(()=>{const l=n.scrollArea;let d=0;if(l){const f=()=>{window.clearTimeout(d),i(!0)},u=()=>{d=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",f),l.addEventListener("pointerleave",u),()=>{window.clearTimeout(d),l.removeEventListener("pointerenter",f),l.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),t.jsx(_t,{present:r||o,children:t.jsx(Bu,{"data-state":o?"visible":"hidden",...a,ref:s})})}),rj=c.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Ot(ns,e.__scopeScrollArea),o=e.orientation==="horizontal",i=Nn(()=>d("SCROLL_END"),100),[l,d]=ej("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return c.useEffect(()=>{if(l==="idle"){const f=window.setTimeout(()=>d("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(f)}},[l,n.scrollHideDelay,d]),c.useEffect(()=>{const f=n.viewport,u=o?"scrollLeft":"scrollTop";if(f){let m=f[u];const h=()=>{const p=f[u];m!==p&&(d("SCROLL"),i()),m=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[n.viewport,o,d,i]),t.jsx(_t,{present:r||l!=="hidden",children:t.jsx(Vi,{"data-state":l==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:ae(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:ae(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),Bu=c.forwardRef((e,s)=>{const r=Ot(ns,e.__scopeScrollArea),{forceMount:a,...n}=e,[o,i]=c.useState(!1),l=e.orientation==="horizontal",d=Nn(()=>{if(r.viewport){const f=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;i(l?f:u)}},10);return pr(r.viewport,d),pr(r.content,d),t.jsx(_t,{present:a||o,children:t.jsx(Vi,{"data-state":o?"visible":"hidden",...n,ref:s})})}),Vi=c.forwardRef((e,s)=>{const{orientation:r="vertical",...a}=e,n=Ot(ns,e.__scopeScrollArea),o=c.useRef(null),i=c.useRef(0),[l,d]=c.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=Ku(l.viewport,l.content),u={...a,sizes:l,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:h=>o.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function m(h,p){return cj(h,i.current,l,p)}return r==="horizontal"?t.jsx(aj,{...u,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollLeft,p=xc(h,l,n.dir);o.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=m(h,n.dir))}}):r==="vertical"?t.jsx(nj,{...u,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollTop,p=xc(h,l);o.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=m(h))}}):null}),aj=c.forwardRef((e,s)=>{const{sizes:r,onSizesChange:a,...n}=e,o=Ot(ns,e.__scopeScrollArea),[i,l]=c.useState(),d=c.useRef(null),f=Ne(s,d,o.onScrollbarXChange);return c.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),t.jsx(Vu,{"data-orientation":"horizontal",...n,ref:f,sizes:r,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":jn(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,m)=>{if(o.viewport){const h=o.viewport.scrollLeft+u.deltaX;e.onWheelScroll(h),Xu(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&o.viewport&&i&&a({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:Va(i.paddingLeft),paddingEnd:Va(i.paddingRight)}})}})}),nj=c.forwardRef((e,s)=>{const{sizes:r,onSizesChange:a,...n}=e,o=Ot(ns,e.__scopeScrollArea),[i,l]=c.useState(),d=c.useRef(null),f=Ne(s,d,o.onScrollbarYChange);return c.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),t.jsx(Vu,{"data-orientation":"vertical",...n,ref:f,sizes:r,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":jn(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,m)=>{if(o.viewport){const h=o.viewport.scrollTop+u.deltaY;e.onWheelScroll(h),Xu(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&o.viewport&&i&&a({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:Va(i.paddingTop),paddingEnd:Va(i.paddingBottom)}})}})}),[oj,Gu]=Uu(ns),Vu=c.forwardRef((e,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:o,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:u,onResize:m,...h}=e,p=Ot(ns,r),[g,x]=c.useState(null),v=Ne(s,C=>x(C)),w=c.useRef(null),y=c.useRef(""),b=p.viewport,j=a.content-a.viewport,N=Dt(u),E=Dt(d),S=Nn(m,10);function _(C){if(w.current){const k=C.clientX-w.current.left,T=C.clientY-w.current.top;f({x:k,y:T})}}return c.useEffect(()=>{const C=k=>{const T=k.target;g?.contains(T)&&N(k,j)};return document.addEventListener("wheel",C,{passive:!1}),()=>document.removeEventListener("wheel",C,{passive:!1})},[b,g,j,N]),c.useEffect(E,[a,E]),pr(g,S),pr(p.content,S),t.jsx(oj,{scope:r,scrollbar:g,hasThumb:n,onThumbChange:Dt(o),onThumbPointerUp:Dt(i),onThumbPositionChange:E,onThumbPointerDown:Dt(l),children:t.jsx(xe.div,{...h,ref:v,style:{position:"absolute",...h.style},onPointerDown:ae(e.onPointerDown,C=>{C.button===0&&(C.target.setPointerCapture(C.pointerId),w.current=g.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),_(C))}),onPointerMove:ae(e.onPointerMove,_),onPointerUp:ae(e.onPointerUp,C=>{const k=C.target;k.hasPointerCapture(C.pointerId)&&k.releasePointerCapture(C.pointerId),document.body.style.webkitUserSelect=y.current,p.viewport&&(p.viewport.style.scrollBehavior=""),w.current=null})})})}),Ga="ScrollAreaThumb",Hu=c.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Gu(Ga,e.__scopeScrollArea);return t.jsx(_t,{present:r||n.hasThumb,children:t.jsx(ij,{ref:s,...a})})}),ij=c.forwardRef((e,s)=>{const{__scopeScrollArea:r,style:a,...n}=e,o=Ot(Ga,r),i=Gu(Ga,r),{onThumbPositionChange:l}=i,d=Ne(s,m=>i.onThumbChange(m)),f=c.useRef(),u=Nn(()=>{f.current&&(f.current(),f.current=void 0)},100);return c.useEffect(()=>{const m=o.viewport;if(m){const h=()=>{if(u(),!f.current){const p=dj(m,l);f.current=p,l()}};return l(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[o.viewport,u,l]),t.jsx(xe.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:ae(e.onPointerDownCapture,m=>{const p=m.target.getBoundingClientRect(),g=m.clientX-p.left,x=m.clientY-p.top;i.onThumbPointerDown({x:g,y:x})}),onPointerUp:ae(e.onPointerUp,i.onThumbPointerUp)})});Hu.displayName=Ga;var Hi="ScrollAreaCorner",Qu=c.forwardRef((e,s)=>{const r=Ot(Hi,e.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?t.jsx(lj,{...e,ref:s}):null});Qu.displayName=Hi;var lj=c.forwardRef((e,s)=>{const{__scopeScrollArea:r,...a}=e,n=Ot(Hi,r),[o,i]=c.useState(0),[l,d]=c.useState(0),f=!!(o&&l);return pr(n.scrollbarX,()=>{const u=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(u),d(u)}),pr(n.scrollbarY,()=>{const u=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(u),i(u)}),f?t.jsx(xe.div,{...a,ref:s,style:{width:o,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Va(e){return e?parseInt(e,10):0}function Ku(e,s){const r=e/s;return isNaN(r)?0:r}function jn(e){const s=Ku(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-r)*s;return Math.max(a,18)}function cj(e,s,r,a="ltr"){const n=jn(r),o=n/2,i=s||o,l=n-i,d=r.scrollbar.paddingStart+i,f=r.scrollbar.size-r.scrollbar.paddingEnd-l,u=r.content-r.viewport,m=a==="ltr"?[0,u]:[u*-1,0];return Yu([d,f],m)(e)}function xc(e,s,r="ltr"){const a=jn(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,o=s.scrollbar.size-n,i=s.content-s.viewport,l=o-a,d=r==="ltr"?[0,i]:[i*-1,0],f=Jr(e,d);return Yu([0,i],[0,l])(f)}function Yu(e,s){return r=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(r-e[0])}}function Xu(e,s){return e>0&&e<s}var dj=(e,s=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},a=0;return function n(){const o={left:e.scrollLeft,top:e.scrollTop},i=r.left!==o.left,l=r.top!==o.top;(i||l)&&s(),r=o,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function Nn(e,s){const r=Dt(e),a=c.useRef(0);return c.useEffect(()=>()=>window.clearTimeout(a.current),[]),c.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function pr(e,s){const r=Dt(s);jt(()=>{let a=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(a),n.unobserve(e)}}},[e,r])}function uj(e,s){const{asChild:r,children:a}=e;if(!r)return typeof s=="function"?s(a):s;const n=c.Children.only(a);return c.cloneElement(n,{children:typeof s=="function"?s(n.props.children):s})}var Ju=zu,mj=Wu,hj=Qu;const Zu=c.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Ju,{ref:a,className:Z("relative overflow-hidden",e),...r,children:[t.jsx(mj,{className:"h-full w-full rounded-[inherit]",children:s}),t.jsx(em,{}),t.jsx(hj,{})]}));Zu.displayName=Ju.displayName;const em=c.forwardRef(({className:e,orientation:s="vertical",...r},a)=>t.jsx(Gi,{ref:a,orientation:s,className:Z("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:t.jsx(Hu,{className:"relative flex-1 rounded-full bg-border"})}));em.displayName=Gi.displayName;const fj=()=>{const{toast:e}=pe();return{withValidSession:c.useCallback(async function(r,a="Operation"){try{const{data:{session:n},error:o}=await P.auth.getSession();if(o||!n?.user?.id)return console.warn(`ðŸš« ${a} blocked - no valid session`),e({title:"Authentication Required",description:"Please sign in to continue.",variant:"destructive"}),null;const{error:i}=await P.rpc("is_current_user_admin");if(i?.message?.includes("permission denied")||i?.message?.includes("insufficient_privilege")){console.warn(`ðŸš« ${a} blocked - auth.uid() returning NULL`);const{error:l}=await P.auth.refreshSession();return l?(e({title:"Session Expired",description:"Please sign in again to continue.",variant:"destructive"}),null):(console.log(`ðŸ”„ Retrying ${a} after session refresh`),await r())}return await r()}catch(n){return console.error(`âŒ ${a} session validation failed:`,n),e({title:"Session Error",description:"Please sign in again to continue.",variant:"destructive"}),null}},[e])}},Oo="fastnow_fasting_session",Lo="fastnow_walking_session",ja=e=>{typeof localStorage>"u"||(e?localStorage.setItem(Oo,JSON.stringify(e)):localStorage.removeItem(Oo))},pj=()=>{if(typeof localStorage>"u")return null;try{const e=localStorage.getItem(Oo);return e?JSON.parse(e):null}catch{return null}},Na=e=>{typeof localStorage>"u"||(e?localStorage.setItem(Lo,JSON.stringify(e)):localStorage.removeItem(Lo))},vc=()=>{if(typeof localStorage>"u")return null;try{const e=localStorage.getItem(Lo);return e?JSON.parse(e):null}catch{return null}},Qi=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!1),{user:n}=Se(),{toast:o}=pe(),{withValidSession:i}=fj(),l=c.useCallback(async()=>{if(!n){s(null),a(!1);return}a(!0);try{const{data:m,error:h}=await P.from("fasting_sessions").select("*").eq("user_id",n.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();h&&console.error("Error loading fasting session:",h);const p=m||null;s(p),p&&ja({id:p.id,start_time:p.start_time,goal_duration_seconds:p.goal_duration_seconds,status:p.status,user_id:p.user_id})}catch(m){console.error("Error loading active session:",m);const h=pj();h&&h.user_id===n.id&&h.status==="active"?s(h):s(null)}finally{a(!1)}},[n]);c.useEffect(()=>{n?l():(s(null),a(!1))},[n,l]);const d=c.useCallback(async(m,h)=>i(async()=>{if(!n)return o({title:"Error",description:"You must be logged in to start a fasting session",variant:"destructive"}),null;a(!0);try{await P.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",n.id).eq("status","active");const p=h?h.toISOString():new Date().toISOString(),{data:g,error:x}=await P.from("fasting_sessions").insert([{user_id:n.id,start_time:p,goal_duration_seconds:m,status:"active"}]).select().single();if(x)throw x;const v=g;return s(v),ja({id:v.id,start_time:v.start_time,goal_duration_seconds:v.goal_duration_seconds,status:v.status,user_id:v.user_id}),v}catch(p){return console.error("Error starting fasting session:",p),o({title:"Error",description:"Failed to start fasting session",variant:"destructive"}),null}finally{a(!1)}},"Start Fasting Session"),[n,o,i]),f=c.useCallback(async m=>i(async()=>{if(!n)return null;const h=m||e?.id;if(!h)return null;a(!0);try{const p=new Date().toISOString(),g=e?.start_time||new Date().toISOString(),x=Math.floor((new Date(p).getTime()-new Date(g).getTime())/1e3),v=e?.goal_duration_seconds||0,w=x>=v?"completed":"cancelled",{data:y,error:b}=await P.from("fasting_sessions").update({status:w,end_time:p,duration_seconds:x}).eq("id",h).eq("user_id",n.id).select().single();if(b)throw b;return s(null),ja(null),y}catch(p){return console.error("Error ending fasting session:",p),o({title:"Error",description:"Failed to end fasting session",variant:"destructive"}),null}finally{a(!1)}},"End Fasting Session"),[n,e,o,i]),u=c.useCallback(async m=>{if(!n)return null;const h=m||e?.id;if(!h)return null;a(!0);try{const{data:p,error:g}=await P.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("id",h).eq("user_id",n.id).select().single();if(g)throw g;return s(null),ja(null),p}catch(p){return console.error("Error cancelling fasting session:",p),o({title:"Error",description:"Failed to cancel fasting session",variant:"destructive"}),null}finally{a(!1)}},[n,e,o]);return{currentSession:e,loading:r,startFastingSession:d,endFastingSession:f,cancelFastingSession:u,loadActiveSession:l}},rr=e=>["profile",e],gj=()=>{const{user:e}=Ks(),s=Ct(),{toast:r}=pe(),a=bt({queryKey:rr(e?.id||null),queryFn:async()=>{if(!e)throw new Error("User not authenticated");const{data:d,error:f}=await P.from("profiles").select("*").eq("user_id",e.id).single();if(f&&f.code!=="PGRST116")throw f;return d||null},enabled:!!e?.id,staleTime:5*60*1e3,gcTime:10*60*1e3,retry:3,retryDelay:d=>Math.min(1e3*2**d,3e4)}),n=yt({mutationFn:async d=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await P.from("profiles").upsert({user_id:e.id,...d,updated_at:new Date().toISOString()}).select().single();if(u)throw u;return f},onMutate:async d=>{await s.cancelQueries({queryKey:rr(e?.id||null)});const f=s.getQueryData(rr(e?.id||null));return s.setQueryData(rr(e?.id||null),u=>u?{...u,...d}:{user_id:e?.id||"",...d}),{previousProfile:f}},onError:(d,f,u)=>{u?.previousProfile&&s.setQueryData(rr(e?.id||null),u.previousProfile),r({title:"Profile Update Failed",description:"There was an error updating your profile. Please try again.",variant:"destructive"})},onSuccess:()=>{r({title:"Profile Updated",description:"Your profile has been successfully updated."})},onSettled:()=>{s.invalidateQueries({queryKey:rr(e?.id||null)})}}),o=()=>{const d=a.data;return d?.onboarding_completed||!!(d?.weight&&d?.height&&d?.age&&d?.sex)},i=()=>{const d=a.data;if(!d?.weight||!d?.height||!d?.age)return 0;const f=d.weight,u=d.height;let m;return d.sex==="female"?m=Math.round(10*f+6.25*u-5*d.age-161):m=Math.round(10*f+6.25*u-5*d.age+5),m},l=(d,f=3)=>{const u=a.data;if(!u?.weight||!o())return 0;const m=u.weight;let h=f*1.60934,p=3;h<4?p=2.5:h<5.6?p=3:h<6.4?p=3.5:h<7.2?p=4:p=4.5;const g=d/60;return Math.round(p*m*g)};return{profile:a.data,loading:a.isLoading,error:a.error,updateProfile:n.mutate,isUpdating:n.isPending,isProfileComplete:o,calculateBMR:i,calculateWalkingCalories:l,refetch:a.refetch}},xj=(e,s)=>{const r=e*.414;let a=1;return s<=2.5?a=.9:s<=3.5?a=1:s<=4.5?a=1.1:a=1.2,r*a},vj=({durationMinutes:e,speedMph:s,userHeight:r=70,units:a="imperial"})=>{const n=a==="metric"?r/2.54:r,i=e/60*s*63360,l=xj(n,s);return Math.round(i/l)},$o=(e,s)=>s.some(r=>e instanceof r);let yc,wc;function yj(){return yc||(yc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wj(){return wc||(wc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uo=new WeakMap,eo=new WeakMap,Sn=new WeakMap;function bj(e){const s=new Promise((r,a)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{r(Is(e.result)),n()},i=()=>{a(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)});return Sn.set(s,e),s}function jj(e){if(Uo.has(e))return;const s=new Promise((r,a)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{r(),n()},i=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});Uo.set(e,s)}let zo={get(e,s,r){if(e instanceof IDBTransaction){if(s==="done")return Uo.get(e);if(s==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Is(e[s])},set(e,s,r){return e[s]=r,!0},has(e,s){return e instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in e}};function tm(e){zo=e(zo)}function Nj(e){return wj().includes(e)?function(...s){return e.apply(qo(this),s),Is(this.request)}:function(...s){return Is(e.apply(qo(this),s))}}function Sj(e){return typeof e=="function"?Nj(e):(e instanceof IDBTransaction&&jj(e),$o(e,yj())?new Proxy(e,zo):e)}function Is(e){if(e instanceof IDBRequest)return bj(e);if(eo.has(e))return eo.get(e);const s=Sj(e);return s!==e&&(eo.set(e,s),Sn.set(s,e)),s}const qo=e=>Sn.get(e);function _j(e,s,{blocked:r,upgrade:a,blocking:n,terminated:o}={}){const i=indexedDB.open(e,s),l=Is(i);return a&&i.addEventListener("upgradeneeded",d=>{a(Is(i.result),d.oldVersion,d.newVersion,Is(i.transaction),d)}),r&&i.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),l.then(d=>{o&&d.addEventListener("close",()=>o()),n&&d.addEventListener("versionchange",f=>n(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const Cj=["get","getKey","getAll","getAllKeys","count"],kj=["put","add","delete","clear"],to=new Map;function bc(e,s){if(!(e instanceof IDBDatabase&&!(s in e)&&typeof s=="string"))return;if(to.get(s))return to.get(s);const r=s.replace(/FromIndex$/,""),a=s!==r,n=kj.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||Cj.includes(r)))return;const o=async function(i,...l){const d=this.transaction(i,n?"readwrite":"readonly");let f=d.store;return a&&(f=f.index(l.shift())),(await Promise.all([f[r](...l),n&&d.done]))[0]};return to.set(s,o),o}tm(e=>({...e,get:(s,r,a)=>bc(s,r)||e.get(s,r,a),has:(s,r)=>!!bc(s,r)||e.has(s,r)}));const Ej=["continue","continuePrimaryKey","advance"],jc={},Wo=new WeakMap,sm=new WeakMap,Tj={get(e,s){if(!Ej.includes(s))return e[s];let r=jc[s];return r||(r=jc[s]=function(...a){Wo.set(this,sm.get(this)[s](...a))}),r}};async function*Mj(...e){let s=this;if(s instanceof IDBCursor||(s=await s.openCursor(...e)),!s)return;s=s;const r=new Proxy(s,Tj);for(sm.set(r,s),Sn.set(r,qo(s));s;)yield r,s=await(Wo.get(r)||s.continue()),Wo.delete(r)}function Nc(e,s){return s===Symbol.asyncIterator&&$o(e,[IDBIndex,IDBObjectStore,IDBCursor])||s==="iterate"&&$o(e,[IDBIndex,IDBObjectStore])}tm(e=>({...e,get(s,r,a){return Nc(s,r)?Mj:e.get(s,r,a)},has(s,r){return Nc(s,r)||e.has(s,r)}}));let so=null;const Xs=()=>(so||(so=_j("fastnow_outbox",1,{upgrade(e){e.objectStoreNames.contains("operations")||e.createObjectStore("operations",{keyPath:"id"}),e.objectStoreNames.contains("mappings")||e.createObjectStore("mappings",{keyPath:"localId"})}})),so),Pj=()=>globalThis.crypto?.randomUUID?.()??`id_${Date.now()}_${Math.random().toString(16).slice(2)}`,ar=async e=>{const s=await Xs(),r={id:Pj(),createdAt:Date.now(),attempts:0,...e};return await s.add("operations",r),Ha("changed"),r.id},rm=async()=>(await(await Xs()).getAll("operations")).sort((r,a)=>r.createdAt-a.createdAt),Dj=async e=>{await(await Xs()).put("operations",e)},Aj=async e=>{await(await Xs()).delete("operations",e),Ha("changed")},Rj=async()=>(await(await Xs()).getAllKeys("operations")).length,ro=async(e,s)=>{const r=await Xs(),a={localId:e,serverId:s,createdAt:Date.now()};await r.put("mappings",a)},ao=async e=>e?e.startsWith("local-")?(await(await Xs()).get("mappings",e))?.serverId??e:e:void 0,Ha=e=>{typeof window<"u"&&(window.dispatchEvent(new CustomEvent(`outbox:${e}`)),e==="sync-complete"&&window.dispatchEvent(new CustomEvent("outbox:sync")))},Js=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!1),[n,o]=c.useState(null),[i,l]=c.useState(!1),[d,f]=c.useState(0),{user:u}=Se(),{profile:m,calculateWalkingCalories:h}=gj(),p=c.useCallback(()=>{f(S=>S+1)},[]),g=c.useCallback(async()=>{if(u){a(!0);try{const{data:S,error:_}=await P.from("walking_sessions").select("*").eq("user_id",u.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();if(_){console.error("Error loading active walking session:",_);const k=vc();k&&k.user_id===u.id&&k.status==="active"&&(s(k),l(k.session_state==="paused"));return}const C=S||null;s(C),l(C?.session_state==="paused"),C&&Na({id:C.id,user_id:C.user_id,start_time:C.start_time,status:C.status,speed_mph:C.speed_mph,session_state:C.session_state,pause_start_time:C.pause_start_time,total_pause_duration:C.total_pause_duration})}catch(S){console.error("Error loading active walking session:",S);const _=vc();_&&_.user_id===u.id&&_.status==="active"&&(s(_),l(_.session_state==="paused"))}finally{a(!1)}}},[u]),x=c.useCallback(async S=>{if(!u)return{error:{message:"User not authenticated"},data:null};const _=S||n||3,C=new Date().toISOString();console.log("Starting walking session with speed:",{speedMph:S,selectedSpeed:n,finalSpeed:_});const k={id:`temp-${Date.now()}-${Math.random().toString(16).slice(2)}`,user_id:u.id,start_time:C,status:"active",session_state:"active",total_pause_duration:0,speed_mph:_};s(k),n===null&&o(_),l(!1);const T=async()=>{const D=`local-${Date.now()}-${Math.random().toString(16).slice(2)}`,W={...k,id:D};return s(W),await ar({entity:"walking_session",action:"start",user_id:u.id,payload:{local_id:D,start_time:C,speed_mph:_,status:"active",session_state:"active",total_pause_duration:0}}),{data:W,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await T();const{data:D,error:W}=await P.from("walking_sessions").insert({user_id:u.id,start_time:C,status:"active",speed_mph:_,session_state:"active",total_pause_duration:0}).select().single();if(W)throw W;return console.log("Walking session started successfully:",D),s(D),Na({id:D.id,user_id:D.user_id,start_time:D.start_time,status:D.status,speed_mph:D.speed_mph,session_state:D.session_state,pause_start_time:D.pause_start_time,total_pause_duration:D.total_pause_duration}),console.log("Triggering refresh after session start"),p(),{data:D,error:null}}catch(D){return console.error("Error starting walking session:",D),D?.message?.includes("fetch")?await T():(s(null),l(!1),{error:D,data:null})}finally{a(!1)}},[u,n,p]),v=c.useCallback(async()=>{if(!u||!e)return{error:{message:"No active session"},data:null};const S=async()=>{const _=new Date().toISOString(),C={...e,session_state:"paused",pause_start_time:_};return s(C),l(!0),await ar({entity:"walking_session",action:"pause",user_id:u.id,payload:{session_id:e.id,pause_start_time:_}}),{data:C,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await S();const{data:_,error:C}=await P.from("walking_sessions").update({session_state:"paused",pause_start_time:new Date().toISOString()}).eq("id",e.id).select().single();if(C)throw C;return s(_),l(!0),p(),{data:_,error:null}}catch(_){return console.error("Error pausing walking session:",_),_.message?.includes("fetch")?await S():{error:_,data:null}}finally{a(!1)}},[u,e,p]),w=c.useCallback(async()=>{if(!u||!e)return{error:{message:"No active session"},data:null};const S=async()=>{const _=e.pause_start_time?Math.floor((new Date().getTime()-new Date(e.pause_start_time).getTime())/1e3):0,C={...e,session_state:"active",pause_start_time:null,total_pause_duration:(e.total_pause_duration||0)+_};return s(C),l(!1),await ar({entity:"walking_session",action:"resume",user_id:u.id,payload:{session_id:e.id,pause_duration_seconds:_}}),{data:C,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await S();const _=e.pause_start_time?Math.floor((new Date().getTime()-new Date(e.pause_start_time).getTime())/1e3):0,{data:C,error:k}=await P.from("walking_sessions").update({session_state:"active",pause_start_time:null,total_pause_duration:(e.total_pause_duration||0)+_}).eq("id",e.id).select().single();if(k)throw k;return s(C),l(!1),p(),{data:C,error:null}}catch(_){return console.error("Error resuming walking session:",_),_.message?.includes("fetch")?await S():{error:_,data:null}}finally{a(!1)}},[u,e,p]),y=c.useCallback(async S=>{if(console.log("Ending walking session..."),!u||!e)return{error:{message:"No active session"},data:null};const _=()=>{const k=new Date,T=new Date(e.start_time);let D,W=!1;if(S)D=S,W=!0;else{let G=k.getTime()-T.getTime(),L=e.total_pause_duration||0;if(i&&e.pause_start_time){const B=Math.floor((k.getTime()-new Date(e.pause_start_time).getTime())/1e3);L+=B}D=G/(1e3*60)-L/60}const $=e.speed_mph||n||3;let V={end_time:(W?new Date(T.getTime()+D*60*1e3):k).toISOString(),status:"completed",session_state:"completed"};if(W)V={...V,calories_burned:null,distance:null,estimated_steps:null,is_edited:!0,edit_reason:"Manual duration correction"};else{const G=h(D,$),L=D/60*$,B=m?.height||175,te=vj({durationMinutes:D,speedMph:$,userHeight:B,units:"metric"});V={...V,calories_burned:G,distance:Math.round(L*100)/100,estimated_steps:te,total_pause_duration:e.total_pause_duration||0}}return V},C=async()=>{const k=_();return s(null),l(!1),await ar({entity:"walking_session",action:"end",user_id:u.id,payload:{session_id:e.id,updateData:k}}),p(),{data:{...e,...k},error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await C();const k=_(),{data:T,error:D}=await P.from("walking_sessions").update(k).eq("id",e.id).select().single();if(D)throw D;return s(null),l(!1),Na(null),p(),setTimeout(()=>{g()},100),{data:T,error:null}}catch(k){return console.error("Error ending walking session:",k),k.message?.includes("fetch")?await C():{error:k,data:null}}finally{a(!1)}},[u,e,n,h,i,m,p,g]),b=c.useCallback(async()=>{if(console.log("Cancelling walking session..."),!u||!e)return{error:{message:"No active session"},data:null};const S=async()=>(s(null),l(!1),await ar({entity:"walking_session",action:"cancel",user_id:u.id,payload:{session_id:e.id}}),p(),{data:!0,error:null});a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await S();const{error:_}=await P.from("walking_sessions").delete().eq("id",e.id);if(_)throw _;return s(null),l(!1),Na(null),p(),{data:!0,error:null}}catch(_){return console.error("Error cancelling walking session:",_),_.message?.includes("fetch")?await S():{error:_,data:null}}finally{a(!1)}},[u,e,p]);c.useEffect(()=>{let S=!0;return(async()=>{S&&await g()})(),()=>{S=!1}},[g]),c.useEffect(()=>{console.log("Speed initialization effect triggered:",{profileSpeed:m?.default_walking_speed,currentSelectedSpeed:n,user:u?.id}),m?.default_walking_speed!=null?(console.log("Setting selectedSpeed from profile:",m.default_walking_speed),o(m.default_walking_speed)):n===null&&(console.log("Setting default selectedSpeed to 3 (no profile speed available)"),o(3))},[m?.default_walking_speed,u]);const j=c.useCallback(async S=>{if(!e||!u)return{error:null,data:null};const _=async()=>{const C={...e,speed_mph:S};return s(C),await ar({entity:"walking_session",action:"update_speed",user_id:u.id,payload:{session_id:e.id,speed_mph:S}}),{data:C,error:null}};console.log("Updating session speed:",{currentSpeed:e.speed_mph,newSpeed:S}),a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await _();const{data:C,error:k}=await P.from("walking_sessions").update({speed_mph:S}).eq("id",e.id).select().single();if(k)throw console.error("Database error updating session speed:",k),k;return console.log("Successfully updated session speed:",C),s(C),{data:C,error:null}}catch(C){return console.error("Error updating session speed:",C),C.message?.includes("fetch")?await _():{error:C,data:null}}finally{a(!1)}},[u,e]),N=c.useCallback(async S=>{if(!u)return!1;try{const{data:_,error:C}=await P.from("profiles").update({default_walking_speed:S}).eq("user_id",u.id);if(C)throw console.error("Database error saving walking speed:",C),C;return!0}catch(_){return console.error("Error saving walking speed to profile:",_),!1}},[u]),E=c.useCallback(async S=>{o(S);try{await N(S)?console.log("Walking speed saved successfully:",S):console.error("Failed to save walking speed, keeping optimistic update")}catch(_){console.error("Error saving walking speed:",_)}},[N]);return{currentSession:e,loading:r,selectedSpeed:n||3,setSelectedSpeed:E,updateSelectedSpeed:E,isPaused:i,startWalkingSession:x,pauseWalkingSession:v,resumeWalkingSession:w,endWalkingSession:y,cancelWalkingSession:b,loadActiveSession:g,updateSessionSpeed:j,refreshTrigger:d,triggerRefresh:p}},am=()=>({executeWithRetry:c.useCallback(async(s,r=3)=>{for(let a=1;a<=r;a++)try{return await s()}catch(n){if(console.log(`Attempt ${a} failed:`,n),a===r)throw n;await new Promise(o=>setTimeout(o,Math.pow(2,a)*1e3))}},[])}),Qa="fastnow_cache_",nm=(e,s,r=24)=>{try{const a={data:s,cached_at:Date.now(),expires_at:Date.now()+r*60*60*1e3};localStorage.setItem(`${Qa}${e}`,JSON.stringify(a))}catch(a){console.warn("Failed to cache data:",a)}},om=e=>{try{const s=localStorage.getItem(`${Qa}${e}`);if(!s)return null;const r=JSON.parse(s);return Date.now()>r.expires_at?(localStorage.removeItem(`${Qa}${e}`),null):r.data}catch(s){return console.warn("Failed to retrieve cached data:",s),null}},Sc=(e,s,r=24)=>{nm(`profile_${e}`,s,r)},Ij=e=>om(`profile_${e}`),Fj=(e,s,r=5)=>{const a=r/60;nm(`request_${e}`,s,a)},_c=e=>om(`request_${e}`),Cc=()=>{try{const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r?.startsWith(Qa))try{const a=localStorage.getItem(r);if(a){const n=JSON.parse(a);Date.now()>n.expires_at&&e.push(r)}}catch{e.push(r)}}e.forEach(s=>localStorage.removeItem(s))}catch(e){console.warn("Failed to cleanup expired data:",e)}},Rr=new Map,Oj=async(e,s,r=5,a=!0)=>{if(a&&typeof document<"u"&&document.hidden){console.log(`Skipping request ${e} - page not visible`);const i=_c(e);if(i)return i}const n=_c(e);if(n)return n;if(Rr.has(e))return Rr.get(e);const o=s().then(async i=>(Fj(e,i,r),Rr.delete(e),i)).catch(i=>{throw Rr.delete(e),i});return Rr.set(e,o),o};let kc=!1;const Lj=()=>{kc||(Cc(),setInterval(Cc,60*60*1e3),kc=!0)},Te=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!1),{user:n}=Ks(),{toast:o}=pe(),{executeWithRetry:i}=am(),l=c.useCallback(async(h=!1)=>{if(!n){s(null),a(!1);return}if(!h){const p=Ij(n.id);if(p&&p.weight&&p.height&&p.age){console.log("Using cached profile data:",p),s(p),a(!1);return}else console.log("Cache invalid or incomplete, fetching fresh profile data")}a(!0);try{let p=null;if(h){const g=await i(async()=>await P.from("profiles").select("*").eq("user_id",n.id).maybeSingle()),{data:x,error:v}=g;if(v)throw console.error("Profile load error (force):",v),v;p=x}else p=await Oj(`profile_${n.id}`,async()=>{const g=await i(async()=>await P.from("profiles").select("*").eq("user_id",n.id).maybeSingle()),{data:x,error:v}=g;if(v)throw console.error("Profile load error:",v),v;return x},30);console.log("Profile loaded successfully:",p),p&&Sc(n.id,p,1),s(p||null)}catch(p){console.error("Error loading profile:",p),s(null),o({variant:"destructive",title:"Connection Error",description:"Unable to load profile. Please check your internet connection."})}finally{a(!1)}},[n?.id,i,o]),d=c.useCallback(async h=>{if(!n)return console.error("updateProfile: User not authenticated"),{error:{message:"User not authenticated"}};console.log("updateProfile: Starting update for user:",n.id),a(!0);try{const{data:{session:p}}=await P.auth.getSession();if(!p)throw console.error("updateProfile: No valid session found"),new Error("No valid session. Please log in again.");console.log("updateProfile: Valid session found, executing update with data:",h);const g=await i(async()=>{console.log("updateProfile: Making database upsert call with user_id:",n.id);const{data:b,error:j}=await P.from("profiles").upsert({user_id:n.id,...h},{onConflict:"user_id"}).select().single();return console.log("updateProfile: Database response:",{data:b,error:j}),{data:b,error:j}}),{data:x,error:v}=g;if(console.log("Database response:",{data:x,error:v}),v)throw console.error("Database error:",v),v;if(!x)throw console.error("No data returned from database"),new Error("No data returned from database");console.log("Updating profile state with:",x),s(x);const w=`profile_${n.id}`,y=`profile_${n.id}`;return typeof window<"u"&&(localStorage.removeItem(`cache_${w}`),localStorage.removeItem(`dedupe_${y}`)),Sc(n.id,x,1),{data:x,error:null}}catch(p){return console.error("Error updating profile:",p),o({variant:"destructive",title:"Update failed",description:`Unable to save profile: ${p.message||"Please try again."}`}),{error:p,data:null}}finally{a(!1)}},[n,i,o,l]),f=c.useCallback(()=>{const h=!!(e&&e.weight&&e.height&&e.age&&(e.activity_level||e["activity-level"])&&e.onboarding_completed);return console.log("Profile completion check:",{complete:h,weight:e?.weight,height:e?.height,age:e?.age,activity_level:e?.activity_level,onboarding_completed:e?.onboarding_completed,profile:e}),h},[e?.weight,e?.height,e?.age,e?.activity_level,e?.onboarding_completed]),u=()=>{if(!e||!e.weight||!e.height||!e.age)return 0;let h,p;return e.units==="metric"?(h=e.weight,p=e.height):(h=e.weight*.453592,p=e.height*2.54),Math.round(10*h+6.25*p-5*e.age-78)},m=(h,p=3)=>{if(!e||!e.weight)return 0;const x={2:2.8,3:3.2,4:4.3,5:5.5}[p]||3.2;let v;return e.units==="metric"?v=e.weight:v=e.weight*.453592,Math.round(x*v*(h/60))};return c.useEffect(()=>{l()},[n?.id,l]),{profile:e,loading:r,updateProfile:d,loadProfile:l,isProfileComplete:f,calculateBMR:u,calculateWalkingCalories:m}},$j=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!1),{user:n}=Se(),o=async()=>{if(!n)return null;a(!0);try{const{data:l}=await P.from("profiles").select("daily_calorie_goal, daily_carb_goal").eq("user_id",n.id).single(),d=l?.daily_calorie_goal||2e3,f=l?.daily_carb_goal||150,u=new Date,m=new Date(u.getFullYear(),u.getMonth(),u.getDate()),h=new Date(m.getTime()+24*60*60*1e3),{data:p}=await P.from("food_entries").select("*").eq("user_id",n.id).gte("created_at",m.toISOString()).lt("created_at",h.toISOString()).order("created_at",{ascending:!1}),g=p?.reduce((_,C)=>_+(C.calories||0),0)||0,x=p?.reduce((_,C)=>_+(C.carbs||0),0)||0,v=new Date(m.getTime()-7*24*60*60*1e3),{data:w}=await P.from("food_entries").select("calories, carbs, created_at").eq("user_id",n.id).gte("created_at",v.toISOString()).lt("created_at",m.toISOString()),y=new Map;w?.forEach(_=>{const C=new Date(_.created_at).toDateString();y.has(C)||y.set(C,{calories:0,carbs:0});const k=y.get(C);k.calories+=_.calories||0,k.carbs+=_.carbs||0});const b=y.size>0?Array.from(y.values()).reduce((_,C)=>_+C.calories,0)/y.size:0,j=y.size>0?Array.from(y.values()).reduce((_,C)=>_+C.carbs,0)/y.size:0,N=(p?.slice(0,3)||[]).map(_=>({name:_.name,calories:_.calories||0,carbs:_.carbs||0,time:new Date(_.created_at).toLocaleTimeString()})),E=p?.[0]?new Date(p[0].created_at):null,S={todayCalories:g,todayCarbs:x,calorieGoal:d,carbGoal:f,caloriesRemaining:Math.max(0,d-g),carbsRemaining:Math.max(0,f-x),todayEntryCount:p?.length||0,lastMealTime:E,recentEntries:N,weeklyAverageCalories:b,weeklyAverageCarbs:j,currentTime:u.toLocaleTimeString(),currentDate:u.toLocaleDateString()};return s(S),S}catch(l){return console.error("Error fetching food context:",l),null}finally{a(!1)}},i=l=>{const d=[`Current time: ${l.currentTime} on ${l.currentDate}`];if(d.push(`Today's nutrition: ${l.todayCalories} calories (${l.caloriesRemaining} remaining of ${l.calorieGoal} goal), ${l.todayCarbs}g carbs (${l.carbsRemaining}g remaining of ${l.carbGoal}g goal)`,`Today's meal count: ${l.todayEntryCount} entries logged`),l.lastMealTime&&d.push(`Last meal logged: ${l.lastMealTime.toLocaleTimeString()}`),l.recentEntries.length>0){const f=l.recentEntries.map(u=>`${u.name} (${u.calories} cal, ${u.carbs}g carbs at ${u.time})`).join(", ");d.push(`Recent meals: ${f}`)}return l.weeklyAverageCalories>0&&d.push(`Weekly averages: ${Math.round(l.weeklyAverageCalories)} calories/day, ${Math.round(l.weeklyAverageCarbs)}g carbs/day`),d.join(". ")+"."};return c.useEffect(()=>{n?o():s(null)},[n]),{context:e,loading:r,buildContextString:i,refreshContext:o}},_n=()=>{const[e,s]=c.useState(!1),[r,a]=c.useState([]),[n,o]=c.useState(!1),[i,l]=c.useState([]),[d,f]=c.useState(new Set),[u,m]=c.useState(null),[h,p]=c.useState({}),{user:g}=Se(),{currentSession:x,startFastingSession:v,endFastingSession:w}=Qi(),{currentSession:y,startWalkingSession:b,endWalkingSession:j}=Js();Te();const{context:N,buildContextString:E,refreshContext:S}=$j();c.useEffect(()=>{const R=H=>{H.key==="Escape"&&e&&s(!1)},M=H=>{const U=H.target;e&&U.closest(".aquarium-container")===null&&U.closest(".ai-voice-button")===null&&s(!1)};return document.addEventListener("keydown",R),document.addEventListener("mousedown",M),()=>{document.removeEventListener("keydown",R),document.removeEventListener("mousedown",M)}},[e]),c.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[e]);const _=(R,M)=>{const H={id:Date.now().toString()+Math.random(),role:R,content:M,timestamp:new Date};return a(U=>[...U,H]),H.id},C=async(R,M=!1)=>{if(!(!g||n)){_("user",R),o(!0);try{const H=window.location.pathname,ee=`You are a helpful assistant for a fasting and health tracking app. Help users with app features, calculations, unit conversions, and guidance. Current page: ${T(H)}`,{data:ue,error:be}=await P.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:ee},{role:"user",content:R}]}});if(be)throw be;if(ue?.functionCall){console.log("ðŸ¤– AI Chat: Function call detected:",ue.functionCall.name);let je="";try{switch(ue.functionCall.name){case"add_multiple_foods":je=await W(ue.functionCall.arguments);break;case"create_motivator":je=await L(ue.functionCall.arguments);break;case"create_multiple_motivators":je=await B(ue.functionCall.arguments);break;case"start_fasting_session":je=await de(ue.functionCall.arguments);break;case"stop_fasting_session":je=await te();break;case"start_walking_session":je=await Y(ue.functionCall.arguments);break;case"stop_walking_session":je=await oe();break;case"edit_motivator":je=await O(ue.functionCall.arguments);break;case"delete_motivator":je=await Q(ue.functionCall.arguments);break;default:je="I processed your request successfully."}}catch(Ue){console.error("ðŸ¤– AI Chat: Function execution error:",Ue),je="Sorry, I had trouble processing that request. Please try again."}_("assistant",je),M&&await k(je)}else ue?.completion&&ue.completion.trim()?(_("assistant",ue.completion),M&&await k(ue.completion)):_("assistant","Sorry, I had trouble processing your request. Please try again.")}catch(H){console.error("AI Chat error:",H),Le({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"})}finally{o(!1)}}},k=async R=>{try{const{data:M,error:H}=await P.functions.invoke("text-to-speech",{body:{text:R.slice(0,500)}});if(H)throw H;M?.audioUrl&&new Audio(M.audioUrl).play()}catch(M){console.error("Text-to-speech error:",M)}},T=R=>{switch(R){case"/walking":return"Walking page - user can start/stop walking sessions, view walking history, and track calories burned";case"/timer":return"Fasting timer page - user can start/stop fasting sessions and see fasting progress";case"/food-tracking":return"Food tracking page - user can add food entries, track calories and carbs";case"/motivators":return"Motivators page - user can view and manage personal motivation cards";case"/settings":return"Settings page - user can configure their profile, goals, and app preferences";default:return"Main app interface for fasting and health tracking"}},D=R=>{R.trim()&&(s(!0),C(R,!0))},W=async R=>{const M=R?.foods||[];return console.log("ðŸ½ï¸ handleAddMultipleFoods called with:",M),M.length===0?"No foods to add.":(l(M),f(new Set(M.map((H,U)=>U))),"")},$=async()=>{const R=i.filter((M,H)=>d.has(H));if(R.length===0){Le({title:"No foods selected",description:"Please select at least one food to add.",variant:"destructive"});return}try{for(const U of R){const{error:ee}=await P.from("food_entries").insert({user_id:g.id,name:U.name,serving_size:U.serving_size||100,calories:U.calories||0,carbs:U.carbs||0,source_date:new Date().toISOString().split("T")[0]});if(ee)throw ee}await S();const M=R.reduce((U,ee)=>U+(ee.calories||0),0),H=R.map(U=>`${U.name} (${U.serving_size}g)`).join(", ");l([]),f(new Set),_("assistant",`Added ${H} - ${M} calories total`),Le({title:"Foods added successfully",description:`Added ${R.length} food${R.length===1?"":"s"}`})}catch(M){console.error("ðŸ½ï¸ Error adding foods:",M),Le({title:"Error adding foods",description:"Please try again.",variant:"destructive"})}},X=R=>{l(M=>M.filter((H,U)=>U!==R)),f(M=>{const H=new Set(M);H.delete(R);const U=new Set;return Array.from(H).forEach(ee=>{ee<R?U.add(ee):ee>R&&U.add(ee-1)}),U})},V=(R,M)=>{l(H=>H.map((U,ee)=>ee===R?{...U,...M}:U))},G=R=>{f(M=>{const H=new Set(M);return H.has(R)?H.delete(R):H.add(R),H})},L=async R=>{try{const{data:M,error:H}=await P.from("motivators").insert({user_id:g.id,title:R.title,content:R.content});if(H)throw H;return`Created motivator: "${R.title}"`}catch(M){return console.error("Error creating motivator:",M),"Sorry, I had trouble creating that motivator."}},B=async R=>{const M=R?.motivators||[];if(M.length===0)return"No motivators to create.";try{const H=M.map(ue=>({user_id:g.id,title:ue.title,content:ue.content})),{data:U,error:ee}=await P.from("motivators").insert(H);if(ee)throw ee;return`Created ${M.length} motivators successfully!`}catch(H){return console.error("Error creating motivators:",H),"Sorry, I had trouble creating those motivators."}},de=async R=>{try{return x?"You already have an active fasting session running.":(await v(16*60*60),"Fasting session started! Good luck with your fast.")}catch(M){return console.error("Error starting fasting session:",M),"Sorry, I had trouble starting your fasting session."}},te=async()=>{try{return x?(await w(),"Fasting session completed! Great work on your fast."):"You don't have an active fasting session to stop."}catch(R){return console.error("Error stopping fasting session:",R),"Sorry, I had trouble stopping your fasting session."}},Y=async R=>{try{return y?"You already have an active walking session running.":(await b(),"Walking session started! Enjoy your walk.")}catch(M){return console.error("Error starting walking session:",M),"Sorry, I had trouble starting your walking session."}},oe=async()=>{try{return y?(await j(),"Walking session completed! Well done."):"You don't have an active walking session to stop."}catch(R){return console.error("Error stopping walking session:",R),"Sorry, I had trouble stopping your walking session."}},O=async R=>{try{const{motivator_id:M,updates:H}=R,{data:U,error:ee}=await P.from("motivators").update(H).eq("id",M).eq("user_id",g.id);if(ee)throw ee;return"Updated motivator successfully."}catch(M){return console.error("Error editing motivator:",M),"Sorry, I had trouble updating that motivator."}},Q=async R=>{try{const{motivator_id:M}=R,{data:H,error:U}=await P.from("motivators").delete().eq("id",M).eq("user_id",g.id);if(U)throw U;return"Deleted motivator successfully."}catch(M){return console.error("Error deleting motivator:",M),"Sorry, I had trouble deleting that motivator."}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>s(!0),className:"ai-voice-button w-8 h-8 p-0 rounded-full bg-ai hover:bg-ai/90 hover:scale-110 transition-all duration-200",title:"AI Voice Assistant",children:t.jsx(Ns,{className:"w-4 h-4 text-white"})}),e&&t.jsx("div",{className:"fixed inset-0 z-50 flex justify-center bg-frame-background/50",children:t.jsxs("div",{className:"relative max-w-md w-full bg-background/5 backdrop-blur-lg",children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"absolute top-4 right-4 z-10 w-12 h-12 p-0 rounded-full bg-background/80 backdrop-blur-sm border border-border/50 hover:bg-background/90 hover:scale-110 transition-all duration-200",title:"Close",children:t.jsx(Ie,{className:"w-6 h-6 text-foreground"})}),t.jsxs("div",{className:"aquarium-container relative w-full h-screen flex flex-col",children:[t.jsx("div",{className:"flex-1 overflow-hidden pt-20 pb-24",children:t.jsx(Zu,{className:"h-full",children:t.jsxs("div",{className:"max-w-full mx-auto space-y-2",children:[r.map((R,M)=>t.jsx(J0,{content:R.content,role:R.role,index:M},R.id)),i.length>0&&t.jsx("div",{className:"px-4 space-y-4",children:t.jsx(ie,{className:"bg-background/90 backdrop-blur-sm border-border/50",children:t.jsxs($e,{className:"p-4",children:[t.jsx("h3",{className:"font-semibold mb-3",children:"Review and Add Foods"}),t.jsx("div",{className:"space-y-3",children:i.map((R,M)=>t.jsxs("div",{className:"flex items-center gap-3 p-2 rounded border border-border/50",children:[t.jsx(qi,{checked:d.has(M),onCheckedChange:()=>G(M),className:"shrink-0"}),u===M?t.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[t.jsx(ge,{value:h[M]?.name??R.name,onChange:H=>p(U=>({...U,[M]:{...U[M],name:H.target.value}})),placeholder:"Food name",className:"text-sm"}),t.jsx(ge,{type:"number",value:h[M]?.serving_size??R.serving_size,onChange:H=>p(U=>({...U,[M]:{...U[M],serving_size:Number(H.target.value)}})),placeholder:"Serving (g)",className:"text-sm"}),t.jsx(ge,{type:"number",value:h[M]?.calories??R.calories,onChange:H=>p(U=>({...U,[M]:{...U[M],calories:Number(H.target.value)}})),placeholder:"Calories",className:"text-sm"}),t.jsx(ge,{type:"number",value:h[M]?.carbs??R.carbs,onChange:H=>p(U=>({...U,[M]:{...U[M],carbs:Number(H.target.value)}})),placeholder:"Carbs (g)",className:"text-sm"}),t.jsxs("div",{className:"col-span-2 flex gap-2",children:[t.jsx(A,{size:"sm",onClick:()=>{V(M,h[M]||{}),m(null),p(H=>{const{[M]:U,...ee}=H;return ee})},className:"text-xs",children:"Save"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>{m(null),p(H=>{const{[M]:U,...ee}=H;return ee})},className:"text-xs",children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium text-sm",children:R.name}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[R.serving_size,"g â€¢ ",R.calories," cal â€¢ ",R.carbs,"g carbs"]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>m(M),className:"h-8 w-8 p-0",children:t.jsx(ut,{className:"h-3 w-3"})}),t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>X(M),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:t.jsx(We,{className:"h-3 w-3"})})]})]})]},M))}),d.size>0&&t.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded border-l-4 border-l-primary",children:[t.jsxs("div",{className:"text-sm font-medium",children:["Selected: ",d.size," food",d.size===1?"":"s"]}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",i.filter((R,M)=>d.has(M)).reduce((R,M)=>R+(M.calories||0),0)," calories, ",i.filter((R,M)=>d.has(M)).reduce((R,M)=>R+(M.carbs||0),0),"g carbs"]})]}),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs(A,{onClick:$,disabled:d.size===0,className:"flex-1",children:["Add Selected Foods (",d.size,")"]}),t.jsx(A,{variant:"outline",onClick:()=>{l([]),f(new Set),m(null),p({})},children:"Cancel"})]})]})})}),n&&t.jsx("div",{className:"w-full mb-4 flex justify-start px-4",children:t.jsx("div",{className:"bg-primary/90 border border-primary/50 rounded-2xl rounded-tl-sm p-4 animate-pulse",children:t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]})})}),t.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2",children:t.jsx(X0,{onTranscription:D,isDisabled:n,size:"lg"})})]})]})})]})},Ki=({onClick:e,title:s="View past entries"})=>t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 p-0 rounded-full bg-ceramic-plate/80 backdrop-blur-sm border border-ceramic-rim hover:bg-ceramic-plate hover:scale-110 transition-all duration-200",title:s,children:t.jsx(Lg,{className:"w-4 h-4 text-warm-text"})}),ca=({isOpen:e,onClose:s,title:r,subtitle:a,heroQuote:n,backgroundImage:o,children:i,showCloseButton:l=!0})=>e?t.jsx("div",{className:"fixed inset-0 z-50 bg-background/95 backdrop-blur-sm flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md max-h-[90vh] bg-card/90 backdrop-blur-sm rounded-2xl border border-border overflow-hidden flex flex-col relative",children:[o&&t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-30 rounded-2xl",style:{backgroundImage:`url('${o}')`}}),t.jsxs("div",{className:"flex justify-between items-start p-4 border-b border-border/30 relative z-10",children:[t.jsxs("div",{className:`${l?"flex-1 mr-3":"w-full"}`,children:[t.jsx("h1",{className:"text-xl font-bold text-warm-text mb-1",children:r}),a&&t.jsx("p",{className:"text-sm text-warm-text/80 leading-relaxed",children:a})]}),l&&t.jsx(A,{variant:"ghost",size:"sm",onClick:s,className:"w-12 h-12 rounded-full bg-muted/50 hover:bg-muted/70 hover:scale-110 transition-all duration-200 flex-shrink-0",title:"Close onboarding",children:t.jsx(Ie,{className:"w-8 h-8 text-warm-text"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 relative z-10",children:[n&&t.jsxs("div",{className:"bg-muted/30 rounded-xl border border-border/50 p-4 relative mt-4",children:[t.jsx(lx,{className:"w-5 h-5 text-warm-text/40 absolute top-3 left-3"}),t.jsxs("blockquote",{className:"text-sm italic text-warm-text/90 leading-relaxed pl-8",children:['"',n,'"']})]}),t.jsx("div",{className:"space-y-4 mt-4",children:i})]})]})}):null,et={profile:{title:"Complete Your Profile",subtitle:"Tell us about yourself to unlock personalized calorie calculations and recommendations.",heroQuote:"Your body is unique. Your plan should be too.",sections:[{icon:Jt,title:"Personalized Calculations",description:"We'll calculate your exact daily calorie needs based on your weight, height, age, and sex using proven metabolic formulas."},{icon:yo,title:"Accurate Tracking",description:"Get precise calorie burn estimates for walking and activities. Your profile enables smart deficit tracking."},{icon:Aa,title:"Smarter Recommendations",description:"Unlock personalized food suggestions, goal recommendations, and motivational content tailored to your journey."}]},timer:{title:"Start With the Fast",subtitle:"60 hours of silence. No food. Just water. This is where change begins.",heroQuote:"Without this fast, I couldn't begin to lose weight. It trains your body and your mind.",backgroundImage:"/src/assets/motivator-placeholder.jpg",sections:[{icon:Aa,title:"The Reset",description:"60-72 hours with just water and coffee shifts your body from burning sugar to burning fat. This breaks the addiction to carbs and emotional eating."},{icon:kg,title:"Embrace the Hunger",description:"Hunger becomes something you sit with â€” not something you fear. This is hard. That's the point. It's the reset your body needs."},{icon:Jt,title:"Start Your Change",description:"Without this fast, you stay stuck. This is where real change begins â€” training both your body and your mind for what's ahead."}]},walking:{title:"Walk. Don't Run.",subtitle:"Cardio you don't hate. A tool that actually works.",heroQuote:"This isn't about performance. It's about output. Walking lets you go far without quitting.",backgroundImage:"/src/assets/motivator-placeholder.jpg",sections:[{icon:vd,title:"Underrated Fat Burner",description:"Walking is the most underrated fat-burning tool on Earth. You can walk for 10 minutes or 3 hours. No pressure, no burnout."},{icon:Vt,title:"All-Day Output",description:"Especially in a city or while traveling â€” walk all day, burn all day. This is how you build a calorie deficit without tracking every bite."},{icon:Jt,title:"Sustainable Cardio",description:"It's not glamorous. It works. Most people hate running â€” it doesn't matter. Walking is cardio you can actually stick with."}]},food:{title:"What You Eat, You Become",subtitle:"Calories go in. Fat stays in. Let's reverse that.",heroQuote:"I don't count obsessively. I just don't lie to myself. I know what I eat.",backgroundImage:"/src/assets/motivator-placeholder.jpg",sections:[{icon:yo,title:"Simple Math",description:"You burn calories all day, even doing nothing. Eat less than you burn â€” that's the only way fat disappears."},{icon:Jt,title:"Make It a System",description:"Use the app to track. Keep it simple. Save 'safe foods' and log them fast. Hit your daily target without obsession."},{icon:Wr,title:"AI Estimation",description:"Estimate with AI tools when labels are missing. This is how you make food a system, not a struggle."}]},motivators:{title:"What You Want Is Waiting",subtitle:"This isn't motivation. This is fuel.",heroQuote:"It's not about the weight. It's about getting back to the person you know is in there.",backgroundImage:"/src/assets/motivator-placeholder.jpg",sections:[{icon:Jt,title:"Real Motivators",description:"These aren't just goals â€” they're fuel. Clothes that don't fit. People you want to surprise. Moments you don't want to miss."},{icon:Wr,title:"Lock Them In",description:"Add your own photos, events, test results. I've included 10 real ones from my own journey to get you started."},{icon:Vt,title:"When You Need Them",description:"The app will show them to you when you need them most. These motivators remind you what matters when it gets hard."}]}},Ec=Wi((e,s)=>({loadingStates:{},timeouts:{},setLoading:(r,a)=>{const{timeouts:n,clearTimeout:o}=s();if(n[r]&&o(r),a){e(l=>({loadingStates:{...l.loadingStates,[r]:!0}}));const i=setTimeout(()=>{console.warn(`Loading timeout for ${r} - forcing to false`),e(l=>({loadingStates:{...l.loadingStates,[r]:!1},timeouts:{...l.timeouts,[r]:void 0}}))},1e4);e(l=>({timeouts:{...l.timeouts,[r]:i}}))}else e(i=>({loadingStates:{...i.loadingStates,[r]:!1}})),n[r]&&o(r)},isLoading:r=>s().loadingStates[r]||!1,clearTimeout:r=>{const{timeouts:a}=s();a[r]&&(clearTimeout(a[r]),e(n=>({timeouts:{...n.timeouts,[r]:void 0}})))}})),im=e=>{const{setLoading:s,isLoading:r,clearTimeout:a}=Ec(),n=Ec(l=>l.loadingStates[e]||!1),o=c.useCallback(()=>{s(e,!0)},[e,s]),i=c.useCallback(()=>{s(e,!1)},[e,s]);return c.useEffect(()=>()=>{a(e),s(e,!1)},[e,a,s]),{loading:n,startLoading:o,stopLoading:i,setLoading:l=>s(e,l)}};let Tc=0;const Uj=()=>{const e=()=>!document.hidden&&document.visibilityState==="visible",s=()=>e()&&Date.now()-Tc<3e4,r=()=>{Tc=Date.now()};return typeof window<"u"&&["click","scroll","keydown","touchstart"].forEach(a=>{window.addEventListener(a,r,{passive:!0})}),{isTabVisible:e,shouldRefetch:s,trackUserInteraction:r}},no="motivators_cache",Mc=24*60*60*1e3,zj=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(0),{user:n}=Se(),{shouldRefetch:o}=Uj();c.useEffect(()=>{if(n){try{const f=localStorage.getItem(`${no}_${n.id}`);if(f){const u=JSON.parse(f);if(Date.now()-u.timestamp<u.ttl){s(u.data),a(u.timestamp);return}}}catch(f){console.error("Error loading cached motivators:",f)}s(null)}},[n?.id]);const i=c.useCallback(()=>{if(!n)return!1;if(!e)return!0;const u=Date.now()-r;return u>Mc||u>30*60*1e3&&o()},[n,e,r,o]),l=c.useCallback(f=>{if(n)try{const u={data:f,timestamp:Date.now(),ttl:Mc};localStorage.setItem(`${no}_${n.id}`,JSON.stringify(u)),s(f),a(Date.now())}catch(u){console.error("Error caching motivators:",u)}},[n?.id]),d=c.useCallback(()=>{if(n)try{localStorage.removeItem(`${no}_${n.id}`),s(null),a(0)}catch(f){console.error("Error invalidating motivator cache:",f)}},[n?.id]);return{cachedMotivators:e,shouldFetchMotivators:i,cacheMotivators:l,invalidateCache:d}},Zs=()=>{const[e,s]=c.useState([]),{user:r}=Se(),{toast:a}=pe(),{loading:n,startLoading:o,stopLoading:i}=im("motivators"),{cachedMotivators:l,shouldFetchMotivators:d,cacheMotivators:f,invalidateCache:u}=zj(),m=async(w=!1)=>{if(!r){i();return}if(!w&&l&&!d()){console.log("Using cached motivators, skipping API call"),s(l),i();return}o();try{const{data:y,error:b}=await P.from("motivators").select("*, image_url").eq("user_id",r.id).eq("is_active",!0).order("created_at",{ascending:!1});if(b)throw b;const j=(y||[]).map(N=>({...N,imageUrl:N.image_url||N.imageUrl||null}));s(j),f(j),console.log("Loaded fresh motivators from API:",j.length)}catch(y){console.error("Error loading motivators:",y),l&&l.length>0?(console.log("Using cached motivators as fallback"),s(l)):a({title:"Error loading motivators",description:"Please check your connection and try again.",variant:"destructive"})}finally{i()}},h=async w=>{if(!r)return null;try{const{data:y,error:b}=await P.from("motivators").insert({user_id:r.id,title:w.title,content:w.content,category:w.category,image_url:w.imageUrl,is_active:!0}).select().single();if(b)throw b;if(y){const j={...y,imageUrl:y.image_url};return s(N=>[j,...N]),a({title:"âœ¨ Motivator Created!",description:"Your new motivator has been saved."}),y.id}return null}catch(y){return console.error("Error creating motivator:",y),a({title:"Error creating motivator",description:"Please try again.",variant:"destructive"}),null}},p=async(w,y)=>{if(!r)return!1;try{const b={...y};y.imageUrl!==void 0&&(b.image_url=y.imageUrl,delete b.imageUrl);const{error:j}=await P.from("motivators").update(b).eq("id",w).eq("user_id",r.id);if(j)throw j;return s(N=>N.map(E=>E.id===w?{...E,...y}:E)),a({title:"âœ¨ Motivator Updated!",description:"Your changes have been saved."}),!0}catch(b){return console.error("Error updating motivator:",b),a({title:"Error updating motivator",description:"Please try again.",variant:"destructive"}),!1}},g=async w=>{if(!r||!w.length)return[];try{const y=w.map(N=>({user_id:r.id,title:N.title,content:N.content,category:N.category||"general",image_url:N.imageUrl,is_active:!0})),{data:b,error:j}=await P.from("motivators").insert(y).select();if(j)throw j;if(b&&b.length>0){const N=b.map(E=>({...E,imageUrl:E.image_url}));return s(E=>[...N,...E]),a({title:"âœ¨ Motivators Created!",description:`Successfully created ${b.length} motivator${b.length>1?"s":""}`}),b.map(E=>E.id)}return[]}catch(y){return console.error("Error creating multiple motivators:",y),a({title:"Error creating motivators",description:"Please try again.",variant:"destructive"}),[]}},x=async w=>{if(!r)return null;try{const y=w.text.length>50?`${w.text.substring(0,47)}...`:w.text,b=`"${w.text}"${w.author?` â€” ${w.author}`:""}`,{data:j,error:N}=await P.from("motivators").insert({user_id:r.id,title:y,content:b,category:"saved_quote",is_active:!0}).select().single();if(N)throw N;if(j){const E={...j,imageUrl:j.image_url};return s(S=>[E,...S]),a({title:"ðŸ“ Quote Saved!",description:"Quote has been saved to your goals."}),j.id}return null}catch(y){return console.error("Error saving quote:",y),a({title:"Error saving quote",description:"Please try again.",variant:"destructive"}),null}},v=async w=>{if(!r)return!1;try{const{error:y}=await P.from("motivators").update({is_active:!1}).eq("id",w).eq("user_id",r.id);if(y)throw y;return s(b=>b.filter(j=>j.id!==w)),a({title:"ðŸ—‘ï¸ Motivator Removed",description:"Motivator has been deleted."}),!0}catch(y){return console.error("Error deleting motivator:",y),a({title:"Error deleting motivator",description:"Please try again.",variant:"destructive"}),!1}};return c.useEffect(()=>{r&&(l&&(s(l),i()),m())},[r?.id]),{motivators:e,loading:n,createMotivator:async w=>{const y=await h(w);return y&&(u(),await m(!0)),y},createMultipleMotivators:async w=>{const y=await g(w);return y.length>0&&(u(),await m(!0)),y},updateMotivator:async(w,y)=>{const b=await p(w,y);return b&&(u(),await m(!0)),b},deleteMotivator:async w=>{const y=await v(w);return y&&u(),y},saveQuoteAsGoal:async w=>{const y=await x(w);return y&&(u(),await m(!0)),y},refreshMotivators:()=>m(!0)}},qj=""+new URL("motivator-placeholder-BSpsGp9Z.jpg",import.meta.url).href,da=({src:e,alt:s,className:r="",style:a,onError:n,onAddImageClick:o,showAddImagePrompt:i=!0})=>{const[l,d]=c.useState(!1),[f,u]=c.useState(!1),m=()=>{d(!0),n?.()},h=()=>{u(!0)};return!e||l&&f?i&&o&&!e?t.jsxs("div",{className:`bg-muted/40 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-muted/60 transition-colors ${r}`,style:a,onClick:o,children:[t.jsx(qe,{className:"w-8 h-8 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:"add image"})]}):t.jsx("div",{className:`bg-muted flex items-center justify-center ${r}`,style:a,children:t.jsx(vi,{className:"w-10 h-10 text-muted-foreground"})}):l?t.jsx("img",{src:qj,alt:s,className:r,style:a,onError:h,loading:"lazy"}):t.jsx("img",{src:e,alt:s,className:r,style:a,onError:m,loading:"lazy"})},lm=({isActive:e,onModeChange:s,className:r="",timerDurationMs:a=5e3,imageLeadMs:n=2e3,textDurationMs:o=4e3})=>{const{motivators:i}=Zs(),l=i.filter(b=>b?.title),[d,f]=c.useState(0),[u,m]=c.useState("timer"),h=c.useRef(0),p=c.useRef(null),g=c.useRef("timer-focused"),x=c.useRef(!1);if(c.useEffect(()=>{const b=()=>{document.visibilityState==="visible"&&x.current?(m("timer"),f(0),x.current=!1,h.current+=1):document.visibilityState==="hidden"&&(x.current=!0)};return document.addEventListener("visibilitychange",b),()=>document.removeEventListener("visibilitychange",b)},[]),c.useEffect(()=>{if(!e||l.length===0){m("timer"),g.current!=="timer-focused"&&(s?.("timer-focused"),g.current="timer-focused"),p.current&&clearTimeout(p.current),h.current+=1;return}const b=++h.current,j=E=>{m(E);const S=E==="timer"?"timer-focused":"motivator-focused";g.current!==S&&(s?.(S),g.current=S)},N=()=>{h.current===b&&(j("timer"),p.current=setTimeout(()=>{if(h.current!==b)return;!!l[d]?.imageUrl?(j("image"),p.current=setTimeout(()=>{h.current===b&&(j("text"),p.current=setTimeout(()=>{h.current===b&&(f(_=>(_+1)%l.length),N())},o))},n)):(j("text"),p.current=setTimeout(()=>{h.current===b&&(f(_=>(_+1)%l.length),N())},o))},a))};return N(),()=>{p.current&&clearTimeout(p.current),h.current+=1}},[e,l.length,d,a,n,o,s]),!e||l.length===0)return null;const v=l[d],w=(u==="image"||u==="text")&&v?.imageUrl,y=u==="text"&&v?.title;return t.jsxs("div",{className:`absolute inset-0 ${r}`,children:[w&&t.jsx("div",{className:"absolute inset-0 overflow-hidden transition-opacity duration-700",style:{zIndex:8},children:t.jsx(da,{src:v.imageUrl,alt:v.title||"Motivator image",className:"absolute inset-0 w-full h-full object-cover",style:{filter:"brightness(0.95) saturate(1.05) contrast(1.02)"}})}),y&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{zIndex:15},children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute -inset-6 rounded-full border-2 border-primary/20 animate-pulse pointer-events-none"}),t.jsx("div",{className:"absolute -inset-3 rounded-full border border-primary/30 animate-pulse pointer-events-none",style:{animationDelay:"0.15s"}}),t.jsx("div",{className:"absolute -inset-1 rounded-full border border-primary/40 animate-pulse pointer-events-none",style:{animationDelay:"0.3s"}}),t.jsx("div",{className:"w-44 h-44 rounded-full bg-black/40 text-white backdrop-blur-sm border border-white/10 shadow-lg animate-scale-in flex items-center justify-center px-6 text-center",style:{textShadow:"0 2px 8px rgba(0,0,0,0.4)"},children:t.jsx("span",{className:"font-semibold text-sm tracking-wide leading-snug",children:v.title.toUpperCase()})})]})})]})},Wj=({isActive:e,animationType:s,onAnimationEnd:r})=>{const[a,n]=c.useState(!1),[o,i]=c.useState(0),l=3;if(c.useEffect(()=>{if(e){n(!0),i(0);const u=2e3,m=u*l,h=setTimeout(()=>{n(!1),i(0),r()},m),p=setInterval(()=>{i(g=>g+1)},u);return()=>{clearTimeout(h),clearInterval(p)}}},[e,s,r]),!a)return null;const d=()=>`${s}-${o}`,f=()=>{switch(s){case"ring-pulse":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-8 border-primary animate-pulse shadow-2xl shadow-primary/60"},d()),t.jsx("div",{className:"absolute inset-4 rounded-full border-4 border-accent animate-pulse shadow-xl shadow-accent/40",style:{animationDelay:"0.5s"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-4xl font-bold text-white animate-pulse bg-ceramic-base/80 rounded-full px-6 py-3 border-2 border-white/30 backdrop-blur-sm",children:"GOAL!"})})]});case"particle-burst":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full animate-bounce border-4 border-accent shadow-xl shadow-accent/50"},d()),t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(8)].map((u,m)=>t.jsx("div",{className:"absolute w-2 h-2 bg-accent rounded-full animate-ping",style:{top:"50%",left:"50%",animationDelay:`${m*.1}s`,transform:`rotate(${m*45}deg) translateY(-120px)`,animationDuration:"1.5s"}},`${d()}-particle-${m}`))}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-bounce bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:"ðŸŽ¯"})})]});case"color-wave":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-r from-primary via-accent to-secondary animate-spin border-4",style:{animationDuration:"2s"}},d()),t.jsx("div",{className:"absolute inset-6 rounded-full bg-gradient-to-r from-secondary via-primary to-accent animate-spin",style:{animationDuration:"1.5s",animationDirection:"reverse"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-pulse bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:"âœ¨"})})]});case"fireworks":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(12)].map((u,m)=>t.jsx("div",{className:"absolute w-1 h-4 bg-gradient-to-t from-yellow-400 via-orange-500 to-red-500 rounded-full animate-pulse",style:{top:"50%",left:"50%",animationDelay:`${m*.1}s`,transform:`rotate(${m*30}deg) translateY(-140px)`,transformOrigin:"bottom",animationDuration:"1s"}},`${d()}-firework-${m}`))}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-spin bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:"ðŸŽ†"})})]});default:return null}};return t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:f()})},Bj=({progress:e,displayTime:s,isActive:r,showSlideshow:a=!1,countDirection:n,onToggleCountDirection:o,fastType:i,goalDuration:l,className:d,celebrationAnimation:f})=>{const[u,m]=c.useState("timer-focused"),h=2*Math.PI*45,p=h-e/100*h;return t.jsx("div",{className:Z("relative flex items-center justify-center",d),children:t.jsxs("div",{className:"relative w-80 h-80 rounded-full",style:{background:"var(--gradient-ceramic)",boxShadow:"var(--shadow-plate)"},children:[t.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"var(--gradient-rim)",boxShadow:"var(--shadow-rim)"}}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-52 h-52 rounded-full flex items-center justify-center",style:{background:"var(--gradient-well)",boxShadow:"var(--shadow-well)"},children:[a&&t.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",children:t.jsx(lm,{isActive:r,onModeChange:m,className:"rounded-full"})}),t.jsxs("svg",{className:"absolute inset-0 w-full h-full transform -rotate-90",viewBox:"0 0 100 100",style:{zIndex:12},children:[t.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"hsl(var(--ceramic-deep))",strokeWidth:"2",opacity:"0.3"}),e>0&&t.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"hsl(var(--primary))",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:h,strokeDashoffset:p,className:"transition-all duration-1000 ease-out",style:{filter:r?"drop-shadow(0 0 6px hsl(var(--primary) / 0.4))":"none"}})]}),t.jsx("div",{className:Z("absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-1000",u==="motivator-focused"?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:13},children:t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:Z("text-sm font-medium transition-colors duration-300",r?"text-primary":"text-muted-foreground"),children:r?"Fasting":"Ready to Fast"}),t.jsx("div",{className:Z("font-mono font-bold tracking-wide transition-colors duration-300","text-4xl",r?"text-warm-text":"text-muted-foreground"),style:{textShadow:"0 2px 4px rgba(0,0,0,0.1)",fontFeatureSettings:'"tnum" 1',lineHeight:"1.1",transform:"translateY(-4px)"},children:s}),r&&i==="longterm"&&l&&t.jsxs("div",{className:"text-xs text-muted-foreground font-medium",children:[Math.round(l),"h goal"]}),r&&e>0&&t.jsxs("div",{className:"text-xs text-muted-foreground font-medium",children:[Math.max(1,Math.round(e)),"%"]}),r&&t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mx-auto mt-2"})]})})]}),t.jsx("div",{className:"absolute inset-1 rounded-full pointer-events-none",style:{zIndex:5,background:"conic-gradient(from 45deg, transparent 0deg, hsl(0 0% 100% / 0.1) 90deg, transparent 180deg, hsl(0 0% 100% / 0.05) 270deg, transparent 360deg)"}}),t.jsx("div",{className:"absolute rounded-full pointer-events-none",style:{top:"12%",left:"12%",right:"12%",bottom:"12%",zIndex:5,background:"radial-gradient(circle, transparent 60%, hsl(var(--ceramic-shadow) / 0.2) 65%, transparent 70%)"}}),r&&n&&o&&t.jsx("button",{onClick:o,className:"absolute bottom-16 right-4 w-8 h-8 rounded-full bg-ceramic-base/80 hover:bg-ceramic-base border border-ceramic-rim flex items-center justify-center text-xs text-muted-foreground hover:text-warm-text transition-all duration-200 backdrop-blur-sm z-10",title:n==="up"?"Switch to Countdown":"Switch to Count Up",children:n==="up"?"â¬‡":"â¬†"}),f&&t.jsx(Wj,{isActive:f.isActive,animationType:f.type,onAnimationEnd:f.onAnimationEnd})]})})};var Gj=[" ","Enter","ArrowUp","ArrowDown"],Vj=[" ","Enter"],ua="Select",[Cn,kn,Hj]=an(ua),[Sr,z2]=St(ua,[Hj,br]),En=br(),[Qj,Ts]=Sr(ua),[Kj,Yj]=Sr(ua),cm=e=>{const{__scopeSelect:s,children:r,open:a,defaultOpen:n,onOpenChange:o,value:i,defaultValue:l,onValueChange:d,dir:f,name:u,autoComplete:m,disabled:h,required:p,form:g}=e,x=En(s),[v,w]=c.useState(null),[y,b]=c.useState(null),[j,N]=c.useState(!1),E=Ys(f),[S=!1,_]=Gt({prop:a,defaultProp:n,onChange:o}),[C,k]=Gt({prop:i,defaultProp:l,onChange:d}),T=c.useRef(null),D=v?g||!!v.closest("form"):!0,[W,$]=c.useState(new Set),X=Array.from(W).map(V=>V.props.value).join(";");return t.jsx(Ei,{...x,children:t.jsxs(Qj,{required:p,scope:s,trigger:v,onTriggerChange:w,valueNode:y,onValueNodeChange:b,valueNodeHasChildren:j,onValueNodeHasChildrenChange:N,contentId:ls(),value:C,onValueChange:k,open:S,onOpenChange:_,dir:E,triggerPointerDownPosRef:T,disabled:h,children:[t.jsx(Cn.Provider,{scope:s,children:t.jsx(Kj,{scope:e.__scopeSelect,onNativeOptionAdd:c.useCallback(V=>{$(G=>new Set(G).add(V))},[]),onNativeOptionRemove:c.useCallback(V=>{$(G=>{const L=new Set(G);return L.delete(V),L})},[]),children:r})}),D?t.jsxs(Rm,{"aria-hidden":!0,required:p,tabIndex:-1,name:u,autoComplete:m,value:C,onChange:V=>k(V.target.value),disabled:h,form:g,children:[C===void 0?t.jsx("option",{value:""}):null,Array.from(W)]},X):null]})})};cm.displayName=ua;var dm="SelectTrigger",um=c.forwardRef((e,s)=>{const{__scopeSelect:r,disabled:a=!1,...n}=e,o=En(r),i=Ts(dm,r),l=i.disabled||a,d=Ne(s,i.onTriggerChange),f=kn(r),u=c.useRef("touch"),[m,h,p]=Im(x=>{const v=f().filter(b=>!b.disabled),w=v.find(b=>b.value===i.value),y=Fm(v,x,w);y!==void 0&&i.onValueChange(y.value)}),g=x=>{l||(i.onOpenChange(!0),p()),x&&(i.triggerPointerDownPosRef.current={x:Math.round(x.pageX),y:Math.round(x.pageY)})};return t.jsx(Ti,{asChild:!0,...o,children:t.jsx(xe.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":Am(i.value)?"":void 0,...n,ref:d,onClick:ae(n.onClick,x=>{x.currentTarget.focus(),u.current!=="mouse"&&g(x)}),onPointerDown:ae(n.onPointerDown,x=>{u.current=x.pointerType;const v=x.target;v.hasPointerCapture(x.pointerId)&&v.releasePointerCapture(x.pointerId),x.button===0&&x.ctrlKey===!1&&x.pointerType==="mouse"&&(g(x),x.preventDefault())}),onKeyDown:ae(n.onKeyDown,x=>{const v=m.current!=="";!(x.ctrlKey||x.altKey||x.metaKey)&&x.key.length===1&&h(x.key),!(v&&x.key===" ")&&Gj.includes(x.key)&&(g(),x.preventDefault())})})})});um.displayName=dm;var mm="SelectValue",hm=c.forwardRef((e,s)=>{const{__scopeSelect:r,className:a,style:n,children:o,placeholder:i="",...l}=e,d=Ts(mm,r),{onValueNodeHasChildrenChange:f}=d,u=o!==void 0,m=Ne(s,d.onValueNodeChange);return jt(()=>{f(u)},[f,u]),t.jsx(xe.span,{...l,ref:m,style:{pointerEvents:"none"},children:Am(d.value)?t.jsx(t.Fragment,{children:i}):o})});hm.displayName=mm;var Xj="SelectIcon",fm=c.forwardRef((e,s)=>{const{__scopeSelect:r,children:a,...n}=e;return t.jsx(xe.span,{"aria-hidden":!0,...n,ref:s,children:a||"â–¼"})});fm.displayName=Xj;var Jj="SelectPortal",pm=e=>t.jsx(rd,{asChild:!0,...e});pm.displayName=Jj;var Us="SelectContent",gm=c.forwardRef((e,s)=>{const r=Ts(Us,e.__scopeSelect),[a,n]=c.useState();if(jt(()=>{n(new DocumentFragment)},[]),!r.open){const o=a;return o?nn.createPortal(t.jsx(xm,{scope:e.__scopeSelect,children:t.jsx(Cn.Slot,{scope:e.__scopeSelect,children:t.jsx("div",{children:e.children})})}),o):null}return t.jsx(vm,{...e,ref:s})});gm.displayName=Us;var Ut=10,[xm,Ms]=Sr(Us),Zj="SelectContentImpl",vm=c.forwardRef((e,s)=>{const{__scopeSelect:r,position:a="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:o,onPointerDownOutside:i,side:l,sideOffset:d,align:f,alignOffset:u,arrowPadding:m,collisionBoundary:h,collisionPadding:p,sticky:g,hideWhenDetached:x,avoidCollisions:v,...w}=e,y=Ts(Us,r),[b,j]=c.useState(null),[N,E]=c.useState(null),S=Ne(s,M=>j(M)),[_,C]=c.useState(null),[k,T]=c.useState(null),D=kn(r),[W,$]=c.useState(!1),X=c.useRef(!1);c.useEffect(()=>{if(b)return Zc(b)},[b]),ed();const V=c.useCallback(M=>{const[H,...U]=D().map(be=>be.ref.current),[ee]=U.slice(-1),ue=document.activeElement;for(const be of M)if(be===ue||(be?.scrollIntoView({block:"nearest"}),be===H&&N&&(N.scrollTop=0),be===ee&&N&&(N.scrollTop=N.scrollHeight),be?.focus(),document.activeElement!==ue))return},[D,N]),G=c.useCallback(()=>V([_,b]),[V,_,b]);c.useEffect(()=>{W&&G()},[W,G]);const{onOpenChange:L,triggerPointerDownPosRef:B}=y;c.useEffect(()=>{if(b){let M={x:0,y:0};const H=ee=>{M={x:Math.abs(Math.round(ee.pageX)-(B.current?.x??0)),y:Math.abs(Math.round(ee.pageY)-(B.current?.y??0))}},U=ee=>{M.x<=10&&M.y<=10?ee.preventDefault():b.contains(ee.target)||L(!1),document.removeEventListener("pointermove",H),B.current=null};return B.current!==null&&(document.addEventListener("pointermove",H),document.addEventListener("pointerup",U,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",H),document.removeEventListener("pointerup",U,{capture:!0})}}},[b,L,B]),c.useEffect(()=>{const M=()=>L(!1);return window.addEventListener("blur",M),window.addEventListener("resize",M),()=>{window.removeEventListener("blur",M),window.removeEventListener("resize",M)}},[L]);const[de,te]=Im(M=>{const H=D().filter(ue=>!ue.disabled),U=H.find(ue=>ue.ref.current===document.activeElement),ee=Fm(H,M,U);ee&&setTimeout(()=>ee.ref.current.focus())}),Y=c.useCallback((M,H,U)=>{const ee=!X.current&&!U;(y.value!==void 0&&y.value===H||ee)&&(C(M),ee&&(X.current=!0))},[y.value]),oe=c.useCallback(()=>b?.focus(),[b]),O=c.useCallback((M,H,U)=>{const ee=!X.current&&!U;(y.value!==void 0&&y.value===H||ee)&&T(M)},[y.value]),Q=a==="popper"?Bo:ym,R=Q===Bo?{side:l,sideOffset:d,align:f,alignOffset:u,arrowPadding:m,collisionBoundary:h,collisionPadding:p,sticky:g,hideWhenDetached:x,avoidCollisions:v}:{};return t.jsx(xm,{scope:r,content:b,viewport:N,onViewportChange:E,itemRefCallback:Y,selectedItem:_,onItemLeave:oe,itemTextRefCallback:O,focusSelectedItem:G,selectedItemText:k,position:a,isPositioned:W,searchRef:de,children:t.jsx(td,{as:ci,allowPinchZoom:!0,children:t.jsx(sd,{asChild:!0,trapped:y.open,onMountAutoFocus:M=>{M.preventDefault()},onUnmountAutoFocus:ae(n,M=>{y.trigger?.focus({preventScroll:!0}),M.preventDefault()}),children:t.jsx(li,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:M=>M.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:t.jsx(Q,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:M=>M.preventDefault(),...w,...R,onPlaced:()=>$(!0),ref:S,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:ae(w.onKeyDown,M=>{const H=M.ctrlKey||M.altKey||M.metaKey;if(M.key==="Tab"&&M.preventDefault(),!H&&M.key.length===1&&te(M.key),["ArrowUp","ArrowDown","Home","End"].includes(M.key)){let ee=D().filter(ue=>!ue.disabled).map(ue=>ue.ref.current);if(["ArrowUp","End"].includes(M.key)&&(ee=ee.slice().reverse()),["ArrowUp","ArrowDown"].includes(M.key)){const ue=M.target,be=ee.indexOf(ue);ee=ee.slice(be+1)}setTimeout(()=>V(ee)),M.preventDefault()}})})})})})})});vm.displayName=Zj;var eN="SelectItemAlignedPosition",ym=c.forwardRef((e,s)=>{const{__scopeSelect:r,onPlaced:a,...n}=e,o=Ts(Us,r),i=Ms(Us,r),[l,d]=c.useState(null),[f,u]=c.useState(null),m=Ne(s,S=>u(S)),h=kn(r),p=c.useRef(!1),g=c.useRef(!0),{viewport:x,selectedItem:v,selectedItemText:w,focusSelectedItem:y}=i,b=c.useCallback(()=>{if(o.trigger&&o.valueNode&&l&&f&&x&&v&&w){const S=o.trigger.getBoundingClientRect(),_=f.getBoundingClientRect(),C=o.valueNode.getBoundingClientRect(),k=w.getBoundingClientRect();if(o.dir!=="rtl"){const ue=k.left-_.left,be=C.left-ue,je=S.left-be,Ue=S.width+je,me=Math.max(Ue,_.width),ve=window.innerWidth-Ut,z=Jr(be,[Ut,Math.max(Ut,ve-me)]);l.style.minWidth=Ue+"px",l.style.left=z+"px"}else{const ue=_.right-k.right,be=window.innerWidth-C.right-ue,je=window.innerWidth-S.right-be,Ue=S.width+je,me=Math.max(Ue,_.width),ve=window.innerWidth-Ut,z=Jr(be,[Ut,Math.max(Ut,ve-me)]);l.style.minWidth=Ue+"px",l.style.right=z+"px"}const T=h(),D=window.innerHeight-Ut*2,W=x.scrollHeight,$=window.getComputedStyle(f),X=parseInt($.borderTopWidth,10),V=parseInt($.paddingTop,10),G=parseInt($.borderBottomWidth,10),L=parseInt($.paddingBottom,10),B=X+V+W+L+G,de=Math.min(v.offsetHeight*5,B),te=window.getComputedStyle(x),Y=parseInt(te.paddingTop,10),oe=parseInt(te.paddingBottom,10),O=S.top+S.height/2-Ut,Q=D-O,R=v.offsetHeight/2,M=v.offsetTop+R,H=X+V+M,U=B-H;if(H<=O){const ue=T.length>0&&v===T[T.length-1].ref.current;l.style.bottom="0px";const be=f.clientHeight-x.offsetTop-x.offsetHeight,je=Math.max(Q,R+(ue?oe:0)+be+G),Ue=H+je;l.style.height=Ue+"px"}else{const ue=T.length>0&&v===T[0].ref.current;l.style.top="0px";const je=Math.max(O,X+x.offsetTop+(ue?Y:0)+R)+U;l.style.height=je+"px",x.scrollTop=H-O+x.offsetTop}l.style.margin=`${Ut}px 0`,l.style.minHeight=de+"px",l.style.maxHeight=D+"px",a?.(),requestAnimationFrame(()=>p.current=!0)}},[h,o.trigger,o.valueNode,l,f,x,v,w,o.dir,a]);jt(()=>b(),[b]);const[j,N]=c.useState();jt(()=>{f&&N(window.getComputedStyle(f).zIndex)},[f]);const E=c.useCallback(S=>{S&&g.current===!0&&(b(),y?.(),g.current=!1)},[b,y]);return t.jsx(sN,{scope:r,contentWrapper:l,shouldExpandOnScrollRef:p,onScrollButtonChange:E,children:t.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:t.jsx(xe.div,{...n,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});ym.displayName=eN;var tN="SelectPopperPosition",Bo=c.forwardRef((e,s)=>{const{__scopeSelect:r,align:a="start",collisionPadding:n=Ut,...o}=e,i=En(r);return t.jsx(Mi,{...i,...o,ref:s,align:a,collisionPadding:n,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Bo.displayName=tN;var[sN,Yi]=Sr(Us,{}),Go="SelectViewport",wm=c.forwardRef((e,s)=>{const{__scopeSelect:r,nonce:a,...n}=e,o=Ms(Go,r),i=Yi(Go,r),l=Ne(s,o.onViewportChange),d=c.useRef(0);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),t.jsx(Cn.Slot,{scope:r,children:t.jsx(xe.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:ae(n.onScroll,f=>{const u=f.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:h}=i;if(h?.current&&m){const p=Math.abs(d.current-u.scrollTop);if(p>0){const g=window.innerHeight-Ut*2,x=parseFloat(m.style.minHeight),v=parseFloat(m.style.height),w=Math.max(x,v);if(w<g){const y=w+p,b=Math.min(g,y),j=y-b;m.style.height=b+"px",m.style.bottom==="0px"&&(u.scrollTop=j>0?j:0,m.style.justifyContent="flex-end")}}}d.current=u.scrollTop})})})]})});wm.displayName=Go;var bm="SelectGroup",[rN,aN]=Sr(bm),nN=c.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=ls();return t.jsx(rN,{scope:r,id:n,children:t.jsx(xe.div,{role:"group","aria-labelledby":n,...a,ref:s})})});nN.displayName=bm;var jm="SelectLabel",Nm=c.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=aN(jm,r);return t.jsx(xe.div,{id:n.id,...a,ref:s})});Nm.displayName=jm;var Ka="SelectItem",[oN,Sm]=Sr(Ka),_m=c.forwardRef((e,s)=>{const{__scopeSelect:r,value:a,disabled:n=!1,textValue:o,...i}=e,l=Ts(Ka,r),d=Ms(Ka,r),f=l.value===a,[u,m]=c.useState(o??""),[h,p]=c.useState(!1),g=Ne(s,y=>d.itemRefCallback?.(y,a,n)),x=ls(),v=c.useRef("touch"),w=()=>{n||(l.onValueChange(a),l.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return t.jsx(oN,{scope:r,value:a,disabled:n,textId:x,isSelected:f,onItemTextChange:c.useCallback(y=>{m(b=>b||(y?.textContent??"").trim())},[]),children:t.jsx(Cn.ItemSlot,{scope:r,value:a,disabled:n,textValue:u,children:t.jsx(xe.div,{role:"option","aria-labelledby":x,"data-highlighted":h?"":void 0,"aria-selected":f&&h,"data-state":f?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...i,ref:g,onFocus:ae(i.onFocus,()=>p(!0)),onBlur:ae(i.onBlur,()=>p(!1)),onClick:ae(i.onClick,()=>{v.current!=="mouse"&&w()}),onPointerUp:ae(i.onPointerUp,()=>{v.current==="mouse"&&w()}),onPointerDown:ae(i.onPointerDown,y=>{v.current=y.pointerType}),onPointerMove:ae(i.onPointerMove,y=>{v.current=y.pointerType,n?d.onItemLeave?.():v.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ae(i.onPointerLeave,y=>{y.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:ae(i.onKeyDown,y=>{d.searchRef?.current!==""&&y.key===" "||(Vj.includes(y.key)&&w(),y.key===" "&&y.preventDefault())})})})})});_m.displayName=Ka;var Ur="SelectItemText",Cm=c.forwardRef((e,s)=>{const{__scopeSelect:r,className:a,style:n,...o}=e,i=Ts(Ur,r),l=Ms(Ur,r),d=Sm(Ur,r),f=Yj(Ur,r),[u,m]=c.useState(null),h=Ne(s,w=>m(w),d.onItemTextChange,w=>l.itemTextRefCallback?.(w,d.value,d.disabled)),p=u?.textContent,g=c.useMemo(()=>t.jsx("option",{value:d.value,disabled:d.disabled,children:p},d.value),[d.disabled,d.value,p]),{onNativeOptionAdd:x,onNativeOptionRemove:v}=f;return jt(()=>(x(g),()=>v(g)),[x,v,g]),t.jsxs(t.Fragment,{children:[t.jsx(xe.span,{id:d.textId,...o,ref:h}),d.isSelected&&i.valueNode&&!i.valueNodeHasChildren?nn.createPortal(o.children,i.valueNode):null]})});Cm.displayName=Ur;var km="SelectItemIndicator",Em=c.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e;return Sm(km,r).isSelected?t.jsx(xe.span,{"aria-hidden":!0,...a,ref:s}):null});Em.displayName=km;var Vo="SelectScrollUpButton",Tm=c.forwardRef((e,s)=>{const r=Ms(Vo,e.__scopeSelect),a=Yi(Vo,e.__scopeSelect),[n,o]=c.useState(!1),i=Ne(s,a.onScrollButtonChange);return jt(()=>{if(r.viewport&&r.isPositioned){let l=function(){const f=d.scrollTop>0;o(f)};const d=r.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),n?t.jsx(Pm,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=r;l&&d&&(l.scrollTop=l.scrollTop-d.offsetHeight)}}):null});Tm.displayName=Vo;var Ho="SelectScrollDownButton",Mm=c.forwardRef((e,s)=>{const r=Ms(Ho,e.__scopeSelect),a=Yi(Ho,e.__scopeSelect),[n,o]=c.useState(!1),i=Ne(s,a.onScrollButtonChange);return jt(()=>{if(r.viewport&&r.isPositioned){let l=function(){const f=d.scrollHeight-d.clientHeight,u=Math.ceil(d.scrollTop)<f;o(u)};const d=r.viewport;return l(),d.addEventListener("scroll",l),()=>d.removeEventListener("scroll",l)}},[r.viewport,r.isPositioned]),n?t.jsx(Pm,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:d}=r;l&&d&&(l.scrollTop=l.scrollTop+d.offsetHeight)}}):null});Mm.displayName=Ho;var Pm=c.forwardRef((e,s)=>{const{__scopeSelect:r,onAutoScroll:a,...n}=e,o=Ms("SelectScrollButton",r),i=c.useRef(null),l=kn(r),d=c.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return c.useEffect(()=>()=>d(),[d]),jt(()=>{l().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),t.jsx(xe.div,{"aria-hidden":!0,...n,ref:s,style:{flexShrink:0,...n.style},onPointerDown:ae(n.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(a,50))}),onPointerMove:ae(n.onPointerMove,()=>{o.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(a,50))}),onPointerLeave:ae(n.onPointerLeave,()=>{d()})})}),iN="SelectSeparator",Dm=c.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e;return t.jsx(xe.div,{"aria-hidden":!0,...a,ref:s})});Dm.displayName=iN;var Qo="SelectArrow",lN=c.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=En(r),o=Ts(Qo,r),i=Ms(Qo,r);return o.open&&i.position==="popper"?t.jsx(Pi,{...n,...a,ref:s}):null});lN.displayName=Qo;function Am(e){return e===""||e===void 0}var Rm=c.forwardRef((e,s)=>{const{value:r,...a}=e,n=c.useRef(null),o=Ne(s,n),i=la(r);return c.useEffect(()=>{const l=n.current,d=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(d,"value").set;if(i!==r&&u){const m=new Event("change",{bubbles:!0});u.call(l,r),l.dispatchEvent(m)}},[i,r]),t.jsx(Vp,{asChild:!0,children:t.jsx("select",{...a,ref:o,defaultValue:r})})});Rm.displayName="BubbleSelect";function Im(e){const s=Dt(e),r=c.useRef(""),a=c.useRef(0),n=c.useCallback(i=>{const l=r.current+i;s(l),function d(f){r.current=f,window.clearTimeout(a.current),f!==""&&(a.current=window.setTimeout(()=>d(""),1e3))}(l)},[s]),o=c.useCallback(()=>{r.current="",window.clearTimeout(a.current)},[]);return c.useEffect(()=>()=>window.clearTimeout(a.current),[]),[r,n,o]}function Fm(e,s,r){const n=s.length>1&&Array.from(s).every(f=>f===s[0])?s[0]:s,o=r?e.indexOf(r):-1;let i=cN(e,Math.max(o,0));n.length===1&&(i=i.filter(f=>f!==r));const d=i.find(f=>f.textValue.toLowerCase().startsWith(n.toLowerCase()));return d!==r?d:void 0}function cN(e,s){return e.map((r,a)=>e[(s+a)%e.length])}var dN=cm,Om=um,uN=hm,mN=fm,hN=pm,Lm=gm,fN=wm,$m=Nm,Um=_m,pN=Cm,gN=Em,zm=Tm,qm=Mm,Wm=Dm;const es=dN,ts=uN,qt=c.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Om,{ref:a,className:Z("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[s,t.jsx(mN,{asChild:!0,children:t.jsx(Nt,{className:"h-4 w-4 opacity-50"})})]}));qt.displayName=Om.displayName;const Bm=c.forwardRef(({className:e,...s},r)=>t.jsx(zm,{ref:r,className:Z("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(xi,{className:"h-4 w-4"})}));Bm.displayName=zm.displayName;const Gm=c.forwardRef(({className:e,...s},r)=>t.jsx(qm,{ref:r,className:Z("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(Nt,{className:"h-4 w-4"})}));Gm.displayName=qm.displayName;const Wt=c.forwardRef(({className:e,children:s,position:r="popper",...a},n)=>t.jsx(hN,{children:t.jsxs(Lm,{ref:n,className:Z("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[t.jsx(Bm,{}),t.jsx(fN,{className:Z("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),t.jsx(Gm,{})]})}));Wt.displayName=Lm.displayName;const xN=c.forwardRef(({className:e,...s},r)=>t.jsx($m,{ref:r,className:Z("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s}));xN.displayName=$m.displayName;const Fe=c.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Um,{ref:a,className:Z("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(gN,{children:t.jsx(Gs,{className:"h-4 w-4"})})}),t.jsx(pN,{children:s})]}));Fe.displayName=Um.displayName;const vN=c.forwardRef(({className:e,...s},r)=>t.jsx(Wm,{ref:r,className:Z("-mx-1 my-1 h-px bg-muted",e),...s}));vN.displayName=Wm.displayName;const oo=768;function Xi(){const[e,s]=c.useState(void 0);return c.useEffect(()=>{const r=window.matchMedia(`(max-width: ${oo-1}px)`),a=()=>{s(window.innerWidth<oo)};return r.addEventListener("change",a),s(window.innerWidth<oo),()=>r.removeEventListener("change",a)},[]),!!e}const st=({children:e,content:s,className:r=""})=>{const[a,n]=c.useState(!1),[o,i]=c.useState(!1),[l,d]=c.useState(!1),f=Xi(),u=c.useRef(null),m=c.useRef(null),h=()=>{if(!m.current)return;const v=m.current.getBoundingClientRect(),w=180,y=120,b=24,j=v.top,N=window.innerHeight-v.bottom,E=v.left,S=window.innerWidth-v.right,_=j<y&&N>=y;let C=!1;v.right+w>window.innerWidth-b?C=!0:v.left-w<b?C=!1:C=S<E,i(_),d(C)},p=v=>{v.preventDefault(),v.stopPropagation(),f&&(n(!a),a||h())},g=()=>{f||(n(!0),h())},x=()=>{f||n(!1)};return c.useEffect(()=>{const v=w=>{f&&a&&u.current&&m.current&&!u.current.contains(w.target)&&!m.current.contains(w.target)&&n(!1)};if(f&&a)return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[f,a]),t.jsxs("div",{className:"relative inline-block",children:[t.jsx("div",{ref:m,className:Z("cursor-pointer transition-colors duration-200",f&&"active:bg-accent/20 rounded-md p-1 -m-1",r),onClick:p,onMouseEnter:g,onMouseLeave:x,children:e}),a&&t.jsxs(t.Fragment,{children:[f&&t.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:()=>n(!1)}),t.jsxs("div",{ref:u,className:Z("absolute z-[60] px-3 py-2 text-sm text-popover-foreground bg-popover border border-border rounded-md shadow-lg","w-[180px] max-w-[calc(100vw-48px)] text-left leading-relaxed","animate-in fade-in-0 zoom-in-95 duration-200",o?l?"top-full right-0 mt-2":"top-full left-0 mt-2":l?"bottom-full right-0 mb-2":"bottom-full left-0 mb-2"),children:[s,t.jsx("div",{className:Z("absolute",l?"left-4":"right-4",o?"top-0 -mt-1 w-2 h-2 bg-popover border-l border-t border-border rotate-45":"bottom-0 -mb-1 w-2 h-2 bg-popover border-r border-b border-border rotate-45")})]})]})]})},_r=c.forwardRef(({className:e,...s},r)=>t.jsx("textarea",{className:Z("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...s}));_r.displayName="Textarea";const yN=({contentKey:e,content:s,size:r="md",className:a})=>{const[n,o]=c.useState(!1),[i,l]=c.useState("top"),[d,f]=c.useState(!1),[u,m]=c.useState(!1),[h,p]=c.useState(s),[g,x]=c.useState(s),[v,w]=c.useState(!1),[y,b]=c.useState({image:"/src/assets/motivator-placeholder.jpg",name:"Admin",title:"Personal Insight"}),j=Xi(),{isAdmin:N,loading:E}=Xe(),{toast:S}=pe(),_=c.useRef(null),C=c.useRef(null);c.useEffect(()=>{(async()=>{try{const{data:B}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["author_tooltip_image","author_tooltip_name","author_tooltip_title"]);if(B){const de=B.reduce((te,Y)=>(te[Y.setting_key]=Y.setting_value,te),{});b({image:de.author_tooltip_image||"/src/assets/motivator-placeholder.jpg",name:de.author_tooltip_name||"Admin",title:de.author_tooltip_title||"Personal Insight"})}if(e){const{data:de}=await P.from("tooltip_content").select("content").eq("content_key",e).maybeSingle();de&&(x(de.content),p(de.content))}}catch(B){console.error("Failed to load author data:",B)}})()},[e]);const k=()=>{if(!C.current||!_.current)return;const L=C.current.getBoundingClientRect(),B=280,de=160,te=16,Y=L.top;window.innerHeight-L.bottom;const oe=window.innerWidth-L.right,O=L.left;l(Y>=de?"top":"bottom");let Q=!1;L.right+B>window.innerWidth-te?Q=!0:L.left-B<te?Q=!1:Q=oe<O,f(Q)},T=L=>{L.preventDefault(),L.stopPropagation(),j&&(o(!n),n||k())},D=()=>{j||(o(!0),k())},W=L=>{if(!j){const B=L.relatedTarget;if(_.current&&B&&_.current.contains(B))return;o(!1)}},$=L=>{if(!j){const B=L.relatedTarget;if(C.current&&B&&C.current.contains(B))return;o(!1)}};c.useEffect(()=>{const L=B=>{j&&n&&_.current&&C.current&&!_.current.contains(B.target)&&!C.current.contains(B.target)&&o(!1)};if(j&&n)return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[j,n]);const X=()=>{u&&p(g),m(!u)},V=async()=>{if(!(!e||!N)){w(!0);try{await P.from("tooltip_content").upsert({content_key:e,content:h},{onConflict:"content_key"}),x(h),m(!1),S({title:"Content saved",description:"Tooltip content has been updated successfully."})}catch(L){console.error("Error saving content:",L),S({title:"Save failed",description:"Failed to save content. Please try again.",variant:"destructive"})}finally{w(!1)}}},G={sm:"w-10 h-10",md:"w-12 h-12",lg:"w-14 h-14"};return t.jsxs("div",{className:"relative inline-block",children:[t.jsxs("div",{ref:C,className:Z("relative cursor-pointer transition-all duration-500 group","border-2 border-[#dac471] bg-gradient-to-br from-[#dac471]/20 to-[#dac471]/10","author-tooltip-bubble shadow-lg hover:shadow-xl","animate-elegant-pulse hover:animate-border-pulse",G[r],j&&"active:scale-95",a),onClick:T,onMouseEnter:D,onMouseLeave:W,style:{borderRadius:"50% 50% 50% 10%"},children:[t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{background:"radial-gradient(circle, #dac471 0%, rgba(218, 196, 113, 0.4) 50%, transparent 70%)",borderRadius:"50% 50% 50% 10%",filter:"blur(8px)",transform:"scale(1.2)"}}),t.jsx("img",{src:y.image,alt:y.name,className:Z("w-full h-full object-cover transition-all duration-300","filter grayscale group-hover:grayscale-0 group-hover:scale-110"),style:{borderRadius:"50% 50% 50% 10%"}})]}),n&&t.jsxs(t.Fragment,{children:[j&&t.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:()=>o(!1)}),t.jsxs("div",{ref:_,onMouseLeave:$,className:Z("absolute z-[60] px-4 py-3 bg-popover border border-border rounded-lg shadow-xl","w-[280px] max-w-[calc(100vw-32px)] text-left","animate-fade-in",i==="bottom"?d?"top-full right-0 mt-3":"top-full left-0 mt-3":d?"bottom-full right-0 mb-3":"bottom-full left-0 mb-3"),children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("img",{src:y.image,alt:y.name,className:"w-8 h-8 rounded-full object-cover"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm text-foreground",children:y.name}),t.jsx("div",{className:"text-xs text-muted-foreground",children:y.title})]})]}),u?t.jsxs("div",{className:"space-y-3",children:[t.jsx(_r,{value:h,onChange:L=>p(L.target.value),className:"text-sm leading-relaxed min-h-[80px] resize-none",placeholder:"Enter tooltip content..."}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsxs(A,{size:"sm",variant:"outline",onClick:X,disabled:v,children:[t.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Cancel"]}),t.jsxs(A,{size:"sm",onClick:V,disabled:v||h.trim()==="",children:[t.jsx(ss,{className:"w-3 h-3 mr-1"}),v?"Saving...":"Save"]})]})]}):t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-popover-foreground leading-relaxed mb-2",children:g}),N&&!E&&e&&t.jsxs(A,{size:"sm",variant:"ghost",onClick:X,className:"text-xs h-6 px-2 hover:bg-muted",children:[t.jsx(ut,{className:"w-3 h-3 mr-1"}),"Edit"]})]}),t.jsx("div",{className:Z("absolute w-3 h-3 bg-popover border-border rotate-45",d?"right-6":"left-6",i==="bottom"?"top-0 -mt-1.5 border-l border-t":"bottom-0 -mb-1.5 border-r border-b")})]})]})]})},Vm=c.createContext(void 0),Hm=()=>{const e=c.useContext(Vm);if(!e)throw new Error("useAnimationControl must be used within AnimationProvider");return e},wN=({children:e})=>{const[s,r]=c.useState(!1),a=()=>{r(!0);const o=document.createElement("style");o.id="suspend-animations",o.textContent=`
      .modal-root * {
        animation-duration: 0.2s;
        transition-duration: 0.2s;
      }
      .modal-root {
        transform: translate3d(0, 0, 0);
        will-change: transform;
        backface-visibility: hidden;
      }
    `,document.head.appendChild(o)},n=()=>{r(!1);const o=document.getElementById("suspend-animations");o&&o.remove()};return t.jsx(Vm.Provider,{value:{isAnimationsSuspended:s,suspendAnimations:a,resumeAnimations:n},children:e})},Zr=(e,s="imperial")=>e?s==="metric"?`${e.toFixed(2)} km`:`${(e/1.60934).toFixed(2)} mi`:"0",bN=({displayTime:e,isActive:s,isPaused:r=!1,onStart:a,onPause:n,onResume:o,onStop:i,onCancel:l,className:d="",showSlideshow:f=!1,realTimeStats:u,units:m="imperial",selectedSpeed:h,onSpeedChange:p})=>{const[g,x]=c.useState("timer-focused"),{isAnimationsSuspended:v}=Hm(),{toast:w}=pe(),y=c.useMemo(()=>[{displaySpeed:"normal",storageSpeed:3.1,label:"Normal",description:"Sustainable pace, light-moderate cardio"},{displaySpeed:"fast",storageSpeed:4.3,label:"Fast",description:"Intense pace, higher calorie burn"}],[]),b=c.useCallback(S=>{const _=y.find(C=>Math.abs(C.storageSpeed-S)<.3);return console.log("Speed matching:",{speedMph:S,match:_?.displaySpeed,options:y.map(C=>({speed:C.storageSpeed,display:C.displaySpeed}))}),_||y[0]},[y]),j=c.useCallback(S=>{console.log("Speed change requested:",S);const _=y.find(C=>C.displaySpeed===S);_&&(console.log("Changing speed to:",_.storageSpeed),p(_.storageSpeed))},[y,p]),E=b(h).displaySpeed;return t.jsx(Hs,{children:t.jsxs("div",{className:`relative ${d}`,children:[t.jsxs("div",{className:"w-full space-y-4",children:[t.jsxs(ie,{className:"p-6 text-center relative overflow-hidden",children:[f&&s&&!r&&t.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:t.jsx(lm,{isActive:f&&s&&!r,onModeChange:x,className:"rounded-lg"})}),t.jsxs("div",{className:Z("mb-4 transition-opacity duration-1000 relative flex flex-col justify-center items-center",g==="motivator-focused"?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:13},children:[t.jsx("div",{className:"text-5xl font-mono font-bold text-warm-text mb-2 tracking-wide",style:{fontFeatureSettings:'"tnum" 1',textShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e}),t.jsx("div",{className:Z("text-lg font-medium transition-colors duration-300",s&&!r?"text-foreground":"text-muted-foreground"),children:r?"Paused":s?"Walking":"Ready to Walk"}),s&&u&&t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 text-sm text-muted-foreground",children:[t.jsx(Vt,{className:"w-4 h-4"}),t.jsxs("span",{children:["Started ",new Date(u.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]}),s&&t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsxs("div",{className:"flex gap-2 flex-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{onClick:async()=>{try{const S=r?await o?.():await n?.();S&&"error"in S&&S.error&&w({title:"Error",description:S.error.message||`Failed to ${r?"resume":"pause"} session`,variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-secondary",className:"flex-1",children:r?t.jsx(Da,{className:"w-6 h-6"}):t.jsx(wd,{className:"w-6 h-6"})})}),t.jsx(Me,{collisionPadding:16,children:t.jsx("p",{children:r?"Resume":"Pause"})})]}),l&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{onClick:async()=>{try{const S=await l?.();S&&"error"in S&&S.error&&w({title:"Error",description:S.error.message||"Failed to cancel session",variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-secondary",className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground",children:t.jsx(Ie,{className:"w-6 h-6"})})}),t.jsx(Me,{collisionPadding:16,children:t.jsx("p",{children:"Cancel"})})]})]}),t.jsx("div",{className:"flex-1",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsxs(A,{onClick:async()=>{try{const S=await i();S&&"error"in S&&S.error&&w({title:"Error",description:S.error.message||"Failed to stop session",variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-main",className:"w-full",children:[t.jsx(gd,{className:"w-5 h-5 mr-2"}),"Finish"]})}),t.jsx(Me,{collisionPadding:16,children:t.jsx("p",{children:"Complete"})})]})})]}),u&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(ie,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Aa,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Speed"}),t.jsx(st,{content:"Normal walking: Comfortable sustainable pace - Default. Fast walking: More intense pace for higher calorie burn. Adjust during your walk if needed.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsx("div",{className:"flex items-center justify-start",children:t.jsxs(es,{value:E,onValueChange:j,children:[t.jsx(qt,{className:"h-7 w-24 text-sm bg-ceramic-base border-ceramic-rim",children:t.jsx(ts,{})}),t.jsx(Wt,{className:"z-50 bg-ceramic-plate border-ceramic-rim backdrop-blur-sm",children:y.map(S=>t.jsx(Fe,{value:S.displaySpeed,className:"text-xs hover:bg-ceramic-base focus:bg-ceramic-base",children:S.label},S.displaySpeed))})]})})]}),t.jsxs(ie,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Distance"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xl font-bold text-foreground",children:Zr(u.distance,m)}),t.jsx(st,{content:"Distance is estimated based on your walking speed and elapsed time.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(ie,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Calories"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xl font-bold text-foreground",children:[u.calories,t.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"cal"})]}),t.jsx(st,{content:"Calories are estimated based on your profile data (weight, age, etc.) and walking intensity.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]})]}),t.jsxs(ie,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(dn,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Fat"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xl font-bold text-foreground",children:[(u.calories/9).toFixed(1),t.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"g"})]}),t.jsx(st,{content:"Fat burned is estimated based on calories (1g fat = 9 calories).",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]})]})]}),t.jsx("div",{className:"flex justify-start mt-3",children:t.jsx(yN,{contentKey:"walking_timer_health",content:"Walking regularly helps improve cardiovascular health, builds stronger bones, and can boost your mood through the release of endorphins. Even short walks make a meaningful difference!",size:"sm"})})]})]}),!s&&t.jsx("div",{className:"mt-8",children:t.jsxs(A,{onClick:a,variant:"action-primary",size:"start-button",className:"w-full",children:[t.jsx(Da,{className:"w-8 h-8 mr-3"}),"Start Walking"]})})]})})},Qm=c.memo(bN);var jN="Label",Km=c.forwardRef((e,s)=>t.jsx(xe.label,{...e,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Km.displayName=jN;var Ym=Km;const NN=on("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),fe=c.forwardRef(({className:e,...s},r)=>t.jsx(Ym,{ref:r,className:Z(NN(),e),...s}));fe.displayName=Ym.displayName;var Xm=["PageUp","PageDown"],Jm=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Zm={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Cr="Slider",[Ko,SN,_N]=an(Cr),[eh,q2]=St(Cr,[_N]),[CN,Tn]=eh(Cr),th=c.forwardRef((e,s)=>{const{name:r,min:a=0,max:n=100,step:o=1,orientation:i="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:f=[a],value:u,onValueChange:m=()=>{},onValueCommit:h=()=>{},inverted:p=!1,form:g,...x}=e,v=c.useRef(new Set),w=c.useRef(0),b=i==="horizontal"?kN:EN,[j=[],N]=Gt({prop:u,defaultProp:f,onChange:T=>{[...v.current][w.current]?.focus(),m(T)}}),E=c.useRef(j);function S(T){const D=AN(j,T);k(T,D)}function _(T){k(T,w.current)}function C(){const T=E.current[w.current];j[w.current]!==T&&h(j)}function k(T,D,{commit:W}={commit:!1}){const $=ON(o),X=LN(Math.round((T-a)/o)*o+a,$),V=Jr(X,[a,n]);N((G=[])=>{const L=PN(G,V,D);if(FN(L,d*o)){w.current=L.indexOf(V);const B=String(L)!==String(G);return B&&W&&h(L),B?L:G}else return G})}return t.jsx(CN,{scope:e.__scopeSlider,name:r,disabled:l,min:a,max:n,valueIndexToChangeRef:w,thumbs:v.current,values:j,orientation:i,form:g,children:t.jsx(Ko.Provider,{scope:e.__scopeSlider,children:t.jsx(Ko.Slot,{scope:e.__scopeSlider,children:t.jsx(b,{"aria-disabled":l,"data-disabled":l?"":void 0,...x,ref:s,onPointerDown:ae(x.onPointerDown,()=>{l||(E.current=j)}),min:a,max:n,inverted:p,onSlideStart:l?void 0:S,onSlideMove:l?void 0:_,onSlideEnd:l?void 0:C,onHomeKeyDown:()=>!l&&k(a,0,{commit:!0}),onEndKeyDown:()=>!l&&k(n,j.length-1,{commit:!0}),onStepKeyDown:({event:T,direction:D})=>{if(!l){const X=Xm.includes(T.key)||T.shiftKey&&Jm.includes(T.key)?10:1,V=w.current,G=j[V],L=o*X*D;k(G+L,V,{commit:!0})}}})})})})});th.displayName=Cr;var[sh,rh]=eh(Cr,{startEdge:"left",endEdge:"right",size:"width",direction:1}),kN=c.forwardRef((e,s)=>{const{min:r,max:a,dir:n,inverted:o,onSlideStart:i,onSlideMove:l,onSlideEnd:d,onStepKeyDown:f,...u}=e,[m,h]=c.useState(null),p=Ne(s,b=>h(b)),g=c.useRef(),x=Ys(n),v=x==="ltr",w=v&&!o||!v&&o;function y(b){const j=g.current||m.getBoundingClientRect(),N=[0,j.width],S=Ji(N,w?[r,a]:[a,r]);return g.current=j,S(b-j.left)}return t.jsx(sh,{scope:e.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width",children:t.jsx(ah,{dir:x,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const j=y(b.clientX);i?.(j)},onSlideMove:b=>{const j=y(b.clientX);l?.(j)},onSlideEnd:()=>{g.current=void 0,d?.()},onStepKeyDown:b=>{const N=Zm[w?"from-left":"from-right"].includes(b.key);f?.({event:b,direction:N?-1:1})}})})}),EN=c.forwardRef((e,s)=>{const{min:r,max:a,inverted:n,onSlideStart:o,onSlideMove:i,onSlideEnd:l,onStepKeyDown:d,...f}=e,u=c.useRef(null),m=Ne(s,u),h=c.useRef(),p=!n;function g(x){const v=h.current||u.current.getBoundingClientRect(),w=[0,v.height],b=Ji(w,p?[a,r]:[r,a]);return h.current=v,b(x-v.top)}return t.jsx(sh,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:t.jsx(ah,{"data-orientation":"vertical",...f,ref:m,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const v=g(x.clientY);o?.(v)},onSlideMove:x=>{const v=g(x.clientY);i?.(v)},onSlideEnd:()=>{h.current=void 0,l?.()},onStepKeyDown:x=>{const w=Zm[p?"from-bottom":"from-top"].includes(x.key);d?.({event:x,direction:w?-1:1})}})})}),ah=c.forwardRef((e,s)=>{const{__scopeSlider:r,onSlideStart:a,onSlideMove:n,onSlideEnd:o,onHomeKeyDown:i,onEndKeyDown:l,onStepKeyDown:d,...f}=e,u=Tn(Cr,r);return t.jsx(xe.span,{...f,ref:s,onKeyDown:ae(e.onKeyDown,m=>{m.key==="Home"?(i(m),m.preventDefault()):m.key==="End"?(l(m),m.preventDefault()):Xm.concat(Jm).includes(m.key)&&(d(m),m.preventDefault())}),onPointerDown:ae(e.onPointerDown,m=>{const h=m.target;h.setPointerCapture(m.pointerId),m.preventDefault(),u.thumbs.has(h)?h.focus():a(m)}),onPointerMove:ae(e.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&n(m)}),onPointerUp:ae(e.onPointerUp,m=>{const h=m.target;h.hasPointerCapture(m.pointerId)&&(h.releasePointerCapture(m.pointerId),o(m))})})}),nh="SliderTrack",oh=c.forwardRef((e,s)=>{const{__scopeSlider:r,...a}=e,n=Tn(nh,r);return t.jsx(xe.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...a,ref:s})});oh.displayName=nh;var Yo="SliderRange",ih=c.forwardRef((e,s)=>{const{__scopeSlider:r,...a}=e,n=Tn(Yo,r),o=rh(Yo,r),i=c.useRef(null),l=Ne(s,i),d=n.values.length,f=n.values.map(h=>ch(h,n.min,n.max)),u=d>1?Math.min(...f):0,m=100-Math.max(...f);return t.jsx(xe.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...a,ref:l,style:{...e.style,[o.startEdge]:u+"%",[o.endEdge]:m+"%"}})});ih.displayName=Yo;var Xo="SliderThumb",lh=c.forwardRef((e,s)=>{const r=SN(e.__scopeSlider),[a,n]=c.useState(null),o=Ne(s,l=>n(l)),i=c.useMemo(()=>a?r().findIndex(l=>l.ref.current===a):-1,[r,a]);return t.jsx(TN,{...e,ref:o,index:i})}),TN=c.forwardRef((e,s)=>{const{__scopeSlider:r,index:a,name:n,...o}=e,i=Tn(Xo,r),l=rh(Xo,r),[d,f]=c.useState(null),u=Ne(s,y=>f(y)),m=d?i.form||!!d.closest("form"):!0,h=oa(d),p=i.values[a],g=p===void 0?0:ch(p,i.min,i.max),x=DN(a,i.values.length),v=h?.[l.size],w=v?RN(v,g,l.direction):0;return c.useEffect(()=>{if(d)return i.thumbs.add(d),()=>{i.thumbs.delete(d)}},[d,i.thumbs]),t.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${g}% + ${w}px)`},children:[t.jsx(Ko.ItemSlot,{scope:e.__scopeSlider,children:t.jsx(xe.span,{role:"slider","aria-label":e["aria-label"]||x,"aria-valuemin":i.min,"aria-valuenow":p,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...o,ref:u,style:p===void 0?{display:"none"}:e.style,onFocus:ae(e.onFocus,()=>{i.valueIndexToChangeRef.current=a})})}),m&&t.jsx(MN,{name:n??(i.name?i.name+(i.values.length>1?"[]":""):void 0),form:i.form,value:p},a)]})});lh.displayName=Xo;var MN=e=>{const{value:s,...r}=e,a=c.useRef(null),n=la(s);return c.useEffect(()=>{const o=a.current,i=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(i,"value").set;if(n!==s&&d){const f=new Event("input",{bubbles:!0});d.call(o,s),o.dispatchEvent(f)}},[n,s]),t.jsx("input",{style:{display:"none"},...r,ref:a,defaultValue:s})};function PN(e=[],s,r){const a=[...e];return a[r]=s,a.sort((n,o)=>n-o)}function ch(e,s,r){const o=100/(r-s)*(e-s);return Jr(o,[0,100])}function DN(e,s){return s>2?`Value ${e+1} of ${s}`:s===2?["Minimum","Maximum"][e]:void 0}function AN(e,s){if(e.length===1)return 0;const r=e.map(n=>Math.abs(n-s)),a=Math.min(...r);return r.indexOf(a)}function RN(e,s,r){const a=e/2,o=Ji([0,50],[0,a]);return(a-o(s)*r)*r}function IN(e){return e.slice(0,-1).map((s,r)=>e[r+1]-s)}function FN(e,s){if(s>0){const r=IN(e);return Math.min(...r)>=s}return!0}function Ji(e,s){return r=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(r-e[0])}}function ON(e){return(String(e).split(".")[1]||"").length}function LN(e,s){const r=Math.pow(10,s);return Math.round(e*r)/r}var dh=th,$N=oh,UN=ih,zN=lh;const Jo=c.forwardRef(({className:e,...s},r)=>t.jsxs(dh,{ref:r,className:Z("relative flex w-full touch-none select-none items-center",e),...s,children:[t.jsx($N,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:t.jsx(UN,{className:"absolute h-full bg-primary"})}),t.jsx(zN,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Jo.displayName=dh.displayName;var Zi="Switch",[qN,W2]=St(Zi),[WN,BN]=qN(Zi),uh=c.forwardRef((e,s)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:o,required:i,disabled:l,value:d="on",onCheckedChange:f,form:u,...m}=e,[h,p]=c.useState(null),g=Ne(s,b=>p(b)),x=c.useRef(!1),v=h?u||!!h.closest("form"):!0,[w=!1,y]=Gt({prop:n,defaultProp:o,onChange:f});return t.jsxs(WN,{scope:r,checked:w,disabled:l,children:[t.jsx(xe.button,{type:"button",role:"switch","aria-checked":w,"aria-required":i,"data-state":fh(w),"data-disabled":l?"":void 0,disabled:l,value:d,...m,ref:g,onClick:ae(e.onClick,b=>{y(j=>!j),v&&(x.current=b.isPropagationStopped(),x.current||b.stopPropagation())})}),v&&t.jsx(GN,{control:h,bubbles:!x.current,name:a,value:d,checked:w,required:i,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});uh.displayName=Zi;var mh="SwitchThumb",hh=c.forwardRef((e,s)=>{const{__scopeSwitch:r,...a}=e,n=BN(mh,r);return t.jsx(xe.span,{"data-state":fh(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})});hh.displayName=mh;var GN=e=>{const{control:s,checked:r,bubbles:a=!0,...n}=e,o=c.useRef(null),i=la(r),l=oa(s);return c.useEffect(()=>{const d=o.current,f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"checked").set;if(i!==r&&m){const h=new Event("click",{bubbles:a});m.call(d,r),d.dispatchEvent(h)}},[i,r,a]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:o,style:{...e.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function fh(e){return e?"checked":"unchecked"}var ph=uh,VN=hh;const Mn=c.forwardRef(({className:e,...s},r)=>t.jsx(ph,{className:Z("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-muted data-[state=unchecked]:border-border",e),...s,ref:r,children:t.jsx(VN,{className:Z("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Mn.displayName=ph.displayName;const ea=nd,HN=ad,gh=c.forwardRef(({className:e,...s},r)=>t.jsx(di,{ref:r,className:Z("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));gh.displayName=di.displayName;const gr=c.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(HN,{children:[t.jsx(gh,{}),t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:t.jsx(ui,{ref:a,className:Z("relative grid w-full max-w-md mx-auto gap-4 border border-ceramic-rim bg-ceramic-plate p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 sm:rounded-lg max-h-[90vh] overflow-y-auto",e),...r,children:s})})]}));gr.displayName=ui.displayName;const Pn=({className:e,...s})=>t.jsx("div",{className:Z("flex flex-col space-y-1.5 text-center sm:text-left border-b border-border -mx-6 px-6 pb-4 mb-4",e),...s});Pn.displayName="DialogHeader";const xh=({className:e,...s})=>t.jsx("div",{className:Z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});xh.displayName="DialogFooter";const xr=c.forwardRef(({className:e,...s},r)=>t.jsx(mi,{ref:r,className:Z("text-lg font-semibold leading-none tracking-tight",e),...s}));xr.displayName=mi.displayName;const Ya=c.forwardRef(({className:e,...s},r)=>t.jsx(hi,{ref:r,className:Z("text-sm text-muted-foreground",e),...s}));Ya.displayName=hi.displayName;const mt=({isOpen:e,onClose:s,title:r,description:a,size:n="md",variant:o="standard",showCloseButton:i=!0,closeOnOverlay:l=!0,children:d,footer:f,className:u,headerClassName:m,contentClassName:h})=>{const p=re.useCallback(()=>{s()},[s]);return re.useEffect(()=>{const g=x=>{x.key==="Escape"&&e&&p()};return e&&(document.addEventListener("keydown",g),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",g),document.body.style.overflow="unset"}},[e,p]),o==="fullscreen"?t.jsx(ea,{open:e,onOpenChange:l?p:void 0,children:t.jsx(gr,{className:Z("w-full max-w-full md:max-w-md h-full max-h-full p-0 overflow-hidden","bg-background","border border-border","rounded-lg shadow-xl","focus:outline-none focus:ring-2 focus:ring-primary",!i&&"[&>button]:hidden",u),onPointerDownOutside:l?void 0:g=>g.preventDefault(),onEscapeKeyDown:l?void 0:g=>g.preventDefault(),children:t.jsxs("div",{className:"h-full flex flex-col max-w-full overflow-hidden",children:[r&&t.jsxs("div",{className:Z("universal-modal-header sticky top-0 z-10 bg-muted/50 border-b border-border px-4 py-3 flex items-center justify-between",m),children:[t.jsx(xr,{className:"text-lg font-semibold text-foreground flex-1 pr-4",children:r}),a&&t.jsx(Ya,{className:"sr-only",children:a}),i&&t.jsx(A,{variant:"ghost",size:"sm",onClick:p,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200 p-0",title:`Close ${r}`,children:t.jsx(Ie,{className:"w-4 h-4"})})]}),t.jsx("div",{className:Z("flex-1 overflow-y-auto overflow-x-hidden",r?"px-4 py-4":"p-0",h),children:d}),f&&t.jsx("div",{className:Z("sticky bottom-0 z-10 bg-muted/50 border-t border-border px-4 py-3 shadow-lg grid grid-cols-2 gap-3"),children:f})]})})}):t.jsx(ea,{open:e,onOpenChange:l?p:void 0,children:t.jsxs(gr,{className:Z("bg-background","border border-border","rounded-lg shadow-xl","p-0 overflow-hidden","mx-4 my-8","max-h-[90vh]","w-[calc(100vw-2rem)] max-w-md","focus:outline-none focus:ring-2 focus:ring-primary",!i&&"[&>button]:hidden",u),onPointerDownOutside:l?void 0:g=>g.preventDefault(),onEscapeKeyDown:l?void 0:g=>g.preventDefault(),children:[r&&t.jsxs("div",{className:Z("universal-modal-header px-6 py-3 border-b border-border flex items-center justify-between","bg-muted/50",m),children:[t.jsx(xr,{className:"text-lg font-semibold text-foreground flex-1 pr-4",children:r}),a&&t.jsx(Ya,{className:"sr-only",children:a}),i&&t.jsx(A,{variant:"ghost",size:"sm",onClick:p,className:Z("h-8 w-8 p-0 rounded-md","text-muted-foreground hover:text-foreground","hover:bg-muted"),"aria-label":"Close modal",children:t.jsx(Ie,{className:"h-5 w-5"})})]}),t.jsx("div",{className:Z("overflow-y-auto",r?"px-6 py-4":"p-0","max-h-[calc(90vh-8rem)]",h),children:d}),f&&t.jsx("div",{className:Z("px-6 py-4 border-t border-border","bg-muted/50","grid grid-cols-2 gap-3"),children:f})]})})},QN=({currentDuration:e,onSelect:s,onClose:r})=>{const[a,n]=c.useState(()=>Math.floor(e/3600)||60),[o,i]=c.useState(!1),[l,d]=c.useState(6),f=()=>{if(o){const g=new Date(Date.now()-l*60*60*1e3),x=g.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});s(a*3600,g,x)}else s(a*3600)},u=()=>o?l>=1&&l<=72:!0,m=()=>{if(!o)return"";const g=new Date(Date.now()-l*60*60*1e3),x=new Date,v=g.toDateString()===x.toDateString(),w=g.toDateString()===new Date(x.getTime()-24*60*60*1e3).toDateString();let y="";v?y="Today":w?y="Yesterday":y=g.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});const b=g.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`Started on ${y} at ${b}`},h=g=>{n(g)},p=[{name:"24 Hour Fast",hours:24},{name:"48 Hour Fast",hours:48},{name:"60 Hour Fast",hours:60,recommended:!0},{name:"72 Hour Fast",hours:72}];return t.jsxs(mt,{isOpen:!0,onClose:r,title:"Configure Fast",variant:"standard",size:"sm",showCloseButton:!0,contentClassName:"px-4 sm:px-6 py-3 sm:py-4 max-h-[85vh] sm:max-h-[90vh]",footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:r,className:"w-full h-10",size:"default",children:"Cancel"}),t.jsx(A,{onClick:f,disabled:!u(),className:"w-full h-10",size:"default",children:o?"Start Past Fasting":"Start Fasting"})]}),children:[t.jsxs("div",{className:"space-y-4 mb-6",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Quick Presets"}),t.jsx("div",{className:"grid gap-2",children:p.map(g=>t.jsxs(A,{variant:a===g.hours?"default":"outline",onClick:()=>n(g.hours),className:a===g.hours?"justify-start bg-primary text-primary-foreground hover:bg-primary/90 border-2 border-primary-foreground/20":"justify-start bg-ceramic-base border-ceramic-rim hover:bg-ceramic-rim",children:[t.jsx("span",{className:"font-medium",children:g.name}),a===g.hours&&t.jsx(Gs,{className:"ml-2 w-4 h-4 text-primary-foreground"}),t.jsxs("span",{className:"ml-auto text-muted-foreground text-sm",children:[g.hours," hours"]})]},g.name))})]}),t.jsx("div",{className:"space-y-4 mb-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs(fe,{className:"text-warm-text font-medium",children:["Fast Duration: ",a,"h"]}),t.jsx(Jo,{value:[a],onValueChange:g=>h(g[0]),max:168,min:24,step:1,defaultValue:[60],className:"w-full"})]})}),t.jsxs("div",{className:"space-y-4 p-3 sm:p-4 rounded-lg bg-ceramic-base/30 border border-ceramic-rim/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ln,{className:"w-4 h-4 text-primary"}),t.jsx(fe,{className:"text-warm-text font-medium text-sm sm:text-base",children:"Start fast in the past"})]}),t.jsx(Mn,{checked:o,onCheckedChange:i})]}),o&&t.jsxs("div",{className:"space-y-4 pt-2",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs(fe,{className:"text-warm-text text-xs sm:text-sm",children:["Hours Ago: ",l,"h"]}),t.jsx(Jo,{value:[l],onValueChange:g=>d(g[0]),max:72,min:1,step:1,className:"w-full"})]}),t.jsx("div",{className:"p-3 bg-primary/10 rounded-md border border-primary/20",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vt,{className:"w-4 h-4 text-white"}),t.jsx("span",{className:"text-xs sm:text-sm font-medium text-white",children:m()})]})}),!u()&&t.jsx("p",{className:"text-red-500 text-xs",children:"Please enter a valid number of hours (1-72)"})]})]})]})},KN=({open:e,onOpenChange:s,onConfirm:r,currentDuration:a,actionType:n="finish"})=>{const o=()=>s(!1);return t.jsx(mt,{isOpen:e,onClose:o,title:n==="cancel"?"Cancel Fast?":"Finish Fast?",size:"sm",showCloseButton:!1,footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",size:"action-main",onClick:o,className:"text-sm w-full",children:"Close"}),t.jsx(A,{variant:"action-primary",size:"action-main",onClick:r,className:"text-sm w-full",children:n==="cancel"?"Cancel Fast":"Finish Fast"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:n==="cancel"?t.jsxs(t.Fragment,{children:["Are you sure you want to cancel your fast? You've been fasting for ",t.jsx("span",{className:"font-medium text-foreground",children:a||"0:00:00"}),"."]}):t.jsxs(t.Fragment,{children:["Are you sure you want to finish your fast? You've been fasting for ",t.jsx("span",{className:"font-medium text-foreground",children:a||"0:00:00"}),"."]})}),t.jsx("div",{className:"text-xs text-muted-foreground font-medium bg-muted/30 rounded-lg p-3 border border-border",children:n==="cancel"?"This will remove your fast from history completely.":"This will save your fast progress to history."})]})})},YN=on("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function js({className:e,variant:s,...r}){return t.jsx("div",{className:Z(YN({variant:s}),e),...r})}function Xt({className:e,...s}){return t.jsx("div",{className:Z("animate-pulse rounded-md bg-muted",e),...s})}const vh=({isLoading:e,children:s,loadingText:r,className:a,...n})=>t.jsxs(A,{disabled:e,className:Z("gap-2",a),...n,children:[e&&t.jsx(zt,{className:"w-4 h-4 animate-spin"}),e?r||"Please wait...":s]}),B2=({text:e="Loading",size:s=16,className:r})=>t.jsxs("div",{className:Z("flex items-center gap-2 text-muted-foreground",r),children:[t.jsx(zt,{className:"animate-spin",style:{width:s,height:s}}),t.jsxs("span",{className:"text-sm",children:[e,"..."]})]});var yh="AlertDialog",[XN,G2]=St(yh,[od]),hs=od(),wh=e=>{const{__scopeAlertDialog:s,...r}=e,a=hs(s);return t.jsx(nd,{...a,...r,modal:!0})};wh.displayName=yh;var JN="AlertDialogTrigger",bh=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=hs(r);return t.jsx(Hp,{...n,...a,ref:s})});bh.displayName=JN;var ZN="AlertDialogPortal",jh=e=>{const{__scopeAlertDialog:s,...r}=e,a=hs(s);return t.jsx(ad,{...a,...r})};jh.displayName=ZN;var e1="AlertDialogOverlay",Nh=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=hs(r);return t.jsx(di,{...n,...a,ref:s})});Nh.displayName=e1;var cr="AlertDialogContent",[t1,s1]=XN(cr),Sh=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,children:a,...n}=e,o=hs(r),i=c.useRef(null),l=Ne(s,i),d=c.useRef(null);return t.jsx(Qp,{contentName:cr,titleName:_h,docsSlug:"alert-dialog",children:t.jsx(t1,{scope:r,cancelRef:d,children:t.jsxs(ui,{role:"alertdialog",...o,...n,ref:l,onOpenAutoFocus:ae(n.onOpenAutoFocus,f=>{f.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:f=>f.preventDefault(),onInteractOutside:f=>f.preventDefault(),children:[t.jsx(Jc,{children:a}),t.jsx(a1,{contentRef:i})]})})})});Sh.displayName=cr;var _h="AlertDialogTitle",Ch=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=hs(r);return t.jsx(mi,{...n,...a,ref:s})});Ch.displayName=_h;var kh="AlertDialogDescription",Eh=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=hs(r);return t.jsx(hi,{...n,...a,ref:s})});Eh.displayName=kh;var r1="AlertDialogAction",Th=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=hs(r);return t.jsx(id,{...n,...a,ref:s})});Th.displayName=r1;var Mh="AlertDialogCancel",Ph=c.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,{cancelRef:n}=s1(Mh,r),o=hs(r),i=Ne(s,n);return t.jsx(id,{...o,...a,ref:i})});Ph.displayName=Mh;var a1=({contentRef:e})=>{const s=`\`${cr}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${cr}\` by passing a \`${kh}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${cr}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return c.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,e]),null},n1=wh,o1=bh,i1=jh,Dh=Nh,Ah=Sh,Rh=Th,Ih=Ph,Fh=Ch,Oh=Eh;const rt=n1,gt=o1,l1=i1,Lh=c.forwardRef(({className:e,...s},r)=>t.jsx(Dh,{className:Z("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:r}));Lh.displayName=Dh.displayName;const Be=c.forwardRef(({className:e,...s},r)=>t.jsxs(l1,{children:[t.jsx(Lh,{}),t.jsx(Ah,{ref:r,className:Z("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));Be.displayName=Ah.displayName;const Ge=({className:e,...s})=>t.jsx("div",{className:Z("flex flex-col space-y-2 text-center sm:text-left",e),...s});Ge.displayName="AlertDialogHeader";const Ve=({className:e,...s})=>t.jsx("div",{className:Z("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});Ve.displayName="AlertDialogFooter";const He=c.forwardRef(({className:e,...s},r)=>t.jsx(Fh,{ref:r,className:Z("text-lg font-semibold",e),...s}));He.displayName=Fh.displayName;const Qe=c.forwardRef(({className:e,...s},r)=>t.jsx(Oh,{ref:r,className:Z("text-sm text-muted-foreground",e),...s}));Qe.displayName=Oh.displayName;const Ke=c.forwardRef(({className:e,...s},r)=>t.jsx(Rh,{ref:r,className:Z(Ui(),e),...s}));Ke.displayName=Rh.displayName;const Ye=c.forwardRef(({className:e,...s},r)=>t.jsx(Ih,{ref:r,className:Z(Ui({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));Ye.displayName=Ih.displayName;const c1=({onClose:e})=>{const[s,r]=c.useState([]),[a,n]=c.useState(!0);c.useState(new Set);const[o,i]=c.useState(0),[l,d]=c.useState(!0),{toast:f}=pe(),{user:u}=Se(),m=10,h=N=>{const E=Math.floor(N/3600),S=Math.floor(N%3600/60);return S>0?`${E}h ${S}m`:`${E}h`},p=N=>{const E=N.duration_seconds&&N.goal_duration_seconds&&N.duration_seconds>=N.goal_duration_seconds;switch(N.status){case"completed":return E?t.jsx(js,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Completed"}):t.jsx("div",{className:"w-6 h-6 bg-destructive rounded-full flex items-center justify-center",children:t.jsx(Ie,{className:"w-3 h-3 text-destructive-foreground"})});case"incomplete":return t.jsx(js,{variant:"default",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",children:"Incomplete"});case"cancelled":return t.jsx("div",{className:"w-6 h-6 bg-destructive rounded-full flex items-center justify-center",children:t.jsx(Ie,{className:"w-3 h-3 text-destructive-foreground"})});case"active":return t.jsx(js,{className:"bg-green-500 text-white hover:bg-green-600 font-medium",children:"Active"});default:return null}},g=()=>{const N=s.filter(S=>S.status==="completed"),E=s.filter(S=>S.status!=="active").length;return E>0?Math.round(N.length/E*100):0},x=()=>{const N=s.filter(S=>S.status==="completed"&&S.duration_seconds);if(N.length===0)return 0;const E=N.reduce((S,_)=>S+(_.duration_seconds||0),0);return Math.round(E/N.length)},v=()=>{let N=0,E=0;const S=[...s].filter(_=>_.status==="completed").sort((_,C)=>new Date(_.start_time).getTime()-new Date(C.start_time).getTime());for(const _ of S)_.status==="completed"?(N++,E=Math.max(E,N)):N=0;return E},w=async(N=0,E=!1)=>{if(u){n(!0);try{console.log("Loading fasting history for user:",u.id);const{data:S,error:_}=await P.from("fasting_sessions").select("*").eq("user_id",u.id).order("start_time",{ascending:!1}).range(N*m,(N+1)*m-1);if(_)throw console.error("Error loading fasting history:",_),_;console.log("Loaded fasting sessions:",S?.length||0);const C=(S||[]).map(k=>({...k,status:k.status}));r(E?k=>[...k,...C]:C),d((S?.length||0)===m),console.log("Updated sessions state, total sessions:",E?s.length+C.length:C.length)}catch(S){console.error("Error loading fasting history:",S),f({title:"Error",description:"Failed to load fasting history. Please try again.",variant:"destructive"})}finally{n(!1)}}},y=()=>{const N=o+1;i(N),w(N,!0)},b=async N=>{try{const{error:E}=await P.from("fasting_sessions").delete().eq("id",N);if(E)throw E;r(S=>S.filter(_=>_.id!==N)),f({title:"Session deleted",description:"Fasting session has been removed"})}catch(E){console.error("Error deleting session:",E),f({title:"Error",description:"Failed to delete fasting session",variant:"destructive"})}},j=async()=>{try{const{error:N}=await P.from("fasting_sessions").delete().eq("user_id",u?.id).neq("status","active");if(N)throw N;await w(),f({title:"History deleted",description:"All completed and cancelled fasting sessions have been deleted"})}catch(N){console.error("Error deleting all history:",N),f({title:"Error",description:"Failed to delete fasting history",variant:"destructive"})}};return c.useEffect(()=>{w()},[u]),a&&s.length===0?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(ie,{className:"w-full max-w-md mx-auto",onClick:N=>N.stopPropagation(),children:[t.jsx(pt,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(us,{className:"text-lg font-semibold",children:"Fasting History"}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]})}),t.jsx($e,{children:t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((N,E)=>t.jsx(ie,{children:t.jsx(pt,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-20"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-16"})]})]}),t.jsx("div",{className:"flex gap-2 justify-end",children:t.jsx("div",{className:"w-16 h-6 bg-muted animate-pulse rounded"})})]})})},E))})})]})}):(s.filter(N=>N.status==="completed"),g(),x(),v(),t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(ie,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:N=>N.stopPropagation(),children:[t.jsx(pt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(us,{className:"text-lg font-semibold",children:"Fasting History"}),t.jsxs("div",{className:"flex gap-2",children:[s.filter(N=>N.status!=="active").length>0&&t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(We,{className:"w-4 h-4"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete All Fasting History"}),t.jsx(Qe,{children:"Are you sure you want to delete ALL fasting history? This will permanently remove all completed and cancelled sessions (active sessions will remain). This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:j,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]})]})}),t.jsx($e,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:s.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Vt,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("div",{className:"text-muted-foreground",children:"No fasting sessions found"}),t.jsx("div",{className:"text-sm text-muted-foreground/80 mt-1",children:"Start your first fast to see history here"})]}):t.jsxs(t.Fragment,{children:[s.map(N=>t.jsxs(ie,{className:"relative bg-muted/20 border-0",children:[t.jsxs(pt,{className:"pb-4",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h3",{className:"font-medium text-sm",children:new Date(N.start_time).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})}),t.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-2",children:[N.duration_seconds&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Vt,{className:"w-3 h-3"}),h(N.duration_seconds)]}),N.goal_duration_seconds&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Jt,{className:"w-3 h-3"}),"Target: ",h(N.goal_duration_seconds)]})]})]})}),t.jsx("div",{className:"absolute bottom-3 right-3",children:p(N)})]}),N.status!=="active"&&t.jsx("div",{className:"absolute top-3 right-3",children:t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(We,{className:"w-3 h-3"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Fasting Session"}),t.jsx(Qe,{children:"Are you sure you want to delete this fasting session? This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>b(N.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Session"})]})]})]})})]},N.id)),l&&t.jsx("div",{className:"text-center pt-4",children:t.jsx(vh,{variant:"outline",onClick:y,isLoading:a,loadingText:"Loading more",children:"Load More"})})]})})]})}))},Mt=e=>["active-fasting-session",e],Sa=e=>["fasting-history",e],el=()=>{const{user:e}=Se(),{toast:s}=pe(),r=Ct(),a=bt({queryKey:Mt(e?.id||null),queryFn:async()=>{if(!e)return null;const{data:u,error:m}=await P.from("fasting_sessions").select("*").eq("user_id",e.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();if(m&&m.code!=="PGRST116")throw m;return u||null},enabled:!!e?.id,staleTime:5*1e3,gcTime:30*1e3,refetchInterval:u=>u?3e4:!1,refetchOnWindowFocus:!0,retry:3,retryDelay:u=>Math.min(1e3*2**u,1e4)}),n=bt({queryKey:Sa(e?.id||null),queryFn:async()=>{if(!e)return[];const{data:u,error:m}=await P.from("fasting_sessions").select("*").eq("user_id",e.id).in("status",["completed","cancelled"]).order("start_time",{ascending:!1}).limit(50);if(m)throw m;return u||[]},enabled:!!e?.id,staleTime:10*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,retry:3}),o=yt({mutationFn:async u=>{if(console.log("Starting fasting session mutation with data:",u),console.log("User:",e),!e)throw new Error("User not authenticated");console.log("Cancelling existing active sessions...");const m=await P.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",e.id).eq("status","active");console.log("Cancel existing sessions result:",m);const h={user_id:e.id,start_time:u.start_time?u.start_time.toISOString():new Date().toISOString(),goal_duration_seconds:u.goal_duration_seconds,status:"active"};console.log("Inserting new session with data:",h);const{data:p,error:g}=await P.from("fasting_sessions").insert(h).select().single();if(console.log("Insert result:",{data:p,error:g}),g)throw g;return p},onMutate:async u=>{await r.cancelQueries({queryKey:Mt(e?.id||null)});const m={id:`temp-${Date.now()}`,user_id:e?.id||"",start_time:u.start_time?u.start_time.toISOString():new Date().toISOString(),goal_duration_seconds:u.goal_duration_seconds,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.setQueryData(Mt(e?.id||null),m),{optimisticSession:m}},onError:(u,m,h)=>{console.error("Fasting session start error:",u),r.setQueryData(Mt(e?.id||null),null),s({title:"Error starting fasting session",description:u instanceof Error?u.message:"Please try again.",variant:"destructive"})},onSuccess:u=>{r.setQueryData(Mt(e?.id||null),u),s({title:"ðŸŽ¯ Fasting Started!",description:"Your fasting session has begun. Good luck!"})}}),i=yt({mutationFn:async u=>{if(console.log("ðŸŽ¯ Starting endSessionMutation with sessionId:",u),console.log("ðŸŽ¯ User:",e),!e)throw console.error("ðŸŽ¯ Error: User not authenticated"),new Error("User not authenticated");console.log("ðŸŽ¯ Fetching session from database...");const{data:m,error:h}=await P.from("fasting_sessions").select("id, user_id, start_time, goal_duration_seconds").eq("id",u).eq("user_id",e.id).maybeSingle();if(console.log("ðŸŽ¯ Fetch result:",{session:m,fetchError:h}),h)throw console.error("ðŸŽ¯ Fetch error:",h),h;if(!m)throw console.error("ðŸŽ¯ Error: No active session found"),new Error("No active session found");const p=new Date,g=new Date(m.start_time),x=Math.floor((p.getTime()-g.getTime())/1e3);m.goal_duration_seconds;const v="completed";console.log("ðŸŽ¯ Updating session with:",{end_time:p.toISOString(),duration_seconds:x,status:v});const{data:w,error:y}=await P.from("fasting_sessions").update({end_time:p.toISOString(),duration_seconds:x,status:v}).eq("id",u).eq("user_id",e.id).select().single();if(console.log("ðŸŽ¯ Update result:",{data:w,error:y}),y)throw console.error("ðŸŽ¯ Update error:",y),y;return w},onMutate:async u=>{await r.cancelQueries({queryKey:Mt(e?.id||null)});const m=r.getQueryData(Mt(e?.id||null));return r.setQueryData(Mt(e?.id||null),null),{previousSession:m}},onError:(u,m,h)=>{console.error("Error ending fasting session:",u),h?.previousSession&&r.setQueryData(Mt(e?.id||null),h.previousSession),s({title:"Error ending fasting session",description:u instanceof Error?u.message:"Please try again.",variant:"destructive"})},onSuccess:u=>{r.setQueryData(Mt(e?.id||null),null),r.setQueryData(Sa(e?.id||null),(p=[])=>[u,...p]);const m=Math.floor((u.duration_seconds||0)/3600),h=Math.floor((u.duration_seconds||0)%3600/60);s({title:"ðŸŽ‰ Fasting Completed!",description:`Great job! You fasted for ${m}h ${h}m.`})}}),l=yt({mutationFn:async u=>{if(!e)throw new Error("User not authenticated");const{error:m}=await P.from("fasting_sessions").update({status:"cancelled"}).eq("id",u).eq("user_id",e.id);if(m)throw m},onSuccess:()=>{r.setQueryData(Mt(e?.id||null),null),r.invalidateQueries({queryKey:Sa(e?.id||null)}),s({title:"Fasting Cancelled",description:"Your fasting session has been cancelled."})},onError:()=>{s({title:"Error cancelling session",description:"Please try again.",variant:"destructive"})}}),d=c.useCallback(async()=>{await r.refetchQueries({queryKey:Mt(e?.id||null)})},[r,e?.id]),f=c.useCallback(async()=>{await r.refetchQueries({queryKey:Sa(e?.id||null)})},[r,e?.id]);return{currentSession:a.data||null,fastingHistory:n.data||[],loading:a.isLoading,historyLoading:n.isLoading,startFastingSession:o.mutateAsync,endFastingSession:i.mutateAsync,cancelFastingSession:l.mutateAsync,refreshActiveSession:d,refreshHistory:f,isStarting:o.isPending,isEnding:i.isPending,isCancelling:l.isPending}},io=e=>["walking-sessions",e],Ds=e=>["active-walking-session",e],$h=()=>{const{user:e}=Ks(),s=Ct(),{toast:r}=pe(),a=bt({queryKey:io(e?.id||null),queryFn:async()=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await P.from("walking_sessions").select("*").eq("user_id",e.id).order("start_time",{ascending:!1}).limit(50);if(u)throw u;return f||[]},enabled:!!e?.id,staleTime:30*1e3,gcTime:5*60*1e3,retry:3}),n=bt({queryKey:Ds(e?.id||null),queryFn:async()=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await P.from("walking_sessions").select("*").eq("user_id",e.id).eq("session_state","active").maybeSingle();if(u&&u.code!=="PGRST116")throw u;return f||null},enabled:!!e?.id,staleTime:5*1e3,gcTime:30*1e3,refetchInterval:f=>f?3e4:!1,retry:3}),o=yt({mutationFn:async()=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await P.from("walking_sessions").insert({user_id:e.id,start_time:new Date().toISOString(),session_state:"active"}).select().single();if(u)throw u;return f},onSuccess:f=>{s.setQueryData(Ds(e?.id||null),f),s.invalidateQueries({queryKey:io(e?.id||null)}),r({title:"Walking Started",description:"Your walking session has begun. Good luck!"})},onError:f=>{r({title:"Failed to Start Walking",description:"There was an error starting your walking session.",variant:"destructive"})}}),i=yt({mutationFn:async f=>{if(!e)throw new Error("User not authenticated");const u=s.getQueryData(Ds(e.id));if(!u)throw new Error("No active session found");const{data:m,error:h}=await P.from("walking_sessions").update({end_time:new Date().toISOString(),session_state:"completed",distance:f.distance_km,calories_burned:f.calories_burned,speed_mph:f.average_speed_kmh,estimated_steps:f.steps}).eq("id",u.id).eq("user_id",e.id).select().single();if(h)throw h;return m},onSuccess:f=>{s.setQueryData(Ds(e?.id||null),null),s.invalidateQueries({queryKey:io(e?.id||null)}),r({title:"Walking Complete",description:`Great job! You burned ${f.calories_burned||0} calories.`})},onError:f=>{r({title:"Failed to End Walking",description:"There was an error ending your walking session.",variant:"destructive"})}}),l=yt({mutationFn:async f=>{if(!e)throw new Error("User not authenticated");const u=s.getQueryData(Ds(e.id));if(!u)throw new Error("No active session found");const{data:m,error:h}=await P.from("walking_sessions").update(f).eq("id",u.id).eq("user_id",e.id).select().single();if(h)throw h;return m},onMutate:async f=>{s.setQueryData(Ds(e?.id||null),u=>u?{...u,...f}:null)},onError:(f,u,m)=>{s.invalidateQueries({queryKey:Ds(e?.id||null)})}}),d=yt({mutationFn:async f=>await l.mutateAsync({})});return{sessions:a.data||[],activeSession:n.data,loading:a.isLoading,activeSessionLoading:n.isLoading,startSession:o.mutate,endSession:i.mutate,updateSession:l.mutate,togglePause:d.mutate,isStarting:o.isPending,isEnding:i.isPending,isUpdating:l.isPending,refetchSessions:a.refetch,refetchActiveSession:n.refetch}},Uh=()=>{const e=kt(),[s,r]=c.useState("fasting"),[a,n]=c.useState(!1),[o,i]=c.useState({fasting:{isActive:!1,timeElapsed:0},walking:{isActive:!1,timeElapsed:0}}),{currentSession:l}=el(),{activeSession:d}=$h();return c.useEffect(()=>{const h=()=>{const g=!!l&&l.status==="active",x=!!d&&d.session_state==="active";let v=0,w=0;if(l&&g){const y=new Date(l.start_time);v=Math.floor((new Date().getTime()-y.getTime())/1e3)}if(d&&x){const y=new Date(d.start_time),b=new Date;let j=Math.floor((b.getTime()-y.getTime())/1e3);const N=d.total_pause_duration||0;let E=0;d.session_state==="paused"&&d.pause_start_time&&(E=Math.floor((b.getTime()-new Date(d.pause_start_time).getTime())/1e3)),w=Math.max(0,j-N-E)}i({fasting:{isActive:g,timeElapsed:v},walking:{isActive:x,timeElapsed:w}})};let p;return l&&l.status==="active"||d&&d.session_state==="active"?(h(),p=setInterval(h,1e3)):h(),()=>{p&&clearInterval(p)}},[l?.status,d?.session_state,l?.start_time,d?.start_time]),c.useEffect(()=>{(()=>{const p=!!l&&l.status==="active",g=!!d&&d.session_state==="active";let x=0,v=0;if(l&&p){const w=new Date(l.start_time);x=Math.floor((new Date().getTime()-w.getTime())/1e3)}if(d&&g){const w=new Date(d.start_time),y=new Date;let b=Math.floor((y.getTime()-w.getTime())/1e3);const j=d.total_pause_duration||0;let N=0;d.session_state==="paused"&&d.pause_start_time&&(N=Math.floor((y.getTime()-new Date(d.pause_start_time).getTime())/1e3)),v=Math.max(0,b-j-N)}i({fasting:{isActive:p,timeElapsed:x},walking:{isActive:g,timeElapsed:v}})})()},[d?.id,d?.session_state,l?.id,l?.status]),{currentMode:s,timerStatus:o,sheetOpen:a,setSheetOpen:n,switchMode:h=>{r(h),n(!1),e(h==="walking"?"/walking":"/")},getActiveTimerCount:()=>(o.fasting.isActive?1:0)+(o.walking.isActive?1:0),formatTime:h=>{const p=Math.floor(h/3600),g=Math.floor(h%3600/60),x=h%60;return`${p.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`}}};let Pc=!1,Xa=null;const d1=async()=>{if(!(typeof window>"u"||Pc))try{const{data:e,error:s}=await P.from("shared_settings").select("setting_value").eq("setting_key","ga_tracking_id").maybeSingle();if(s||!e?.setting_value){console.log("No GA tracking ID configured");return}const r=e.setting_value;if(Xa=r,typeof document<"u"){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",r,{anonymize_ip:!0,allow_google_signals:!1,allow_ad_personalization_signals:!1});const a=document.createElement("script");a.async=!0,a.src=`https://www.googletagmanager.com/gtag/js?id=${r}`,a.onerror=()=>console.warn("Failed to load Google Analytics script");const n=document.getElementsByTagName("script")[0];n?n.parentNode?.insertBefore(a,n):document.head.appendChild(a)}Pc=!0,console.log("Google Analytics initialized with ID:",r)}catch(e){console.warn("Analytics initialization failed (non-critical):",e)}},u1=e=>{if(typeof window<"u"&&window.gtag&&Xa)try{window.gtag("config",Xa,{page_path:e})}catch(s){console.warn("Failed to track page view:",s)}},Dn=(e,s)=>{if(typeof window<"u"&&window.gtag&&Xa)try{window.gtag("event",e,s)}catch(r){console.warn("Failed to track event:",r)}},Dc=(e,s,r)=>{Dn("fasting_action",{action:e,fast_type:s,duration_hours:r?Math.round(r/3600):void 0})},Ir=(e,s,r)=>{Dn("walking_action",{action:e,speed_mph:s,duration_minutes:r?Math.round(r/60):void 0})},Zo=(e,s)=>{Dn("food_tracking",{action:e,input_method:s})},_a=(e,s)=>{Dn("motivator_action",{action:e,category:s})},zh=({quotes:e,className:s="",onSaveQuote:r,compact:a=!1})=>{const[n,o]=c.useState(null),[i,l]=c.useState(-1),d=()=>{if(e.length===0)return null;if(e.length===1)return e[0];let m;do m=Math.floor(Math.random()*e.length);while(m===i&&e.length>1);return l(m),e[m]};c.useEffect(()=>{if(e.length===0){o(null);return}const m=d();o(m);const h=setInterval(()=>{const p=d();o(p)},3e4);return()=>clearInterval(h)},[e]);const f=()=>{const m=d();o(m)},u=()=>{n&&r&&r(n)};return!n||e.length===0?null:t.jsxs("div",{className:`max-w-md mx-auto text-center ${a?"px-4 py-2":"px-6 py-4"} cursor-pointer transition-opacity duration-500 hover:opacity-80 ${s}`,onClick:f,children:[t.jsxs("blockquote",{className:"relative",children:[t.jsxs("p",{className:`${a?"text-xs":"text-sm"} italic text-muted-foreground/80 leading-relaxed mb-2`,children:['"',n.text,'"']}),n.author&&t.jsxs("cite",{className:`${a?"text-[10px]":"text-xs"} text-muted-foreground/60 not-italic`,children:["â€” ",n.author]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("div",{className:`${a?"text-[10px]":"text-xs"} text-muted-foreground/40`,children:"Tap for another quote"}),r&&t.jsxs(A,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),u()},className:`${a?"h-5 px-1 text-[10px]":"h-6 px-2 text-xs"} text-muted-foreground/60 hover:text-muted-foreground`,children:[t.jsx(ug,{className:`${a?"w-2 h-2 mr-0.5":"w-3 h-3 mr-1"}`}),"Save to Goals"]})]})]})},m1=({currentHour:e,className:s="",maxHour:r=72,onHourChange:a})=>{const n=f=>Math.min(Math.max(f,0),r),o=Math.max(e-1,0),i=Math.min(e+1,r),l=e>0,d=e<r;return t.jsxs("div",{className:`w-full animate-fade-in ${s}`,"aria-live":"polite",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("button",{type:"button",className:`transition-colors ${l?"text-muted-foreground hover:text-foreground":"text-muted-foreground/50 cursor-not-allowed"}`,onClick:()=>l&&a?.(o),disabled:!l,"aria-label":`Go to hour ${o}`,children:["Hour ",o]}),t.jsxs("span",{className:"font-medium text-foreground",children:["Hour ",n(e)]}),t.jsxs("button",{type:"button",className:`transition-colors ${d?"text-muted-foreground hover:text-foreground":"text-muted-foreground/50 cursor-not-allowed"}`,onClick:()=>d&&a?.(i),disabled:!d,"aria-label":`Go to hour ${i}`,children:["Hour ",i]})]}),t.jsxs("div",{className:"relative mt-2 h-5",children:[t.jsx("div",{className:"absolute left-0 right-0 top-1/2 -translate-y-1/2 h-px bg-border"}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary shadow-sm","aria-label":`Current fasting hour: ${n(e)}`})]})]})},Fs=["fasting","hours"];function h1(){const{isAdmin:e}=Xe();return bt({queryKey:Fs,queryFn:async()=>{console.log("ðŸ”„ FASTING HOURS QUERY: Fetching fresh data from database");const{data:s,error:r}=await P.from("fasting_hours").select("*").lte("hour",72).order("hour",{ascending:!0});if(r)throw r;const a=(s||[]).map(n=>({...n,content_rotation_data:n.content_rotation_data?n.content_rotation_data:void 0}));return console.log("ðŸ”„ FASTING HOURS QUERY: Fetched",a.length,"hours"),console.log("ðŸ”„ FASTING HOURS QUERY: Sample data for hours 0-2:",a.slice(0,3).map(n=>({hour:n.hour,metabolic_changes:n.metabolic_changes?.substring(0,50)+"...",content_rotation_data:n.content_rotation_data?"present":"missing"}))),a},staleTime:e?30*1e3:60*1e3,refetchOnWindowFocus:!0,refetchInterval:e?3e4:!1})}function f1({fastingHour:e,autoRotate:s=!0,rotationInterval:r=1e4}){const[a,n]=c.useState({currentContent:"",currentType:"metabolic",currentIndex:0,totalVariants:0,isRotating:s}),o=c.useCallback(u=>{console.log("Building content variants for hour:",u.hour,u);const m=[];return u.stage&&m.push({type:"stage",content:u.stage}),u.metabolic_changes&&m.push({type:"metabolic",content:u.metabolic_changes}),u.physiological_effects&&m.push({type:"physiological",content:u.physiological_effects}),u.mental_emotional_state&&u.mental_emotional_state.length>0&&m.push({type:"mental",content:u.mental_emotional_state.join(". ")}),u.encouragement&&m.push({type:"encouragement",content:u.encouragement}),m.length===0&&u.body_state&&m.push({type:"physiological",content:u.body_state}),console.log("Built variants (excluding admin logs):",m),m},[]);c.useEffect(()=>{if(console.log("Content rotation effect triggered with fastingHour:",e),!e){console.log("No fasting hour provided");return}let u=[];e.content_rotation_data?.variants?.length&&(console.log("Using provided rotation data:",e.content_rotation_data.variants),u=e.content_rotation_data.variants.filter(m=>m.content&&m.content.trim()!==""&&!m.content.includes("coming soon")&&m.type!=="admin_personal_log").map(m=>({...m,content:m.content.replace(/\\n/g," ").replace(/\n/g," ").trim()}))),u.length===0&&(console.log("Building variants from hour data"),u=o(e)),console.log("Final variants for display:",u),u.length>0?n(m=>({...m,currentContent:u[0]?.content||"",currentType:u[0]?.type||"metabolic",currentIndex:0,totalVariants:u.length,isRotating:s})):(console.log("No variants found, using fallback"),n(m=>({...m,currentContent:e.body_state||"Information will be available soon.",currentType:"physiological",currentIndex:0,totalVariants:1})))},[e,o]),c.useEffect(()=>{if(!a.isRotating||a.totalVariants<=1)return;const u=setInterval(()=>{n(m=>{if(!e)return m;const h=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants.filter(x=>x.content&&!x.content.includes("coming soon")):o(e),p=(m.currentIndex+1)%h.length,g=h[p];return{...m,currentContent:g?.content||"",currentType:g?.type||"metabolic",currentIndex:p}})},r);return()=>clearInterval(u)},[a.isRotating,a.totalVariants,r,e,o]);const i=c.useCallback(()=>{if(!e)return;const u=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e);n(m=>{const h=(m.currentIndex+1)%u.length,p=u[h];return{...m,currentContent:p.content,currentType:p.type,currentIndex:h}})},[e,o]),l=c.useCallback(()=>{if(!e)return;const u=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e);n(m=>{const h=m.currentIndex===0?u.length-1:m.currentIndex-1,p=u[h];return{...m,currentContent:p.content,currentType:p.type,currentIndex:h}})},[e,o]),d=c.useCallback(u=>{if(!e)return;const m=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e),h=Math.max(0,Math.min(u,m.length-1)),p=m[h];n(g=>({...g,currentContent:p.content,currentType:p.type,currentIndex:h}))},[e,o]),f=c.useCallback(()=>{n(u=>({...u,isRotating:!u.isRotating}))},[]);return{...a,goToNext:i,goToPrevious:l,goToIndex:d,toggleRotation:f}}const qh=({onTranscription:e,isDisabled:s=!1})=>t.jsx("div",{className:"flex justify-center",children:t.jsx(fr,{onTranscription:e,isDisabled:s,size:"lg"})}),p1=({currentHour:e,existingLog:s="",onLogSaved:r})=>{const{isAdmin:a}=Xe(),{toast:n}=pe(),{currentSession:o}=Qi(),i=Ct(),[l,d]=c.useState(s),[f,u]=c.useState(s),[m,h]=c.useState(!s),[p,g]=c.useState(!1),[x,v]=c.useState(!1);if(c.useEffect(()=>{console.log("ðŸ”„ AdminPersonalLogInterface: existingLog changed:",{existingLog:s,currentHour:e}),d(s||""),u(s||""),h(!s),s!==l&&console.log("ðŸ”„ FORCING STATE UPDATE:",{existingLog:s,currentLogText:l})},[s,e]),!a)return null;const w=async()=>{g(!0);try{console.log("ðŸ”§ ADMIN LOG SAVE DEBUG:",{hourToUpdate:e,logText:l.trim(),logTextLength:l.trim().length,userId:o?.user_id});const{data:b,error:j}=await P.from("fasting_hours").update({admin_personal_log:l.trim()||null}).eq("hour",e).select("*");if(console.log("ðŸ”§ SUPABASE UPDATE RESULT:",{data:b,error:j}),j)throw j;n({title:"Personal log saved",description:`Hour ${e} log updated successfully`}),h(!1),u(l.trim()),i.removeQueries({queryKey:Fs}),await i.invalidateQueries({queryKey:Fs}),await i.refetchQueries({queryKey:Fs}),console.log("ðŸ”„ CACHE AGGRESSIVELY REFRESHED: For hour",e),r?.()}catch(b){console.error("Error saving personal log:",b),n({title:"Error saving log",description:"Please try again",variant:"destructive"})}finally{g(!1)}},y=b=>{d(j=>j?`${j} ${b}`:b),v(!1),m||h(!0)};return t.jsxs("div",{className:"mt-4 p-4 rounded-md border bg-card/50 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Admin Personal Log"}),t.jsxs("div",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-medium",children:["Hour ",e]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[!m&&l&&t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{u(l),h(!0)},className:"h-7 w-7 p-0",children:t.jsx(ax,{className:"h-3 w-3"})}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>v(!x),className:"h-7 w-7 p-0",disabled:!m,children:t.jsx(Ns,{className:"h-3 w-3"})})]})]}),x&&m&&t.jsxs("div",{className:"mb-3 p-3 rounded border bg-muted/30",children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Voice Recording"}),t.jsx(qh,{onTranscription:y,isDisabled:p})]}),m?t.jsxs("div",{className:"space-y-3",children:[t.jsx(_r,{value:l,onChange:b=>d(b.target.value),placeholder:`Record your experience at hour ${e} of your fast...`,className:"min-h-[80px] text-sm resize-none",disabled:p}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>{d(f),h(!1),v(!1)},disabled:p,className:"h-7 px-3",children:[t.jsx(Ie,{className:"h-3 w-3 mr-1"}),"Cancel"]}),t.jsxs(A,{size:"sm",onClick:w,disabled:p,className:"h-7 px-3",children:[t.jsx(ss,{className:"h-3 w-3 mr-1"}),p?"Saving...":"Save"]})]})]}):t.jsx("div",{className:"space-y-2",children:l?t.jsx("div",{className:"text-sm text-foreground p-3 rounded border bg-muted/20",children:l}):t.jsxs("div",{className:"text-sm text-muted-foreground italic p-3 rounded border bg-muted/10",children:["No personal log for hour ",e," yet. Click the edit button or mic to add one."]})})]})},lo=72,g1=({currentHour:e=1,className:s})=>{const{data:r,isLoading:a}=h1(),n=Ct(),[o,i]=c.useState(Math.min(Math.max(e||1,0),lo)),[l,d]=c.useState(!1),[f,u]=c.useState(!1);c.useEffect(()=>{l||i(Math.min(Math.max(e||1,0),lo))},[e,l]);const m=v=>{const w=Math.min(Math.max(v,0),lo);i(w),d(!0),u(!0),setTimeout(()=>u(!1),100)},p=c.useMemo(()=>{const v=new Map;return(r||[]).forEach(w=>v.set(w.hour,w)),v},[r]).get(o),g=f1({fastingHour:p||null,autoRotate:!0,rotationInterval:1e4}),x=v=>{switch(v){case"metabolic":return"Metabolic Changes";case"physiological":return"Physical Effects";case"mental":return"Mental State";case"stage":return"Stage";case"encouragement":return"Encouragement";default:return""}};return t.jsxs("div",{className:Z("w-full",s),children:[t.jsx(m1,{currentHour:o,className:"mb-3",onHourChange:m}),t.jsx("div",{className:"mt-4 rounded-md border bg-card p-4",role:"region","aria-live":"polite",children:a?t.jsxs("div",{className:"space-y-3",children:[t.jsx(Xt,{className:"h-5 w-1/2"}),t.jsx(Xt,{className:"h-4 w-3/4"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Xt,{className:"h-5 w-20"}),t.jsx(Xt,{className:"h-5 w-24"})]}),t.jsx(Xt,{className:"h-4 w-full"}),t.jsx(Xt,{className:"h-4 w-5/6"})]}):t.jsxs("div",{className:"space-y-3",children:[g.totalVariants>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:g.goToPrevious,className:"h-6 w-6 p-0",children:t.jsx(yg,{className:"h-3 w-3"})}),t.jsx(A,{variant:"ghost",size:"sm",onClick:g.toggleRotation,className:"h-6 w-6 p-0",children:g.isRotating?t.jsx(wd,{className:"h-3 w-3"}):t.jsx(Da,{className:"h-3 w-3"})}),t.jsx(A,{variant:"ghost",size:"sm",onClick:g.goToNext,className:"h-6 w-6 p-0",children:t.jsx(gi,{className:"h-3 w-3"})})]}),t.jsxs("div",{className:"min-h-[80px] relative",children:[t.jsx("div",{className:"absolute bottom-2 right-2 bg-muted/20 text-foreground border border-muted rounded-full w-8 h-8 flex items-center justify-center text-xs font-bold z-10",children:o}),g.totalVariants>1?t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h4",{className:"text-xs font-medium text-muted-foreground",children:x(g.currentType)}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[g.currentIndex+1," of ",g.totalVariants]})]}),t.jsx("div",{className:"text-sm text-foreground animate-fade-in pr-10",style:{animation:f?"fade-in 0.3s ease-in-out":"fade-in 0.8s ease-in-out"},children:g.currentContent},`${o}-${g.currentIndex}-${g.currentType}`)]}):t.jsx("div",{className:"text-sm text-muted-foreground pr-10",children:p?.physiological_effects||p?.body_state||"We'll add details for this hour soon."})]})]})}),t.jsx(p1,{currentHour:o,existingLog:p?.admin_personal_log,onLogSaved:async()=>{n.removeQueries({queryKey:Fs}),await n.invalidateQueries({queryKey:Fs}),await n.refetchQueries({queryKey:Fs}),console.log("ðŸ”„ TIMELINE REFRESH: Forced complete refresh after log save for hour",o)}},`admin-log-${o}-${p?.admin_personal_log}`)]})},x1=({quotes:e,currentFastingHour:s=0,className:r="",onSaveQuote:a})=>t.jsxs("div",{className:r,children:[t.jsx(g1,{currentHour:s}),e&&e.length>0&&t.jsx(zh,{quotes:e,className:"mt-4",onSaveQuote:a,compact:!0})]}),Ac=["quotes","timer"];async function v1(){const{data:e,error:s}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["fasting_timer_quotes","walking_timer_quotes"]);if(s)throw s;const r={fasting_timer_quotes:[],walking_timer_quotes:[]};return e?.forEach(a=>{try{const n=JSON.parse(a.setting_value||"[]");a.setting_key==="fasting_timer_quotes"?r.fasting_timer_quotes=n:a.setting_key==="walking_timer_quotes"&&(r.walking_timer_quotes=n)}catch(n){console.warn(`Failed to parse quotes for ${a.setting_key}:`,n)}}),r}const Wh=()=>{const e=Ct(),{data:s,isLoading:r,refetch:a}=bt({queryKey:Ac,queryFn:v1,staleTime:24*60*60*1e3}),n=yt({mutationFn:async({type:i,newQuotes:l})=>{const{error:d}=await P.from("shared_settings").upsert({setting_key:i,setting_value:JSON.stringify(l)});if(d)throw d;return{type:i,newQuotes:l}},onSuccess:()=>{e.invalidateQueries({queryKey:Ac})}});return{quotes:s||{fasting_timer_quotes:[],walking_timer_quotes:[]},loading:r,updateQuotes:async(i,l)=>{try{return await n.mutateAsync({type:i,newQuotes:l}),{success:!0}}catch(d){return console.error("Error updating quotes:",d),{success:!1,error:d}}},refetch:a}},tl="fasting_celebrated_milestones",ei=e=>{if(!e)return new Set;try{const s=localStorage.getItem(`${tl}_${e}`);return s?new Set(JSON.parse(s)):new Set}catch{return new Set}},y1=(e,s)=>{try{const r=ei(e);r.add(s),localStorage.setItem(`${tl}_${e}`,JSON.stringify([...r]))}catch{}},w1=(e,s)=>e==="hourly"?"color-wave":s===16?"particle-burst":s===24||s>=20?"fireworks":"particle-burst",b1=e=>{const[s,r]=c.useState({lastMilestoneHour:0,isVisible:!1,currentEvent:null,animationType:"ring-pulse"}),{toast:a}=pe(),n=c.useCallback(d=>{if(e&&!d.message.includes("ðŸŽ‰ Testing")){if(ei(e).has(d.hours)){console.log(`Milestone ${d.hours} already celebrated for session ${e}, skipping`);return}y1(e,d.hours)}console.log(`ðŸŽ‰ Triggering celebration for ${d.type} milestone:`,d);const f=w1(d.type,d.hours);r({lastMilestoneHour:d.hours,isVisible:!0,currentEvent:d,animationType:f}),a({title:"ðŸŽ‰ Milestone Reached!",description:d.message,duration:5e3}),setTimeout(()=>{r(u=>({...u,isVisible:!1}))},3e3)},[a,e]),o=c.useCallback((d,f)=>{const u=Math.floor(d/3600);if(!e)return;const m=ei(e);if(u>0&&!m.has(u)){const h={type:"hourly",hours:u,message:`${u} hour${u===1?"":"s"} of fasting completed!`};n(h);return}if(f&&d>=f){const h=Math.floor(f/3600);if(!m.has(h)){const p={type:"completion",hours:h,message:`ðŸ† Goal completed! ${h} hour fast achieved!`};n(p)}}},[e,n]),i=c.useCallback(()=>{if(r({lastMilestoneHour:0,isVisible:!1,currentEvent:null,animationType:"ring-pulse"}),e)try{localStorage.removeItem(`${tl}_${e}`)}catch{}},[e]),l=c.useCallback(()=>{r(d=>({...d,isVisible:!1}))},[]);return{celebration:s,checkForMilestones:o,resetMilestones:i,triggerCelebration:n,closeCelebration:l}},j1=()=>{const[e,s]=c.useState(0),[r,a]=c.useState(60*60*60),[n,o]=c.useState("longterm"),[i,l]=c.useState("up"),[d,f]=c.useState(!1),[u,m]=c.useState(!1),[h,p]=c.useState("finish"),[g,x]=c.useState(!1),[v,w]=c.useState(!1);c.useState(0);const{currentSession:y,startFastingSession:b,endFastingSession:j,cancelFastingSession:N,refreshActiveSession:E}=el(),{currentSession:S,startWalkingSession:_,endWalkingSession:C}=Js(),{currentMode:k,timerStatus:T,switchMode:D,formatTime:W}=Uh(),{toast:$}=pe();Se();const{profile:X}=Te(),{quotes:V}=Wh(),{saveQuoteAsGoal:G}=Zs(),{celebration:L,checkForMilestones:B,resetMilestones:de,closeCelebration:te,triggerCelebration:Y}=b1(y?.id);Xe();const oe=!!y,O=c.useCallback(me=>{const ve=Math.floor(me/3600),z=Math.floor(me%3600/60),he=me%60;return`${ve.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}:${he.toString().padStart(2,"0")}`},[]);c.useEffect(()=>{E()},[E]),c.useEffect(()=>{Rs.prefetchQuery({queryKey:["fasting","hours"],queryFn:async()=>{const{data:me,error:ve}=await P.from("fasting_hours").select("*").lte("hour",72).order("hour",{ascending:!0});if(ve)throw ve;return me||[]},staleTime:24*60*60*1e3}),Rs.prefetchQuery({queryKey:["quotes","timer"],queryFn:async()=>{const{data:me,error:ve}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["fasting_timer_quotes","walking_timer_quotes"]);if(ve)throw ve;return me||[]},staleTime:24*60*60*1e3})},[]),c.useEffect(()=>{y?.goal_duration_seconds&&a(y.goal_duration_seconds)},[y]);const Q=c.useCallback((me,ve)=>{B(me,ve)},[B]),R=c.useCallback(async me=>{await j(me)},[j]);c.useEffect(()=>{let me,ve;if(oe&&y){const z=()=>{const he=new Date(y.start_time),J=Math.floor((new Date().getTime()-he.getTime())/1e3);s(J),Q(J,y.goal_duration_seconds)};if(z(),me=setInterval(z,1e3),y.goal_duration_seconds){const he=new Date(y.start_time),J=new Date(he.getTime()+y.goal_duration_seconds*1e3).getTime()-Date.now(),ce=24*60*60*1e3;J>0&&J<ce?(console.log(`ðŸŽ¯ Setting goal completion timeout for ${J}ms from now`),ve=setTimeout(async()=>{console.log("ðŸŽ‰ Goal achieved! Auto-completing fasting session...");try{const{data:{session:it}}=await P.auth.getSession();if(!it?.user?.id){console.warn("âš ï¸ Goal timeout triggered but user not authenticated, skipping");return}const{data:at}=await P.from("fasting_sessions").select("id, status").eq("id",y.id).eq("status","active").maybeSingle();if(!at){console.warn("âš ï¸ Session no longer active, skipping auto-completion");return}await R(y.id),$({title:"ðŸŽ‰ Goal Achieved!",description:`Congratulations! You've completed your ${O(y.goal_duration_seconds)} fast!`})}catch(it){console.error("Error auto-completing fasting session:",it)}},J)):J>=ce?console.warn(`âš ï¸ Skipping goal timeout - duration too long: ${J}ms`):console.log("âš ï¸ Skipping goal timeout - time already passed")}}else s(0);return()=>{me&&clearInterval(me),ve&&(console.log("ðŸ§¹ Cleaning up goal timeout"),clearTimeout(ve))}},[oe,y?.start_time,y?.id,y?.goal_duration_seconds,Q,R,$,O]);const M=async()=>{if(!y?.id){console.error("No active fasting session found"),$({title:"Error",description:"No active fasting session found.",variant:"destructive"});return}try{h==="cancel"?(await N(y.id),Dc("stop",n,e)):(await j(y.id),Dc("stop",n,e))}catch(me){console.error("Error stopping fasting session:",me),$({title:"Error",description:"Failed to stop fasting session. Please try again.",variant:"destructive"})}},H=async()=>{const me=await _();me.error?$({variant:"destructive",title:"Error",description:me.error.message}):$({title:"Walking started",description:"Your walking session has begun!"})},U=async()=>{if(!S)return;const me=await C();me.error?$({variant:"destructive",title:"Error",description:me.error.message}):$({title:"Walking completed",description:`Session completed! Calories burned: ${me.data?.calories_burned||0}`})},ee=()=>{if(i==="up")return O(e);{const me=Math.max(0,r-e);return O(me)}},ue=()=>Math.min(e/r*100,100),be=()=>y?"Extended Fast":"Start Your Fast",je=async(me,ve,z)=>{o("longterm"),a(me),f(!1),ve&&z?await Ue(ve,me):await b({goal_duration_seconds:me})&&$({title:"Fast started",description:`Your ${O(me)} fast has begun!`})},Ue=async(me,ve)=>{try{if(await b({goal_duration_seconds:ve,start_time:me})){await E();const le=new Date().getTime()-me.getTime(),J=Math.floor(le/1e3);$({title:"Fast started retroactively",description:`Fast started ${O(J)} ago`})}}catch{$({title:"Error",description:"Failed to start retroactive fast",variant:"destructive"})}};return t.jsxs("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:[t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(_n,{})}),k==="fasting"&&t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx(Ki,{onClick:()=>w(!0),title:"View fasting history"})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent mb-1",children:k==="fasting"?"Fasting Timer":"Walking Timer"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:k==="fasting"?be():"Track your walking session"})]})]}),t.jsx("div",{className:"relative mb-12 mt-12",children:k==="fasting"?t.jsx(t.Fragment,{children:t.jsx(Bj,{progress:ue(),displayTime:ee(),isActive:oe,showSlideshow:X?.enable_fasting_slideshow??!1,countDirection:i,onToggleCountDirection:()=>l(i==="up"?"down":"up"),fastType:n,goalDuration:r/3600,celebrationAnimation:L.isVisible?{isActive:L.isVisible,type:L.animationType,onAnimationEnd:te}:void 0})}):t.jsx(Qm,{displayTime:W(T.walking.timeElapsed),isActive:T.walking.isActive,onStart:H,onStop:U,showSlideshow:X?.enable_walking_slideshow??!1,selectedSpeed:3,onSpeedChange:()=>{}})}),k==="fasting"&&t.jsx("div",{className:"space-y-4",children:oe?t.jsx(Hs,{children:t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{onClick:()=>{p("cancel"),m(!0)},variant:"action-primary",size:"action-main",children:t.jsx(Ie,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Cancel your fast without saving it to history"})})]}),t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsxs(A,{onClick:()=>{p("finish"),m(!0)},variant:"action-primary",size:"action-main",children:[t.jsx(gd,{className:"w-5 h-5 mr-2"}),"Finish"]})}),t.jsx(Me,{children:t.jsx("p",{children:"Complete your fast and save it to history"})})]})]})}):t.jsx("div",{className:"space-y-3",children:t.jsxs(A,{onClick:()=>f(!0),variant:"action-primary",size:"start-button",className:"w-full",children:[t.jsx(Da,{className:"w-8 h-8 mr-3"}),"Start Fasting"]})})}),X?.enable_fasting_slideshow?t.jsx(x1,{quotes:V.fasting_timer_quotes,currentFastingHour:Math.max(1,Math.ceil(e/3600)),className:"mt-8",onSaveQuote:G}):null]}),d&&t.jsx(QN,{currentDuration:r,onSelect:je,onClose:()=>f(!1)}),t.jsx(KN,{open:u,onOpenChange:m,onConfirm:()=>{m(!1),M()},currentDuration:O(e),actionType:h}),v&&t.jsx(c1,{onClose:()=>w(!1)}),t.jsx(ca,{isOpen:g,onClose:()=>x(!1),title:et.timer.title,subtitle:et.timer.subtitle,heroQuote:et.timer.heroQuote,backgroundImage:et.timer.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:et.timer.subtitle})}),et.timer.sections.map((me,ve)=>{const z=me.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(z,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:me.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:me.description})]})]},ve)})]})})]})};function N1(e,s=[]){let r=[];function a(o,i){const l=c.createContext(i),d=r.length;r=[...r,i];function f(m){const{scope:h,children:p,...g}=m,x=h?.[e][d]||l,v=c.useMemo(()=>g,Object.values(g));return t.jsx(x.Provider,{value:v,children:p})}function u(m,h){const p=h?.[e][d]||l,g=c.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${o}\``)}return f.displayName=o+"Provider",[f,u]}const n=()=>{const o=r.map(i=>c.createContext(i));return function(l){const d=l?.[e]||o;return c.useMemo(()=>({[`__scope${e}`]:{...l,[e]:d}}),[l,d])}};return n.scopeName=e,[a,S1(n,...s)]}function S1(...e){const s=e[0];if(e.length===1)return s;const r=()=>{const a=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(o){const i=a.reduce((l,{useScope:d,scopeName:f})=>{const m=d(o)[`__scope${f}`];return{...l,...m}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}var co="rovingFocusGroup.onEntryFocus",_1={bubbles:!1,cancelable:!0},An="RovingFocusGroup",[ti,Bh,C1]=an(An),[k1,kr]=N1(An,[C1]),[E1,T1]=k1(An),Gh=c.forwardRef((e,s)=>t.jsx(ti.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(ti.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(M1,{...e,ref:s})})}));Gh.displayName=An;var M1=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:n=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:d,onEntryFocus:f,preventScrollOnEntryFocus:u=!1,...m}=e,h=c.useRef(null),p=Ne(s,h),g=Ys(o),[x=null,v]=Gt({prop:i,defaultProp:l,onChange:d}),[w,y]=c.useState(!1),b=Dt(f),j=Bh(r),N=c.useRef(!1),[E,S]=c.useState(0);return c.useEffect(()=>{const _=h.current;if(_)return _.addEventListener(co,b),()=>_.removeEventListener(co,b)},[b]),t.jsx(E1,{scope:r,orientation:a,dir:g,loop:n,currentTabStopId:x,onItemFocus:c.useCallback(_=>v(_),[v]),onItemShiftTab:c.useCallback(()=>y(!0),[]),onFocusableItemAdd:c.useCallback(()=>S(_=>_+1),[]),onFocusableItemRemove:c.useCallback(()=>S(_=>_-1),[]),children:t.jsx(xe.div,{tabIndex:w||E===0?-1:0,"data-orientation":a,...m,ref:p,style:{outline:"none",...e.style},onMouseDown:ae(e.onMouseDown,()=>{N.current=!0}),onFocus:ae(e.onFocus,_=>{const C=!N.current;if(_.target===_.currentTarget&&C&&!w){const k=new CustomEvent(co,_1);if(_.currentTarget.dispatchEvent(k),!k.defaultPrevented){const T=j().filter(V=>V.focusable),D=T.find(V=>V.active),W=T.find(V=>V.id===x),X=[D,W,...T].filter(Boolean).map(V=>V.ref.current);Qh(X,u)}}N.current=!1}),onBlur:ae(e.onBlur,()=>y(!1))})})}),Vh="RovingFocusGroupItem",Hh=c.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:n=!1,tabStopId:o,...i}=e,l=ls(),d=o||l,f=T1(Vh,r),u=f.currentTabStopId===d,m=Bh(r),{onFocusableItemAdd:h,onFocusableItemRemove:p}=f;return c.useEffect(()=>{if(a)return h(),()=>p()},[a,h,p]),t.jsx(ti.ItemSlot,{scope:r,id:d,focusable:a,active:n,children:t.jsx(xe.span,{tabIndex:u?0:-1,"data-orientation":f.orientation,...i,ref:s,onMouseDown:ae(e.onMouseDown,g=>{a?f.onItemFocus(d):g.preventDefault()}),onFocus:ae(e.onFocus,()=>f.onItemFocus(d)),onKeyDown:ae(e.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){f.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const x=A1(g,f.orientation,f.dir);if(x!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let w=m().filter(y=>y.focusable).map(y=>y.ref.current);if(x==="last")w.reverse();else if(x==="prev"||x==="next"){x==="prev"&&w.reverse();const y=w.indexOf(g.currentTarget);w=f.loop?R1(w,y+1):w.slice(y+1)}setTimeout(()=>Qh(w))}})})})});Hh.displayName=Vh;var P1={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function D1(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function A1(e,s,r){const a=D1(e.key,r);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return P1[a]}function Qh(e,s=!1){const r=document.activeElement;for(const a of e)if(a===r||(a.focus({preventScroll:s}),document.activeElement!==r))return}function R1(e,s){return e.map((r,a)=>e[(s+a)%e.length])}var sl=Gh,rl=Hh,al="Tabs",[I1,V2]=St(al,[kr]),Kh=kr(),[F1,nl]=I1(al),Yh=c.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,onValueChange:n,defaultValue:o,orientation:i="horizontal",dir:l,activationMode:d="automatic",...f}=e,u=Ys(l),[m,h]=Gt({prop:a,onChange:n,defaultProp:o});return t.jsx(F1,{scope:r,baseId:ls(),value:m,onValueChange:h,orientation:i,dir:u,activationMode:d,children:t.jsx(xe.div,{dir:u,"data-orientation":i,...f,ref:s})})});Yh.displayName=al;var Xh="TabsList",Jh=c.forwardRef((e,s)=>{const{__scopeTabs:r,loop:a=!0,...n}=e,o=nl(Xh,r),i=Kh(r);return t.jsx(sl,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:a,children:t.jsx(xe.div,{role:"tablist","aria-orientation":o.orientation,...n,ref:s})})});Jh.displayName=Xh;var Zh="TabsTrigger",ef=c.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,disabled:n=!1,...o}=e,i=nl(Zh,r),l=Kh(r),d=rf(i.baseId,a),f=af(i.baseId,a),u=a===i.value;return t.jsx(rl,{asChild:!0,...l,focusable:!n,active:u,children:t.jsx(xe.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":f,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:d,...o,ref:s,onMouseDown:ae(e.onMouseDown,m=>{!n&&m.button===0&&m.ctrlKey===!1?i.onValueChange(a):m.preventDefault()}),onKeyDown:ae(e.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&i.onValueChange(a)}),onFocus:ae(e.onFocus,()=>{const m=i.activationMode!=="manual";!u&&!n&&m&&i.onValueChange(a)})})})});ef.displayName=Zh;var tf="TabsContent",sf=c.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,forceMount:n,children:o,...i}=e,l=nl(tf,r),d=rf(l.baseId,a),f=af(l.baseId,a),u=a===l.value,m=c.useRef(u);return c.useEffect(()=>{const h=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(h)},[]),t.jsx(_t,{present:n||u,children:({present:h})=>t.jsx(xe.div,{"data-state":u?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":d,hidden:!h,id:f,tabIndex:0,...i,ref:s,style:{...e.style,animationDuration:m.current?"0s":void 0},children:h&&o})})});sf.displayName=tf;function rf(e,s){return`${e}-trigger-${s}`}function af(e,s){return`${e}-content-${s}`}var O1=Yh,nf=Jh,of=ef,lf=sf;const Ja=O1,Rn=c.forwardRef(({className:e,...s},r)=>t.jsx(nf,{ref:r,className:Z("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));Rn.displayName=nf.displayName;const zs=c.forwardRef(({className:e,...s},r)=>t.jsx(of,{ref:r,className:Z("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));zs.displayName=of.displayName;const qs=c.forwardRef(({className:e,...s},r)=>t.jsx(lf,{ref:r,className:Z("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));qs.displayName=lf.displayName;const In=()=>{const[e,s]=c.useState(!1),{toast:r}=pe();return{addToDefaultGoals:async l=>{s(!0);try{const{data:d,error:f}=await P.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(f)throw f;const u=d?.setting_value?JSON.parse(d.setting_value):[];if(u.some(x=>x.title===l.title||x.id===l.id))return r({title:"Already exists",description:"This motivator is already in the default goals.",variant:"destructive"}),!1;const h={id:l.id,title:l.title,description:l.content||"",category:l.category||"personal",imageUrl:l.imageUrl},p=[...u,h],{error:g}=await P.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(p)},{onConflict:"setting_key"});if(g)throw g;return r({title:"Added to default goals",description:`"${l.title}" has been added to the default goal ideas.`}),!0}catch(d){return console.error("Error adding to default goals:",d),r({title:"Error",description:"Failed to add motivator to default goals.",variant:"destructive"}),!1}finally{s(!1)}},removeFromDefaultGoals:async l=>{s(!0);try{const{data:d,error:f}=await P.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(f)throw f;const m=(d?.setting_value?JSON.parse(d.setting_value):[]).filter(p=>p.id!==l),{error:h}=await P.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(m)},{onConflict:"setting_key"});if(h)throw h;return r({title:"Removed from default goals",description:"The goal idea has been removed from the default list."}),!0}catch(d){return console.error("Error removing from default goals:",d),r({title:"Error",description:"Failed to remove goal from default list.",variant:"destructive"}),!1}finally{s(!1)}},updateDefaultGoal:async(l,d)=>{s(!0);try{console.log("ðŸ”„ Starting update for goal ID:",l,"with updates:",d);const{data:f,error:u}=await P.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(u)throw u;let m=[];f?.setting_value&&(m=JSON.parse(f.setting_value)),console.log("ðŸ“‹ Current goal ideas:",m);const h=m.findIndex(g=>g.id===l);if(h===-1)return console.error("âŒ Goal not found with ID:",l),r({title:"Error",description:"Goal idea not found",variant:"destructive"}),!1;m[h]={...m[h],title:d.title||m[h].title,description:d.content||m[h].description,imageUrl:d.imageUrl!==void 0?d.imageUrl:m[h].imageUrl},console.log("âœï¸ Updated goal:",m[h]);const{error:p}=await P.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(m)},{onConflict:"setting_key"});if(p)throw console.error("âŒ Database update error:",p),p;return console.log("âœ… Successfully updated admin goal ideas in database"),r({title:"âœ… Goal Updated!",description:"Admin goal idea has been updated successfully"}),!0}catch(f){return console.error("âŒ Error updating default goal:",f),r({title:"Error",description:"Failed to update goal idea",variant:"destructive"}),!1}finally{s(!1)}},checkIfInDefaultGoals:async l=>{try{const{data:d,error:f}=await P.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();return f||!d?.setting_value?!1:JSON.parse(d.setting_value).some(m=>m.id===l)}catch(d){return console.error("Error checking if in default goals:",d),!1}},loading:e}},L1=async(e,s=1024,r=1024,a=.8)=>new Promise((n,o)=>{const i=document.createElement("canvas"),l=i.getContext("2d"),d=new Image;d.onload=()=>{let{width:f,height:u}=d;f>u?f>s&&(u=u*s/f,f=s):u>r&&(f=f*r/u,u=r),i.width=f,i.height=u,l?.drawImage(d,0,0,f,u),i.toBlob(m=>{if(m){const h=i.toDataURL("image/jpeg",a);n({blob:m,dataUrl:h,size:m.size,width:f,height:u})}else o(new Error("Failed to compress image"))},"image/jpeg",a)},d.onerror=()=>o(new Error("Failed to load image")),d.src=URL.createObjectURL(e)}),si=async(e,s,r)=>{try{if(!e)return{success:!0};const a=e.split("/"),n=a.findIndex(l=>l===s);if(n===-1)return console.warn("Could not extract filename from URL:",e),{success:!1,error:"Invalid image URL format"};const o=a.slice(n+1).join("/");if(!o)return console.warn("Empty file path extracted from URL:",e),{success:!1,error:"Could not determine file path"};console.log("ðŸ—‘ï¸ Deleting image:",{imageUrl:e,bucketName:s,filePath:o});const{error:i}=await r.storage.from(s).remove([o]);return i?(console.error("Storage deletion error:",i),{success:!1,error:i.message}):(console.log("âœ… Image deleted successfully"),{success:!0})}catch(a){return console.error("Delete operation failed:",a),{success:!1,error:a instanceof Error?a.message:"Delete failed"}}},$1=async(e,s,r,a="motivator-images",n)=>{try{if(n){const u=await si(n,a,r);u.success||console.warn("Failed to delete old image (continuing with upload):",u.error)}const o=await L1(e),i=`${s}/${Date.now()}_${e.name}`,{data:l,error:d}=await r.storage.from(a).upload(i,o.blob);if(d)throw d;const{data:f}=r.storage.from(a).getPublicUrl(i);return{success:!0,imageId:i,url:f.publicUrl}}catch(o){return console.error("Upload error:",o),{success:!1,imageId:"",url:"",error:o instanceof Error?o.message:"Upload failed"}}},ol=({currentImageUrl:e,onImageUpload:s,onImageRemove:r,showUploadOptionsWhenImageExists:a=!1,regenerateButton:n,aiGenerationPrompt:o,motivatorId:i,onAiGenerate:l,isGenerating:d=!1,bucket:f="motivator-images"})=>{const[u,m]=c.useState(!1),[h,p]=c.useState(!1),[g,x]=c.useState(e||null),v=c.useRef(null),w=c.useRef(null),{toast:y}=pe(),{user:b}=Se(),{hasPremiumFeatures:j}=Xe(),N=Xi(),E=$=>{$.preventDefault(),m(!0)},S=$=>{$.preventDefault(),m(!1)},_=$=>{$.preventDefault(),m(!1);const V=Array.from($.dataTransfer.files).find(G=>G.type.startsWith("image/"));V&&D(V)},C=()=>{v.current?.click()},k=()=>{w.current?.click()},T=$=>{const X=$.target.files?.[0];X&&D(X)},D=async $=>{if(!b){y({title:"Error",description:"Please sign in to upload images",variant:"destructive"});return}if(!$.type.startsWith("image/")){y({title:"Error",description:"Please select an image file",variant:"destructive"});return}if($.size>5*1024*1024){y({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});return}p(!0);try{const X=URL.createObjectURL($);if(x(X),!j){y({title:"Premium Required",description:"Image uploads are only available for premium users",variant:"destructive"}),x(e||null);return}const V=await $1($,b.id,P,f,e);if(!V.success)throw new Error(V.error||"Upload failed");s(V.url)}catch(X){console.error("Upload error:",X),y({title:"Error",description:"Failed to upload image",variant:"destructive"}),x(e||null)}finally{p(!1)}},W=()=>{x(null),r?.()};return t.jsxs("div",{className:"space-y-4",children:[g?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"aspect-video max-h-[70vh] bg-ceramic-rim rounded-lg overflow-hidden flex items-center justify-center",children:t.jsx("img",{src:g,alt:"Preview",className:"w-full h-full object-contain"})}),t.jsx(A,{variant:"destructive",size:"sm",onClick:W,className:"absolute top-2 right-2 h-8 w-8 p-0",disabled:h,children:t.jsx(Ie,{className:"w-4 h-4"})}),n&&t.jsx("div",{className:"absolute top-2 right-12",children:n})]}),a&&t.jsxs("div",{className:"space-y-3",children:[N&&t.jsxs(A,{variant:"outline",onClick:k,disabled:h,className:"w-full h-16 flex-col space-y-1 bg-ceramic-base border-ceramic-rim",children:[t.jsx(Wr,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",children:"Use camera"})]}),!N&&t.jsxs(A,{variant:"outline",onClick:C,disabled:h,className:"w-full bg-ceramic-base border-ceramic-rim",children:[t.jsx(wo,{className:"w-4 h-4 mr-2"}),"Upload New Image"]})]})]}):t.jsxs("div",{className:"space-y-4",children:[!N&&t.jsx("div",{className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${u?"border-primary bg-primary/5":"border-ceramic-rim"}
                ${h?"opacity-50 cursor-not-allowed":"hover:border-primary hover:bg-primary/5"}
              `,onDragOver:E,onDragLeave:S,onDrop:_,onClick:h?void 0:C,children:h?t.jsx("div",{className:"flex flex-col items-center",children:t.jsx(zt,{className:"w-12 h-12 text-primary animate-spin"})}):t.jsx("div",{className:"flex flex-col items-center",children:t.jsx(Wr,{className:"w-16 h-16 text-muted-foreground"})})}),N&&t.jsx(A,{variant:"outline",onClick:k,disabled:h,className:"w-full h-32 flex-col bg-ceramic-base border-ceramic-rim",children:t.jsx(Wr,{className:"w-12 h-12"})})]}),t.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:T,className:"hidden"}),t.jsx("input",{ref:w,type:"file",accept:"image/*",capture:"environment",onChange:T,className:"hidden"})]})},U1=()=>{const[e,s]=c.useState([]),[r,a]=c.useState(!0);pe();const n=async()=>{try{const{data:o,error:i}=await P.from("shared_settings").select("setting_value").eq("setting_key","ai_admin_motivator_templates").single();if(i&&i.code!=="PGRST116")throw i;if(o?.setting_value){const l=JSON.parse(o.setting_value);s(Array.isArray(l)?l:[])}else s([])}catch(o){console.error("Error loading admin templates:",o),s([])}finally{a(!1)}};return c.useEffect(()=>{n()},[]),{templates:e,loading:r,refreshTemplates:n}},z1=({isOpen:e,onClose:s,feature:r})=>{const{createSubscription:a,isTrial:n}=Xe(),{toast:o}=pe(),i=async()=>{try{await a(),o({title:"Redirecting to checkout",description:"Opening payment page..."})}catch{o({title:"Error",description:"Failed to create subscription. Please try again.",variant:"destructive"})}};return e?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[9999]",onClick:s,children:t.jsx("div",{className:"bg-background rounded-2xl p-6 w-full max-w-sm border border-border",onClick:l=>l.stopPropagation(),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center",children:t.jsx(go,{className:"w-4 h-4 text-white"})}),t.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Premium Feature"})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:s,className:"w-8 h-8 p-0",children:t.jsx(Ie,{className:"w-4 h-4"})})]}),t.jsx("p",{className:"text-sm text-muted-foreground text-center",children:n?"This feature requires a premium subscription.":"Your trial has expired. Upgrade to premium to access this feature."}),t.jsxs(A,{onClick:i,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white border-0",children:[t.jsx(go,{className:"w-4 h-4 mr-2"}),"Upgrade to Premium"]})]})})}):null},Bt=({children:e,feature:s,className:r="",showUpgrade:a=!0,grayOutForFree:n=!1})=>{const{access_level:o,hasPremiumFeatures:i,loading:l,createSubscription:d}=Xe(),[f,u]=re.useState(!1),m=o!=="free";if(l)return t.jsx(t.Fragment,{children:e});if(m)return t.jsx(t.Fragment,{children:e});const h=x=>{x.preventDefault(),x.stopPropagation(),a&&u(!0)},p=x=>re.Children.map(x,v=>{if(c.isValidElement(v)){const w={...v.props,onClick:h,onDoubleClick:void 0,onMouseDown:void 0,onMouseUp:void 0};return v.type===is||v.type===Ns?t.jsx(Vs,{className:v.props.className,onClick:h}):v.props?.children?c.cloneElement(v,{...w,children:p(v.props.children)}):c.cloneElement(v,w)}return v}),g=p(e);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:Z("opacity-50 cursor-pointer",r),onClick:h,style:{position:"relative"},children:g}),t.jsx(z1,{isOpen:f,onClose:()=>u(!1),feature:s})]})},Za=({motivator:e,onSave:s,onClose:r})=>{const[a,n]=c.useState(e?.title||""),[o,i]=c.useState(e?.content||""),[l,d]=c.useState(e?.imageUrl||""),[f,u]=c.useState(!1),[m,h]=c.useState(null),{toast:p}=pe(),{templates:g,loading:x}=U1(),v=!!e?.id;c.useEffect(()=>{e&&(n(e.title||""),i(e.content||""),d(e.imageUrl||""))},[e]);const w=async()=>{if(!a.trim()){p({title:"Title required",description:"Please add a title for your motivator.",variant:"destructive"});return}const j={id:e?.id||m||"",title:a.trim(),content:o.trim(),imageUrl:l||void 0};if(m&&!e?.id)try{await P.from("motivators").update({title:j.title,content:j.content,image_url:j.imageUrl}).eq("id",m),j.id=m}catch(N){console.error("Error updating temporary motivator:",N)}console.log("MotivatorFormModal: Saving motivator data:",j),s(j)},y=j=>{j.length<50?n(j):i(j),u(!1)},b=j=>{n(j.title),i(j.description),j.imageUrl&&d(j.imageUrl)};return t.jsxs(mt,{isOpen:!0,onClose:r,title:v?"Edit Motivator":"Create New Motivator",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:r,className:"w-full bg-ceramic-base border-ceramic-rim",children:"Cancel"}),t.jsxs(A,{onClick:w,disabled:!a.trim(),className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(ss,{className:"w-4 h-4 mr-2"}),v?"Save":"Create"]})]}),children:[!v&&g.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(cn,{className:"w-4 h-4 text-primary"}),t.jsx(fe,{className:"text-warm-text font-medium",children:"Get inspired by examples"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-40 overflow-y-auto",children:g.map(j=>t.jsx(ie,{className:"p-3 cursor-pointer hover:bg-ceramic-base border-ceramic-rim transition-colors",onClick:()=>b(j),children:t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-medium text-sm text-warm-text",children:j.title}),t.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:j.description}),t.jsx(js,{variant:"secondary",className:"text-xs",children:j.category})]})},j.id))}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Click any example to use as a starting point (you can edit it afterwards)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(fe,{htmlFor:"title",className:"text-warm-text font-medium",children:"Title *"}),t.jsx(Bt,{feature:"Voice Input",showUpgrade:!1,children:t.jsx("button",{onClick:()=>u(!0),className:"w-6 h-6 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200",children:t.jsx(Ns,{className:"w-3 h-3 mx-auto"})})})]}),t.jsx(ge,{id:"title",value:a,onChange:j=>n(j.target.value),className:"bg-ceramic-base border-ceramic-rim",placeholder:"What motivates you to fast?"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(fe,{htmlFor:"content",className:"text-warm-text font-medium",children:"Description (Optional)"}),t.jsx(Bt,{feature:"Voice Input",showUpgrade:!1,children:t.jsx("button",{onClick:()=>u(!0),className:"w-6 h-6 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200",children:t.jsx(Ns,{className:"w-3 h-3 mx-auto"})})})]}),t.jsx(_r,{id:"content",value:o,onChange:j=>i(j.target.value),className:"bg-ceramic-base border-ceramic-rim min-h-[40px]",placeholder:"Optional: Add more details about this motivation..."})]}),t.jsx("div",{className:"space-y-2",children:t.jsx(ol,{currentImageUrl:l,onImageUpload:d,onImageRemove:()=>d(""),showUploadOptionsWhenImageExists:!0})}),t.jsx("div",{className:"h-2"})]}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[60]",children:t.jsxs("div",{className:"bg-ceramic-plate rounded-2xl p-6 w-full max-w-sm",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h4",{className:"font-semibold text-warm-text mb-2",children:"Voice Input"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Speak your motivator title or description"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(Bt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(qh,{onTranscription:y})}),t.jsx(A,{variant:"outline",onClick:()=>u(!1),className:"w-full",children:"Cancel"})]})]})})]})};class q1 extends c.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),console.error("Production error:",{error:s.message,stack:s.stack,componentStack:r.componentStack}),this.setState({errorInfo:r}),this.props.onError?.(s,r)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleGoHome=()=>{window.location.href="/"};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const{level:s="component"}=this.props;return this.state,s==="page"?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsxs(ie,{className:"w-full max-w-md p-6 text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:t.jsx(Zt,{className:"w-8 h-8 text-destructive"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Something went wrong"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"We encountered an unexpected error. Please try refreshing the page."})]}),!1,t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(A,{onClick:this.handleRetry,variant:"outline",className:"flex-1",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Try Again"]}),t.jsxs(A,{onClick:this.handleGoHome,className:"flex-1",children:[t.jsx(vo,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})]})}):s==="critical"?t.jsx(ie,{className:"p-4 border-destructive/20 bg-destructive/5",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Zt,{className:"w-5 h-5 text-destructive flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-medium text-destructive",children:"Critical Error"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"This component failed to load. Please refresh the page."})]}),t.jsx(A,{size:"sm",onClick:this.handleRetry,variant:"outline",children:t.jsx(At,{className:"w-4 h-4"})})]})}):t.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-muted-foreground",children:[t.jsx(Zt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Component unavailable"}),t.jsx(A,{size:"sm",variant:"ghost",onClick:this.handleRetry,className:"h-6 px-2",children:t.jsx(At,{className:"w-3 h-3"})})]})})}return this.props.children}}const Pa=({children:e,onError:s})=>t.jsx(q1,{level:"component",onError:s,children:e}),il=e=>{const[s,r]=c.useState([]),[a,n]=c.useState(0),[o,i]=c.useState(!0);pe();const l=async(f=!1)=>{console.log("ðŸ”„ Loading admin goal ideas with gender filter:",e,"Force clear:",f),console.log("ðŸ§¹ Clearing ALL cache before loading goal ideas"),Rs.invalidateQueries({queryKey:["admin"]}),Rs.removeQueries({queryKey:["admin"]}),localStorage.removeItem("goalIdeasCache"),localStorage.removeItem("adminGoalIdeas"),sessionStorage.removeItem("goalIdeasCache"),sessionStorage.removeItem("adminGoalIdeas");try{const u=Date.now(),{data:m,error:h}=await P.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(h){console.error("Admin Goal Ideas Database error:",h),r([]),i(!1);return}if(m?.setting_value)try{const p=JSON.parse(m.setting_value);let g=Array.isArray(p)?p:[];e&&(console.log("ðŸ” Filtering ideas by gender:",e),console.log("ðŸ“‹ All ideas before filtering:",g.map(x=>({id:x.id,title:x.title,gender:x.gender}))),g=g.filter(x=>x.gender===e),console.log("âœ… Filtered ideas:",g.map(x=>({id:x.id,title:x.title,gender:x.gender})))),console.log("âœ… Admin Goal Ideas loaded successfully:",g.length,"ideas for gender:",e),r(g.map(x=>({...x,_timestamp:u})))}catch(p){console.error("Error parsing admin goal ideas:",p),r([])}else console.log("No admin goal ideas data found in database"),r([])}catch(u){console.error("Error loading admin goal ideas:",u),r([])}finally{i(!1)}};return c.useEffect(()=>{console.log("ðŸ”„ useAdminGoalIdeas useEffect triggered - refreshTrigger:",a,"genderFilter:",e),l(!0)},[a,e]),{goalIdeas:s,loading:o,refreshGoalIdeas:()=>l(!0),forceRefresh:()=>{console.log("ðŸ”„ Force refreshing admin goal ideas..."),localStorage.clear(),sessionStorage.clear(),Rs.clear(),n(f=>f+1)}}},W1=({onSelectGoal:e,onClose:s})=>{const[r,a]=c.useState(""),[n,o]=c.useState(null),{profile:i}=Te(),{isAdmin:l}=Xe(),d=i?.sex||"male",{goalIdeas:f,loading:u}=il(d),m=f.filter(h=>h.title.toLowerCase().includes(r.toLowerCase())||h.description.toLowerCase().includes(r.toLowerCase()));return u?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("div",{className:"w-4 h-4 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[...Array(4)].map((h,p)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},p))})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Goal Ideas"}),t.jsx(A,{variant:"ghost",size:"sm",onClick:s,className:"w-10 h-10 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]}),t.jsxs("div",{className:"relative",children:[t.jsx(bd,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),t.jsx(ge,{placeholder:"Search goal ideas...",value:r,onChange:h=>a(h.target.value),className:"pl-9"})]}),t.jsx("div",{className:"max-h-80 overflow-y-auto space-y-3",children:m.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(cn,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No goal ideas found"})]}):m.map(h=>{const p=n===h.id;return t.jsxs(ie,{className:"border-ceramic-rim transition-colors",children:[t.jsx("div",{className:"p-3 cursor-pointer hover:bg-ceramic-base",onClick:()=>o(p?null:h.id),children:t.jsxs("div",{className:"flex gap-3",children:[h.imageUrl&&t.jsx("div",{className:"w-8 h-8 flex-shrink-0",children:t.jsx(da,{src:h.imageUrl,alt:h.title,className:"w-full h-full object-cover rounded"})}),t.jsxs("div",{className:"flex-1 space-y-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("h4",{className:"font-medium text-warm-text text-sm leading-tight",children:h.title}),l&&h.gender&&t.jsx("span",{className:"text-xs",title:`${h.gender} goal`,children:h.gender==="male"?"ðŸ”µ":"ðŸ”´"})]}),t.jsx(js,{variant:"secondary",className:"text-xs bg-muted text-muted-foreground flex-shrink-0",children:h.category})]}),t.jsx("p",{className:`text-xs text-muted-foreground leading-relaxed ${p?"":"line-clamp-3"}`,children:h.description})]}),t.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:p?t.jsx(Nt,{className:"w-4 h-4 text-muted-foreground"}):t.jsx(gi,{className:"w-4 h-4 text-muted-foreground"})})]})}),p&&t.jsx("div",{className:"px-3 pb-3",children:t.jsxs(A,{size:"sm",onClick:g=>{g.stopPropagation(),e(h)},className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Add This Goal"]})})]},h.id)})})]})},B1=({isOpen:e,onClose:s,onSelectGoal:r,onEditGoal:a})=>{const[n,o]=c.useState(null),[i,l]=c.useState(!1),{goalIdeas:d,loading:f,refreshGoalIdeas:u}=il(),{removeFromDefaultGoals:m,loading:h}=In(),{user:p}=Se();c.useEffect(()=>{(async()=>{if(p)try{const{data:v,error:w}=await P.rpc("is_current_user_admin");if(w)throw w;l(v||!1)}catch(v){console.error("Error checking admin role:",v),l(!1)}})()},[p]),c.useEffect(()=>{e&&u()},[e,u]);const g=async x=>{await m(x)&&u()};return f?t.jsx(mt,{isOpen:e,onClose:s,title:"Motivator Ideas",variant:"standard",size:"md",showCloseButton:!0,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("div",{className:"w-4 h-4 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[...Array(4)].map((x,v)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},v))})]})}):t.jsx(mt,{isOpen:e,onClose:s,title:"Motivator Ideas",variant:"standard",size:"md",showCloseButton:!0,children:t.jsx("div",{className:"space-y-4 py-2",children:t.jsx("div",{className:"max-h-96 overflow-y-auto space-y-3",children:d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(cn,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No motivator ideas found"})]}):d.map(x=>{const v=n===x.id,w=x.description&&x.description.length>50;return t.jsx(ie,{className:"overflow-hidden relative",children:t.jsxs($e,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0",children:t.jsx(da,{src:x.imageUrl,alt:x.title,className:"w-full h-full object-cover"})}),t.jsx("div",{className:"flex-1 p-4 pr-2 cursor-pointer hover:bg-muted/5",onClick:y=>{w&&(y.stopPropagation(),o(v?null:x.id))},children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h3",{className:"font-semibold text-warm-text line-clamp-1",children:x.title})}),x.description&&t.jsx("div",{className:"text-sm text-muted-foreground",children:v?t.jsx("p",{className:"whitespace-pre-wrap",children:x.description}):t.jsx("p",{className:"line-clamp-2",children:x.description})})]}),t.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",onClick:y=>{y.stopPropagation(),r(x),s()},className:"p-1 h-6 w-6 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground",children:t.jsx(qe,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add this motivator to your goals"})})]}),i&&a&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),a(x)},className:"p-1 h-6 w-6 rounded-md hover:bg-ceramic-base text-muted-foreground hover:text-warm-text",children:t.jsx(ut,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this idea (Admin)"})})]}),i&&t.jsxs(rt,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(gt,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation()},disabled:h,className:"p-1 h-6 w-6 rounded-md hover:bg-destructive/10 hover:text-destructive",children:t.jsx(We,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Remove from default goals (Admin)"})})]}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Remove Default Goal"}),t.jsxs(Qe,{children:['Are you sure you want to remove "',x.title,'" from the default goal ideas? This action cannot be undone.']})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>g(x.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})]})]})]})})]}),w&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>o(v?null:x.id),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10",children:t.jsx(Nt,{className:`w-3 h-3 transition-transform duration-200 ${v?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:v?"Show less":"Show full description"})})]})})]})},x.id)})})})})},cf=c.memo(({motivator:e,onEdit:s,onDelete:r})=>{const[a,n]=c.useState(!1),[o,i]=c.useState(e.imageUrl||""),[l,d]=c.useState(!1),[f,u]=c.useState(!1),{addToDefaultGoals:m,checkIfInDefaultGoals:h,loading:p}=In(),{user:g}=Se(),x=e.content&&e.content.length>50;c.useEffect(()=>{(async()=>{if(g)try{const{data:b,error:j}=await P.rpc("is_current_user_admin");if(j)throw j;d(b||!1)}catch(b){console.error("Error checking admin role:",b),d(!1)}})()},[g]),c.useEffect(()=>{(async()=>{if(!l)return;const b=await h(e.id);u(b)})()},[l,e.id,h]),c.useEffect(()=>{i(e.imageUrl||"")},[e.imageUrl]);const v=async()=>{await m(e)&&u(!0)},w=e.category==="saved_quote";return t.jsx(ie,{className:`overflow-hidden relative ${w?"bg-gray-900 border-gray-700":""}`,children:t.jsxs($e,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0 relative",children:t.jsx(da,{src:o,alt:e.title,className:"w-full h-full object-cover",onAddImageClick:s,showAddImagePrompt:!o})}),t.jsx("div",{className:"flex-1 p-4 pr-2 cursor-pointer hover:bg-muted/5",onClick:y=>{x&&(y.stopPropagation(),n(!a))},children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h3",{className:`font-semibold ${w?"text-white":"text-warm-text"} ${a?"":"line-clamp-2"}`,children:e.title})}),e.content&&t.jsx("div",{className:`text-sm ${w?"text-gray-200":"text-muted-foreground"}`,children:a?t.jsx("p",{className:"whitespace-pre-wrap",children:e.content}):t.jsx("p",{className:"line-clamp-2",children:e.content})})]}),t.jsxs("div",{className:"flex flex-col gap-1 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),s()},className:"p-1 h-6 w-6 hover:bg-muted hover:text-foreground",children:t.jsx(ut,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this motivator"})})]}),l&&!f&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),v()},disabled:p,className:"p-1 h-6 w-6 hover:bg-yellow-500/10 hover:text-yellow-600",children:t.jsx(Pl,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add to default goals (Admin)"})})]}),l&&f&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx("div",{className:"p-1 h-6 w-6 flex items-center justify-center",children:t.jsx(Pl,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"})})}),t.jsx(Me,{children:t.jsx("p",{children:"In default goals"})})]}),t.jsxs(rt,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(gt,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation()},className:"p-1 h-6 w-6 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(We,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Delete this motivator"})})]}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Motivator"}),t.jsxs(Qe,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:r,children:"Delete"})]})]})]})]})]})})]}),x&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>n(!a),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10",children:t.jsx(Nt,{className:`w-3 h-3 transition-transform duration-200 ${a?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:a?"Show less":"Show full description"})})]})})]})})});cf.displayName="ExpandableMotivatorCard";const df=c.memo(({motivator:e,onDelete:s})=>t.jsx(ie,{className:"overflow-hidden relative bg-gray-900 border-gray-700",children:t.jsx($e,{className:"p-6",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsx("div",{className:"flex-1 pr-4",children:e.content&&t.jsx("p",{className:"text-lg text-white leading-relaxed whitespace-pre-wrap",children:e.content})}),t.jsx("div",{className:"flex-shrink-0",children:t.jsxs(rt,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(gt,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",className:"p-2 h-8 w-8 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(We,{className:"w-4 h-4"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Delete this quote"})})]}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Quote"}),t.jsx(Qe,{children:"Are you sure you want to delete this saved quote? This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:s,children:"Delete"})]})]})]})})]})})}));df.displayName="SimpleMotivatorCard";const G1=()=>t.jsx(ie,{className:"overflow-hidden",children:t.jsxs("div",{className:"flex",children:[t.jsx(Xt,{className:"w-24 h-24 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 p-4 space-y-2",children:[t.jsx(Xt,{className:"h-4 w-[180px]"}),t.jsx(Xt,{className:"h-3 w-[120px]"}),t.jsx(Xt,{className:"h-3 w-[160px]"})]})]})}),V1=()=>{const e=kt(),{toast:s}=pe(),{motivators:r,loading:a,createMotivator:n,createMultipleMotivators:o,updateMotivator:i,deleteMotivator:l,refreshMotivators:d}=Zs(),{addToDefaultGoals:f,removeFromDefaultGoals:u,updateDefaultGoal:m,checkIfInDefaultGoals:h}=In(),[p,g]=c.useState("goals"),[x,v]=c.useState(!1),[w,y]=c.useState(null),[b,j]=c.useState(!1),[N,E]=c.useState(!1),[S,_]=c.useState(!1);c.useState(null);const C=r.filter(G=>G.category!=="saved_quote"),k=r.filter(G=>G.category==="saved_quote"),T=async G=>{try{await n({title:G.title,content:G.content,category:"personal",imageUrl:G.imageUrl}),_a("create","personal"),v(!1),s({title:"âœ… Motivator Created!",description:"Your new motivator has been saved successfully."}),d()}catch{s({title:"Error",description:"Failed to create motivator",variant:"destructive"})}},D=G=>{y(G)},W=async G=>{try{w&&(w._isAdminGoal||w.source==="admin_goals")?await m(w.id,{title:G.title,content:G.content,imageUrl:G.imageUrl})&&(_a("edit","admin_goal"),y(null),s({title:"âœ… Admin Goal Updated!",description:"The goal idea has been updated successfully."}),E(!0)):(await i(G.id,{title:G.title,content:G.content,imageUrl:G.imageUrl}),_a("edit","personal"),y(null),s({title:"âœ¨ Motivator Updated!",description:"Your changes have been saved."}),d())}catch{s({title:"Error",description:"Failed to update motivator",variant:"destructive"})}},$=async G=>{try{await l(G)&&_a("delete","personal")}catch{s({title:"Error",description:"Failed to delete motivator",variant:"destructive"})}},X=G=>{const L={id:G.id,title:G.title,content:G.description||"",imageUrl:G.imageUrl};y(L),E(!1)},V=async G=>{try{await T({title:G.title,content:G.description,imageUrl:G.imageUrl||null}),j(!1)}catch(L){console.error("Error creating motivator from goal idea:",L)}};return t.jsx(Hs,{children:t.jsx("div",{className:"relative min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4",children:t.jsx("div",{className:"max-w-md mx-auto pt-10 pb-20",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(_n,{})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent mb-1",children:p==="goals"?"My Goals":"Saved Quotes"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:p==="goals"?"Your personal motivators":"Quotes saved from timers"})]})]}),t.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{onClick:()=>v(!0),variant:"action-primary",size:"action-tall",className:"w-full flex items-center justify-center","aria-label":"Create motivator manually",children:t.jsx(qe,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Create a motivator by typing title, description, and adding images"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Goal"})]}),t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{onClick:()=>e("/motivator-ideas"),variant:"action-secondary",size:"action-tall",className:"w-full flex items-center justify-center","aria-label":"Browse motivator ideas",children:t.jsx(fd,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Browse professionally designed motivators and add them to your collection"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Goal ideas"})]})]}),t.jsx("div",{className:"mb-6",children:t.jsx(Ja,{value:p,onValueChange:g,className:"w-full",children:t.jsxs(Rn,{className:"grid w-full grid-cols-2",children:[t.jsxs(zs,{value:"goals",children:["Goals (",C.length,")"]}),t.jsxs(zs,{value:"quotes",children:["Quotes (",k.length,")"]})]})})}),b&&t.jsx("div",{className:"mb-6 bg-card border border-border rounded-lg p-4",children:t.jsx(Pa,{children:t.jsx(W1,{onSelectGoal:V,onClose:()=>j(!1)})})}),a?t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((G,L)=>t.jsx(G1,{},L))}):t.jsxs(Ja,{value:p,onValueChange:g,className:"w-full",children:[t.jsx(qs,{value:"goals",children:C.length===0?t.jsx(ie,{className:"p-6 text-center",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto",children:t.jsx(Jt,{className:"w-8 h-8 text-muted-foreground"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No goals yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first goal to stay inspired during your fasting journey"}),t.jsxs(A,{onClick:()=>v(!0),variant:"action-secondary",size:"action-secondary",children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Create Goal"]})]})]})}):t.jsxs("div",{className:"space-y-4",children:[C.map(G=>t.jsx(cf,{motivator:G,onEdit:()=>D(G),onDelete:()=>$(G.id)},G.id)),C.length<3&&[...Array(3-C.length)].map((G,L)=>t.jsx(ie,{className:"overflow-hidden border-dashed border-2 border-muted-foreground/20 hover:border-primary/30 cursor-pointer transition-all duration-200 hover:bg-muted/10 bg-muted/5",onClick:()=>v(!0),children:t.jsx($e,{className:"p-6",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:t.jsx(qe,{className:"w-6 h-6 text-primary/60"})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-muted-foreground/70 mb-1",children:["Create Goal #",C.length+L+1]}),t.jsx("p",{className:"text-xs text-muted-foreground/50",children:"Tap to add another motivating goal"})]})]})})},`placeholder-${L}`))]})}),t.jsx(qs,{value:"quotes",children:k.length===0?t.jsx(ie,{className:"p-6 text-center",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto",children:t.jsx(Br,{className:"w-8 h-8 text-muted-foreground"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No saved quotes yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Quotes you save from timer screens will appear here"})]})]})}):t.jsx("div",{className:"space-y-4",children:k.map(G=>t.jsx(df,{motivator:G,onDelete:()=>$(G.id)},G.id))})})]}),x&&t.jsx(Pa,{children:t.jsx(Za,{onSave:T,onClose:()=>v(!1)})}),w&&t.jsx(Pa,{children:t.jsx(Za,{motivator:w,onSave:W,onClose:()=>y(null)})}),t.jsx(B1,{isOpen:N,onClose:()=>E(!1),onSelectGoal:V,onEditGoal:X}),t.jsx(ca,{isOpen:S,onClose:()=>_(!1),title:et.motivators.title,subtitle:et.motivators.subtitle,heroQuote:et.motivators.heroQuote,backgroundImage:et.motivators.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:et.motivators.subtitle})}),et.motivators.sections.map((G,L)=>{const B=G.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(B,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:G.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:G.description})]})]},L)})]})})]})})})})},H1=c.memo(V1);function Q1({title:e,description:s,canonicalPath:r}){c.useEffect(()=>{if(document.title=e,s){let a=document.querySelector('meta[name="description"]');a||(a=document.createElement("meta"),a.setAttribute("name","description"),document.head.appendChild(a)),a.setAttribute("content",s)}if(r){const a=`${window.location.origin}${r}`;let n=document.querySelector('link[rel="canonical"]');n||(n=document.createElement("link"),n.setAttribute("rel","canonical"),document.head.appendChild(n)),n.setAttribute("href",a)}},[e,s,r])}var ll="Radio",[K1,uf]=St(ll),[Y1,X1]=K1(ll),mf=c.forwardRef((e,s)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:o,disabled:i,value:l="on",onCheck:d,form:f,...u}=e,[m,h]=c.useState(null),p=Ne(s,v=>h(v)),g=c.useRef(!1),x=m?f||!!m.closest("form"):!0;return t.jsxs(Y1,{scope:r,checked:n,disabled:i,children:[t.jsx(xe.button,{type:"button",role:"radio","aria-checked":n,"data-state":pf(n),"data-disabled":i?"":void 0,disabled:i,value:l,...u,ref:p,onClick:ae(e.onClick,v=>{n||d?.(),x&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})}),x&&t.jsx(J1,{control:m,bubbles:!g.current,name:a,value:l,checked:n,required:o,disabled:i,form:f,style:{transform:"translateX(-100%)"}})]})});mf.displayName=ll;var hf="RadioIndicator",ff=c.forwardRef((e,s)=>{const{__scopeRadio:r,forceMount:a,...n}=e,o=X1(hf,r);return t.jsx(_t,{present:a||o.checked,children:t.jsx(xe.span,{"data-state":pf(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:s})})});ff.displayName=hf;var J1=e=>{const{control:s,checked:r,bubbles:a=!0,...n}=e,o=c.useRef(null),i=la(r),l=oa(s);return c.useEffect(()=>{const d=o.current,f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"checked").set;if(i!==r&&m){const h=new Event("click",{bubbles:a});m.call(d,r),d.dispatchEvent(h)}},[i,r,a]),t.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:o,style:{...e.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function pf(e){return e?"checked":"unchecked"}var Z1=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],cl="RadioGroup",[eS,H2]=St(cl,[kr,uf]),gf=kr(),xf=uf(),[tS,sS]=eS(cl),vf=c.forwardRef((e,s)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:o,required:i=!1,disabled:l=!1,orientation:d,dir:f,loop:u=!0,onValueChange:m,...h}=e,p=gf(r),g=Ys(f),[x,v]=Gt({prop:o,defaultProp:n,onChange:m});return t.jsx(tS,{scope:r,name:a,required:i,disabled:l,value:x,onValueChange:v,children:t.jsx(sl,{asChild:!0,...p,orientation:d,dir:g,loop:u,children:t.jsx(xe.div,{role:"radiogroup","aria-required":i,"aria-orientation":d,"data-disabled":l?"":void 0,dir:g,...h,ref:s})})})});vf.displayName=cl;var yf="RadioGroupItem",wf=c.forwardRef((e,s)=>{const{__scopeRadioGroup:r,disabled:a,...n}=e,o=sS(yf,r),i=o.disabled||a,l=gf(r),d=xf(r),f=c.useRef(null),u=Ne(s,f),m=o.value===n.value,h=c.useRef(!1);return c.useEffect(()=>{const p=x=>{Z1.includes(x.key)&&(h.current=!0)},g=()=>h.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",g)}},[]),t.jsx(rl,{asChild:!0,...l,focusable:!i,active:m,children:t.jsx(mf,{disabled:i,required:o.required,checked:m,...d,...n,name:o.name,ref:u,onCheck:()=>o.onValueChange(n.value),onKeyDown:ae(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:ae(n.onFocus,()=>{h.current&&f.current?.click()})})})});wf.displayName=yf;var rS="RadioGroupIndicator",bf=c.forwardRef((e,s)=>{const{__scopeRadioGroup:r,...a}=e,n=xf(r);return t.jsx(ff,{...n,...a,ref:s})});bf.displayName=rS;var jf=vf,Nf=wf,aS=bf;const Sf=c.forwardRef(({className:e,...s},r)=>t.jsx(jf,{className:Z("grid gap-2",e),...s,ref:r}));Sf.displayName=jf.displayName;const ri=c.forwardRef(({className:e,...s},r)=>t.jsx(Nf,{ref:r,className:Z("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:t.jsx(aS,{className:"flex items-center justify-center",children:t.jsx(xd,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ri.displayName=Nf.displayName;const nS=({onImageUpload:e,onImageRemove:s,currentImageUrl:r,onError:a,onSuccess:n})=>{const[o,i]=c.useState(!1),{user:l,session:d}=Se(),{toast:f}=pe(),u=async h=>{if(h){if(!h.type.startsWith("image/")){a?.("Please select an image file");return}if(h.size>5*1024*1024){a?.("Image size must be less than 5MB");return}if(!l||!d){a?.("Authentication required. Please sign in to upload images.");return}i(!0),console.log("ðŸ” Session state before upload:",{hasUser:!!l,hasSession:!!d,sessionExpiry:d?.expires_at?new Date(d.expires_at*1e3):"No expiry",userId:l?.id});try{if(r){const b=await si(r,"motivator-images",P);b.success||console.warn("Failed to delete old image (continuing with upload):",b.error)}const p=h.name.split(".").pop(),g=`${l.id}/${Date.now()}-admin-goal.${p}`;console.log("ðŸ”„ Uploading admin goal image to:",g),console.log("ðŸ“Š File size:",h.size,"bytes"),console.log("ðŸ“„ File type:",h.type);const{data:x,error:v}=await P.storage.from("motivator-images").upload(g,h,{cacheControl:"3600",upsert:!0});if(v)throw console.error("âŒ Storage upload error:",v),new Error(`Upload failed: ${v.message}`);if(!x)throw console.error("âŒ No data returned from upload"),new Error("Upload failed: No data returned");console.log("âœ… File uploaded successfully:",x);const{data:w}=P.storage.from("motivator-images").getPublicUrl(g);if(!w?.publicUrl)throw console.error("âŒ Failed to get public URL"),new Error("Failed to get public URL");const y=w.publicUrl;console.log("âœ… Public URL generated:",y),e(y),n?.("Image uploaded successfully"),f({title:"Success",description:"Image uploaded successfully"})}catch(p){console.error("âŒ Upload error details:",{message:p.message,stack:p.stack,error:p});const g=p.message||"Failed to upload image. Please try again.";a?.(g),f({title:"Upload Failed",description:g,variant:"destructive"})}finally{i(!1)}}},m=async()=>{if(r){i(!0);try{const h=await si(r,"motivator-images",P);h.success?(s(),n?.("Image removed successfully"),f({title:"Success",description:"Image removed successfully"})):(console.warn("Failed to delete image from storage:",h.error),s(),n?.("Image reference removed (storage cleanup may be needed)"),f({title:"Warning",description:"Image removed locally, but storage cleanup failed",variant:"destructive"}))}catch(h){console.error("Error during image removal:",h),a?.(`Failed to remove image: ${h.message}`),f({title:"Error",description:`Failed to remove image: ${h.message}`,variant:"destructive"})}finally{i(!1)}}};return t.jsxs("div",{className:"space-y-3",children:[r&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:r,alt:"Goal idea",className:"w-full h-32 object-cover rounded-lg border border-ceramic-rim"}),t.jsx(A,{type:"button",size:"sm",variant:"destructive",onClick:m,className:"absolute top-2 right-2 h-6 w-6 p-0",disabled:o,children:t.jsx(Ie,{className:"w-3 h-3"})})]}),!r&&t.jsxs("div",{className:"border-2 border-dashed border-ceramic-rim rounded-lg p-6 text-center bg-ceramic-plate",children:[t.jsx(vi,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Upload an image for this goal idea"}),t.jsx("label",{htmlFor:"admin-image-upload-silent",className:"cursor-pointer",children:t.jsx(A,{type:"button",variant:"outline",size:"sm",disabled:o,className:"bg-ceramic-base border-ceramic-rim",asChild:!0,children:t.jsx("span",{children:o?t.jsxs(t.Fragment,{children:[t.jsx(zt,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(wo,{className:"w-4 h-4 mr-2"}),"Choose Image"]})})})}),t.jsx("input",{id:"admin-image-upload-silent",type:"file",accept:"image/*",onChange:h=>{const p=h.target.files?.[0];p&&u(p)},className:"hidden",disabled:o})]}),r&&t.jsxs("div",{className:"flex justify-center",children:[t.jsx("label",{htmlFor:"admin-image-replace-silent",className:"cursor-pointer",children:t.jsx(A,{type:"button",variant:"outline",size:"sm",disabled:o,className:"bg-ceramic-base border-ceramic-rim",asChild:!0,children:t.jsx("span",{children:o?t.jsxs(t.Fragment,{children:[t.jsx(zt,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(wo,{className:"w-4 h-4 mr-2"}),"Replace Image"]})})})}),t.jsx("input",{id:"admin-image-replace-silent",type:"file",accept:"image/*",onChange:h=>{const p=h.target.files?.[0];p&&u(p)},className:"hidden",disabled:o})]})]})},oS=({goal:e,onSave:s,onClose:r})=>{const[a,n]=c.useState(""),[o,i]=c.useState(""),[l,d]=c.useState(""),[f,u]=c.useState("male"),[m,h]=c.useState(!1),[p,g]=c.useState(0),[x,v]=c.useState(""),[w,y]=c.useState("");pe(),c.useEffect(()=>{e&&(console.log("ðŸ“ Loading goal data into form:",e),n(e.title||""),i(e.description||""),d(e.imageUrl||""),u(e.gender||"male"),h(!1),v(""),y(""),g(j=>j+1))},[e]);const b=async()=>{if(!a.trim()){v("Title is required");return}if(e){h(!0),v(""),y("");try{const j={...e,title:a.trim(),description:o.trim(),imageUrl:l||void 0,gender:f};console.log("ðŸ’¾ Saving goal data:",j),await s(j),y("Changes saved successfully!"),setTimeout(()=>{n(""),i(""),d(""),u("male"),h(!1),v(""),y(""),r()},1e3)}catch(j){console.error("âŒ Error saving goal:",j),v("Failed to save changes. Please try again."),h(!1)}}};return e?t.jsx(mt,{isOpen:!0,onClose:r,title:"Edit Motivator Idea",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:r,disabled:m,className:"w-full bg-ceramic-base border-ceramic-rim",children:"Cancel"}),t.jsx(A,{onClick:b,disabled:!a.trim()||m,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:m?t.jsxs(t.Fragment,{children:[t.jsx(ss,{className:"w-4 h-4 mr-2 animate-pulse"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ss,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),children:t.jsxs("div",{"data-modal-editing":"true",className:"space-y-4",children:[x&&t.jsx("div",{className:"p-3 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive text-sm",children:x}),w&&t.jsx("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-green-600 text-sm",children:w}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"goal-title",className:"text-warm-text font-medium",children:"Title *"}),t.jsx(ge,{id:"goal-title",value:a,onChange:j=>n(j.target.value),className:"bg-ceramic-base border-ceramic-rim",placeholder:"Enter the motivator title...",disabled:m})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"goal-description",className:"text-warm-text font-medium",children:"Description"}),t.jsx(_r,{id:"goal-description",value:o,onChange:j=>i(j.target.value),className:"bg-ceramic-base border-ceramic-rim min-h-[80px]",placeholder:"Enter the motivator description...",disabled:m})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Gender"}),t.jsxs(Sf,{value:f,onValueChange:j=>u(j),children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ri,{value:"male",id:"male"}),t.jsx(fe,{htmlFor:"male",className:"text-warm-text",children:"Male ðŸ”µ"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ri,{value:"female",id:"female"}),t.jsx(fe,{htmlFor:"female",className:"text-warm-text",children:"Female ðŸ”´"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Image"}),t.jsx(nS,{currentImageUrl:l,onImageUpload:d,onImageRemove:()=>d(""),onError:j=>v(j),onSuccess:j=>y(j)})]})]})},p):null};function iS(){Q1({title:"Motivator Ideas Library",description:"Browse motivator ideas and add them to your goals.",canonicalPath:"/motivator-ideas"});const e=kt(),{toast:s}=pe(),{profile:r}=Te(),{isAdmin:a}=Xe(),n=r?.sex||"male";console.log("MotivatorIdeas - User gender for filtering:",n,"Profile sex:",r?.sex);const{goalIdeas:o,loading:i,refreshGoalIdeas:l,forceRefresh:d}=il(n),{removeFromDefaultGoals:f,updateDefaultGoal:u,loading:m}=In(),{createMotivator:h}=Zs(),[p,g]=c.useState(null),[x,v]=c.useState(null),[w,y]=c.useState(null);c.useEffect(()=>{console.log("ðŸ”„ Refreshing goal ideas on page load..."),l()},[]),c.useEffect(()=>{r?.sex&&(w!==null&&w!==r.sex&&(console.log("MotivatorIdeas: Profile sex changed from",w,"to",r.sex,"- refreshing goals"),l()),y(r.sex))},[r?.sex,w,d]);const b=async S=>{try{await h({title:S.title,content:S.description||"",category:"personal",imageUrl:S.imageUrl||void 0}),s({title:"âœ… Added to My Goals",description:"The motivator was added successfully."})}catch{s({title:"Error",description:"Failed to add motivator.",variant:"destructive"})}},j=S=>{v(S)},N=c.useCallback(async S=>{try{if(console.log("Saving edit with data:",S),await u(S.id,{title:S.title,content:S.description,imageUrl:S.imageUrl}))console.log("âœ… Update successful, clearing modal..."),s({title:"âœ… Idea Updated",description:"Changes saved successfully."}),v(null),setTimeout(()=>l(),200);else throw new Error("Update failed")}catch(_){console.error("Update error:",_),s({title:"Error",description:"Failed to update idea.",variant:"destructive"})}},[u,d,s]),E=async S=>{await f(S)&&(s({title:"Removed",description:"Idea removed from defaults."}),l())};return t.jsxs("div",{className:"pt-20 pb-20",children:[" ",t.jsxs("header",{className:"flex items-center gap-3 mb-4",children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>e("/motivators"),"aria-label":"Back to My Goals",children:t.jsx(fi,{className:"w-4 h-4"})}),t.jsx("h1",{className:"text-xl font-bold text-warm-text",children:"Goal Ideas"})]}),t.jsx("main",{children:i?t.jsx("div",{className:"space-y-4",children:[...Array(4)].map((S,_)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},_))}):o.length===0?t.jsxs("section",{className:"text-center py-10",children:[t.jsx(cn,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No motivator ideas found"})]}):t.jsx("section",{className:"space-y-3","aria-label":"Motivator ideas list",children:o.map(S=>{const _=p===S.id,C=S.description&&S.description.length>50;return t.jsx(ie,{className:"overflow-hidden relative",children:t.jsxs($e,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0",children:t.jsx(da,{src:S.imageUrl,alt:S.title,className:"w-full h-full object-cover"})}),t.jsx("div",{className:"flex-1 p-4 pr-2",children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"font-semibold text-warm-text line-clamp-1",children:S.title}),a&&S.gender&&t.jsx("span",{className:"text-sm",title:`${S.gender} goal`,children:S.gender==="male"?"ðŸ”µ":"ðŸ”´"})]}),S.description&&t.jsx("div",{className:"text-sm text-muted-foreground",children:_?t.jsx("p",{className:"whitespace-pre-wrap",children:S.description}):t.jsx("p",{className:"line-clamp-2",children:S.description})})]}),t.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",onClick:()=>b(S),className:"p-1 h-6 w-6 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground","aria-label":"Add to my goals",children:t.jsx(qe,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add this motivator to your goals"})})]}),a&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>j(S),className:"p-1 h-6 w-6 rounded-md hover:bg-ceramic-base text-muted-foreground hover:text-warm-text","aria-label":"Edit idea",children:t.jsx(ut,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this idea (Admin)"})})]}),a&&t.jsxs(rt,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(gt,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",disabled:m,className:"p-1 h-6 w-6 rounded-md hover:bg-destructive/10 hover:text-destructive","aria-label":"Delete idea",children:t.jsx(We,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Remove from default goals (Admin)"})})]}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Remove Default Goal"}),t.jsxs(Qe,{children:['Are you sure you want to remove "',S.title,'" from the default goal ideas? This action cannot be undone.']})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>E(S.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})]})]})]})})]}),C&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>g(_?null:S.id),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10","aria-label":_?"Show less":"Show full description",children:t.jsx(Nt,{className:`w-3 h-3 transition-transform duration-200 ${_?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:_?"Show less":"Show full description"})})]})})]})},S.id)})})}),x&&t.jsx(oS,{goal:x,onSave:N,onClose:()=>v(null)})]},`motivator-ideas-${r?.sex||"unknown"}-${Date.now()}`)}const lS=({value:e,onChange:s,className:r})=>{const{profile:a,updateProfile:n}=Te(),[o,i]=c.useState(e),[l,d]=c.useState(a?.units==="metric"?"kg":"lb");c.useEffect(()=>{i(e)},[e]);const f=w=>Math.round(w*2.20462*10)/10,u=w=>Math.round(w/2.20462*10)/10,m=async w=>{if(o&&!isNaN(Number(o))){const y=Number(o);let b;l==="kg"&&w==="lb"?b=f(y):l==="lb"&&w==="kg"?b=u(y):b=y;const j=b.toString();i(j);const N=w==="kg"?b:u(b);s(N.toString())}a&&await n({units:w==="kg"?"metric":"imperial"}),d(w)},h=w=>{if(i(w),w&&!isNaN(Number(w))){const y=Number(w),b=l==="kg"?y:u(y);s(b.toString())}else w||s("")},p=()=>l==="kg"?{min:30,max:300,step:.1}:{min:66,max:660,step:.1},{min:g,max:x,step:v}=p();return t.jsxs("div",{className:r,children:[t.jsx(fe,{htmlFor:"weight",className:"text-sm font-medium mb-2 block",children:"Weight"}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{id:"weight",type:"number",value:o,onChange:w=>h(w.target.value),placeholder:`Enter weight in ${l}`,min:g,max:x,step:v,className:"pr-20"}),t.jsx("div",{className:"absolute right-1 top-1 bottom-1",children:t.jsxs(es,{value:l,onValueChange:m,children:[t.jsx(qt,{className:"w-16 h-8 border-0 bg-muted/30 text-xs font-medium",children:t.jsx(ts,{})}),t.jsxs(Wt,{className:"bg-popover border min-w-16",children:[t.jsx(Fe,{value:"kg",className:"text-xs",children:"kg"}),t.jsx(Fe,{value:"lb",className:"text-xs",children:"lb"})]})]})})]})]})},cS=({value:e,onChange:s,className:r})=>{const{profile:a,updateProfile:n}=Te(),[o,i]=c.useState(e),[l,d]=c.useState(a?.units==="metric"?"cm":"ft");c.useEffect(()=>{i(e)},[e]);const f=j=>{const N=j/2.54,E=Math.floor(N/12),S=Math.round(N%12);return`${E}.${S.toString().padStart(2,"0")}`},u=j=>Math.round(j/2.54*10)/10,m=j=>{const[N,E]=j.split(".").map(Number),S=(N||0)*12+(E||0);return Math.round(S*2.54)},h=j=>Math.round(j*2.54),p=async j=>{if(o&&!isNaN(Number(o.replace(".","")))){let N;const E=l==="cm"?Number(o):l==="ft"?m(o):h(Number(o));j==="cm"?N=E.toString():j==="ft"?N=f(E):N=u(E).toString(),i(N),s(E.toString())}a&&await n({units:j==="cm"?"metric":"imperial"}),d(j)},g=j=>{if(i(j),j){let N;if(l==="cm"&&!isNaN(Number(j)))N=Number(j);else if(l==="ft"&&/^\d+\.\d*$/.test(j))N=m(j);else if(l==="in"&&!isNaN(Number(j)))N=h(Number(j));else{if(j)return;s("");return}s(N.toString())}else s("")},x=()=>l==="cm"?{min:100,max:250,step:1,placeholder:"Enter height in cm"}:l==="ft"?{min:3.03,max:8.02,step:.01,placeholder:`e.g. 5.08 (5'8")`}:{min:39,max:98,step:.1,placeholder:"Enter height in inches"},{min:v,max:w,step:y,placeholder:b}=x();return t.jsxs("div",{className:r,children:[t.jsx(fe,{htmlFor:"height",className:"text-sm font-medium mb-2 block",children:"Height"}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{id:"height",type:"number",value:o,onChange:j=>g(j.target.value),placeholder:b,min:v,max:w,step:y,className:"pr-20"}),t.jsx("div",{className:"absolute right-1 top-1 bottom-1",children:t.jsxs(es,{value:l,onValueChange:p,children:[t.jsx(qt,{className:"w-16 h-8 border-0 bg-muted/30 text-xs font-medium",children:t.jsx(ts,{})}),t.jsxs(Wt,{className:"bg-popover border min-w-16",children:[t.jsx(Fe,{value:"cm",className:"text-xs",children:"cm"}),t.jsx(Fe,{value:"ft",className:"text-xs",children:"ft"}),t.jsx(Fe,{value:"in",className:"text-xs",children:"in"})]})]})})]})]})},dS=({onComplete:e,onSkip:s})=>{const{profile:r,updateProfile:a,loading:n}=Te(),{toast:o}=pe(),[i,l]=c.useState({weight:r?.weight?r.weight.toString():"",height:r?.height?r.height.toString():"",age:r?.age?r.age.toString():"",sex:r?.sex||"",activityLevel:r?.activity_level||""});c.useEffect(()=>{r&&l({weight:r.weight?r.weight.toString():"",height:r.height?r.height.toString():"",age:r.age?r.age.toString():"",sex:r.sex||"",activityLevel:r.activity_level||""})},[r]);const[d,f]=c.useState(null),[u,m]=c.useState(""),[h,p]=c.useState(!1),g=async()=>{if(!x()){o({title:"Missing Information",description:"Please fill in all required fields to continue.",variant:"destructive"});return}try{p(!0);let j="imperial";if(typeof u=="object"&&u){const E=u.weight?parseFloat(u.weight):parseFloat(i.weight);E&&E<=300&&(j="metric");const S=u.height?parseInt(u.height):parseInt(i.height);S&&S>=120&&S<=250&&(j="metric")}else{const E=parseFloat(i.weight),S=parseInt(i.height);(E&&E<=300||S&&S>=120&&S<=250)&&(j="metric")}const{error:N}=await a({weight:Number(i.weight),height:Number(i.height),age:Number(i.age),sex:i.sex,activity_level:i.activityLevel,onboarding_completed:!0,units:j});N?o({title:"Error",description:"Failed to save profile information.",variant:"destructive"}):(o({title:"Profile Complete",description:"Your profile has been set up successfully!"}),e())}catch{o({title:"Error",description:"Something went wrong. Please try again.",variant:"destructive"})}finally{p(!1)}},x=()=>i.weight&&i.height&&i.age&&i.sex&&i.activityLevel,v=j=>{f(j),j==="weight"?m({weight:i.weight}):j==="height"?m({height:i.height}):j==="age"?m(i.age):j==="sex"?m(i.sex):j==="activityLevel"&&m(i.activityLevel)},w=()=>{if(d==="weight"){const j=typeof u=="object"&&u?.weight?u.weight:"";l(N=>({...N,weight:j}))}else if(d==="height"){const j=typeof u=="object"&&u?.height?u.height:"";l(N=>({...N,height:j}))}else d==="age"?l(j=>({...j,age:typeof u=="string"?u:""})):d==="sex"?l(j=>({...j,sex:typeof u=="string"?u:""})):d==="activityLevel"&&l(j=>({...j,activityLevel:typeof u=="string"?u:""}));f(null)},y=j=>{const N=i[j];if(!N)return"Not set";switch(j){case"weight":return`${Number(N).toFixed(1)} kg`;case"height":return`${N} cm`;case"age":return`${N} years`;case"sex":return N.charAt(0).toUpperCase()+N.slice(1);case"activityLevel":return N?{sedentary:"Low",moderately_active:"Medium",very_active:"High"}[N]||N:"Not set";default:return N}},b=()=>{if(!d)return null;switch(d){case"weight":return t.jsx(lS,{value:typeof u=="object"&&u?.weight?u.weight:"",onChange:j=>m(N=>typeof N=="object"?{...N,weight:j}:{weight:j}),className:"space-y-2"});case"height":return t.jsx(cS,{value:typeof u=="object"&&u?.height?u.height:"",onChange:j=>m(N=>typeof N=="object"?{...N,height:j}:{height:j}),className:"space-y-2"});case"age":return t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Age"}),t.jsx(ge,{type:"number",value:typeof u=="string"?u:"",onChange:j=>m(j.target.value),placeholder:"Enter age (13-120)",min:"13",max:"120"})]})});case"sex":return t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Biological Sex"}),t.jsxs(es,{value:typeof u=="string"?u:"",onValueChange:m,children:[t.jsx(qt,{children:t.jsx(ts,{placeholder:"Select sex"})}),t.jsxs(Wt,{className:"bg-background border z-50",children:[t.jsx(Fe,{value:"male",children:"Male"}),t.jsx(Fe,{value:"female",children:"Female"})]})]})]})});case"activityLevel":return t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Activity Level"}),t.jsxs(es,{value:typeof u=="string"?u:"",onValueChange:m,children:[t.jsx(qt,{children:t.jsx(ts,{placeholder:"Select activity level"})}),t.jsxs(Wt,{className:"bg-background border z-50",children:[t.jsx(Fe,{value:"sedentary",children:"Low"}),t.jsx(Fe,{value:"moderately_active",children:"Medium"}),t.jsx(Fe,{value:"very_active",children:"High"})]})]})]})});default:return null}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("button",{onClick:()=>v("weight"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Weight"}),t.jsx("div",{className:"font-medium",children:y("weight")})]}),t.jsxs("button",{onClick:()=>v("height"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Height"}),t.jsx("div",{className:"font-medium",children:y("height")})]}),t.jsxs("button",{onClick:()=>v("age"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Age"}),t.jsx("div",{className:"font-medium",children:y("age")})]}),t.jsxs("button",{onClick:()=>v("sex"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sex"}),t.jsx("div",{className:"font-medium",children:y("sex")})]}),t.jsxs("button",{onClick:()=>v("activityLevel"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left col-span-2",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Activity Level"}),t.jsx("div",{className:"font-medium",children:y("activityLevel")})]})]}),t.jsxs("div",{className:"mt-8",children:[t.jsx(A,{onClick:g,className:"w-full",disabled:h||!x(),children:h?"Saving...":"Complete Profile"}),!x()&&t.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:"Please fill in all required fields to continue"})]}),t.jsx(ea,{open:!!d,onOpenChange:()=>f(null),children:t.jsxs(gr,{className:"sm:max-w-md",children:[t.jsx(Pn,{children:t.jsx(xr,{children:d&&d.charAt(0).toUpperCase()+d.slice(1)})}),b(),t.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[t.jsx(A,{variant:"outline",onClick:()=>f(null),children:"Cancel"}),t.jsx(A,{onClick:w,disabled:typeof u=="object"&&!u?.weight&&!u?.height||typeof u=="string"&&!u,children:"Save"})]})]})})]})},_f=({isOpen:e,onClose:s})=>{const r=et.profile,a=()=>{};return t.jsx(ca,{isOpen:e,onClose:a,title:r.title,subtitle:r.subtitle,showCloseButton:!1,children:t.jsx("div",{className:"mt-6 bg-muted/20 rounded-xl border border-border/50 p-6",children:t.jsx(dS,{onComplete:s,onSkip:s})})})},uS=()=>{const[e,s]=c.useState(!1),{toast:r}=pe(),a=async()=>{s(!0);try{if(localStorage.clear(),sessionStorage.clear(),"indexedDB"in window){const n=await indexedDB.databases();await Promise.all(n.map(o=>{if(o.name)return new Promise((i,l)=>{const d=indexedDB.deleteDatabase(o.name);d.onsuccess=()=>i(),d.onerror=()=>l(d.error)})}))}if("caches"in window){const n=await caches.keys();await Promise.all(n.map(o=>caches.delete(o)))}if("serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();await Promise.all(n.map(o=>(o.waiting&&o.waiting.postMessage({type:"SKIP_WAITING"}),o.unregister())));try{await navigator.serviceWorker.register("/sw.js")}catch(o){console.log("Service worker registration after clear:",o)}}r({title:"Cache Cleared",description:"All cached data has been cleared. The page will reload to get the latest version."}),setTimeout(()=>{window.location.href=window.location.origin},1e3)}catch(n){console.error("Error clearing cache:",n),r({title:"Error",description:"Failed to clear cache completely. Please try refreshing the page manually.",variant:"destructive"})}finally{s(!1)}};return t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"outline",className:"w-full bg-ceramic-base border-ceramic-rim justify-start",children:"Clear Cache"})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Clear App Cache?"}),t.jsx(Qe,{children:"This will clear all cached data and reload the app to ensure you have the latest version. You may need to sign in again."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:a,disabled:e,children:e?t.jsx(t.Fragment,{children:"Clearing..."}):t.jsx(t.Fragment,{children:"Clear Cache"})})]})]})]})},mS=({onClose:e})=>{const[s,r]=c.useState([]),[a,n]=c.useState(""),[o,i]=c.useState(!1),[l,d]=c.useState(!1),f=c.useRef(null),{toast:u}=pe(),{createMotivator:m,updateMotivator:h,refreshMotivators:p}=Zs();c.useEffect(()=>{r([{role:"assistant",content:`Welcome! I'm here to help you create powerful motivators for your fasting journey. Let me share some real examples that work incredibly well:

**Fitting into clothes** - This is one of the most powerful motivators. Think about:
â€¢ That pair of pants you bought but never wore
â€¢ Clothes you used to fit into years ago
â€¢ A tuxedo or special outfit for an upcoming event (wedding, reunion, etc.)

The magic happens when you combine this with:
â€¢ A specific deadline (like a wedding date)
â€¢ Financial investment (you bought something expensive)
â€¢ Social validation (others will see you)
â€¢ Progress tracking (trying them on regularly)

**Impressing someone specific** - This might not be the most noble goal, but it works:
â€¢ Someone who used to like you but doesn't anymore
â€¢ People who insulted you or doubted you
â€¢ Someone you want to attract or re-attract

For each motivator, record a voice message telling me:
1. What specifically motivates you
2. Why it's important to you
3. Any deadlines or events involved
4. The emotional impact you want

I'll create each motivator in your database with a placeholder image. Then you should replace it with real photos - like actually wearing those tight clothes or a photo of the person you want to impress.

What's your first powerful motivator? Record it and tell me everything!`,timestamp:new Date}])},[]),c.useEffect(()=>{f.current?.scrollIntoView({behavior:"smooth"})},[s]);const g=async y=>{if(!y.trim())return;const b={role:"user",content:y,timestamp:new Date,audioEnabled:!0};r(j=>[...j,b]),await v(y,!0)},x=async y=>{const b=a.trim();if(!b||o)return;const j={role:"user",content:b,timestamp:new Date};r(N=>[...N,j]),n(""),await v(b)},v=async(y,b=!1)=>{i(!0);try{const j=s.map(T=>({role:T.role,content:T.content})),N=`You are a motivational coach specialized in creating powerful fasting motivators. Your goal is to help users create specific, emotionally resonant motivators.

IMPORTANT: Each voice message from the user should be processed individually to create separate motivators. If they mention multiple motivators in one message, split them into separate ones.

When a user describes a motivator, immediately create it by responding with a JSON object:
{
  "action": "create_motivator",
  "title": "Brief, powerful title (max 50 chars)",
  "content": "Detailed description based on their story (max 200 chars)",
  "category": "personal" | "health" | "achievement" | "mindset"
}

MOTIVATOR CREATION GUIDELINES:
- Use their exact words and emotional language
- Include specific details they mentioned (dates, people, clothes, etc.)
- Make it personal and emotionally charged
- Focus on the outcome they want
- Include any deadlines or social elements
- Reference specific items (clothes, photos, events)

RESPONSE STYLE:
- After creating each motivator, tell them: "I've created your motivator! I'm also generating a motivational image for it automatically - you can replace it later with your own photos if you prefer."
- Ask if they have more motivators to add
- Keep responses encouraging and action-oriented
- Don't ask too many clarifying questions - create the motivator from what they give you

ALWAYS create the motivator immediately when they describe one. Don't ask for permission.`,{data:E,error:S}=await P.functions.invoke("chat-completion",{body:{message:y,conversationHistory:[{role:"system",content:N},...j]}});if(S)throw S;let _=!1,C=E.completion;try{const T=E.completion.match(/\{[\s\S]*?"action":\s*"create_motivator"[\s\S]*?\}/);if(T){const D=JSON.parse(T[0]);if(D.action==="create_motivator"){const W=await m({title:D.title,content:D.content,category:D.category||"personal"});_=!0,C=E.completion.replace(T[0],"").trim(),u({title:"âœ¨ Motivator Created!",description:`"${D.title}" has been added to your motivators.`})}}}catch(T){console.error("Error parsing motivator JSON:",T)}const k={role:"assistant",content:C||E.completion,timestamp:new Date,audioEnabled:l&&b};r(T=>[...T,k]),l&&b&&C&&await w(C),_&&p()}catch(j){console.error("Error sending message:",j),u({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{i(!1)}},w=async y=>{try{const{data:b,error:j}=await P.functions.invoke("text-to-speech",{body:{text:y,voice:"alloy"}});if(j)throw j;b.audioUrl&&new Audio(b.audioUrl).play()}catch(b){console.error("Error playing text as audio:",b)}};return t.jsxs(mt,{isOpen:!0,onClose:e,title:"AI Motivator Coach",variant:"standard",size:"md",showCloseButton:!0,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 justify-end",children:[t.jsx(Mn,{id:"modal-audio-mode",checked:l,onCheckedChange:d,className:"scale-75"}),t.jsx(fe,{htmlFor:"modal-audio-mode",className:"text-sm",children:l?t.jsx(Al,{className:"h-3 w-3"}):t.jsx(Wx,{className:"h-3 w-3"})})]}),t.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto mb-4",children:[s.map((y,b)=>t.jsx("div",{className:`flex ${y.role==="user"?"justify-end":"justify-start"}`,children:t.jsx(ie,{className:`max-w-[85%] p-3 ${y.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:y.content}),t.jsx("p",{className:"text-xs opacity-70 mt-1",children:y.timestamp.toLocaleTimeString()})]}),y.audioEnabled&&y.role==="assistant"&&t.jsx(Al,{className:"h-4 w-4 opacity-70"})]})})},b)),o&&t.jsx("div",{className:"flex justify-start",children:t.jsx(ie,{className:"max-w-[85%] p-3 bg-muted",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),t.jsx("p",{className:"text-sm",children:"AI is thinking..."})]})})}),t.jsx("div",{ref:f})]}),t.jsxs("div",{className:"border-t border-border pt-4 mt-4 space-y-3",children:[t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsx(ge,{value:a,onChange:y=>n(y.target.value),placeholder:"Tell me what motivates you...",onKeyPress:y=>y.key==="Enter"&&!y.shiftKey&&x(),disabled:o,className:"flex-1"}),t.jsx(A,{onClick:()=>x(),disabled:!a.trim()||o,size:"default",className:"flex-shrink-0",children:t.jsx(jd,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(Bt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(fr,{onTranscription:g,isDisabled:o,size:"lg"})})})]})]})},hS=({onClose:e})=>{const{toast:s}=pe(),{motivators:r,loading:a,createMotivator:n,updateMotivator:o,deleteMotivator:i,refreshMotivators:l}=Zs(),[d,f]=c.useState(!1),[u,m]=c.useState(null),h=async v=>{try{await n({title:v.title,content:v.content,category:"personal",imageUrl:v.imageUrl}),f(!1),l()}catch{s({title:"Error",description:"Failed to create motivator",variant:"destructive"})}},p=v=>{m(v)},g=async v=>{try{if(console.log("Updating motivator with ID:",v.id,"Type:",typeof v.id),!v.id||typeof v.id!="string")throw new Error("Invalid motivator ID");await o(v.id,{title:v.title,content:v.content,imageUrl:v.imageUrl}),m(null),l()}catch(w){console.error("Error updating motivator:",w),s({title:"Error updating motivator",description:w.message||"Failed to update motivator",variant:"destructive"})}},x=async v=>{try{await i(v),l()}catch{s({title:"Error",description:"Failed to delete motivator",variant:"destructive"})}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-ceramic-plate rounded-3xl w-full max-w-md max-h-[85vh] border border-ceramic-rim shadow-2xl mt-4 flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-ceramic-rim",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"My Motivators"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Your personal motivators"})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[t.jsxs(A,{onClick:()=>f(!0),className:"w-full mb-6 bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Create New Motivator"]}),a?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading your motivators..."})}):r.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(Br,{className:"w-8 h-8 text-muted-foreground"})}),t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No motivators yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first motivator to stay inspired during your fasting journey"})]}):t.jsx("div",{className:"space-y-4",children:r.map(v=>t.jsx(ie,{className:"overflow-hidden",children:t.jsx($e,{className:"p-0",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-20 h-20 bg-muted flex items-center justify-center flex-shrink-0",children:v.imageUrl?t.jsx("img",{src:v.imageUrl,alt:v.title,className:"w-full h-full object-cover"}):t.jsx(vi,{className:"w-8 h-8 text-muted-foreground"})}),t.jsx("div",{className:"flex-1 p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text line-clamp-1",children:v.title}),v.content&&t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:v.content}),v.category&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(js,{variant:"secondary",className:"text-xs",children:v.category})})]}),t.jsxs("div",{className:"flex gap-1 ml-2",children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>p(v),className:"p-1 h-6 w-6 hover:bg-muted hover:text-foreground",children:t.jsx(ut,{className:"w-3 h-3"})}),t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",className:"p-1 h-6 w-6 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(We,{className:"w-3 h-3"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Motivator"}),t.jsxs(Qe,{children:['Are you sure you want to delete "',v.title,'"? This action cannot be undone.']})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>x(v.id),children:"Delete"})]})]})]})]})]})})]})})},v.id))})]}),d&&t.jsx(Za,{onSave:h,onClose:()=>f(!1)}),u&&t.jsx(Za,{motivator:u,onSave:g,onClose:()=>m(null)})]})})},Cf=c.createContext(void 0),fS=()=>{const e=c.useContext(Cf);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},pS=({children:e})=>{const[s,r]=c.useState(()=>localStorage.getItem("theme")||"system"),[a,n]=c.useState("dark");c.useEffect(()=>{let i;if(s==="system"?i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":i=s,n(i),document.documentElement.classList.toggle("dark",i==="dark"),s==="system"){const l=window.matchMedia("(prefers-color-scheme: dark)"),d=f=>{const u=f.matches?"dark":"light";n(u),document.documentElement.classList.toggle("dark",u==="dark")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)}},[s]);const o=i=>{r(i),localStorage.setItem("theme",i)};return t.jsx(Cf.Provider,{value:{theme:s,setTheme:o,actualTheme:a},children:e})},gS=()=>{const{theme:e,setTheme:s}=fS(),r=[{value:"light",icon:_x,label:"Light"},{value:"dark",icon:Zg,label:"Dark"},{value:"system",icon:Xg,label:"Auto"}];return t.jsx("div",{className:"flex bg-muted rounded-lg p-1 gap-1",children:r.map(({value:a,icon:n,label:o})=>t.jsxs(A,{variant:e===a?"default":"ghost",size:"sm",onClick:()=>s(a),className:`
            flex-1 h-8 px-2 transition-all duration-200
            ${e===a?"bg-background shadow-sm text-foreground":"hover:bg-muted-foreground/10 text-muted-foreground"}
          `,children:[t.jsx(n,{className:"w-3.5 h-3.5 mr-1.5"}),t.jsx("span",{className:"text-xs font-medium",children:o})]},a))})},xS=()=>{const e=Ct(),s=c.useCallback(async()=>{console.log("ðŸ—‘ï¸ Clearing ALL subscription-related cache");try{await e.invalidateQueries({queryKey:["unified-subscription"]}),await e.invalidateQueries({queryKey:["subscription"]}),await e.invalidateQueries({queryKey:["optimized-subscription"]}),e.removeQueries({queryKey:["unified-subscription"]}),e.removeQueries({queryKey:["subscription"]}),e.removeQueries({queryKey:["optimized-subscription"]}),e.invalidateQueries({queryKey:["profile"]}),await e.refetchQueries({queryKey:["unified-subscription"],type:"active"}),await new Promise(l=>setTimeout(l,100)),console.log("âœ… All subscription cache cleared and refetched"),window.location.reload()}catch(l){console.error("âŒ Error clearing subscription cache:",l)}},[e]),r=c.useCallback(()=>{console.log("ðŸ”„ Force refreshing subscription data"),e.invalidateQueries({queryKey:["unified-subscription"]}),e.refetchQueries({queryKey:["unified-subscription"]})},[e]),a=c.useCallback((l={})=>{console.log("ðŸ—‘ï¸ Clearing subscription cache"),e.invalidateQueries({queryKey:["unified-subscription"]}),e.invalidateQueries({queryKey:["subscription"]}),e.removeQueries({queryKey:["unified-subscription"]}),e.removeQueries({queryKey:["subscription"]}),l.showToast&&console.log("âœ… Subscription cache cleared")},[e]),n=c.useCallback((l={})=>{console.log("ðŸ—‘ï¸ Clearing walking cache"),e.invalidateQueries({queryKey:["walking"]}),e.removeQueries({queryKey:["walking"]}),l.showToast&&console.log("âœ… Walking cache cleared")},[e]),o=c.useCallback(async(l={})=>{console.log("ðŸ—‘ï¸ Clearing goals cache"),e.invalidateQueries({queryKey:["goals"]}),e.invalidateQueries({queryKey:["motivators"]}),e.removeQueries({queryKey:["goals"]}),e.removeQueries({queryKey:["motivators"]}),l.showToast&&console.log("âœ… Goals cache cleared")},[e]),i=c.useCallback(async(l={})=>{console.log("ðŸ—‘ï¸ Clearing profile cache"),e.invalidateQueries({queryKey:["profile"]}),e.removeQueries({queryKey:["profile"]}),l.showToast&&console.log("âœ… Profile cache cleared")},[e]);return{clearAllSubscriptionCache:s,forceRefreshSubscription:r,clearSubscriptionCache:a,clearWalkingCache:n,clearGoalsCache:o,clearProfileCache:i}},vS=()=>{c.useState(!0);const[e,s]=c.useState(!1),[r,a]=c.useState("gpt-4o-mini-realtime"),[n,o]=c.useState("whisper-1"),[i,l]=c.useState("tts-1"),[d,f]=c.useState("alloy"),[u,m]=c.useState(""),[h,p]=c.useState(""),[g,x]=c.useState(""),[v,w]=c.useState(""),[y,b]=c.useState(""),[j,N]=c.useState(""),[E,S]=c.useState("sedentary"),[_,C]=c.useState(""),{toast:k}=pe(),{user:T,signOut:D}=Se(),W=kt(),{isAdmin:$,originalIsAdmin:X,hasPremiumFeatures:V,createSubscription:G,openCustomerPortal:L,isTrial:B,daysRemaining:de,access_level:te}=Xe(),Y=!0,oe="Stripe",[O,Q]=c.useState(!1),[R,M]=c.useState(!1),[H,U]=c.useState(!1),{profile:ee,updateProfile:ue,loading:be}=Te();bn();const{clearGoalsCache:je,clearProfileCache:Ue}=xS();c.useEffect(()=>{s($),(async()=>{if(T)try{const{data:ce,error:it}=await P.from("profiles").select("speech_model, transcription_model, tts_model, tts_voice, weight, height, age, sex, daily_calorie_goal, daily_carb_goal, activity_level, manual_tdee_override, enable_fasting_slideshow, enable_walking_slideshow").eq("user_id",T.id).maybeSingle();if(it){console.error("Error loading profile settings:",it);return}if(ce){a(ce.speech_model||"gpt-4o-mini-realtime"),o(ce.transcription_model||"whisper-1"),l(ce.tts_model||"tts-1"),f(ce.tts_voice||"alloy"),m(ce.weight?.toString()||""),p(ce.height?.toString()||""),x(ce.age?.toString()||""),w(ce.sex||""),b(ce.daily_calorie_goal?.toString()||""),N(ce.daily_carb_goal?.toString()||""),S(ce.activity_level||"sedentary"),C(ce.manual_tdee_override?.toString()||"");const at=!ce.weight||!ce.height||!ce.age||!ce.activity_level&&!ce["activity-level"];console.log("Profile incompleteness check:",{weight:ce.weight,height:ce.height,age:ce.age,activity_level:ce.activity_level,isIncomplete:at}),at&&U(!0)}else U(!0)}catch(ce){console.error("Error fetching user settings:",ce)}})()},[T,$]);const me=()=>{if(!u||!h||!g||!v)return 0;const J=parseFloat(u),ce=parseInt(h),it=parseInt(g);let at;return v==="female"?at=10*J+6.25*ce-5*it-161:at=10*J+6.25*ce-5*it+5,Math.round(at)},ve=J=>{const ce=me(),at={sedentary:0,lightly_active:.1,moderately_active:.3,very_active:.45}[J]||0;return Math.round(ce*at)},z=async()=>{try{if(u){const J=parseFloat(u);if(ee?.units==="metric"){if(J<30||J>300){k({title:"Invalid Weight",description:"Weight must be between 30-300 kg",variant:"destructive"});return}}else if(J<66||J>660){k({title:"Invalid Weight",description:"Weight must be between 66-660 lbs",variant:"destructive"});return}}if(h){const J=parseInt(h);if(ee?.units==="metric"){if(J<100||J>250){k({title:"Invalid Height",description:"Height must be between 100-250 cm",variant:"destructive"});return}}else if(J<39||J>98){k({title:"Invalid Height",description:"Height must be between 39-98 inches",variant:"destructive"});return}}if(T){const J={speech_model:r,transcription_model:n,tts_model:i,tts_voice:d,weight:u?parseFloat(u):null,height:h?parseInt(h):null,age:g?parseInt(g):null,sex:v||null,daily_calorie_goal:y?parseInt(y):null,daily_carb_goal:j?parseInt(j):null,activity_level:E,manual_tdee_override:_?parseInt(_):null};console.log("Settings: User ID:",T?.id),console.log("Settings: Saving profile data:",J);const ce=await ue(J);if(ce?.error){console.error("Settings save error:",ce.error),k({title:"Database Error",description:`Failed to save: ${ce.error.message}`,variant:"destructive"});return}ce?.data&&J.sex&&J.sex!==ee?.sex&&(console.log("ðŸ”„ Sex changed - clearing goal and profile caches"),await je({showToast:!1}),await Ue({showToast:!1}),k({title:"Profile Updated",description:"Sex updated successfully. Goal recommendations have been refreshed."}));const at=ce?.error;try{await P.rpc("update_user_tier",{_user_id:T.id})}catch(Er){console.warn("Tier update RPC failed:",Er)}console.log("Settings saved successfully"),k({title:"âœ… Settings Saved!",description:"Your settings have been updated successfully."})}}catch(J){console.error("Settings save error:",J),k({title:"Error",description:J?.message||"Failed to save settings. Please try again.",variant:"destructive"})}},he=async()=>{if(T)try{const J=[P.from("chat_conversations").delete().eq("user_id",T.id),P.from("motivators").delete().eq("user_id",T.id),P.from("food_entries").delete().eq("user_id",T.id),P.from("user_foods").delete().eq("user_id",T.id),P.from("fasting_sessions").delete().eq("user_id",T.id),P.from("walking_sessions").delete().eq("user_id",T.id),P.from("manual_calorie_burns").delete().eq("user_id",T.id),P.from("daily_activity_overrides").delete().eq("user_id",T.id),P.from("daily_food_templates").delete().eq("user_id",T.id),P.from("default_food_favorites").delete().eq("user_id",T.id)];await Promise.all(J),await P.from("profiles").update({weight:null,height:null,age:null,daily_calorie_goal:null,daily_carb_goal:null,goal_weight:null,onboarding_completed:!1}).eq("user_id",T.id),k({title:"Account Reset Complete",description:"All your data has been cleared. You can start fresh!"}),W("/")}catch(J){console.error("Error resetting account:",J),k({title:"Error",description:"Failed to reset account. Please try again.",variant:"destructive"})}},le=async()=>{if(T)try{const{data:J,error:ce}=await P.functions.invoke("delete-account",{headers:{Authorization:`Bearer ${(await P.auth.getSession()).data.session?.access_token}`}});if(ce)throw ce;J.scheduled?k({title:"Account Deletion Scheduled",description:J.message}):(k({title:"Account Deleted",description:J.message}),await D(),W("/auth"))}catch(J){console.error("Error deleting account:",J),k({title:"Error",description:"Failed to delete account. Please try again.",variant:"destructive"})}};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4",children:t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"mb-2 mt-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent mb-1",children:"Settings"}),(e||X)&&t.jsx(A,{size:"sm",variant:"outline",onClick:()=>W("/admin"),children:"Admin Dashboard"})]}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Customize your fasting experience"})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Dl,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Profile"})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>U(!0),className:"w-8 h-8 p-0 rounded-full bg-ceramic-plate/80 backdrop-blur-sm border border-ceramic-rim hover:bg-ceramic-plate hover:scale-110 transition-all duration-200",title:"Setup Profile Walkthrough",children:t.jsx(pi,{className:"w-4 h-4 text-warm-text"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-warm-text",children:"Physical Attributes"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"weight",className:"text-warm-text",children:["Weight (",ee?.units==="metric"?"kg":"lbs",")"]}),t.jsx(ge,{id:"weight",type:"number",placeholder:ee?.units==="metric"?"70":"154",value:u,onChange:J=>m(J.target.value),className:"bg-ceramic-base border-ceramic-rim",min:ee?.units==="metric"?"30":"66",max:ee?.units==="metric"?"300":"660",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"height",className:"text-warm-text",children:["Height (",ee?.units==="metric"?"cm":"in",")"]}),t.jsx(ge,{id:"height",type:"number",placeholder:ee?.units==="metric"?"175":"69",value:h,onChange:J=>p(J.target.value),className:"bg-ceramic-base border-ceramic-rim",min:ee?.units==="metric"?"100":"39",max:ee?.units==="metric"?"250":"98",step:"1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"age",className:"text-warm-text",children:"Age"}),t.jsx(ge,{id:"age",type:"number",placeholder:"30",value:g,onChange:J=>x(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"sex",className:"text-warm-text",children:"Biological Sex"}),t.jsxs(es,{value:v,onValueChange:w,children:[t.jsx(qt,{className:"bg-ceramic-base border-ceramic-rim",children:t.jsx(ts,{placeholder:"Select sex"})}),t.jsxs(Wt,{children:[t.jsx(Fe,{value:"male",children:"Male"}),t.jsx(Fe,{value:"female",children:"Female"})]})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium text-warm-text",children:"Daily Goals"}),t.jsx(st,{content:"Set your daily calorie and carb targets. These help track your progress and calculate deficits. Leave blank if you don't want to track these goals.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"daily-calorie-goal",className:"text-warm-text",children:"Calorie Goal"}),t.jsx(ge,{id:"daily-calorie-goal",type:"number",placeholder:"2000",value:y,onChange:J=>b(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"daily-carb-goal",className:"text-warm-text",children:"Carb Goal (g)"}),t.jsx(ge,{id:"daily-carb-goal",type:"number",placeholder:"200",value:j,onChange:J=>N(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(fe,{htmlFor:"activity-level",className:"text-warm-text",children:"Activity Level"}),t.jsx(st,{content:"Affects calorie burn calculations. Most people should choose 'Sedentary' (office work) or 'Lightly Active' (some walking). This is your default setting.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs(es,{value:E,onValueChange:S,children:[t.jsx(qt,{className:"bg-ceramic-base border-ceramic-rim w-full",children:t.jsx(ts,{placeholder:"Select"})}),t.jsxs(Wt,{children:[t.jsxs(Fe,{value:"sedentary",children:["Sedentary ",ve("sedentary")>0?`(+${ve("sedentary")} cal)`:""]}),t.jsxs(Fe,{value:"lightly_active",children:["Lightly Active (+",ve("lightly_active")," cal)"]}),t.jsxs(Fe,{value:"moderately_active",children:["Moderately Active (+",ve("moderately_active")," cal)"]}),t.jsxs(Fe,{value:"very_active",children:["Very Active (+",ve("very_active")," cal)"]})]})]})]}),me()>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(fe,{htmlFor:"manual-tdee",className:"text-warm-text",children:"Manual Daily Burn Override (optional)"}),t.jsx(st,{content:"Override the calculated daily burn if you know your actual TDEE from metabolic testing.",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(ge,{id:"manual-tdee",type:"number",placeholder:`${Math.round(me()*(1.2+ve(E)/me()))} (calculated)`,value:_,onChange:J=>C(J.target.value),className:"bg-ceramic-base border-ceramic-rim flex-1"}),_&&t.jsx(A,{variant:"outline",size:"sm",onClick:()=>C(""),className:"bg-ceramic-base border-ceramic-rim",children:"Clear"})]})]})]})]})}),t.jsx(A,{onClick:z,variant:"action-primary",size:"action-main",className:"w-full",children:"Save Settings"}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Dl,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Account"})]}),t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Email"}),t.jsx("span",{className:"text-warm-text font-medium",children:T?.email})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Login Method"}),t.jsx("span",{className:"text-warm-text font-medium",children:T?.app_metadata?.provider==="google"?"Google":"Email"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Account Type"}),t.jsx("span",{className:"text-warm-text font-medium",children:B?"Trial User":V?"Premium User":"Free User"})]}),(B||V)&&de&&t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:B?"Trial expires":"Premium expires"}),t.jsx("span",{className:"text-warm-text font-medium",children:new Date(Date.now()+de*24*60*60*1e3).toLocaleDateString()})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Member since"}),t.jsx("span",{className:"text-warm-text font-medium",children:T?.created_at?new Date(T.created_at).toLocaleDateString():"Unknown"})]})]}),t.jsxs("div",{className:"pt-3 border-t border-ceramic-rim space-y-3",children:[te==="free"&&t.jsxs(A,{onClick:async()=>{try{await G(),k({title:Y?"Redirecting to checkout":`Use ${oe} to upgrade`,description:Y?"Opening payment page...":`Purchases are managed via ${oe}.`})}catch{k({title:"Error",description:"Failed to start subscription. Please try again.",variant:"destructive"})}},className:"w-full bg-gradient-to-r from-primary to-primary-glow hover:from-primary-hover hover:to-primary",children:[t.jsx(go,{className:"w-4 h-4 mr-2"}),"Upgrade to Premium"]}),V&&t.jsx(A,{onClick:async()=>{try{await L(),k({title:"Opening customer portal",description:"Manage your subscription..."})}catch{k({title:"Error",description:"Failed to open customer portal. Please try again.",variant:"destructive"})}},variant:"outline",className:"w-full bg-ceramic-base border-ceramic-rim justify-start",children:"Manage Subscription"}),t.jsx(A,{onClick:()=>{D(),W("/auth")},variant:"outline",className:"w-full bg-ceramic-base border-ceramic-rim justify-start hover:bg-red-50 hover:border-red-200 hover:text-red-600",children:"Sign Out"})]})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(tx,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Appearance"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(gS,{})})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Tg,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Distance & Speed Units"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(fe,{className:"text-warm-text",children:"Measurement System"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Choose how distances and speeds are displayed"})]}),t.jsxs(es,{value:ee?.units||"imperial",onValueChange:async J=>{await ue({units:J}),k({title:"Units Updated",description:`Switched to ${J==="metric"?"metric (km, km/h)":"imperial (miles, mph)"} system`})},children:[t.jsx(qt,{className:"w-32 bg-ceramic-base border-ceramic-rim",children:t.jsx(ts,{})}),t.jsxs(Wt,{className:"bg-popover border z-50",children:[t.jsx(Fe,{value:"imperial",children:"Imperial"}),t.jsx(Fe,{value:"metric",children:"Metric"})]})]})]}),t.jsx("div",{className:"text-xs text-muted-foreground bg-ceramic-plate/30 rounded-lg p-3 border border-ceramic-rim",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Imperial:"})," miles, mph, lbs"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Metric:"})," kilometers, km/h, kg"]})]})})]})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim border-destructive/20",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Zt,{className:"w-5 h-5 text-destructive"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Account Management"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(uS,{}),t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"outline",className:"w-full border-orange-500/30 text-orange-600 hover:bg-orange-500/10 justify-start",children:"Reset Account Data"})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Reset Account Data?"}),t.jsx(Qe,{children:"This will permanently delete all your data (food entries, fasting sessions, walking history, motivators, etc.) but keep your account active. You can start fresh with a clean slate."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:he,className:"bg-orange-500 hover:bg-orange-600",children:"Reset All Data"})]})]})]}),t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"outline",className:"w-full border-destructive/30 text-destructive hover:bg-destructive/10 justify-start",children:"Delete Account"})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Account Permanently?"}),t.jsx(Qe,{children:"This will permanently delete your account and all associated data. This action cannot be undone. If you have an active subscription, it will be canceled."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:le,className:"bg-destructive hover:bg-destructive/80",children:"Delete Forever"})]})]})]})]})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(tt,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"About"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Version"}),t.jsx("span",{className:"text-warm-text font-medium",children:"1.0.0"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Build"}),t.jsx("span",{className:"text-warm-text font-medium",children:"Beta"})]})]})]})}),t.jsx(ie,{className:"p-6 bg-card border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ml,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Legal"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("a",{href:"https://fastnow.app/privacy",target:"_blank",rel:"noopener noreferrer",className:"block w-full text-left text-sm text-foreground hover:underline",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ml,{className:"w-4 h-4 mr-2"}),"Privacy Policy"]})}),t.jsx("a",{href:"https://fastnow.app/terms",target:"_blank",rel:"noopener noreferrer",className:"block w-full text-left text-sm text-foreground hover:underline",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(tt,{className:"w-4 h-4 mr-2"}),"Terms of Service"]})})]})]})})]}),O&&t.jsx(hS,{onClose:()=>Q(!1)}),R&&t.jsx(mS,{onClose:()=>M(!1)}),t.jsx(_f,{isOpen:H,onClose:()=>U(!1)})]})})};var dl="Collapsible",[yS,Q2]=St(dl),[wS,ul]=yS(dl),kf=c.forwardRef((e,s)=>{const{__scopeCollapsible:r,open:a,defaultOpen:n,disabled:o,onOpenChange:i,...l}=e,[d=!1,f]=Gt({prop:a,defaultProp:n,onChange:i});return t.jsx(wS,{scope:r,disabled:o,contentId:ls(),open:d,onOpenToggle:c.useCallback(()=>f(u=>!u),[f]),children:t.jsx(xe.div,{"data-state":hl(d),"data-disabled":o?"":void 0,...l,ref:s})})});kf.displayName=dl;var Ef="CollapsibleTrigger",Tf=c.forwardRef((e,s)=>{const{__scopeCollapsible:r,...a}=e,n=ul(Ef,r);return t.jsx(xe.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":hl(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...a,ref:s,onClick:ae(e.onClick,n.onOpenToggle)})});Tf.displayName=Ef;var ml="CollapsibleContent",Mf=c.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=ul(ml,e.__scopeCollapsible);return t.jsx(_t,{present:r||n.open,children:({present:o})=>t.jsx(bS,{...a,ref:s,present:o})})});Mf.displayName=ml;var bS=c.forwardRef((e,s)=>{const{__scopeCollapsible:r,present:a,children:n,...o}=e,i=ul(ml,r),[l,d]=c.useState(a),f=c.useRef(null),u=Ne(s,f),m=c.useRef(0),h=m.current,p=c.useRef(0),g=p.current,x=i.open||l,v=c.useRef(x),w=c.useRef();return c.useEffect(()=>{const y=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(y)},[]),jt(()=>{const y=f.current;if(y){w.current=w.current||{transitionDuration:y.style.transitionDuration,animationName:y.style.animationName},y.style.transitionDuration="0s",y.style.animationName="none";const b=y.getBoundingClientRect();m.current=b.height,p.current=b.width,v.current||(y.style.transitionDuration=w.current.transitionDuration,y.style.animationName=w.current.animationName),d(a)}},[i.open,a]),t.jsx(xe.div,{"data-state":hl(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!x,...o,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...e.style},children:x&&n})});function hl(e){return e?"open":"closed"}var jS=kf;const NS=jS,SS=Tf,_S=Mf,ta=({fullScreen:e=!0,text:s="Loading",subText:r="Preparing your experience"})=>{const a=t.jsxs("div",{className:"text-center space-y-4",children:[t.jsxs("div",{className:"relative w-16 h-16 mx-auto",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary rounded-full animate-spin"}),t.jsx("div",{className:"absolute inset-2 border-2 border-primary/30 rounded-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-lg font-medium text-foreground",children:s}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),t.jsxs("div",{className:"flex justify-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]});return e?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a}):t.jsx("div",{className:"flex items-center justify-center p-8",children:a})},CS=()=>{const[e,s]=c.useState(""),[r,a]=c.useState(""),[n,o]=c.useState(!1),[i,l]=c.useState(!1),[d,f]=c.useState(!1),{signIn:u,signUp:m,signInWithGoogle:h,user:p,loading:g}=Se(),x=kt();if(Ft.isNativePlatform(),c.useEffect(()=>{p&&!g&&x("/")},[p,g,x]),g)return t.jsx(ta,{});const v=async b=>{b.preventDefault(),o(!0),await u(e,r),o(!1)},w=async b=>{b.preventDefault(),o(!0),await m(e,r),o(!1)},y=async()=>{await h()};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background/80 to-accent/10 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent",children:"FastNow"}),t.jsx("p",{className:"text-muted-foreground",children:"Your no-BS weight loss program"})]}),t.jsx(ie,{className:"border-border/50 backdrop-blur-sm bg-card/80 shadow-elegant",children:t.jsxs($e,{className:"space-y-6 pt-6",children:[t.jsxs(A,{size:"lg",className:"w-full h-12 text-base bg-gradient-to-r from-primary to-primary-glow hover:from-primary-hover hover:to-primary shadow-lg",onClick:y,disabled:n,children:[n?t.jsx(zt,{className:"mr-3 h-5 w-5 animate-spin"}):t.jsxs("svg",{className:"mr-3 h-5 w-5",viewBox:"0 0 24 24",children:[t.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),t.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),t.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),t.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),t.jsxs(NS,{open:i,onOpenChange:l,children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 flex items-center",children:t.jsx("div",{className:"w-full border-t border-border"})}),t.jsx("div",{className:"relative flex justify-center",children:t.jsx(SS,{asChild:!0,children:t.jsxs(A,{variant:"ghost",size:"sm",className:"bg-card px-4 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[t.jsx(yd,{className:"mr-2 h-4 w-4"}),"Use email instead",t.jsx(Nt,{className:`ml-2 h-4 w-4 transition-transform ${i?"rotate-180":""}`})]})})})]}),t.jsxs(_S,{className:"space-y-4 animate-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsx(A,{variant:d?"outline":"default",size:"sm",className:"flex-1",onClick:()=>f(!1),children:"Sign In"}),t.jsx(A,{variant:d?"default":"outline",size:"sm",className:"flex-1",onClick:()=>f(!0),children:"Sign Up"})]}),t.jsxs("form",{onSubmit:d?w:v,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"email",children:"Email"}),t.jsx(ge,{id:"email",type:"email",placeholder:"Enter your email",value:e,onChange:b=>s(b.target.value),required:!0,disabled:n})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"password",children:"Password"}),t.jsx(ge,{id:"password",type:"password",placeholder:d?"Create a password":"Enter your password",value:r,onChange:b=>a(b.target.value),required:!0,disabled:n})]}),t.jsx(A,{type:"submit",className:"w-full",disabled:n,children:n?t.jsxs(t.Fragment,{children:[t.jsx(zt,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Creating Account...":"Signing In..."]}):d?"Create Account":"Sign In"}),!d&&t.jsx("div",{className:"text-center",children:t.jsx(ia,{to:"/reset-password",className:"text-sm text-muted-foreground hover:text-primary transition-colors",children:"Forgot your password?"})})]})]})]}),t.jsxs("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:["By continuing, you agree to our"," ",t.jsx("a",{href:"https://go.fastnow.app/terms",target:"_blank",rel:"noopener noreferrer",className:"underline text-foreground hover:text-foreground",children:"Terms of Service"})," ","and"," ",t.jsx("a",{href:"https://go.fastnow.app/privacy",target:"_blank",rel:"noopener noreferrer",className:"underline text-foreground hover:text-foreground",children:"Privacy Policy"}),"."," ","Your data is secured and never shared with third parties."]})]})})]})})},kS=()=>{const e=kt(),{toast:s}=pe();return c.useEffect(()=>{(async()=>{try{if(console.log("ðŸ”„ Processing OAuth callback..."),Ft.isNativePlatform()){console.warn("âš ï¸ Native platform reached web callback - redirecting to auth"),e("/auth");return}const{data:n,error:o}=await P.auth.getSession();if(o){console.error("âŒ OAuth callback error:",o),s({title:"Authentication Failed",description:o.message||"Failed to complete sign-in. Please try again.",variant:"destructive"}),e("/auth");return}n.session?.user?(console.log("âœ… OAuth callback successful:",{userId:n.session.user.id,email:n.session.user.email}),s({title:"Welcome!",description:"Successfully signed in with Google."}),e("/")):(console.warn("âš ï¸ OAuth callback completed but no session found"),s({title:"Authentication Incomplete",description:"Please try signing in again.",variant:"destructive"}),e("/auth"))}catch(a){console.error("âŒ Unexpected error in OAuth callback:",a),s({title:"Authentication Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),e("/auth")}})()},[e,s]),t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background/80 to-accent/10 flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(ta,{}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Completing sign-in..."}),t.jsx("p",{className:"text-muted-foreground",children:"Please wait while we finish setting up your account."})]})]})})},ES=()=>{const[e,s]=c.useState(""),[r,a]=c.useState(!1),[n,o]=c.useState(!1),{resetPassword:i}=Se(),l=kt(),d=async f=>{f.preventDefault(),a(!0);const{error:u}=await i(e);u||o(!0),a(!1)};return n?t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(ie,{className:"w-full max-w-md",children:[t.jsxs(pt,{className:"text-center space-y-4",children:[t.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(yd,{className:"h-6 w-6 text-primary"})}),t.jsx(us,{children:"Check Your Email"}),t.jsxs(Ba,{children:["We've sent a password reset link to ",e]})]}),t.jsx($e,{className:"space-y-4",children:t.jsx(A,{onClick:()=>l("/auth"),className:"w-full",variant:"outline",children:"Back to Sign In"})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(ie,{className:"w-full max-w-md",children:[t.jsxs(pt,{className:"space-y-4",children:[t.jsxs(ia,{to:"/auth",className:"flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors",children:[t.jsx(fi,{className:"h-4 w-4 mr-2"}),"Back to Sign In"]}),t.jsxs("div",{className:"text-center",children:[t.jsx(us,{children:"Reset Password"}),t.jsx(Ba,{children:"Enter your email address and we'll send you a link to reset your password"})]})]}),t.jsx($e,{children:t.jsxs("form",{onSubmit:d,className:"space-y-4",children:[t.jsx("div",{className:"space-y-2",children:t.jsx(ge,{type:"email",placeholder:"Enter your email",value:e,onChange:f=>s(f.target.value),required:!0,disabled:r})}),t.jsx(A,{type:"submit",className:"w-full",disabled:r||!e,children:r?"Sending...":"Send Reset Link"})]})})]})})},TS=()=>{const[e,s]=c.useState(""),[r,a]=c.useState(""),[n,o]=c.useState(!1),{updatePassword:i,session:l}=Se(),d=kt();c.useEffect(()=>{l||d("/auth")},[l,d]);const f=async p=>{if(p.preventDefault(),e!==r||e.length<6)return;o(!0);const{error:g}=await i(e);g||d("/"),o(!1)},u=e===r,m=e.length>=6,h=u&&m&&e&&r;return t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(ie,{className:"w-full max-w-md",children:[t.jsxs(pt,{className:"text-center space-y-4",children:[t.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(Vs,{className:"h-6 w-6 text-primary"})}),t.jsx(us,{children:"Update Password"}),t.jsx(Ba,{children:"Enter your new password below"})]}),t.jsx($e,{children:t.jsxs("form",{onSubmit:f,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{type:"password",placeholder:"New password",value:e,onChange:p=>s(p.target.value),required:!0,disabled:n,minLength:6}),e&&!m&&t.jsx("p",{className:"text-sm text-destructive",children:"Password must be at least 6 characters"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{type:"password",placeholder:"Confirm new password",value:r,onChange:p=>a(p.target.value),required:!0,disabled:n,minLength:6}),r&&!u&&t.jsx("p",{className:"text-sm text-destructive",children:"Passwords do not match"})]}),t.jsx(A,{type:"submit",className:"w-full",disabled:n||!h,children:n?"Updating...":"Update Password"})]})})]})})},MS=()=>{const e=Kt();return c.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),t.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),t.jsx(ia,{to:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},PS=()=>{const{access_level:e,hasPremiumFeatures:s,createSubscription:r,testRole:a,isTestingMode:n}=Xe(),{toast:o}=pe();return(n?a:e)==="admin"||(n?a==="paid_user"||a==="admin":s)?t.jsx(_n,{}):t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{$u({current_tier:"free",limit_reached:!0},o,r)},className:"ai-voice-button w-8 h-8 p-0 rounded-full bg-ai hover:bg-ai/90 hover:scale-110 transition-all duration-200 opacity-50",title:"AI Voice Assistant (Premium Feature)",children:t.jsx(Vs,{className:"w-4 h-4 text-white"})})},DS=({isOpen:e,onClose:s,onComplete:r,requiredFor:a="this feature"})=>{const{profile:n,updateProfile:o,loading:i}=Te(),{toast:l}=pe(),[d,f]=c.useState({weight:n?.weight||"",height:n?.height||"",age:n?.age||""}),u=(h,p)=>{f(g=>({...g,[h]:p}))},m=async h=>{if(h.preventDefault(),!d.weight||!d.height||!d.age){l({title:"Missing Information",description:"Please fill in all fields to continue.",variant:"destructive"});return}const{error:p}=await o({weight:Number(d.weight),height:Number(d.height),age:Number(d.age)});p?l({title:"Error",description:"Failed to save profile information.",variant:"destructive"}):(l({title:"Profile Updated",description:"Your profile information has been saved."}),r())};return t.jsx(ea,{open:e,onOpenChange:s,children:t.jsxs(gr,{className:"sm:max-w-[425px]",children:[t.jsxs(Pn,{children:[t.jsx(xr,{children:"Complete Your Profile"}),t.jsxs(Ya,{children:["We need some basic information to enable ",a,". This helps us provide accurate calculations."]})]}),t.jsxs("form",{onSubmit:m,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"weight",children:"Weight (lbs)"}),t.jsx(ge,{id:"weight",type:"number",value:d.weight,onChange:h=>u("weight",h.target.value),placeholder:"Enter your weight",min:"50",max:"500"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"height",children:"Height (inches)"}),t.jsx(ge,{id:"height",type:"number",value:d.height,onChange:h=>u("height",h.target.value),placeholder:"Enter your height",min:"36",max:"96"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"age",children:"Age (years)"}),t.jsx(ge,{id:"age",type:"number",value:d.age,onChange:h=>u("age",h.target.value),placeholder:"Enter your age",min:"13",max:"120"})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsx(A,{type:"button",variant:"outline",onClick:s,className:"flex-1",children:"Skip for Now"}),t.jsx(A,{type:"submit",disabled:i,className:"flex-1",children:i?"Saving...":"Save & Continue"})]})]})]})})};function Lt(e){const s=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&s==="[object Date]"?new e.constructor(+e):typeof e=="number"||s==="[object Number]"||typeof e=="string"||s==="[object String]"?new Date(e):new Date(NaN)}function Ws(e,s){return e instanceof Date?new e.constructor(s):new Date(s)}const Pf=6048e5,AS=864e5,Df=6e4,Af=36e5;let RS={};function Fn(){return RS}function sa(e,s){const r=Fn(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=Lt(e),o=n.getDay(),i=(o<a?7:0)+o-a;return n.setDate(n.getDate()-i),n.setHours(0,0,0,0),n}function en(e){return sa(e,{weekStartsOn:1})}function Rf(e){const s=Lt(e),r=s.getFullYear(),a=Ws(e,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=en(a),o=Ws(e,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const i=en(o);return s.getTime()>=n.getTime()?r+1:s.getTime()>=i.getTime()?r:r-1}function ai(e){const s=Lt(e);return s.setHours(0,0,0,0),s}function Rc(e){const s=Lt(e),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+e-+r}function IS(e,s){const r=ai(e),a=ai(s),n=+r-Rc(r),o=+a-Rc(a);return Math.round((n-o)/AS)}function FS(e){const s=Rf(e),r=Ws(e,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),en(r)}function OS(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function LS(e){if(!OS(e)&&typeof e!="number")return!1;const s=Lt(e);return!isNaN(Number(s))}function $S(e){const s=Lt(e);return s.setHours(23,59,59,999),s}function US(e){const s=Lt(e),r=Ws(e,0);return r.setFullYear(s.getFullYear(),0,1),r.setHours(0,0,0,0),r}const zS={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},qS=(e,s,r)=>{let a;const n=zS[e];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function uo(e){return(s={})=>{const r=s.width?String(s.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const WS={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},BS={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},GS={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},VS={date:uo({formats:WS,defaultWidth:"full"}),time:uo({formats:BS,defaultWidth:"full"}),dateTime:uo({formats:GS,defaultWidth:"full"})},HS={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},QS=(e,s,r,a)=>HS[e];function Fr(e){return(s,r)=>{const a=r?.context?String(r.context):"standalone";let n;if(a==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,l=r?.width?String(r.width):i;n=e.formattingValues[l]||e.formattingValues[i]}else{const i=e.defaultWidth,l=r?.width?String(r.width):e.defaultWidth;n=e.values[l]||e.values[i]}const o=e.argumentCallback?e.argumentCallback(s):s;return n[o]}}const KS={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},YS={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},XS={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},JS={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ZS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},e_={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},t_=(e,s)=>{const r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},s_={ordinalNumber:t_,era:Fr({values:KS,defaultWidth:"wide"}),quarter:Fr({values:YS,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Fr({values:XS,defaultWidth:"wide"}),day:Fr({values:JS,defaultWidth:"wide"}),dayPeriod:Fr({values:ZS,defaultWidth:"wide",formattingValues:e_,defaultFormattingWidth:"wide"})};function Or(e){return(s,r={})=>{const a=r.width,n=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],o=s.match(n);if(!o)return null;const i=o[0],l=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],d=Array.isArray(l)?a_(l,m=>m.test(i)):r_(l,m=>m.test(i));let f;f=e.valueCallback?e.valueCallback(d):d,f=r.valueCallback?r.valueCallback(f):f;const u=s.slice(i.length);return{value:f,rest:u}}}function r_(e,s){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&s(e[r]))return r}function a_(e,s){for(let r=0;r<e.length;r++)if(s(e[r]))return r}function n_(e){return(s,r={})=>{const a=s.match(e.matchPattern);if(!a)return null;const n=a[0],o=s.match(e.parsePattern);if(!o)return null;let i=e.valueCallback?e.valueCallback(o[0]):o[0];i=r.valueCallback?r.valueCallback(i):i;const l=s.slice(n.length);return{value:i,rest:l}}}const o_=/^(\d+)(th|st|nd|rd)?/i,i_=/\d+/i,l_={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},c_={any:[/^b/i,/^(a|c)/i]},d_={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},u_={any:[/1/i,/2/i,/3/i,/4/i]},m_={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},h_={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},f_={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},p_={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},g_={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},x_={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},v_={ordinalNumber:n_({matchPattern:o_,parsePattern:i_,valueCallback:e=>parseInt(e,10)}),era:Or({matchPatterns:l_,defaultMatchWidth:"wide",parsePatterns:c_,defaultParseWidth:"any"}),quarter:Or({matchPatterns:d_,defaultMatchWidth:"wide",parsePatterns:u_,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Or({matchPatterns:m_,defaultMatchWidth:"wide",parsePatterns:h_,defaultParseWidth:"any"}),day:Or({matchPatterns:f_,defaultMatchWidth:"wide",parsePatterns:p_,defaultParseWidth:"any"}),dayPeriod:Or({matchPatterns:g_,defaultMatchWidth:"any",parsePatterns:x_,defaultParseWidth:"any"})},y_={code:"en-US",formatDistance:qS,formatLong:VS,formatRelative:QS,localize:s_,match:v_,options:{weekStartsOn:0,firstWeekContainsDate:1}};function w_(e){const s=Lt(e);return IS(s,US(s))+1}function b_(e){const s=Lt(e),r=+en(s)-+FS(s);return Math.round(r/Pf)+1}function If(e,s){const r=Lt(e),a=r.getFullYear(),n=Fn(),o=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=Ws(e,0);i.setFullYear(a+1,0,o),i.setHours(0,0,0,0);const l=sa(i,s),d=Ws(e,0);d.setFullYear(a,0,o),d.setHours(0,0,0,0);const f=sa(d,s);return r.getTime()>=l.getTime()?a+1:r.getTime()>=f.getTime()?a:a-1}function j_(e,s){const r=Fn(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,n=If(e,s),o=Ws(e,0);return o.setFullYear(n,0,a),o.setHours(0,0,0,0),sa(o,s)}function N_(e,s){const r=Lt(e),a=+sa(r,s)-+j_(r,s);return Math.round(a/Pf)+1}function Ce(e,s){const r=e<0?"-":"",a=Math.abs(e).toString().padStart(s,"0");return r+a}const vs={y(e,s){const r=e.getFullYear(),a=r>0?r:1-r;return Ce(s==="yy"?a%100:a,s.length)},M(e,s){const r=e.getMonth();return s==="M"?String(r+1):Ce(r+1,2)},d(e,s){return Ce(e.getDate(),s.length)},a(e,s){const r=e.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,s){return Ce(e.getHours()%12||12,s.length)},H(e,s){return Ce(e.getHours(),s.length)},m(e,s){return Ce(e.getMinutes(),s.length)},s(e,s){return Ce(e.getSeconds(),s.length)},S(e,s){const r=s.length,a=e.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return Ce(n,s.length)}},nr={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ic={G:function(e,s,r){const a=e.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(e,s,r){if(s==="yo"){const a=e.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return vs.y(e,s)},Y:function(e,s,r,a){const n=If(e,a),o=n>0?n:1-n;if(s==="YY"){const i=o%100;return Ce(i,2)}return s==="Yo"?r.ordinalNumber(o,{unit:"year"}):Ce(o,s.length)},R:function(e,s){const r=Rf(e);return Ce(r,s.length)},u:function(e,s){const r=e.getFullYear();return Ce(r,s.length)},Q:function(e,s,r){const a=Math.ceil((e.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return Ce(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,s,r){const a=Math.ceil((e.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return Ce(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,s,r){const a=e.getMonth();switch(s){case"M":case"MM":return vs.M(e,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(e,s,r){const a=e.getMonth();switch(s){case"L":return String(a+1);case"LL":return Ce(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(e,s,r,a){const n=N_(e,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):Ce(n,s.length)},I:function(e,s,r){const a=b_(e);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):Ce(a,s.length)},d:function(e,s,r){return s==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):vs.d(e,s)},D:function(e,s,r){const a=w_(e);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):Ce(a,s.length)},E:function(e,s,r){const a=e.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(e,s,r,a){const n=e.getDay(),o=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(o);case"ee":return Ce(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,s,r,a){const n=e.getDay(),o=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(o);case"cc":return Ce(o,s.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,s,r){const a=e.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return Ce(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(e,s,r){const n=e.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,s,r){const a=e.getHours();let n;switch(a===12?n=nr.noon:a===0?n=nr.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,s,r){const a=e.getHours();let n;switch(a>=17?n=nr.evening:a>=12?n=nr.afternoon:a>=4?n=nr.morning:n=nr.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,s,r){if(s==="ho"){let a=e.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return vs.h(e,s)},H:function(e,s,r){return s==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):vs.H(e,s)},K:function(e,s,r){const a=e.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):Ce(a,s.length)},k:function(e,s,r){let a=e.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):Ce(a,s.length)},m:function(e,s,r){return s==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):vs.m(e,s)},s:function(e,s,r){return s==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):vs.s(e,s)},S:function(e,s){return vs.S(e,s)},X:function(e,s,r){const a=e.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return Oc(a);case"XXXX":case"XX":return As(a);case"XXXXX":case"XXX":default:return As(a,":")}},x:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"x":return Oc(a);case"xxxx":case"xx":return As(a);case"xxxxx":case"xxx":default:return As(a,":")}},O:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Fc(a,":");case"OOOO":default:return"GMT"+As(a,":")}},z:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Fc(a,":");case"zzzz":default:return"GMT"+As(a,":")}},t:function(e,s,r){const a=Math.trunc(e.getTime()/1e3);return Ce(a,s.length)},T:function(e,s,r){const a=e.getTime();return Ce(a,s.length)}};function Fc(e,s=""){const r=e>0?"-":"+",a=Math.abs(e),n=Math.trunc(a/60),o=a%60;return o===0?r+String(n):r+String(n)+s+Ce(o,2)}function Oc(e,s){return e%60===0?(e>0?"-":"+")+Ce(Math.abs(e)/60,2):As(e,s)}function As(e,s=""){const r=e>0?"-":"+",a=Math.abs(e),n=Ce(Math.trunc(a/60),2),o=Ce(a%60,2);return r+n+s+o}const Lc=(e,s)=>{switch(e){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},Ff=(e,s)=>{switch(e){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},S_=(e,s)=>{const r=e.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return Lc(e,s);let o;switch(a){case"P":o=s.dateTime({width:"short"});break;case"PP":o=s.dateTime({width:"medium"});break;case"PPP":o=s.dateTime({width:"long"});break;case"PPPP":default:o=s.dateTime({width:"full"});break}return o.replace("{{date}}",Lc(a,s)).replace("{{time}}",Ff(n,s))},__={p:Ff,P:S_},C_=/^D+$/,k_=/^Y+$/,E_=["D","DD","YY","YYYY"];function T_(e){return C_.test(e)}function M_(e){return k_.test(e)}function P_(e,s,r){const a=D_(e,s,r);if(console.warn(a),E_.includes(e))throw new RangeError(a)}function D_(e,s,r){const a=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const A_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,R_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,I_=/^'([^]*?)'?$/,F_=/''/g,O_=/[a-zA-Z]/;function mo(e,s,r){const a=Fn(),n=a.locale??y_,o=a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,i=a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=Lt(e);if(!LS(l))throw new RangeError("Invalid time value");let d=s.match(R_).map(u=>{const m=u[0];if(m==="p"||m==="P"){const h=__[m];return h(u,n.formatLong)}return u}).join("").match(A_).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const m=u[0];if(m==="'")return{isToken:!1,value:L_(u)};if(Ic[m])return{isToken:!0,value:u};if(m.match(O_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:u}});n.localize.preprocessor&&(d=n.localize.preprocessor(l,d));const f={firstWeekContainsDate:o,weekStartsOn:i,locale:n};return d.map(u=>{if(!u.isToken)return u.value;const m=u.value;(M_(m)||T_(m))&&P_(m,s,String(e));const h=Ic[m[0]];return h(l,m,n.localize,f)}).join("")}function L_(e){const s=e.match(I_);return s?s[1].replace(F_,"'"):e}function ho(e,s){const a=q_(e);let n;if(a.date){const d=W_(a.date,2);n=B_(d.restDateString,d.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const o=n.getTime();let i=0,l;if(a.time&&(i=G_(a.time),isNaN(i)))return new Date(NaN);if(a.timezone){if(l=V_(a.timezone),isNaN(l))return new Date(NaN)}else{const d=new Date(o+i),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(o+i+l)}const Ca={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},$_=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,U_=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,z_=/^([+-])(\d{2})(?::?(\d{2}))?$/;function q_(e){const s={},r=e.split(Ca.dateTimeDelimiter);let a;if(r.length>2)return s;if(/:/.test(r[0])?a=r[0]:(s.date=r[0],a=r[1],Ca.timeZoneDelimiter.test(s.date)&&(s.date=e.split(Ca.timeZoneDelimiter)[0],a=e.substr(s.date.length,e.length))),a){const n=Ca.timezone.exec(a);n?(s.time=a.replace(n[1],""),s.timezone=n[1]):s.time=a}return s}function W_(e,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};const n=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?n:o*100,restDateString:e.slice((a[1]||a[2]).length)}}function B_(e,s){if(s===null)return new Date(NaN);const r=e.match($_);if(!r)return new Date(NaN);const a=!!r[4],n=Lr(r[1]),o=Lr(r[2])-1,i=Lr(r[3]),l=Lr(r[4]),d=Lr(r[5])-1;if(a)return X_(s,l,d)?H_(s,l,d):new Date(NaN);{const f=new Date(0);return!K_(s,o,i)||!Y_(s,n)?new Date(NaN):(f.setUTCFullYear(s,o,Math.max(n,i)),f)}}function Lr(e){return e?parseInt(e):1}function G_(e){const s=e.match(U_);if(!s)return NaN;const r=fo(s[1]),a=fo(s[2]),n=fo(s[3]);return J_(r,a,n)?r*Af+a*Df+n*1e3:NaN}function fo(e){return e&&parseFloat(e.replace(",","."))||0}function V_(e){if(e==="Z")return 0;const s=e.match(z_);if(!s)return 0;const r=s[1]==="+"?-1:1,a=parseInt(s[2]),n=s[3]&&parseInt(s[3])||0;return Z_(a,n)?r*(a*Af+n*Df):NaN}function H_(e,s,r){const a=new Date(0);a.setUTCFullYear(e,0,4);const n=a.getUTCDay()||7,o=(s-1)*7+r+1-n;return a.setUTCDate(a.getUTCDate()+o),a}const Q_=[31,null,31,30,31,30,31,31,30,31,30,31];function Of(e){return e%400===0||e%4===0&&e%100!==0}function K_(e,s,r){return s>=0&&s<=11&&r>=1&&r<=(Q_[s]||(Of(e)?29:28))}function Y_(e,s){return s>=1&&s<=(Of(e)?366:365)}function X_(e,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function J_(e,s,r){return e===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&e>=0&&e<25}function Z_(e,s){return s>=0&&s<=59}const Lf=({session:e,isOpen:s,onClose:r,onSessionEdited:a})=>{const{toast:n}=pe(),o=Ct(),{user:i}=Ks(),l=j=>{const N=ho(j);return new Date(N.getTime()-N.getTimezoneOffset()*6e4).toISOString().slice(0,16)},[d,f]=c.useState(e.start_time?l(e.start_time):""),[u,m]=c.useState(e.end_time?l(e.end_time):""),[h,p]=c.useState(""),[g,x]=c.useState(!1),v=()=>{if(!d||!u)return 0;const j=new Date(d),N=new Date(u);return Math.round((N.getTime()-j.getTime())/(1e3*60))},w=async()=>{if(!i||!d||!u){n({title:"Invalid Input",description:"Please fill in both start and end times.",variant:"destructive"});return}const j=new Date(d),N=new Date(u);if(N<=j){n({title:"Invalid Time Range",description:"End time must be after start time.",variant:"destructive"});return}const E=v();if(E<=0||E>1440){n({title:"Invalid Duration",description:"Duration must be between 1 minute and 24 hours.",variant:"destructive"});return}x(!0);try{const S=e.is_edited?e.duration_minutes:Math.round((ho(e.end_time).getTime()-ho(e.start_time).getTime())/6e4),{error:_}=await P.from("walking_sessions").update({start_time:j.toISOString(),end_time:N.toISOString(),is_edited:!0,original_duration_minutes:e.is_edited?e.duration_minutes:S,edit_reason:h||null,calories_burned:null,distance:null,estimated_steps:null,updated_at:new Date().toISOString()}).eq("id",e.id).eq("user_id",i.id);if(_)throw _;o.invalidateQueries({queryKey:["walking-sessions"]}),o.invalidateQueries({queryKey:["daily-deficit"]}),o.invalidateQueries({queryKey:["walking-calories"]}),n({title:"Session Updated",description:"Walking session time has been updated. Calculated data has been removed."}),a(),r()}catch(S){console.error("Error updating session:",S),n({title:"Update Failed",description:"Failed to update walking session.",variant:"destructive"})}finally{x(!1)}},y=v(),b=y>0?`${Math.floor(y/60)}h ${y%60}m`:"0m";return t.jsx(ea,{open:s,onOpenChange:r,children:t.jsxs(gr,{className:"sm:max-w-md",children:[t.jsx(Pn,{children:t.jsxs(xr,{className:"flex items-center gap-2",children:[t.jsx(Vt,{className:"w-5 h-5"}),"Edit Walking Time"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Zt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Editing will remove calculated data"}),t.jsx("p",{children:"Calories, distance, and steps will be nulled out and excluded from deficit calculations."})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"start-time",children:"Start Time"}),t.jsx(ge,{id:"start-time",type:"datetime-local",value:d,onChange:j=>f(j.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"end-time",children:"End Time"}),t.jsx(ge,{id:"end-time",type:"datetime-local",value:u,onChange:j=>m(j.target.value)})]})]}),y>0&&t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsx("strong",{children:"New Duration:"})," ",b]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"edit-reason",children:"Edit Reason (Optional)"}),t.jsx(_r,{id:"edit-reason",placeholder:"e.g., Forgot to stop timer",value:h,onChange:j=>p(j.target.value),rows:2})]})]}),t.jsxs(xh,{children:[t.jsx(A,{variant:"outline",onClick:r,children:"Cancel"}),t.jsx(A,{onClick:w,disabled:g||!d||!u,children:g?"Saving...":"Save"})]})]})})},eC=({onClose:e})=>{const[s,r]=c.useState([]),[a,n]=c.useState(!0),[o,i]=c.useState(!1),[l,d]=c.useState(null),[f,u]=c.useState(!1),[m,h]=c.useState(new Set),[p,g]=c.useState(null),{user:x}=Se(),{toast:v}=pe(),{refreshTrigger:w}=Js(),{profile:y}=Te();c.useEffect(()=>{(async()=>{if(x){n(!0);try{const T=o?50:5,{data:D,error:W}=await P.from("walking_sessions").select("id, start_time, end_time, calories_burned, distance, speed_mph, estimated_steps, status, is_edited, original_duration_minutes, edit_reason").eq("user_id",x.id).eq("status","completed").is("deleted_at",null).order("created_at",{ascending:!1}).limit(T);if(W)throw W;if(r(D||[]),o)u(!1);else{const{count:$}=await P.from("walking_sessions").select("*",{count:"exact",head:!0}).eq("user_id",x.id).eq("status","completed").is("deleted_at",null);u(($||0)>5)}}catch(T){console.error("Error fetching walking sessions:",T)}finally{n(!1)}}})()},[x,o,w]);const b=async k=>{if(x){d(k);try{const{error:T}=await P.from("walking_sessions").delete().eq("id",k).eq("user_id",x.id);if(T)throw T;r(D=>D.filter(W=>W.id!==k)),v({title:"Session deleted",description:"Walking session has been permanently deleted."})}catch(T){console.error("Error deleting session:",T),v({title:"Error",description:"Failed to delete walking session. Please try again.",variant:"destructive"})}finally{d(null)}}},j=async()=>{try{const{error:k}=await P.from("walking_sessions").delete().eq("user_id",x?.id).eq("status","completed");if(k)throw k;r([]),u(!1),v({title:"History deleted",description:"All completed walking sessions have been deleted"})}catch(k){console.error("Error deleting all history:",k),v({title:"Error",description:"Failed to delete walking history",variant:"destructive"})}},N=(k,T)=>{const D=new Date(k),$=new Date(T).getTime()-D.getTime();return Math.floor($/(1e3*60))},E=k=>{const T=Math.floor(k/60),D=k%60;return T>0?`${T}h ${D}m`:`${D}m`},S=s.reduce((k,T)=>{const D=mo(new Date(T.start_time),"yyyy-MM-dd");return k[D]||(k[D]=[]),k[D].push(T),k},{});re.useEffect(()=>{const k=Object.keys(S);h(new Set(k))},[s.length]);const _=k=>{h(T=>{const D=new Set(T);return D.has(k)?D.delete(k):D.add(k),D})},C=s.filter(k=>k.status==="completed");return C.length,C.reduce((k,T)=>k+(T.distance||0),0),C.reduce((k,T)=>k+(T.calories_burned||0),0),C.reduce((k,T)=>k+N(T.start_time,T.end_time),0),t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(ie,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:k=>k.stopPropagation(),children:[t.jsx(pt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(us,{className:"text-lg font-semibold",children:"Walking History"}),t.jsxs("div",{className:"flex gap-2",children:[s.length>0&&t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(We,{className:"w-4 h-4"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete All Walking History"}),t.jsx(Qe,{children:"Are you sure you want to delete ALL walking history? This will permanently remove all completed sessions. This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:j,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]})]})}),t.jsxs($e,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:[a?t.jsx("div",{className:"space-y-3",children:[...Array(3)].map((k,T)=>t.jsxs(ie,{className:"p-4 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]},T))}):s.length===0?t.jsxs(ie,{className:"p-6 text-center",children:[t.jsx(Tl,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),t.jsx("p",{className:"text-muted-foreground",children:"No walking sessions yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Start your first walk to see your progress here!"})]}):t.jsx("div",{className:"space-y-4",children:Object.entries(S).sort(([k],[T])=>new Date(T).getTime()-new Date(k).getTime()).map(([k,T])=>{const D=m.has(k),W=mo(new Date(k),"MMM d, yyyy");return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-muted/20 rounded-lg cursor-pointer hover:bg-muted/30 transition-colors border-0",onClick:()=>_(k),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ln,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"font-medium text-sm",children:W}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",T.length," session",T.length>1?"s":"",")"]})]}),t.jsx(Nt,{className:`w-4 h-4 text-muted-foreground transition-transform ${D?"":"rotate-180"}`})]}),!D&&t.jsx("div",{className:"space-y-2 ml-4",children:T.map($=>{const X=N($.start_time,$.end_time),V=new Date($.start_time);return t.jsxs(ie,{className:"relative bg-muted/20 border-0",children:[t.jsx(pt,{className:"pb-4",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h3",{className:"font-medium text-sm",children:mo(V,"h:mm a")})}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mt-2",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Vt,{className:"w-3 h-3"}),E(X),$.is_edited&&t.jsx("span",{className:"text-xs text-muted-foreground/70 ml-1",children:"(Edited)"})]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Tl,{className:"w-3 h-3 text-green-500"}),$.is_edited?"N/A":Zr($.distance||0,y?.units||"imperial")]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Aa,{className:"w-3 h-3 text-orange-500"}),$.is_edited?"N/A":`${$.calories_burned||0} cal`]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(dn,{className:"w-3 h-3 text-purple-500"}),$.is_edited?"N/A":`${$.estimated_steps?.toLocaleString()||"N/A"} steps`]})]})]})})}),t.jsxs("div",{className:"absolute top-3 right-3 flex gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>g($),children:t.jsx(ut,{className:"w-3 h-3"})}),t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10 hover:text-destructive",disabled:l===$.id,children:t.jsx(We,{className:"w-3 h-3"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Walking Session"}),t.jsxs(Qe,{children:["Are you sure you want to delete this walking session from ",W,"? This action cannot be undone."]})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>b($.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]}),$.is_edited&&$.edit_reason&&t.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:[t.jsx("span",{className:"font-medium",children:"Edit reason:"})," ",$.edit_reason]})]},$.id)})})]},k)})}),(f||o)&&s.length>0&&t.jsx("div",{className:"flex justify-center",children:t.jsx(A,{variant:"outline",onClick:()=>i(!o),className:"w-full",disabled:a,children:o?t.jsxs(t.Fragment,{children:[t.jsx(xi,{className:"w-4 h-4 mr-2"}),"Show Less"]}):t.jsxs(t.Fragment,{children:[t.jsx(Nt,{className:"w-4 h-4 mr-2"}),"Load More (",f?"more available":"no more",")"]})})})]}),p&&t.jsx(Lf,{session:p,isOpen:!!p,onClose:()=>g(null),onSessionEdited:()=>{n(!0),(async()=>{if(x)try{const T=o?50:5,{data:D,error:W}=await P.from("walking_sessions").select("id, start_time, end_time, calories_burned, distance, speed_mph, estimated_steps, status, is_edited, original_duration_minutes, edit_reason").eq("user_id",x.id).eq("status","completed").is("deleted_at",null).order("created_at",{ascending:!1}).limit(T);if(W)throw W;r(D||[])}catch(T){console.error("Error refreshing sessions:",T)}finally{n(!1)}})()}})]})})},$c=({open:e,onOpenChange:s,onConfirm:r,onManualDurationConfirm:a,currentDuration:n,durationMinutes:o=0,calories:i,distance:l,units:d="imperial",actionType:f="finish"})=>{const[u,m]=c.useState(!1),[h,p]=c.useState(""),g=()=>{s(!1),m(!1),p("")},x=()=>{const y=parseInt(h);y>0&&a&&(a(y),g())},v=o>=120,w=f==="finish"&&v&&!u;return t.jsx(mt,{isOpen:e,onClose:g,title:u?"Correct Walking Duration":f==="cancel"?"Cancel Walking Session?":"Finish Walking Session?",size:"sm",showCloseButton:!0,footer:u?t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:()=>m(!1),className:"w-full h-10",size:"default",children:"Back"}),t.jsx(A,{variant:"action-primary",onClick:x,disabled:!h||parseInt(h)<=0,className:"w-full h-10",size:"default",children:"Save"})]}):t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:g,className:"w-full h-10",size:"default",children:"Close"}),w&&t.jsx(A,{variant:"outline",onClick:()=>m(!0),className:"w-full h-10",size:"default",children:"Edit"}),t.jsx(A,{variant:"action-primary",onClick:r,className:"w-full h-10",size:"default",children:f==="cancel"?"Cancel Session":"Finish Session"})]}),children:t.jsx("div",{className:"space-y-4",children:u?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Zt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Manual duration correction"}),t.jsx("p",{children:"Enter how long you actually walked. Calculated data (calories, distance, steps) will be removed."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"manual-duration",children:"Walking Duration (minutes)"}),t.jsx(ge,{id:"manual-duration",type:"number",placeholder:"e.g., 30",value:h,onChange:y=>p(y.target.value),min:"1",max:"1440"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm leading-relaxed text-muted-foreground",children:["You've been walking for ",t.jsx("span",{className:"font-medium text-foreground",children:n||"0:00:00"}),"."]}),w&&t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Zt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Long session detected"}),t.jsx("p",{children:"Did you forget to stop the timer? You can edit the duration if needed."})]})]}),i&&l&&t.jsxs("div",{className:"space-y-2 text-xs bg-muted/50 rounded-lg p-3 border border-border",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Calories:"}),t.jsx("span",{className:"font-medium",children:i})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Distance:"}),t.jsx("span",{className:"font-medium",children:Zr(l,d)})]})]}),t.jsx("div",{className:"text-xs text-muted-foreground font-medium bg-muted/30 rounded-lg p-3 border border-border",children:f==="cancel"?"This will remove your session from history completely.":"This will save your walking progress to history."})]})})})},$f=c.createContext(void 0),tC=({children:e})=>{const[s,r]=c.useState({calories:0,distance:0,pace:"",startTime:"",fatBurned:0}),a=Js(),n=a?.currentSession||null,o=a?.selectedSpeed||3;c.useEffect(()=>{if(!n||n.status!=="active"){r({calories:0,distance:0,pace:"",startTime:"",fatBurned:0});return}const l=()=>{const f=new Date,u=new Date(n.start_time),m=(f.getTime()-u.getTime())/(1e3*60),h=n.total_pause_duration?n.total_pause_duration/60:0,p=m-h;if(p<=0)return;const g=Math.max(3,o*1.2),x=Math.round(p*g),v=p/60*o,w=o>0?60/o:0,y=Math.floor(w),b=Math.round((w-y)*60),j=`${y}:${b.toString().padStart(2,"0")}/mi`,N=u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),E=Math.round(x*.2);r({calories:x,distance:parseFloat(v.toFixed(2)),pace:j,startTime:N,fatBurned:E})};l();const d=setInterval(l,3e4);return()=>{clearInterval(d)}},[n,o]);const i=c.useMemo(()=>({walkingStats:s}),[s]);return t.jsx($f.Provider,{value:i,children:e})},sC=()=>{const e=c.useContext($f);return e===void 0?{walkingStats:{calories:0,distance:0,pace:"",startTime:"",fatBurned:0}}:e},rC=()=>{const[e,s]=c.useState(!1),[r,a]=c.useState(0),n=c.useRef(!0),o=c.useCallback(async()=>{const u=await Rj();n.current&&a(u)},[]);c.useEffect(()=>{n.current=!0,o();const u=()=>o();return window.addEventListener("outbox:changed",u),()=>{n.current=!1,window.removeEventListener("outbox:changed",u)}},[o]);const i=c.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,g=async x=>await ao(x);if(m==="start"){const{local_id:x,start_time:v,speed_mph:w,total_pause_duration:y,session_state:b,status:j}=h,{data:N,error:E}=await P.from("walking_sessions").insert({user_id:p,start_time:v,status:j??"active",session_state:b??"active",total_pause_duration:y??0,speed_mph:w}).select().single();if(E)throw E;x&&N?.id&&await ro(x,N.id);return}if(m==="pause"){const x=await g(h.session_id),v=h.pause_start_time??new Date().toISOString(),{error:w}=await P.from("walking_sessions").update({session_state:"paused",pause_start_time:v}).eq("id",x);if(w)throw w;return}if(m==="resume"){const x=await g(h.session_id),v=h.pause_duration_seconds??0,{data:w,error:y}=await P.from("walking_sessions").select("total_pause_duration").eq("id",x).single();if(y)throw y;const b=(w?.total_pause_duration??0)+v,{error:j}=await P.from("walking_sessions").update({session_state:"active",pause_start_time:null,total_pause_duration:b}).eq("id",x);if(j)throw j;return}if(m==="update_speed"){const x=await g(h.session_id),{error:v}=await P.from("walking_sessions").update({speed_mph:h.speed_mph}).eq("id",x);if(v)throw v;return}if(m==="end"){const x=await g(h.session_id),v=h.updateData,{error:w}=await P.from("walking_sessions").update(v).eq("id",x);if(w)throw w;return}if(m==="cancel"){const x=await g(h.session_id),{error:v}=await P.from("walking_sessions").delete().eq("id",x);if(v)throw v;return}},[]),l=c.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,g=async x=>await ao(x);if(m==="start"){await P.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",p).eq("status","active");const{local_id:x,start_time:v,goal_duration_seconds:w}=h,{data:y,error:b}=await P.from("fasting_sessions").insert({user_id:p,start_time:v,goal_duration_seconds:w,status:"active"}).select().single();if(b)throw b;x&&y?.id&&await ro(x,y.id);return}if(m==="end"){const x=await g(h.session_id),{end_time:v,duration_seconds:w,status:y}=h,{error:b}=await P.from("fasting_sessions").update({end_time:v,duration_seconds:w,status:y}).eq("id",x);if(b)throw b;return}if(m==="cancel"){const x=await g(h.session_id),{error:v}=await P.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("id",x);if(v)throw v;return}},[]),d=c.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,g=async x=>await ao(x);if(m==="create"){const{local_id:x,name:v,calories:w,carbs:y,serving_size:b,consumed:j,image_url:N}=h,{data:E,error:S}=await P.from("food_entries").insert({user_id:p,name:v,calories:w,carbs:y,serving_size:b,consumed:j??!0,image_url:N}).select().single();if(S)throw S;x&&E?.id&&await ro(x,E.id);return}if(m==="update"){const x=await g(h.entry_id),{updates:v}=h,{error:w}=await P.from("food_entries").update(v).eq("id",x).eq("user_id",p);if(w)throw w;return}if(m==="delete"){const x=await g(h.entry_id),{error:v}=await P.from("food_entries").delete().eq("id",x).eq("user_id",p);if(v)throw v;return}if(m==="toggle_consumed"){const x=await g(h.entry_id),{consumed:v}=h,{error:w}=await P.from("food_entries").update({consumed:v}).eq("id",x).eq("user_id",p);if(w)throw w;return}},[]),f=c.useCallback(async()=>{if(!e&&!(typeof navigator<"u"&&!navigator.onLine)){s(!0),Ha("sync-start");try{const u=await rm();for(const m of u)try{m.entity==="walking_session"?await i(m):m.entity==="fasting_session"?await l(m):m.entity==="food_entry"&&await d(m),await Aj(m.id)}catch(h){m.attempts=(m.attempts??0)+1,m.lastError=h?.message??String(h),await Dj(m);break}}finally{s(!1),Ha("sync-complete"),o()}}},[e,i,l,d,o]);return c.useEffect(()=>{const u=()=>f(),m=()=>{document.hidden||f()};return window.addEventListener("online",u),document.addEventListener("visibilitychange",m),f(),()=>{window.removeEventListener("online",u),document.removeEventListener("visibilitychange",m)}},[f]),{isSyncing:e,pending:r,triggerSync:f}},aC=({className:e})=>{const{isSyncing:s,pending:r,triggerSync:a}=rC(),[n,o]=c.useState(!1),[i,l]=c.useState([]);if(c.useEffect(()=>{o(s||r>0),r>0&&rm().then(l)},[s,r]),!n||r===0)return null;const d=u=>{switch(u){case"walking_session":return t.jsx(Ex,{className:"w-3 h-3"});case"fasting_session":return t.jsx(Vt,{className:"w-3 h-3"});case"food_entry":return t.jsx(is,{className:"w-3 h-3"});default:return t.jsx(El,{className:"w-3 h-3"})}},f=i.reduce((u,m)=>(u[m.entity]=(u[m.entity]||0)+1,u),{});return t.jsxs("div",{className:Z("flex items-center gap-2",e),children:[t.jsxs("div",{className:Z("text-xs text-muted-foreground flex items-center gap-1"),title:s?"Syncing changes...":`${r} change(s) pending sync`,children:[t.jsx(El,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:s?"Syncingâ€¦":`${r} pending`})]}),Object.keys(f).length>1&&t.jsx("div",{className:"flex items-center gap-1",children:Object.entries(f).map(([u,m])=>t.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-muted-foreground",children:[d(u),t.jsx("span",{children:m})]},u))}),t.jsxs(A,{size:"sm",variant:"outline",onClick:a,disabled:s,children:[t.jsx(At,{className:"w-3.5 h-3.5 mr-1"}),"Sync"]})]})},nC=()=>{const[e,s]=c.useState(!1),[r,a]=c.useState(!1),[n,o]=c.useState(!1),[i,l]=c.useState(!1),[d,f]=c.useState(!1),[u,m]=c.useState(0),{toast:h}=pe(),{currentSession:p,loading:g,selectedSpeed:x,updateSelectedSpeed:v,isPaused:w,startWalkingSession:y,pauseWalkingSession:b,resumeWalkingSession:j,endWalkingSession:N,cancelWalkingSession:E,updateSessionSpeed:S}=Js(),{profile:_}=Te(),{walkingStats:C}=sC(),{quotes:k}=Wh(),{saveQuoteAsGoal:T}=Zs(),D=!!p;c.useEffect(()=>{let Y;if(p&&!w){const oe=()=>{const O=Date.now(),Q=new Date(p.start_time).getTime(),R=(p.total_pause_duration||0)*1e3,M=Math.floor((O-Q-R)/1e3);m(Math.max(0,M))};oe(),Y=setInterval(oe,1e3)}else p||m(0);return()=>{Y&&clearInterval(Y)}},[p,w]);const W=async()=>{try{await y(x),h({title:"Walking session started",description:"Good luck on your walk!"}),Ir("start",x)}catch(Y){console.error("Failed to start walking session:",Y),h({title:"Error",description:"Failed to start walking session. Please try again.",variant:"destructive"})}},$=async()=>{const Y=await b();Y.error?h({variant:"destructive",title:"Error",description:Y.error.message}):Ir("pause",x,u)},X=async()=>{const Y=await j();Y.error?h({variant:"destructive",title:"Error",description:Y.error.message}):Ir("resume",x)},V=async()=>{console.log("Stop walking confirmed - ending session immediately"),a(!1),h({title:"Stopping session...",description:"Saving your walking session data."});const Y=await N();Y.error?h({variant:"destructive",title:"Error",description:Y.error.message}):(Ir("stop",x,u),h({title:"Walking completed!",description:`Great job! You walked for ${te(u)} and burned ${Y.data?.calories_burned||0} calories.`}))},G=async Y=>{console.log("Manual duration confirmed:",Y),a(!1),h({title:"Correcting session...",description:"Saving with manual duration."});const oe=await N(Y);oe.error?h({variant:"destructive",title:"Error",description:oe.error.message}):(Ir("stop",x,Y*60),h({title:"Walking completed!",description:`Session corrected to ${Y} minutes. Calculated data removed for accuracy.`}))},L=()=>{o(!0)},B=async()=>{o(!1);const Y=await E();Y.error?h({variant:"destructive",title:"Error",description:Y.error.message}):h({title:"Session cancelled",description:"Walking session was cancelled and removed from history."})},de=()=>{s(!1),W()},te=Y=>{const oe=Math.floor(Y/3600),O=Math.floor(Y%3600/60),Q=Y%60;return`${oe.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`};return t.jsx("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(PS,{})}),t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx(Ki,{onClick:()=>f(!0),title:"View walking history"})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent mb-1",children:"Walking Timer"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Track your walking session"})]}),p&&t.jsx("div",{className:"mt-2 flex justify-end",children:t.jsx(aC,{})})]}),t.jsx("div",{className:"relative mb-6",children:t.jsx(Qm,{displayTime:te(u),isActive:!!p,isPaused:w,onStart:W,onPause:$,onResume:X,onStop:async()=>{a(!0)},onCancel:async()=>{L()},showSlideshow:_?.enable_walking_slideshow??!1,units:_?.units||"imperial",selectedSpeed:x,onSpeedChange:async Y=>{try{v(Y),D&&(await S(Y)).error&&h({variant:"destructive",title:"Session Update Failed",description:"Speed saved but session update failed. Will sync when online."});const oe=Y>=4?"fast pace":"normal pace";h({title:"Speed Updated",description:`Speed set to ${oe}`})}catch(oe){console.error("Error updating speed:",oe),h({title:"Network Error",description:"Speed will be synced when connection is restored",variant:"destructive"})}},realTimeStats:p?{speed:p.speed_mph||x,distance:C.distance,calories:C.calories,startTime:p.start_time}:void 0})}),t.jsx(zh,{quotes:k.walking_timer_quotes,className:"mt-8",onSaveQuote:T,compact:!0}),t.jsx(DS,{isOpen:e,onComplete:de,onClose:()=>s(!1),requiredFor:"accurate calorie calculation during walking"}),t.jsx($c,{open:r,onOpenChange:a,onConfirm:V,onManualDurationConfirm:G,currentDuration:te(u),durationMinutes:Math.floor(u/60),calories:C.calories,distance:C.distance,units:_?.units||"imperial"}),t.jsx($c,{open:n,onOpenChange:o,onConfirm:B,currentDuration:te(u),calories:C.calories,distance:C.distance,units:_?.units||"imperial",actionType:"cancel"}),d&&t.jsx(eC,{onClose:()=>f(!1)}),t.jsx(ca,{isOpen:i,onClose:()=>l(!1),title:et.walking.title,subtitle:et.walking.subtitle,heroQuote:et.walking.heroQuote,backgroundImage:et.walking.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:et.walking.subtitle})}),et.walking.sections.map((Y,oe)=>{const O=Y.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(O,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:Y.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:Y.description})]})]},oe)})]})})]})})};var ni=["Enter"," "],oC=["ArrowDown","PageUp","Home"],Uf=["ArrowUp","PageDown","End"],iC=[...oC,...Uf],lC={ltr:[...ni,"ArrowRight"],rtl:[...ni,"ArrowLeft"]},cC={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ma="Menu",[ra,dC,uC]=an(ma),[er,zf]=St(ma,[uC,br,kr]),On=br(),qf=kr(),[mC,tr]=er(ma),[hC,ha]=er(ma),Wf=e=>{const{__scopeMenu:s,open:r=!1,children:a,dir:n,onOpenChange:o,modal:i=!0}=e,l=On(s),[d,f]=c.useState(null),u=c.useRef(!1),m=Dt(o),h=Ys(n);return c.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),t.jsx(Ei,{...l,children:t.jsx(mC,{scope:s,open:r,onOpenChange:m,content:d,onContentChange:f,children:t.jsx(hC,{scope:s,onClose:c.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:u,dir:h,modal:i,children:a})})})};Wf.displayName=ma;var fC="MenuAnchor",fl=c.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e,n=On(r);return t.jsx(Ti,{...n,...a,ref:s})});fl.displayName=fC;var pl="MenuPortal",[pC,Bf]=er(pl,{forceMount:void 0}),Gf=e=>{const{__scopeMenu:s,forceMount:r,children:a,container:n}=e,o=tr(pl,s);return t.jsx(pC,{scope:s,forceMount:r,children:t.jsx(_t,{present:r||o.open,children:t.jsx(rd,{asChild:!0,container:n,children:a})})})};Gf.displayName=pl;var It="MenuContent",[gC,gl]=er(It),Vf=c.forwardRef((e,s)=>{const r=Bf(It,e.__scopeMenu),{forceMount:a=r.forceMount,...n}=e,o=tr(It,e.__scopeMenu),i=ha(It,e.__scopeMenu);return t.jsx(ra.Provider,{scope:e.__scopeMenu,children:t.jsx(_t,{present:a||o.open,children:t.jsx(ra.Slot,{scope:e.__scopeMenu,children:i.modal?t.jsx(xC,{...n,ref:s}):t.jsx(vC,{...n,ref:s})})})})}),xC=c.forwardRef((e,s)=>{const r=tr(It,e.__scopeMenu),a=c.useRef(null),n=Ne(s,a);return c.useEffect(()=>{const o=a.current;if(o)return Zc(o)},[]),t.jsx(xl,{...e,ref:n,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:ae(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),vC=c.forwardRef((e,s)=>{const r=tr(It,e.__scopeMenu);return t.jsx(xl,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),xl=c.forwardRef((e,s)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:d,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...x}=e,v=tr(It,r),w=ha(It,r),y=On(r),b=qf(r),j=dC(r),[N,E]=c.useState(null),S=c.useRef(null),_=Ne(s,S,v.onContentChange),C=c.useRef(0),k=c.useRef(""),T=c.useRef(0),D=c.useRef(null),W=c.useRef("right"),$=c.useRef(0),X=g?td:c.Fragment,V=g?{as:ci,allowPinchZoom:!0}:void 0,G=B=>{const de=k.current+B,te=j().filter(M=>!M.disabled),Y=document.activeElement,oe=te.find(M=>M.ref.current===Y)?.textValue,O=te.map(M=>M.textValue),Q=MC(O,de,oe),R=te.find(M=>M.textValue===Q)?.ref.current;(function M(H){k.current=H,window.clearTimeout(C.current),H!==""&&(C.current=window.setTimeout(()=>M(""),1e3))})(de),R&&setTimeout(()=>R.focus())};c.useEffect(()=>()=>window.clearTimeout(C.current),[]),ed();const L=c.useCallback(B=>W.current===D.current?.side&&DC(B,D.current?.area),[]);return t.jsx(gC,{scope:r,searchRef:k,onItemEnter:c.useCallback(B=>{L(B)&&B.preventDefault()},[L]),onItemLeave:c.useCallback(B=>{L(B)||(S.current?.focus(),E(null))},[L]),onTriggerLeave:c.useCallback(B=>{L(B)&&B.preventDefault()},[L]),pointerGraceTimerRef:T,onPointerGraceIntentChange:c.useCallback(B=>{D.current=B},[]),children:t.jsx(X,{...V,children:t.jsx(sd,{asChild:!0,trapped:n,onMountAutoFocus:ae(o,B=>{B.preventDefault(),S.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:t.jsx(li,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,children:t.jsx(sl,{asChild:!0,...b,dir:w.dir,orientation:"vertical",loop:a,currentTabStopId:N,onCurrentTabStopIdChange:E,onEntryFocus:ae(d,B=>{w.isUsingKeyboardRef.current||B.preventDefault()}),preventScrollOnEntryFocus:!0,children:t.jsx(Mi,{role:"menu","aria-orientation":"vertical","data-state":lp(v.open),"data-radix-menu-content":"",dir:w.dir,...y,...x,ref:_,style:{outline:"none",...x.style},onKeyDown:ae(x.onKeyDown,B=>{const te=B.target.closest("[data-radix-menu-content]")===B.currentTarget,Y=B.ctrlKey||B.altKey||B.metaKey,oe=B.key.length===1;te&&(B.key==="Tab"&&B.preventDefault(),!Y&&oe&&G(B.key));const O=S.current;if(B.target!==O||!iC.includes(B.key))return;B.preventDefault();const R=j().filter(M=>!M.disabled).map(M=>M.ref.current);Uf.includes(B.key)&&R.reverse(),EC(R)}),onBlur:ae(e.onBlur,B=>{B.currentTarget.contains(B.target)||(window.clearTimeout(C.current),k.current="")}),onPointerMove:ae(e.onPointerMove,aa(B=>{const de=B.target,te=$.current!==B.clientX;if(B.currentTarget.contains(de)&&te){const Y=B.clientX>$.current?"right":"left";W.current=Y,$.current=B.clientX}}))})})})})})})});Vf.displayName=It;var yC="MenuGroup",vl=c.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(xe.div,{role:"group",...a,ref:s})});vl.displayName=yC;var wC="MenuLabel",Hf=c.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(xe.div,{...a,ref:s})});Hf.displayName=wC;var tn="MenuItem",Uc="menu.itemSelect",Ln=c.forwardRef((e,s)=>{const{disabled:r=!1,onSelect:a,...n}=e,o=c.useRef(null),i=ha(tn,e.__scopeMenu),l=gl(tn,e.__scopeMenu),d=Ne(s,o),f=c.useRef(!1),u=()=>{const m=o.current;if(!r&&m){const h=new CustomEvent(Uc,{bubbles:!0,cancelable:!0});m.addEventListener(Uc,p=>a?.(p),{once:!0}),Kp(m,h),h.defaultPrevented?f.current=!1:i.onClose()}};return t.jsx(Qf,{...n,ref:d,disabled:r,onClick:ae(e.onClick,u),onPointerDown:m=>{e.onPointerDown?.(m),f.current=!0},onPointerUp:ae(e.onPointerUp,m=>{f.current||m.currentTarget?.click()}),onKeyDown:ae(e.onKeyDown,m=>{const h=l.searchRef.current!=="";r||h&&m.key===" "||ni.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Ln.displayName=tn;var Qf=c.forwardRef((e,s)=>{const{__scopeMenu:r,disabled:a=!1,textValue:n,...o}=e,i=gl(tn,r),l=qf(r),d=c.useRef(null),f=Ne(s,d),[u,m]=c.useState(!1),[h,p]=c.useState("");return c.useEffect(()=>{const g=d.current;g&&p((g.textContent??"").trim())},[o.children]),t.jsx(ra.ItemSlot,{scope:r,disabled:a,textValue:n??h,children:t.jsx(rl,{asChild:!0,...l,focusable:!a,children:t.jsx(xe.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...o,ref:f,onPointerMove:ae(e.onPointerMove,aa(g=>{a?i.onItemLeave(g):(i.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ae(e.onPointerLeave,aa(g=>i.onItemLeave(g))),onFocus:ae(e.onFocus,()=>m(!0)),onBlur:ae(e.onBlur,()=>m(!1))})})})}),bC="MenuCheckboxItem",Kf=c.forwardRef((e,s)=>{const{checked:r=!1,onCheckedChange:a,...n}=e;return t.jsx(ep,{scope:e.__scopeMenu,checked:r,children:t.jsx(Ln,{role:"menuitemcheckbox","aria-checked":sn(r)?"mixed":r,...n,ref:s,"data-state":wl(r),onSelect:ae(n.onSelect,()=>a?.(sn(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Kf.displayName=bC;var Yf="MenuRadioGroup",[jC,NC]=er(Yf,{value:void 0,onValueChange:()=>{}}),Xf=c.forwardRef((e,s)=>{const{value:r,onValueChange:a,...n}=e,o=Dt(a);return t.jsx(jC,{scope:e.__scopeMenu,value:r,onValueChange:o,children:t.jsx(vl,{...n,ref:s})})});Xf.displayName=Yf;var Jf="MenuRadioItem",Zf=c.forwardRef((e,s)=>{const{value:r,...a}=e,n=NC(Jf,e.__scopeMenu),o=r===n.value;return t.jsx(ep,{scope:e.__scopeMenu,checked:o,children:t.jsx(Ln,{role:"menuitemradio","aria-checked":o,...a,ref:s,"data-state":wl(o),onSelect:ae(a.onSelect,()=>n.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Zf.displayName=Jf;var yl="MenuItemIndicator",[ep,SC]=er(yl,{checked:!1}),tp=c.forwardRef((e,s)=>{const{__scopeMenu:r,forceMount:a,...n}=e,o=SC(yl,r);return t.jsx(_t,{present:a||sn(o.checked)||o.checked===!0,children:t.jsx(xe.span,{...n,ref:s,"data-state":wl(o.checked)})})});tp.displayName=yl;var _C="MenuSeparator",sp=c.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(xe.div,{role:"separator","aria-orientation":"horizontal",...a,ref:s})});sp.displayName=_C;var CC="MenuArrow",rp=c.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e,n=On(r);return t.jsx(Pi,{...n,...a,ref:s})});rp.displayName=CC;var kC="MenuSub",[K2,ap]=er(kC),zr="MenuSubTrigger",np=c.forwardRef((e,s)=>{const r=tr(zr,e.__scopeMenu),a=ha(zr,e.__scopeMenu),n=ap(zr,e.__scopeMenu),o=gl(zr,e.__scopeMenu),i=c.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:d}=o,f={__scopeMenu:e.__scopeMenu},u=c.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return c.useEffect(()=>u,[u]),c.useEffect(()=>{const m=l.current;return()=>{window.clearTimeout(m),d(null)}},[l,d]),t.jsx(fl,{asChild:!0,...f,children:t.jsx(Qf,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":n.contentId,"data-state":lp(r.open),...e,ref:ld(s,n.onTriggerChange),onClick:m=>{e.onClick?.(m),!(e.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:ae(e.onPointerMove,aa(m=>{o.onItemEnter(m),!m.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:ae(e.onPointerLeave,aa(m=>{u();const h=r.content?.getBoundingClientRect();if(h){const p=r.content?.dataset.side,g=p==="right",x=g?-5:5,v=h[g?"left":"right"],w=h[g?"right":"left"];o.onPointerGraceIntentChange({area:[{x:m.clientX+x,y:m.clientY},{x:v,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x:v,y:h.bottom}],side:p}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(m),m.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:ae(e.onKeyDown,m=>{const h=o.searchRef.current!=="";e.disabled||h&&m.key===" "||lC[a.dir].includes(m.key)&&(r.onOpenChange(!0),r.content?.focus(),m.preventDefault())})})})});np.displayName=zr;var op="MenuSubContent",ip=c.forwardRef((e,s)=>{const r=Bf(It,e.__scopeMenu),{forceMount:a=r.forceMount,...n}=e,o=tr(It,e.__scopeMenu),i=ha(It,e.__scopeMenu),l=ap(op,e.__scopeMenu),d=c.useRef(null),f=Ne(s,d);return t.jsx(ra.Provider,{scope:e.__scopeMenu,children:t.jsx(_t,{present:a||o.open,children:t.jsx(ra.Slot,{scope:e.__scopeMenu,children:t.jsx(xl,{id:l.contentId,"aria-labelledby":l.triggerId,...n,ref:f,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{i.isUsingKeyboardRef.current&&d.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:ae(e.onFocusOutside,u=>{u.target!==l.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:ae(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:ae(e.onKeyDown,u=>{const m=u.currentTarget.contains(u.target),h=cC[i.dir].includes(u.key);m&&h&&(o.onOpenChange(!1),l.trigger?.focus(),u.preventDefault())})})})})})});ip.displayName=op;function lp(e){return e?"open":"closed"}function sn(e){return e==="indeterminate"}function wl(e){return sn(e)?"indeterminate":e?"checked":"unchecked"}function EC(e){const s=document.activeElement;for(const r of e)if(r===s||(r.focus(),document.activeElement!==s))return}function TC(e,s){return e.map((r,a)=>e[(s+a)%e.length])}function MC(e,s,r){const n=s.length>1&&Array.from(s).every(f=>f===s[0])?s[0]:s,o=r?e.indexOf(r):-1;let i=TC(e,Math.max(o,0));n.length===1&&(i=i.filter(f=>f!==r));const d=i.find(f=>f.toLowerCase().startsWith(n.toLowerCase()));return d!==r?d:void 0}function PC(e,s){const{x:r,y:a}=e;let n=!1;for(let o=0,i=s.length-1;o<s.length;i=o++){const l=s[o].x,d=s[o].y,f=s[i].x,u=s[i].y;d>a!=u>a&&r<(f-l)*(a-d)/(u-d)+l&&(n=!n)}return n}function DC(e,s){if(!s)return!1;const r={x:e.clientX,y:e.clientY};return PC(r,s)}function aa(e){return s=>s.pointerType==="mouse"?e(s):void 0}var AC=Wf,RC=fl,IC=Gf,FC=Vf,OC=vl,LC=Hf,$C=Ln,UC=Kf,zC=Xf,qC=Zf,WC=tp,BC=sp,GC=rp,VC=np,HC=ip,bl="DropdownMenu",[QC,Y2]=St(bl,[zf]),ht=zf(),[KC,cp]=QC(bl),dp=e=>{const{__scopeDropdownMenu:s,children:r,dir:a,open:n,defaultOpen:o,onOpenChange:i,modal:l=!0}=e,d=ht(s),f=c.useRef(null),[u=!1,m]=Gt({prop:n,defaultProp:o,onChange:i});return t.jsx(KC,{scope:s,triggerId:ls(),triggerRef:f,contentId:ls(),open:u,onOpenChange:m,onOpenToggle:c.useCallback(()=>m(h=>!h),[m]),modal:l,children:t.jsx(AC,{...d,open:u,onOpenChange:m,dir:a,modal:l,children:r})})};dp.displayName=bl;var up="DropdownMenuTrigger",mp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...n}=e,o=cp(up,r),i=ht(r);return t.jsx(RC,{asChild:!0,...i,children:t.jsx(xe.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:ld(s,o.triggerRef),onPointerDown:ae(e.onPointerDown,l=>{!a&&l.button===0&&l.ctrlKey===!1&&(o.onOpenToggle(),o.open||l.preventDefault())}),onKeyDown:ae(e.onKeyDown,l=>{a||(["Enter"," "].includes(l.key)&&o.onOpenToggle(),l.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});mp.displayName=up;var YC="DropdownMenuPortal",hp=e=>{const{__scopeDropdownMenu:s,...r}=e,a=ht(s);return t.jsx(IC,{...a,...r})};hp.displayName=YC;var fp="DropdownMenuContent",pp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=cp(fp,r),o=ht(r),i=c.useRef(!1);return t.jsx(FC,{id:n.contentId,"aria-labelledby":n.triggerId,...o,...a,ref:s,onCloseAutoFocus:ae(e.onCloseAutoFocus,l=>{i.current||n.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:ae(e.onInteractOutside,l=>{const d=l.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,u=d.button===2||f;(!n.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});pp.displayName=fp;var XC="DropdownMenuGroup",JC=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(OC,{...n,...a,ref:s})});JC.displayName=XC;var ZC="DropdownMenuLabel",gp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(LC,{...n,...a,ref:s})});gp.displayName=ZC;var ek="DropdownMenuItem",xp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx($C,{...n,...a,ref:s})});xp.displayName=ek;var tk="DropdownMenuCheckboxItem",vp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(UC,{...n,...a,ref:s})});vp.displayName=tk;var sk="DropdownMenuRadioGroup",rk=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(zC,{...n,...a,ref:s})});rk.displayName=sk;var ak="DropdownMenuRadioItem",yp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(qC,{...n,...a,ref:s})});yp.displayName=ak;var nk="DropdownMenuItemIndicator",wp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(WC,{...n,...a,ref:s})});wp.displayName=nk;var ok="DropdownMenuSeparator",bp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(BC,{...n,...a,ref:s})});bp.displayName=ok;var ik="DropdownMenuArrow",lk=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(GC,{...n,...a,ref:s})});lk.displayName=ik;var ck="DropdownMenuSubTrigger",jp=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(VC,{...n,...a,ref:s})});jp.displayName=ck;var dk="DropdownMenuSubContent",Np=c.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=ht(r);return t.jsx(HC,{...n,...a,ref:s,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Np.displayName=dk;var uk=dp,mk=mp,hk=hp,Sp=pp,_p=gp,Cp=xp,kp=vp,Ep=yp,Tp=wp,Mp=bp,Pp=jp,Dp=Np;const oi=uk,ii=mk,fk=c.forwardRef(({className:e,inset:s,children:r,...a},n)=>t.jsxs(Pp,{ref:n,className:Z("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-muted hover:bg-muted data-[state=open]:bg-accent",s&&"pl-8",e),...a,children:[r,t.jsx(gi,{className:"ml-auto h-4 w-4"})]}));fk.displayName=Pp.displayName;const pk=c.forwardRef(({className:e,...s},r)=>t.jsx(Dp,{ref:r,collisionPadding:16,className:Z("z-[60] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));pk.displayName=Dp.displayName;const rn=c.forwardRef(({className:e,sideOffset:s=4,...r},a)=>t.jsx(hk,{children:t.jsx(Sp,{ref:a,sideOffset:s,collisionPadding:16,className:Z("z-[60] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));rn.displayName=Sp.displayName;const ot=c.forwardRef(({className:e,inset:s,...r},a)=>t.jsx(Cp,{ref:a,className:Z("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...r}));ot.displayName=Cp.displayName;const gk=c.forwardRef(({className:e,children:s,checked:r,...a},n)=>t.jsxs(kp,{ref:n,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...a,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Tp,{children:t.jsx(Gs,{className:"h-4 w-4"})})}),s]}));gk.displayName=kp.displayName;const xk=c.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Ep,{ref:a,className:Z("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Tp,{children:t.jsx(xd,{className:"h-2 w-2 fill-current"})})}),s]}));xk.displayName=Ep.displayName;const vk=c.forwardRef(({className:e,inset:s,...r},a)=>t.jsx(_p,{ref:a,className:Z("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...r}));vk.displayName=_p.displayName;const yk=c.forwardRef(({className:e,...s},r)=>t.jsx(Mp,{ref:r,className:Z("-mx-1 my-1 h-px bg-muted",e),...s}));yk.displayName=Mp.displayName;const wk=({food:e,onUpdate:s,isOpen:r,onClose:a,mode:n="default"})=>{const[o,i]=c.useState(!1),[l,d]=c.useState(e.name),[f,u]=c.useState(e.calories_per_100g.toString()),[m,h]=c.useState(e.carbs_per_100g.toString()),[p,g]=c.useState(e.image_url||""),x=c.useRef(e.id);c.useEffect(()=>{e.id!==x.current&&(console.log("EditDefaultFoodModal: Switching to new food:",e.id),d(e.name),u(e.calories_per_100g.toString()),h(e.carbs_per_100g.toString()),g(e.image_url||""),x.current=e.id)},[e.id]);const{toast:v}=pe(),{profile:w}=Te(),y=async()=>{if(!l.trim()){v({title:"Error",description:"Food name is required",variant:"destructive"});return}const b=parseFloat(f),j=parseFloat(m);if(isNaN(b)||b<0){v({title:"Error",description:"Please enter a valid calories value",variant:"destructive"});return}if(isNaN(j)||j<0){v({title:"Error",description:"Please enter a valid carbs value",variant:"destructive"});return}try{console.log("ðŸŽ EditDefaultFoodModal: === SAVE PROCESS START ==="),console.log("ðŸŽ EditDefaultFoodModal: Current form state before save:",{foodId:e.id,name:l.trim(),calories:parseFloat(f),carbs:parseFloat(m),imageUrl:p,imageUrlLength:p?.length||0});const N={name:l.trim(),calories_per_100g:b,carbs_per_100g:j,image_url:p||null};console.log("ðŸŽ EditDefaultFoodModal: Data being sent to onUpdate:",N),await s(e.id,N),console.log("ðŸŽ EditDefaultFoodModal: onUpdate completed successfully"),console.log("ðŸŽ EditDefaultFoodModal: === SAVE PROCESS SUCCESS ==="),a?a():i(!1),v({title:"Success",description:"Default food updated successfully"})}catch(N){console.error("Failed to update default food:",N),v({title:"Error",description:"Failed to update default food",variant:"destructive"})}};return t.jsxs(t.Fragment,{children:[r===void 0&&t.jsx(A,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6 hover:bg-primary/10",title:"Edit default food",onClick:b=>{b.stopPropagation(),i(!0)},children:t.jsx(ut,{className:"w-3 h-3 text-muted-foreground"})}),t.jsx(mt,{isOpen:r!==void 0?r:o,onClose:()=>{a?a():i(!1)},title:`Edit ${e.name}`,description:`Edit the details of ${e.name} including name, calories, carbs, and image`,variant:"standard",size:"sm",footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:()=>{a?a():i(!1)},className:"w-full",children:"Cancel"}),t.jsx(A,{onClick:y,className:"w-full",children:"Save"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"name",children:"Food Name"}),t.jsx(ge,{id:"name",value:l,onChange:b=>d(b.target.value),placeholder:"Enter food name"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"calories",children:["Calories (per 100",w?.units==="imperial"?"oz":"g",")"]}),t.jsx(ge,{id:"calories",type:"number",value:f,onChange:b=>u(b.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"carbs",children:["Carbs (per 100",w?.units==="imperial"?"oz":"g",")"]}),t.jsx(ge,{id:"carbs",type:"number",value:m,onChange:b=>h(b.target.value),placeholder:"0",min:"0",step:"0.1"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{children:"Food Image"}),t.jsx(ol,{currentImageUrl:p,onImageUpload:b=>{console.log("ðŸ–¼ï¸ EditDefaultFoodModal: === IMAGE UPLOAD CALLBACK ==="),console.log("ðŸ–¼ï¸ EditDefaultFoodModal: Received image URL from upload:",b),console.log("ðŸ–¼ï¸ EditDefaultFoodModal: URL length:",b?.length||0),console.log("ðŸ–¼ï¸ EditDefaultFoodModal: Previous imageUrl state:",p),g(b),console.log("ðŸ–¼ï¸ EditDefaultFoodModal: Updated imageUrl state to:",b),console.log("ðŸ–¼ï¸ EditDefaultFoodModal: === IMAGE UPLOAD CALLBACK END ===")},onImageRemove:()=>{console.log("ðŸ—‘ï¸ EditDefaultFoodModal: === IMAGE REMOVE CALLBACK ==="),console.log("ðŸ—‘ï¸ EditDefaultFoodModal: Previous imageUrl state:",p),g(""),console.log("ðŸ—‘ï¸ EditDefaultFoodModal: Cleared imageUrl state"),console.log("ðŸ—‘ï¸ EditDefaultFoodModal: === IMAGE REMOVE CALLBACK END ===")},bucket:"food-images"})]})]})})]})},bk=()=>{const[e,s]=c.useState([]),[r,a]=c.useState(!0),{user:n}=Se();c.useEffect(()=>{n&&o()},[n]);const o=async()=>{if(n)try{a(!0);const{data:i,error:l}=await P.from("food_entries").select(`
          name,
          calories,
          carbs,
          image_url,
          created_at
        `).eq("user_id",n.id).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(l)throw l;const d=new Map;i?.forEach(u=>{const m=u.name.toLowerCase();(!d.has(m)||new Date(u.created_at)>new Date(d.get(m).last_used))&&d.set(m,{id:`recent-${m}`,name:u.name,calories_per_100g:u.calories||0,carbs_per_100g:u.carbs||0,image_url:u.image_url,last_used:u.created_at,usage_count:1})});const f=Array.from(d.values()).sort((u,m)=>new Date(m.last_used).getTime()-new Date(u.last_used).getTime()).slice(0,20);s(f)}catch(i){console.error("Error loading recent foods:",i)}finally{a(!1)}};return{recentFoods:e,loading:r,refreshRecentFoods:o}},jk=({onSelectFood:e,onBack:s})=>{const[r,a]=c.useState([]),[n,o]=c.useState([]),[i,l]=c.useState(new Set),[d,f]=c.useState(""),[u,m]=c.useState(!0),[h,p]=c.useState(!1),[g,x]=c.useState("my-foods"),[v,w]=c.useState(!1),{user:y}=Se(),{toast:b}=pe(),{recentFoods:j,loading:N,refreshRecentFoods:E}=bk();c.useEffect(()=>{y&&(async()=>{m(!0);try{await Promise.all([_(),C(),k(),S()])}finally{m(!1)}})()},[y]);const S=async()=>{if(y)try{const{data:O,error:Q}=await P.rpc("is_current_user_admin");if(Q)throw Q;p(O||!1)}catch(O){console.error("Error checking admin role:",O),p(!1)}},_=async()=>{if(y)try{const{data:O,error:Q}=await P.from("user_foods").select("*").eq("user_id",y.id).order("is_favorite",{ascending:!1}).order("name");if(Q)throw Q;a(O||[])}catch(O){console.error("Error loading user foods:",O),b({title:"Error",description:"Failed to load your food library",variant:"destructive"})}},C=async()=>{try{const{data:O,error:Q}=await P.from("default_foods").select("*").order("name");if(Q)throw Q;o(O||[])}catch(O){console.error("Error loading default foods:",O),b({title:"Warning",description:"Failed to load suggested foods",variant:"destructive"})}},k=async()=>{if(y)try{const{data:O,error:Q}=await P.from("default_food_favorites").select("default_food_id").eq("user_id",y.id);if(Q)throw Q;const R=new Set(O?.map(M=>M.default_food_id)||[]);l(R)}catch(O){console.error("Error loading default food favorites:",O)}},T=async(O,Q=!1)=>{console.log("ðŸ”„ FoodLibrary: Adding food to today:",O.name);const R="variations"in O?O:{...O,is_favorite:!1,variations:[]};await e(R,Q)},D=async O=>{if(y){console.log("ðŸ½ï¸ FoodLibrary - handleAddToTemplate called with:",O);try{const{data:Q,error:R}=await P.from("daily_food_templates").insert({user_id:y.id,name:O.name,calories:O.calories_per_100g,carbs:O.carbs_per_100g,serving_size:100,image_url:O.image_url}).select().single();if(R)throw console.error("ðŸ½ï¸ FoodLibrary - handleAddToTemplate error:",R),R;console.log("ðŸ½ï¸ FoodLibrary - handleAddToTemplate success:",Q),b({title:"Added to templates",description:`${O.name} has been added to your daily templates`})}catch(Q){console.error("ðŸ½ï¸ FoodLibrary - handleAddToTemplate failed:",Q),b({variant:"destructive",title:"Error",description:"Failed to add food to templates"})}}},W=async(O,Q)=>{console.log("ðŸ½ï¸ FoodLibrary - toggleFavorite called with:",{foodId:O,currentFavorite:Q});try{const{data:R,error:M}=await P.from("user_foods").update({is_favorite:!Q}).eq("id",O).eq("user_id",y?.id).select().single();if(M)throw console.error("ðŸ½ï¸ FoodLibrary - toggleFavorite error:",M),M;console.log("ðŸ½ï¸ FoodLibrary - toggleFavorite success:",R),a(H=>H.map(U=>U.id===O?{...U,is_favorite:!Q}:U))}catch(R){console.error("ðŸ½ï¸ FoodLibrary - toggleFavorite failed:",R),b({variant:"destructive",title:"Error",description:"Failed to update favorite status"})}},$=async(O,Q)=>{console.log("ðŸ½ï¸ FoodLibrary - updateFood called with:",{foodId:O,updates:Q});try{const{data:R,error:M}=await P.from("user_foods").update(Q).eq("id",O).eq("user_id",y?.id).select().single();if(M)throw console.error("ðŸ½ï¸ FoodLibrary - updateFood error:",M),M;console.log("ðŸ½ï¸ FoodLibrary - updateFood success:",R),a(H=>H.map(U=>U.id===O?{...U,...Q}:U)),console.log("ðŸ½ï¸ FoodLibrary - food updated in local state")}catch(R){throw console.error("ðŸ½ï¸ FoodLibrary - updateFood failed:",R),R}},X=async O=>{console.log("ðŸ½ï¸ FoodLibrary - deleteFood called with:",{foodId:O});try{const{data:Q,error:R}=await P.from("user_foods").delete().eq("id",O).eq("user_id",y?.id).select();if(R)throw console.error("ðŸ½ï¸ FoodLibrary - deleteFood error:",R),R;if(!Q||Q.length===0){console.warn("ðŸ½ï¸ FoodLibrary - No rows were deleted"),b({variant:"destructive",title:"Error",description:"Food not found or already deleted"});return}console.log("ðŸ½ï¸ FoodLibrary - deleteFood success:",Q),a(M=>M.filter(H=>H.id!==O)),b({title:"Food removed",description:"Food has been removed from your library"})}catch(Q){console.error("ðŸ½ï¸ FoodLibrary - deleteFood failed:",Q),b({title:"Error",description:"Failed to remove food",variant:"destructive"})}},V=async()=>{if(y)try{const{error:O}=await P.from("user_foods").delete().eq("user_id",y.id);if(O)throw O;a([]),w(!1),b({title:"All foods removed",description:"All foods have been removed from your library"})}catch(O){console.error("Error deleting all foods:",O),b({title:"Error",description:"Failed to remove all foods",variant:"destructive"})}},G=async(O,Q)=>{try{console.log("ðŸ”„ FoodLibraryView: === UPDATE DEFAULT FOOD START ==="),console.log("ðŸ”„ FoodLibraryView: foodId:",O),console.log("ðŸ”„ FoodLibraryView: updates received:",Q),console.log("ðŸ”„ FoodLibraryView: image_url in updates:",Q.image_url);const{error:R}=await P.from("default_foods").update(Q).eq("id",O);if(R)throw console.error("ðŸ”„ FoodLibraryView: Database update error:",R),R;console.log("ðŸ”„ FoodLibraryView: Database update successful"),console.log("ðŸ”„ FoodLibraryView: Updating local state..."),o(n.map(M=>M.id===O?{...M,...Q}:M)),console.log("ðŸ”„ FoodLibraryView: Local state updated"),console.log("ðŸ”„ FoodLibraryView: === UPDATE DEFAULT FOOD SUCCESS ===")}catch(R){throw console.error("ðŸ”„ FoodLibraryView: Error updating default food:",R),R}},L=async O=>{try{const{error:Q}=await P.from("food_entries").delete().eq("user_id",y?.id).eq("name",O);if(Q)throw Q;E(),b({title:"Food removed",description:`All entries of "${O}" have been removed from your history`})}catch(Q){console.error("Error deleting recent food:",Q),b({title:"Error",description:"Failed to remove food from history",variant:"destructive"})}},B=async O=>{try{const{error:Q}=await P.from("default_foods").delete().eq("id",O);if(Q)throw Q;o(n.filter(R=>R.id!==O)),b({title:"Default food removed",description:"Default food has been removed from the system"})}catch(Q){console.error("Error deleting default food:",Q),b({title:"Error",description:"Failed to remove default food",variant:"destructive"})}},te=(()=>{const O=new Map,Q=new Map;return j.forEach(M=>{O.set(M.name.toLowerCase(),{...M,is_favorite:!1,variations:[]})}),r.forEach(M=>{Q.set(M.name.toLowerCase(),M)}),Array.from(new Map([...O,...Q]).values())})().filter(O=>O.name.toLowerCase().includes(d.toLowerCase())).sort((O,Q)=>O.is_favorite&&!Q.is_favorite?-1:!O.is_favorite&&Q.is_favorite?1:O.name.localeCompare(Q.name)),Y=n.filter(O=>O.name.toLowerCase().includes(d.toLowerCase())).map(O=>({...O,is_favorite:i.has(O.id)})).sort((O,Q)=>O.is_favorite&&!Q.is_favorite?-1:!O.is_favorite&&Q.is_favorite?1:O.name.localeCompare(Q.name));te.filter(O=>O.is_favorite).slice(0,5);const oe=({food:O,isUserFood:Q=!0})=>{const[R,M]=c.useState(!1),H=U=>{const ee=U.target;if(ee.closest("button")||ee.closest('[role="menuitem"]')||ee.closest("[data-radix-dropdown-menu-content]")||ee.closest("[data-radix-popper-content-wrapper]")||ee.closest(".dropdown-menu")||ee.closest(".flex-shrink-0")||R){U.preventDefault(),U.stopPropagation();return}T(O,!1)};return t.jsxs("div",{className:"p-2 mx-2 rounded-lg transition-all duration-200 cursor-pointer bg-card border border-ceramic-rim hover:bg-ceramic-base",onClick:H,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-shrink-0",onClick:U=>U.stopPropagation(),children:t.jsxs(oi,{children:[t.jsx(ii,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"min-w-[44px] min-h-[44px] p-2 hover:bg-secondary/80 rounded-md flex items-center justify-center",title:"More options","aria-label":"More options",onClick:U=>U.stopPropagation(),children:t.jsx(xo,{className:"w-4 h-4 text-muted-foreground"})})}),t.jsx(rn,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:Q?t.jsxs(t.Fragment,{children:[(Q||h)&&!O.id.startsWith("recent-")&&t.jsxs(ot,{onClick:U=>{U.stopPropagation(),M(!0)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ut,{className:"w-4 h-4 mr-3"}),"Edit Food"]}),t.jsxs(ot,{onClick:async U=>{U.stopPropagation(),await T(O,!1)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(qe,{className:"w-4 h-4 mr-3"}),"Add to Today"]}),t.jsxs(ot,{onClick:U=>{U.stopPropagation(),D(O)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ss,{className:"w-4 h-4 mr-3"}),"Add to Template"]}),t.jsxs(ot,{onClick:U=>{U.stopPropagation(),X(O.id)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(We,{className:"w-4 h-4 mr-3"}),"Delete"]})]}):t.jsxs(t.Fragment,{children:[h&&!O.id.startsWith("recent-")&&t.jsxs(ot,{onClick:U=>{U.stopPropagation(),M(!0)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ut,{className:"w-4 h-4 mr-3"}),"Edit Food"]}),t.jsxs(ot,{onClick:async U=>{U.stopPropagation(),await T(O,!1)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(qe,{className:"w-4 h-4 mr-3"}),"Add to Today"]}),t.jsxs(ot,{onClick:U=>{U.stopPropagation(),D(O)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ss,{className:"w-4 h-4 mr-3"}),"Add to Template"]}),O.id.startsWith("recent-")?t.jsxs(ot,{onClick:U=>{U.stopPropagation(),L(O.name)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(We,{className:"w-4 h-4 mr-3"}),"Delete"]}):h&&t.jsxs(ot,{onClick:U=>{U.stopPropagation(),B(O.id)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(We,{className:"w-4 h-4 mr-3"}),"Delete"]})]})})]})}),O.image_url?t.jsx("img",{src:O.image_url,alt:O.name,className:"w-10 h-10 rounded-lg object-cover flex-shrink-0",loading:"lazy",onError:U=>{const ee=U.target;ee.style.display="none";const ue=ee.nextElementSibling;ue&&(ue.style.display="flex")}}):null,t.jsx("div",{className:`w-10 h-10 rounded-lg bg-muted flex items-center justify-center flex-shrink-0 ${O.image_url?"hidden":"flex"}`,children:t.jsx(is,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"mb-0.5",children:t.jsx("h3",{className:"text-sm font-semibold text-foreground truncate",children:O.name})}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs("span",{className:"font-medium",children:[Math.round(O.calories_per_100g)," cal"]}),t.jsx("span",{className:"text-muted-foreground/60",children:"â€¢"}),t.jsxs("span",{className:"font-medium",children:[Math.round(O.carbs_per_100g),"g carbs"]})]})]}),g==="my-foods"&&"is_favorite"in O&&t.jsx("div",{className:"flex-shrink-0",onClick:U=>U.stopPropagation(),children:t.jsx(A,{variant:"ghost",size:"sm",onClick:U=>{U.stopPropagation(),W(O.id,O.is_favorite||!1)},className:"min-w-[44px] min-h-[44px] p-2 hover:bg-secondary/80 rounded-md flex items-center justify-center",title:O.is_favorite?"Remove from favorites":"Add to favorites","aria-label":O.is_favorite?"Remove from favorites":"Add to favorites",children:t.jsx(Fg,{className:`w-4 h-4 transition-colors ${O.is_favorite?"fill-red-500 text-red-500":"text-muted-foreground hover:text-red-400"}`})})}),t.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:U=>U.stopPropagation(),children:t.jsx(A,{variant:"default",size:"sm",onClick:async U=>{U.preventDefault(),U.stopPropagation(),await T(O,!1)},className:"min-w-[44px] min-h-[44px] p-2 flex-shrink-0 rounded-md flex items-center justify-center hover:bg-primary/90 transition-colors",title:"Add to today's plan","aria-label":"Add to today's plan",children:t.jsx(qe,{className:"w-4 h-4"})})})]}),R&&t.jsx(wk,{food:O,onUpdate:Q?$:G,isOpen:R,onClose:()=>M(!1),mode:Q?"user":"default"})]})};return t.jsxs("div",{className:"h-full flex flex-col max-w-7xl mx-auto",children:[t.jsxs("div",{className:"px-6 py-6 border-b border-border",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"My Foods"}),t.jsxs(A,{variant:"ghost",size:"sm",onClick:s,className:"hover:bg-muted transition-colors",children:[t.jsx(fi,{className:"w-4 h-4 mr-2"}),"Back"]})]}),t.jsxs("div",{className:"relative mt-4",children:[t.jsx(bd,{className:"w-4 h-4 text-muted-foreground absolute left-3 top-1/2 transform -translate-y-1/2"}),t.jsx(ge,{placeholder:"Search foods...",value:d,onChange:O=>f(O.target.value),className:"pl-10"})]})]}),t.jsx("div",{className:"flex-1 px-2 py-4 overflow-hidden",children:t.jsxs(Ja,{value:g,onValueChange:O=>x(O),className:"h-full flex flex-col",children:[t.jsx("div",{className:"mb-4",children:t.jsxs(Rn,{className:"grid w-full grid-cols-2",children:[t.jsxs(zs,{value:"my-foods",className:"flex items-center gap-2",children:["MyFoods",te.length>0&&t.jsx(We,{className:"w-3 h-3 text-destructive cursor-pointer hover:text-destructive/80",onClick:O=>{O.stopPropagation(),w(!0)}})]}),t.jsx(zs,{value:"suggested",children:"Default"})]})}),t.jsx(qs,{value:"my-foods",className:"flex-1 overflow-y-auto mt-0",children:t.jsx("div",{className:"space-y-2 mt-1",children:u?t.jsx("div",{className:"space-y-1",children:[...Array(8)].map((O,Q)=>t.jsx("div",{className:"p-2 rounded-lg bg-muted/20 border-0 animate-pulse mb-1",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted"}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"})]})]})},Q))}):te.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(is,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:d?"No foods found":"Your library is empty"}),t.jsx("p",{className:"text-muted-foreground text-sm",children:d?"Try a different search term":"Log foods to automatically add them to your library"})]}):t.jsx("div",{className:"space-y-1 overflow-x-hidden",children:te.map(O=>t.jsx(oe,{food:O,isUserFood:!0},O.id))})})}),t.jsx(qs,{value:"suggested",className:"flex-1 overflow-y-auto mt-0",children:t.jsx("div",{className:"space-y-2 mt-1",children:u?t.jsx("div",{className:"space-y-1",children:[...Array(8)].map((O,Q)=>t.jsx("div",{className:"p-2 rounded-lg bg-muted/20 border-0 animate-pulse mb-1",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted"}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"})]})]})},Q))}):Y.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸŒŸ"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:d?"No suggested foods found":"No suggested foods available"}),t.jsx("p",{className:"text-muted-foreground",children:d?"Try a different search term":"Check back later for curated food suggestions"})]}):t.jsx("div",{className:"space-y-1 overflow-x-hidden",children:Y.map(O=>t.jsx(oe,{food:O,isUserFood:!1},`default-${O.id}`))})})})]})}),t.jsx(rt,{open:v,onOpenChange:w,children:t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete All Foods?"}),t.jsxs(Qe,{children:["This will permanently delete all ",te.length," foods from your personal library. This action cannot be undone."]})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:V,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All"})]})]})})]})},po=e=>e?.trim().toLowerCase().replace(/\s+/g," ")||"",Nk=()=>{const{user:e}=Se(),[s,r]=c.useState(!1),[a,n]=c.useState(new Set),o=c.useCallback(async()=>{if(!e?.id){n(new Set);return}r(!0);try{const{data:f,error:u}=await P.from("user_foods").select("name").eq("user_id",e.id);if(u){console.error("Error fetching user library:",u),n(new Set);return}const m=new Set;if(f&&f.length>0)for(const h of f)m.add(po(h.name));n(m)}catch(f){console.error("Exception fetching library:",f),n(new Set)}finally{r(!1)}},[e?.id]);c.useEffect(()=>{o()},[o]),c.useEffect(()=>{e?.id||n(new Set)},[e?.id]);const i=c.useCallback(f=>!f||a.size===0?!1:a.has(po(f)),[a]),l=c.useCallback(f=>{if(!f)return;const u=po(f);n(m=>{if(m.has(u))return m;const h=new Set(m);return h.add(u),h})},[]),d=c.useCallback(async()=>{await o()},[o]);return c.useMemo(()=>({isInLibrary:i,refresh:d,addLocal:l,loading:s}),[i,d,l,s])},Sk=()=>{const[e,s]=c.useState(!1),{user:r}=Se();return{copyDayToToday:async n=>{if(!r)return va.error("User not authenticated"),{success:!1};s(!0);try{const o=new Date(n),i=ai(o),l=$S(o),{data:d,error:f}=await P.from("food_entries").select("*").eq("user_id",r.id).gte("created_at",i.toISOString()).lte("created_at",l.toISOString()).order("created_at",{ascending:!0});if(f)throw f;if(!d||d.length===0)return va.info("No food entries found for this day"),{success:!1};const u=d.map(g=>({name:g.name,calories:g.calories,carbs:g.carbs,serving_size:g.serving_size,consumed:!1,image_url:g.image_url,user_id:r.id})),{data:m,error:h}=await P.from("food_entries").insert(u).select();if(h)throw h;const p=new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"});return va.success(`Copied ${m?.length||0} food items from ${p} to today's plan`),{success:!0,count:m?.length||0}}catch(o){return console.error("Error copying day's foods:",o),va.error("Failed to copy food items"),{success:!1}}finally{s(!1)}},loading:e}},_k=({onClose:e,onCopySuccess:s})=>{const[r,a]=c.useState([]),[n,o]=c.useState(!0),[i,l]=c.useState(new Set),[d,f]=c.useState(0),[u,m]=c.useState(!0),{toast:h}=pe(),{user:p}=Se(),{copyDayToToday:g,loading:x}=Sk(),v=7,w=async(E=0,S=!1)=>{if(p){o(!0);try{const _=new Date;_.setHours(0,0,0,0);const C=new Date(_.getTime()-1),{data:k,error:T}=await P.from("food_entries").select("*").eq("user_id",p.id).eq("consumed",!0).lt("created_at",C.toISOString()).order("created_at",{ascending:!1}).range(E*50,(E+1)*50-1);if(T)throw T;const D=new Map;k?.forEach($=>{const X=new Date($.created_at).toDateString();D.has(X)||D.set(X,{date:X,totalCalories:0,totalCarbs:0,entryCount:0,entries:[]});const V=D.get(X);V.totalCalories+=$.calories||0,V.totalCarbs+=$.carbs||0,V.entryCount+=1,V.entries.push({id:$.id,name:$.name,calories:$.calories||0,carbs:$.carbs||0,serving_size:$.serving_size||100,created_at:$.created_at})});const W=Array.from(D.values()).sort(($,X)=>new Date(X.date).getTime()-new Date($.date).getTime()).slice(0,v);a(S?$=>[...$,...W]:W),m(k?.length===50)}catch(_){console.error("Error loading food history:",_),h({title:"Error",description:"Failed to load food history",variant:"destructive"})}finally{o(!1)}}},y=()=>{const E=d+1;f(E),w(E,!0)},b=E=>{l(S=>{const _=new Set(S);return _.has(E)?_.delete(E):_.add(E),_})},j=async E=>{try{const S=r.find(k=>k.date===E);if(!S)return;const _=S.entries.map(k=>k.id),{error:C}=await P.from("food_entries").delete().in("id",_);if(C)throw C;a(k=>k.filter(T=>T.date!==E)),h({title:"Day deleted",description:"All food entries for this day have been removed"})}catch(S){console.error("Error deleting day:",S),h({title:"Error",description:"Failed to delete food entries",variant:"destructive"})}},N=async()=>{if(p)try{const{error:E}=await P.from("food_entries").delete().eq("user_id",p.id);if(E)throw E;a([]),h({title:"History deleted",description:"All food history has been permanently removed"})}catch(E){console.error("Error deleting all history:",E),h({title:"Error",description:"Failed to delete food history",variant:"destructive"})}};return c.useEffect(()=>{w()},[p]),n&&r.length===0?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(ie,{className:"w-full max-w-md mx-auto",onClick:E=>E.stopPropagation(),children:[t.jsx(pt,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(us,{className:"text-lg font-semibold",children:"Food History"}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]})}),t.jsx($e,{children:t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((E,S)=>t.jsx(ie,{children:t.jsx(pt,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-24"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-16"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-20"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-12"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"w-6 h-6 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"w-6 h-6 bg-muted animate-pulse rounded"})]})]})})},S))})})]})}):t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(ie,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:E=>E.stopPropagation(),children:[t.jsx(pt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(us,{className:"text-lg font-semibold",children:"Food History"}),t.jsxs("div",{className:"flex gap-2",children:[r.length>0&&t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(We,{className:"w-4 h-4"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete All Food History"}),t.jsx(Qe,{children:"Are you sure you want to delete ALL food history? This will permanently remove all food entries from all days. This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:N,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Ie,{className:"w-8 h-8"})})]})]})}),t.jsx($e,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:r.length===0?t.jsx("div",{className:"text-center py-8",children:t.jsx("div",{className:"text-muted-foreground",children:"No food entries found"})}):t.jsxs(t.Fragment,{children:[r.map(E=>t.jsxs(ie,{className:"relative",children:[t.jsx(pt,{className:"py-3 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>b(E.date),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-medium text-sm",children:new Date(E.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(Nt,{className:`w-5 h-5 text-muted-foreground transition-transform ${i.has(E.date)?"rotate-180":""}`})})]})}),i.has(E.date)&&t.jsxs($e,{className:"pt-0",children:[t.jsx("div",{className:"space-y-1",children:E.entries.map(S=>t.jsx("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded text-xs",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:S.name}),t.jsxs("div",{className:"text-muted-foreground",children:[S.calories," cal â€¢ ",S.carbs,"g carbs â€¢ ",S.serving_size,"g"]})]})},S.id))}),t.jsxs("div",{className:"mt-3 pt-2 border-t border-border flex items-center gap-2",children:[t.jsx(A,{variant:"outline",size:"sm",onClick:async S=>{S.stopPropagation(),(await g(E.date))?.success&&(s&&s(),e())},disabled:x,className:"h-7 px-2 text-xs",children:"Copy to Today"}),t.jsxs(rt,{children:[t.jsx(gt,{asChild:!0,children:t.jsx(A,{variant:"ghost",size:"sm",onClick:S=>S.stopPropagation(),className:"h-7 w-7 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(We,{className:"w-3 h-3"})})}),t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Delete Entire Day"}),t.jsxs(Qe,{children:["Are you sure you want to delete all food entries for ",new Date(E.date).toLocaleDateString(),"? This action cannot be undone."]})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:()=>j(E.date),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Day"})]})]})]})]})]})]},E.date)),u&&t.jsx("div",{className:"text-center pt-4",children:t.jsx(vh,{variant:"outline",onClick:y,isLoading:n,loadingText:"Loading more",children:"Load More"})})]})})]})})},Ck=({entry:e,onUpdate:s,isOpen:r,onClose:a})=>{const[n,o]=c.useState(!1),[i,l]=c.useState(e.name),[d,f]=c.useState(e.calories.toString()),[u,m]=c.useState(e.carbs.toString()),[h,p]=c.useState(e.serving_size.toString()),[g,x]=c.useState(!1),{toast:v}=pe(),w=async()=>{if(!i.trim()){v({title:"Error",description:"Food name is required",variant:"destructive"});return}const b=parseFloat(d),j=parseFloat(u),N=parseFloat(h);if(isNaN(b)||b<0){v({title:"Error",description:"Please enter a valid calories value",variant:"destructive"});return}if(isNaN(j)||j<0){v({title:"Error",description:"Please enter a valid carbs value",variant:"destructive"});return}if(isNaN(N)||N<=0){v({title:"Error",description:"Please enter a valid serving size",variant:"destructive"});return}x(!0);try{const E={...e,name:i.trim(),calories:b,carbs:j,serving_size:N};await s(E),a?a():o(!1)}catch(E){console.error("Failed to update food entry:",E),v({title:"Error",description:"Failed to update food entry",variant:"destructive"})}finally{x(!1)}},y=()=>{l(e.name),f(e.calories.toString()),m(e.carbs.toString()),p(e.serving_size.toString())};return t.jsx(mt,{isOpen:r!==void 0?r:n,onClose:()=>{a?a():o(!1),y()},title:`Edit ${e.name}`,variant:"standard",size:"sm",footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:()=>{a?a():o(!1)},className:"w-full",children:"Cancel"}),t.jsxs(A,{onClick:w,disabled:g,className:"w-full",children:[t.jsx(ss,{className:"w-4 h-4 mr-2"}),g?"Saving...":"Save"]})]}),children:t.jsxs("div",{className:"space-y-4",children:[e.image_url&&t.jsx("div",{className:"w-full h-32 mb-4",children:t.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover rounded-lg"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"name",children:"Food Name"}),t.jsx(ge,{id:"name",value:i,onChange:b=>l(b.target.value),placeholder:"Enter food name"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"calories",children:"Calories"}),t.jsx(ge,{id:"calories",type:"number",value:d,onChange:b=>f(b.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"carbs",children:"Carbs (g)"}),t.jsx(ge,{id:"carbs",type:"number",value:u,onChange:b=>m(b.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"serving",children:"Serving (g)"}),t.jsx(ge,{id:"serving",type:"number",value:h,onChange:b=>p(b.target.value),placeholder:"0",min:"0.1",step:"0.1"})]})]})]})})},kk=()=>{const{user:e}=Se(),s=Ct(),[r,a]=c.useState([]),[n,o]=c.useState([]),[i,l]=c.useState(!1),d=async(g,x)=>{if(!e)throw new Error("User not authenticated");l(!0);const v=[];try{if(x==="today"){const w=new Date().toISOString().split("T")[0],{data:y,error:b}=await P.from("food_entries").select("id, name, serving_size, calories, carbs").eq("user_id",e.id).eq("source_date",w).ilike("name",`%${g}%`);if(b)throw b;y?.forEach(j=>{v.push({id:j.id,name:j.name,type:"today",current_values:{serving_size:j.serving_size,calories:j.calories,carbs:j.carbs}})})}else if(x==="library"){const{data:w,error:y}=await P.from("user_foods").select("id, name, calories_per_100g, carbs_per_100g").eq("user_id",e.id).ilike("name",`%${g}%`);if(y)throw y;w?.forEach(b=>{v.push({id:b.id,name:b.name,type:"library",current_values:{calories_per_100g:b.calories_per_100g,carbs_per_100g:b.carbs_per_100g}})})}else if(x==="templates"){const{data:w,error:y}=await P.from("daily_food_templates").select("id, name, serving_size, calories, carbs").eq("user_id",e.id).ilike("name",`%${g}%`);if(y)throw y;w?.forEach(b=>{v.push({id:b.id,name:b.name,type:"template",current_values:{serving_size:b.serving_size,calories:b.calories,carbs:b.carbs}})})}return a(v),v}catch(w){return console.error("Error searching foods:",w),Le({title:"Search Error",description:"Failed to search for foods. Please try again.",variant:"destructive"}),[]}finally{l(!1)}},f=async(g,x)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await P.from("food_entries").update(x).eq("id",g).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["food-entries"]}),Le({title:"Food Entry Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing food entry:",v),Le({title:"Update Error",description:"Failed to update food entry. Please try again.",variant:"destructive"}),v}},u=async(g,x)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await P.from("user_foods").update(x).eq("id",g).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["user-foods"]}),Le({title:"Library Food Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing library food:",v),Le({title:"Update Error",description:"Failed to update library food. Please try again.",variant:"destructive"}),v}},m=async(g,x)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await P.from("daily_food_templates").update(x).eq("id",g).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["daily-food-templates"]}),Le({title:"Template Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing template food:",v),Le({title:"Update Error",description:"Failed to update template. Please try again.",variant:"destructive"}),v}};return{searchResults:r,editPreviews:n,isSearching:i,searchFoodsForEdit:d,editFoodEntry:f,editLibraryFood:u,editTemplateFood:m,createEditPreview:(g,x)=>({id:g.id,name:g.name,type:g.type,before:g.current_values,after:{...g.current_values,...x},confirmed:!1}),applyEditPreview:async g=>{const x=Object.keys(g.after).reduce((v,w)=>(g.after[w]!==g.before[w]&&(v[w]=g.after[w]),v),{});if(g.type==="today")return await f(g.id,x);if(g.type==="library")return await u(g.id,x);if(g.type==="template")return await m(g.id,x)},setEditPreviews:o}},Ek=({preview:e,onConfirm:s,onCancel:r,onEdit:a})=>{const n=(l,d)=>l==="serving_size"?`${d}g`:l==="calories"||l==="calories_per_100g"?`${d} cal`:l==="carbs"||l==="carbs_per_100g"?`${d}g carbs`:`${d}`,i=(()=>{const l=[];return Object.keys(e.after).forEach(d=>{e.after[d]!==e.before[d]&&typeof e.after[d]=="number"&&l.push({key:d,before:e.before[d],after:e.after[d]})}),l})();return i.length===0?null:t.jsx(ie,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-900",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"font-medium text-warm-text",children:["Edit Preview: ",e.name]}),t.jsx("div",{className:"text-xs text-muted-foreground bg-ceramic-base px-2 py-1 rounded",children:e.type==="today"?"Today's Entry":e.type==="library"?"Food Library":"Template"})]}),t.jsx("div",{className:"space-y-2",children:i.map(({key:l,before:d,after:f})=>t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{className:"capitalize text-warm-text",children:[l.replace("_"," ").replace("per 100g","/100g"),":"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-muted-foreground line-through",children:n(l,d)}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"â†’"}),t.jsx("span",{className:"text-primary font-medium",children:n(l,f)})]})]},l))}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsxs(A,{size:"sm",onClick:s,className:"flex-1",children:[t.jsx(Gs,{className:"w-3 h-3 mr-1"}),"Apply Changes"]}),t.jsx(A,{size:"sm",variant:"ghost",onClick:a,className:"px-3",children:t.jsx(ut,{className:"w-3 h-3"})}),t.jsx(A,{size:"sm",variant:"ghost",onClick:r,className:"px-3",children:t.jsx(Ie,{className:"w-3 h-3"})})]})]})})},ze=(e,s)=>["food-entries",e,s],or=(e,s)=>["daily-totals",e,s],$n=()=>{const{user:e}=Se(),{toast:s}=pe(),r=Ct(),a=new Date().toISOString().split("T")[0],n=bt({queryKey:ze(e?.id||null,a),queryFn:async()=>{if(console.log("ðŸ½ï¸ foodEntriesQuery queryFn - user:",e?.id),!e)return console.log("ðŸ½ï¸ No user authenticated, returning empty array"),[];const m=new Date;m.setHours(0,0,0,0);const h=new Date(m);h.setDate(h.getDate()+1),console.log("ðŸ½ï¸ Fetching food entries from",m.toISOString(),"to",h.toISOString(),"for user:",e.id);const{data:p,error:g}=await P.from("food_entries").select("*").eq("user_id",e.id).gte("created_at",m.toISOString()).lt("created_at",h.toISOString()).order("consumed",{ascending:!0}).order("created_at",{ascending:!1});if(console.log("ðŸ½ï¸ Food entries query result:",{data:p,error:g,userCalling:e.id,count:p?.length}),g)throw g;return p||[]},enabled:!!e?.id,staleTime:5*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,retry:3,retryDelay:m=>Math.min(1e3*2**m,3e4)}),o=bt({queryKey:or(e?.id||null,a),queryFn:()=>{const h=(n.data||[]).filter(p=>p.consumed);return{calories:h.reduce((p,g)=>p+g.calories,0),carbs:h.reduce((p,g)=>p+g.carbs,0)}},enabled:!!n.data,staleTime:5*60*1e3,gcTime:30*60*1e3}),i=yt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const{data:h,error:p}=await P.from("food_entries").insert({user_id:e.id,name:m.name,calories:m.calories,carbs:m.carbs,serving_size:m.serving_size,consumed:m.consumed??!0,image_url:m.image_url}).select().single();if(p)throw p;return h},onMutate:async m=>{await r.cancelQueries({queryKey:ze(e?.id||null,a)});const h=r.getQueryData(ze(e?.id||null,a)),p={id:`temp-${Date.now()}`,user_id:e?.id||"",name:m.name,calories:m.calories,carbs:m.carbs,serving_size:m.serving_size,consumed:m.consumed??!0,image_url:m.image_url,created_at:new Date().toISOString()};return r.setQueryData(ze(e?.id||null,a),(g=[])=>[p,...g]),{previousEntries:h}},onError:(m,h,p)=>{console.error("ðŸ”„ useFoodEntriesQuery: addFoodEntryMutation error:",m),console.error("ðŸ”„ useFoodEntriesQuery: Failed entry:",h),p?.previousEntries&&r.setQueryData(ze(e?.id||null,a),p.previousEntries);let g="Please try again.";m instanceof Error&&(m.message.includes("duplicate")?g="This food entry already exists.":m.message.includes("network")?g="Network error. Check your connection.":m.message.includes("permission")?g="Permission denied. Please log in again.":g=m.message||"Unknown error occurred."),s({title:"Error adding food entry",description:g,variant:"destructive"})},onSuccess:m=>{r.setQueryData(ze(e?.id||null,a),(h=[])=>{const p=h.filter(g=>!g.id.startsWith("temp-"));return[m,...p]}),r.invalidateQueries({queryKey:or(e?.id||null,a)})}}),l=yt({mutationFn:async({id:m,updates:h})=>{if(console.log("ðŸ½ï¸ Starting updateFoodEntryMutation with:",{id:m,updates:h}),!e)throw console.error("ðŸ½ï¸ Error: User not authenticated"),new Error("User not authenticated");console.log("ðŸ½ï¸ Current user ID:",e.id),console.log("ðŸ½ï¸ Checking if food entry exists...");const{data:p,error:g}=await P.from("food_entries").select("id, user_id, name").eq("id",m).maybeSingle();if(console.log("ðŸ½ï¸ Existing entry check:",{existingEntry:p,checkError:g}),g)throw console.error("ðŸ½ï¸ Error checking existing entry:",g),new Error(`Failed to check existing entry: ${g.message}`);if(!p)throw console.error("ðŸ½ï¸ Food entry not found in database"),new Error("Food entry not found");if(p.user_id!==e.id)throw console.error("ðŸ½ï¸ User ID mismatch:",{entryUserId:p.user_id,currentUserId:e.id}),new Error("Permission denied - entry belongs to different user");console.log("ðŸ½ï¸ Food entry found and belongs to user, proceeding with update...");const{data:x,error:v}=await P.from("food_entries").update(h).eq("id",m).eq("user_id",e.id).select().maybeSingle();if(console.log("ðŸ½ï¸ Update result:",{data:x,error:v}),v)throw console.error("ðŸ½ï¸ Database error:",v),v;if(!x)throw console.error("ðŸ½ï¸ No data returned from update"),new Error("Update failed - no data returned");return x},onMutate:async({id:m,updates:h})=>{await r.cancelQueries({queryKey:ze(e?.id||null,a)});const p=r.getQueryData(ze(e?.id||null,a));return r.setQueryData(ze(e?.id||null,a),(g=[])=>g.map(x=>x.id===m?{...x,...h}:x)),{previousEntries:p}},onSuccess:m=>{console.log("ðŸ½ï¸ Update successful:",m),r.invalidateQueries({queryKey:ze(e?.id||null,a)}),r.invalidateQueries({queryKey:or(e?.id||null,a)})},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData(ze(e?.id||null,a),p.previousEntries),console.error("ðŸ½ï¸ Update mutation error:",m),s({title:"Error updating food entry",description:`Database error: ${m.message||"Please try again."}`,variant:"destructive"})}}),d=yt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const{error:h}=await P.from("food_entries").delete().eq("id",m).eq("user_id",e.id);if(h)throw h},onMutate:async m=>{await r.cancelQueries({queryKey:ze(e?.id||null,a)});const h=r.getQueryData(ze(e?.id||null,a));return r.setQueryData(ze(e?.id||null,a),(p=[])=>p.filter(g=>g.id!==m)),{previousEntries:h}},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData(ze(e?.id||null,a),p.previousEntries),s({title:"Error deleting food entry",description:"Please try again.",variant:"destructive"})},onSuccess:()=>{r.invalidateQueries({queryKey:or(e?.id||null,a)})}}),f=yt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const h=n.data?.find(x=>x.id===m);if(!h)throw new Error("Entry not found");const{data:p,error:g}=await P.from("food_entries").update({consumed:!h.consumed}).eq("id",m).eq("user_id",e.id).select().single();if(g)throw g;return p},onMutate:async m=>{await r.cancelQueries({queryKey:ze(e?.id||null,a)});const h=r.getQueryData(ze(e?.id||null,a));return r.setQueryData(ze(e?.id||null,a),(p=[])=>p.map(g=>g.id===m?{...g,consumed:!g.consumed}:g)),{previousEntries:h}},onSuccess:m=>{const h=m.consumed?"Food marked as eaten":"Food returned to active list";s({title:h,description:"Food status updated successfully."}),r.invalidateQueries({queryKey:or(e?.id||null,a)})},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData(ze(e?.id||null,a),p.previousEntries),s({title:"Error updating food entry",description:"Please try again.",variant:"destructive"})}}),u=c.useCallback(async()=>{await r.refetchQueries({queryKey:ze(e?.id||null,a)}),await r.refetchQueries({queryKey:or(e?.id||null,a)})},[r,e?.id,a]);return{todayEntries:n.data||[],todayTotals:o.data||{calories:0,carbs:0},loading:n.isLoading,addFoodEntry:i.mutateAsync,updateFoodEntry:l.mutateAsync,deleteFoodEntry:d.mutateAsync,toggleConsumption:f.mutateAsync,refreshFoodEntries:u,isAddingEntry:i.isPending,isUpdatingEntry:l.isPending,isDeletingEntry:d.isPending,isTogglingConsumption:f.isPending}},Ap=()=>{const[e,s]=c.useState([]),[r,a]=c.useState(0),[n,o]=c.useState(!1),{user:i}=Se(),l=c.useCallback(async()=>{if(i){o(!0);try{const f=new Date().toISOString().split("T")[0],{data:u,error:m}=await P.from("manual_calorie_burns").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});if(m)throw m;const h=(u||[]).filter(g=>g.created_at.split("T")[0]===f);s(h);const p=h.reduce((g,x)=>g+x.calories_burned,0);a(p),console.log("ðŸ”¥ MANUAL CALORIE BURNS HOOK RESULT:",{totalAllEntries:(u||[]).length,todayEntriesCount:h.length,todayEntries:h?.map(g=>({activity:g.activity_name,calories:g.calories_burned,date:g.created_at.split("T")[0]})),calculatedTotal:p,todayDate:f,filterCheck:u?.map(g=>({burnDate:g.created_at.split("T")[0],today:f,matches:g.created_at.split("T")[0]===f}))})}catch(f){console.error("Error loading manual calorie burns:",f),s([]),a(0)}finally{o(!1)}}},[i]);c.useEffect(()=>{l()},[l]);const d=c.useCallback(async f=>{if(i)try{const{error:u}=await P.from("manual_calorie_burns").delete().eq("id",f).eq("user_id",i.id);if(u)throw u;await l()}catch(u){throw console.error("Error deleting manual calorie burn:",u),u}},[i,l]);return{manualBurns:e,todayTotal:r,loading:n,refreshManualBurns:l,deleteManualBurn:d}},Rp=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!1),{user:n}=Se(),{toast:o}=pe(),i=c.useCallback(async()=>{if(n)try{const f=new Date().toISOString().split("T")[0],{data:u,error:m}=await P.from("daily_activity_overrides").select("*").eq("user_id",n.id).eq("date",f).maybeSingle();if(m){console.error("Error fetching today's activity override:",m);return}s(u)}catch(f){console.error("Error in getTodayOverride:",f)}},[n]),l=c.useCallback(async(f,u=!1)=>{if(n){a(!0);try{const m=new Date().toISOString().split("T")[0];console.log("Setting activity override:",{activityLevel:f,isPermanent:u,userId:n.id,date:m});const{data:h,error:p}=await P.from("daily_activity_overrides").upsert({user_id:n.id,date:m,activity_level:f},{onConflict:"user_id,date"}).select().single();if(p)throw console.error("Database error setting activity override:",p),p;if(console.log("Successfully set activity override:",h),s(h),u){const{error:g}=await P.from("profiles").update({activity_level:f}).eq("user_id",n.id);g?(console.error("Error updating profile activity level:",g),o({variant:"destructive",title:"Profile Update Failed",description:"Today's override saved, but couldn't update your default activity level."})):o({title:"Activity Level Updated",description:"Your default activity level has been updated permanently."})}else o({title:"Activity Override Set",description:"Activity level changed for today only."})}catch(m){console.error("Error setting activity override:",m);let h="Unable to set activity override. Please try again.";m?.message?.includes("Failed to fetch")?h="Network connection issue. Please check your connection and try again.":m?.code&&(h=`Database error (${m.code}). Please try again.`),o({variant:"destructive",title:"Update Failed",description:h})}finally{a(!1)}}},[n,o]),d=c.useCallback(async()=>{if(!(!n||!e)){a(!0);try{const{error:f}=await P.from("daily_activity_overrides").delete().eq("id",e.id);if(f)throw f;s(null),o({title:"Override Cleared",description:"Reverted to your default activity level for today."})}catch(f){console.error("Error clearing activity override:",f),o({variant:"destructive",title:"Clear Failed",description:"Unable to clear override. Please try again."})}finally{a(!1)}}},[n,e,o]);return c.useEffect(()=>{n?i():s(null)},[n,i]),{todayOverride:e,loading:r,setActivityOverride:l,clearTodayOverride:d,refreshOverride:i}},Tk=(e,s)=>["daily-deficit-stable",e,s],Mk=(e,s)=>["bmr-tdee-stable",e,s],Un=()=>{const{user:e}=Se(),{profile:s}=Te(),{todayTotals:r}=$n(),{sessions:a}=$h(),{todayOverride:n}=Rp(),o=new Date().toISOString().split("T")[0],i=n?.activity_level||s?.activity_level||"sedentary",l=s?`${s.weight}-${s.height}-${s.age}-${i}-${s.manual_tdee_override||"auto"}`:"no-profile",{todayTotal:d,loading:f}=Ap(),u=bt({queryKey:Mk(e?.id||null,l),queryFn:()=>{if(!s?.weight||!s?.height||!s?.age)return{bmr:0,tdee:0};const g=s.weight,x=s.height,v=10*g+6.25*x-5*s.age+5;if(s.manual_tdee_override&&s.manual_tdee_override>0){const N=s.manual_tdee_override;return{bmr:Math.round(v),tdee:Math.round(N)}}const w={sedentary:1.2,"lightly-active":1.375,lightly_active:1.375,"moderately-active":1.55,moderately_active:1.55,"very-active":1.725,very_active:1.725,"extremely-active":1.9,extremely_active:1.9},y=n?.activity_level||s.activity_level||"sedentary",b=w[y]||1.2,j=v*b;return{bmr:Math.round(v),tdee:Math.round(j)}},enabled:!!s?.weight&&!!s?.height&&!!s?.age,staleTime:0,gcTime:0}),m=bt({queryKey:["walking-calories",e?.id,o],queryFn:()=>!a||!s?.weight?0:a.filter(v=>v.start_time.split("T")[0]===o).reduce((v,w)=>{if(w.calories_burned&&w.end_time)return v+w.calories_burned;if(w.session_state==="active"&&w.start_time&&w.speed_mph){const y=new Date,b=new Date(w.start_time),j=Math.max(0,(y.getTime()-b.getTime())/(1e3*60)),E={2:2.8,2.5:2.8,3:3.2,3.5:3.5,4:3.8,4.5:4.3,5:4.8}[w.speed_mph]||3.2,S=j/60,_=Math.round(E*s.weight*S);return v+_}return v},0),enabled:!!a&&!!s?.weight,staleTime:0,gcTime:0}),h=bt({queryKey:Tk(e?.id||null,o),queryFn:()=>{const g=u.data||{bmr:0,tdee:0},x=r?.calories||0,v=m.data||0,w=d||0,y=g.tdee+v+w,b=y-x;return{todayDeficit:Math.round(b),totalCaloriesBurned:Math.round(y),bmr:g.bmr,tdee:g.tdee,caloriesConsumed:x,walkingCalories:v,manualCalories:w,activityLevel:i}},enabled:!!u.data&&r!==void 0&&m.data!==void 0&&d!==void 0&&!f,staleTime:0,gcTime:10*60*1e3}),p=c.useCallback(async()=>{await m.refetch(),await h.refetch()},[m.refetch,h.refetch]);return{deficitData:h.data||{todayDeficit:0,totalCaloriesBurned:0,bmr:0,tdee:0,caloriesConsumed:0,walkingCalories:0,manualCalories:0,activityLevel:"sedentary"},loading:h.isLoading||u.isLoading,refreshDeficit:p}},jl=()=>{const{deficitData:e}=Un(),{profile:s}=Te();return c.useMemo(()=>{const a=s?.weight||null,n=s?.goal_weight||null,o=e.todayDeficit,i=Math.round(Math.max(0,o)/7.7*10)/10,l=Math.round(Math.max(0,o*30)/7.7*10)/10;if(!a||!n||a<=n)return{weeksToGoal:null,dailyDeficitNeeded:null,currentDeficit:o,goalWeight:n,currentWeight:a,weightToLose:null,fatInGrams:i,thirtyDayProjection:l};const d=a-n;let f;s?.units==="metric"?f=d*1e3:f=d*453.592;const u=f*7.7;let m=null,h=null;if(o>0){const g=u/o;m=Math.round(g/7*10)/10}s?.units;const p=(s?.units==="metric"?500:453.592)*7.7;return h=Math.round(p/7),{weeksToGoal:m,dailyDeficitNeeded:h,currentDeficit:o,goalWeight:n,currentWeight:a,weightToLose:d,fatInGrams:i,thirtyDayProjection:l}},[e.todayDeficit,s?.weight,s?.goal_weight,s?.units])},Pk=({isOpen:e,onClose:s,onResult:r,context:a="",title:n="AI Assistant",systemPrompt:o="You are a helpful AI assistant.",conversationType:i="general",proactiveMessage:l="",quickReplies:d=[],onFoodAdd:f})=>{c.useState("");const[u,m]=c.useState([]),[h,p]=c.useState(!1),[g,x]=c.useState(null),[v,w]=c.useState(null),[y,b]=c.useState(null),[j,N]=c.useState(null),[E,S]=c.useState(null),[_,C]=c.useState(!1),[k,T]=c.useState({title:"",content:""}),[D,W]=c.useState({}),[$,X]=c.useState({}),[V,G]=c.useState(new Set),L=c.useRef(null),B=c.useRef(null),de=c.useRef(null),te=c.useRef(null);Se();const{searchResults:Y,searchFoodsForEdit:oe,createEditPreview:O,applyEditPreview:Q}=kk(),[R,M]=c.useState([]),{currentSession:H,startFastingSession:U,endFastingSession:ee,cancelFastingSession:ue}=Qi(),{currentSession:be,startWalkingSession:je,endWalkingSession:Ue}=Js(),{profile:me,updateProfile:ve}=Te(),{isAdmin:z}=Xe(),{deficitData:he}=Un();jl(),c.useEffect(()=>{setTimeout(()=>{L.current?.scrollIntoView({behavior:"smooth",block:"end"})},100)},[u]),c.useEffect(()=>{g?.foods&&g.foods.length>0&&setTimeout(()=>{de.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[g?.foods]),c.useEffect(()=>{if(e){const I=[];if(a){const F={role:"assistant",content:a,timestamp:new Date};I.push(F)}if(l){const F={role:"assistant",content:l,timestamp:new Date};I.push(F)}m(I),x(null),w(null),b(null),G(new Set)}else e||(te.current&&te.current.cancelRecording(),setTimeout(()=>{m([]),N(null),S(null),C(!1),T({title:"",content:""}),W({}),X({}),x(null),w(null),b(null),G(new Set)},100))},[e,a,i,l]);const le=async(I,F=!1)=>{console.log("ðŸ“¤ sendToAI called:",{message:I,fromVoice:F,isProcessing:h}),p(!0);try{const q=u.map(_e=>({role:_e.role,content:_e.content}));let K=o;n==="Food Assistant"?K=`${o}

You are a comprehensive food tracking assistant. Your goals are to:

FOR ADDING FOODS:
1. IMMEDIATELY process food information and call add_multiple_foods
2. Be concise but helpful - when users ask about your reasoning or assumptions, provide brief explanations
3. CRITICAL QUANTITY HANDLING: When users specify a COUNT of items (e.g., "two cucumbers", "three bananas", "four apples"), create SEPARATE entries for each item. DO NOT aggregate quantities.
4. EXAMPLES OF CORRECT BEHAVIOR:
   - "two cucumbers" â†’ 2 separate cucumber entries (e.g., 150g each)
   - "three bananas each 120g" â†’ 3 separate banana entries at 120g each
   - "400g chicken" â†’ 1 chicken entry at 400g
   - "two Greek yogurts" â†’ 2 separate Greek yogurt entries
   - "200g of rice" â†’ 1 rice entry at 200g
5. Only aggregate when NO specific count is mentioned and user gives total weight
6. When making assumptions (like estimating portion sizes), briefly explain your reasoning when asked
7. Destination: default to today. If the user explicitly says template or library, pass destination accordingly

FOR EDITING/DELETING FOODS:
1. When users want to edit/change/delete/remove foods, FIRST call search_foods_for_edit to find the item
2. Context hints:
   - "today's food", "my lunch", "the chicken I ate" â†’ context: "today"
   - "in my library", "my saved foods" â†’ context: "library"
   - "my template" â†’ context: "templates"
3. For deletion phrases like "I didn't eat that", "remove it", "delete the banana":
   - search_foods_for_edit first (context defaults to today)
   - then call delete_food_entry (or delete_library_food for library items)
4. For updates, after finding foods, call edit_food_entry or edit_library_food

FORMATS:
- For adding: list each as "Name (Xg) - Y cal, Zg carbs" and include Total line
- For editing/deleting: call the tool first, then a short confirmation

CRITICAL: Always use function calls for food operations.`:n==="Motivator Assistant"&&(K=`${o}

You are a motivational goal creation assistant. Your task is to:

**FOR SINGLE MOTIVATORS:**
1. If user mentions ONE goal/motivation, use create_motivator function
2. Extract the key motivation from what they said
3. Create a short, punchy title (3-8 words max)
4. Write compelling content that includes their specific trigger/motivation

**FOR MULTIPLE MOTIVATORS:**
1. If user mentions MULTIPLE goals/motivations, use create_multiple_motivators function
2. Parse each distinct goal into a separate motivator
3. Examples of multiple goals:
   - "I want to lose weight, feel confident, and impress my friends" = 3 motivators
   - "Create motivators for my health and fitness goals" = multiple health/fitness motivators
   - "I need goals for weight loss, exercise, and confidence" = 3 motivators

**FOR EDITING/DELETING MOTIVATORS:**
1. When users want to edit/change/modify their goals, use edit_motivator function
2. When users want to delete/remove their goals, use delete_motivator function
3. Listen for phrases like "edit my goal", "change that motivator", "delete my weight loss goal", "remove that", etc.

**CRITICAL RULES:**
- ALWAYS call the appropriate function immediately - no questions or discussions
- For multiple goals, ALWAYS use create_multiple_motivators, not individual create_motivator calls
- Create the motivators directly based on what they told you
- Each motivator should be distinct and focused on one specific goal
- Support editing and deleting motivators through voice commands`);const{data:se,error:nt}=await P.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:K},...q,{role:"user",content:I}]}});if(nt)throw nt;if(console.log("ðŸ¤– AI Response received:",{data:se,completion:se?.completion,functionCall:se?.functionCall}),se.functionCall){if(se.functionCall.name==="add_multiple_foods"){const _e=se.functionCall.arguments?.foods||[];x({foods:_e,destination:se.functionCall.arguments?.destination||"today",added:!1}),G(new Set(_e.map((Re,Ps)=>Ps)));return}else if(se.functionCall.name==="create_multiple_motivators"){b(se.functionCall.arguments);return}else if(se.functionCall.name==="create_motivator"){w(se.functionCall);const _e=se.functionCall.arguments,Re={role:"assistant",content:`${_e.title}

${_e.content}`,timestamp:new Date};m(Ps=>[...Ps,Re]);return}else if(se.functionCall.name==="search_foods_for_edit"){const{search_term:_e,context:Re}=se.functionCall.arguments;await xa(_e,Re);return}else if(se.functionCall.name==="edit_food_entry"){const{entry_id:_e,updates:Re}=se.functionCall.arguments;await Mr(_e,Re,"today");return}else if(se.functionCall.name==="edit_library_food"){const{food_id:_e,updates:Re}=se.functionCall.arguments;await Mr(_e,Re,"library");return}else if(se.functionCall.name==="delete_food_entry"||se.functionCall.name==="delete_library_food"){await r?.(se.functionCall);return}else if(se.functionCall.name==="start_fasting_session"){await Wn(se.functionCall.arguments);return}else if(se.functionCall.name==="stop_fasting_session"){await ye(se.functionCall.arguments);return}else if(se.functionCall.name==="start_walking_session"){await Ee(se.functionCall.arguments);return}else if(se.functionCall.name==="stop_walking_session"){await ke();return}else if(se.functionCall.name==="get_current_session_status"){await Et();return}else if(se.functionCall.name==="get_current_fast_duration"){await Tt();return}else if(se.functionCall.name==="get_current_walk_duration"){await sr();return}else if(se.functionCall.name==="get_today_deficit"){await Bn();return}else if(se.functionCall.name==="add_admin_personal_log"){await Fp(se.functionCall.arguments);return}else if(se.functionCall.name==="get_admin_personal_log"){await Op(se.functionCall.arguments);return}else if(se.functionCall.name==="update_weight"){await Lp(se.functionCall.arguments);return}else if(se.functionCall.name==="update_goal_weight"){await $p(se.functionCall.arguments);return}else if(se.functionCall.name==="update_daily_goals"){await Up(se.functionCall.arguments);return}else if(se.functionCall.name==="get_weight_loss_projection"){await zp();return}}if(se.completion&&se.completion.trim()&&!qp(se.completion)&&!se.functionCall){const _e={role:"assistant",content:se.completion,timestamp:new Date};m(Re=>[...Re,_e])}else if(se.functionCall&&(!se.completion||!se.completion.trim())){let _e="";switch(se.functionCall.name){case"add_multiple_foods":break;case"create_motivator":case"create_multiple_motivators":break;case"start_fasting_session":_e="Fasting session started successfully!";break;case"stop_fasting_session":_e="Fasting session stopped. Great work!";break;case"start_walking_session":_e="Walking session started!";break;case"stop_walking_session":_e="Walking session completed successfully!";break;case"search_foods_for_edit":case"edit_food_entry":case"edit_library_food":case"delete_food_entry":case"delete_library_food":_e="Food operation completed successfully.";break;default:_e="Request processed successfully."}if(_e){const Re={role:"assistant",content:_e,timestamp:new Date};m(Ps=>[...Ps,Re])}}}catch(q){console.error("Error sending message to AI:",q),Le({title:"Error",description:q?.message||"Failed to send message. Please try again.",variant:"destructive"})}finally{p(!1)}},J=async I=>{if(console.log("ðŸŽ¤ Voice transcription received:",I),!I.trim())return;const F={role:"user",content:I,timestamp:new Date};console.log("ðŸ‘¤ Adding user voice message to chat"),m(q=>[...q,F]),await le(I,!0)},ce=I=>{if(g?.foods&&g.foods[I]){const F=g.foods[I];W(q=>({...q,[I]:{name:F.name||"",portion:F.serving_size?.toString()||"",calories:F.calories?.toString()||"",carbs:F.carbs?.toString()||""}})),N(I)}},it=I=>{const F=D[I];if(F&&g?.foods){const q=[...g.foods];q[I]={...q[I],name:F.name,serving_size:parseInt(F.portion)||0,calories:parseInt(F.calories)||0,carbs:parseInt(F.carbs)||0},x(K=>({...K,foods:q})),N(null),W(K=>{const se={...K};return delete se[I],se})}},at=I=>{N(null),W(F=>{const q={...F};return delete q[I],q})},Er=I=>{if(g?.foods){const F=g.foods.filter((q,K)=>K!==I);x(q=>({...q,foods:F})),G(q=>{const K=new Set;return Array.from(q).forEach(se=>{se<I?K.add(se):se>I&&K.add(se-1)}),K}),j===I&&(N(null),W(q=>{const K={...q};return delete K[I],K}))}},fa=async()=>{if(!(!g?.foods||h)){p(!0);try{const I=g.destination||"today",F=g.foods.filter((q,K)=>V.has(K));if(F.length===0){Le({title:"No foods selected",description:"Please select at least one food to add.",variant:"destructive"}),p(!1);return}f?await f(F,I):r&&await r({name:"add_multiple_foods",arguments:{foods:F,destination:I}}),x(q=>({...q,added:!0})),Le({title:"Foods added successfully",description:`Added ${F.length} foods to your ${I}`}),setTimeout(()=>{s()},2e3)}catch(I){console.error("Error adding foods:",I),Le({title:"Error",description:"Failed to add foods. Please try again.",variant:"destructive"})}finally{p(!1)}}},Tr=async()=>{if(v&&r){console.log("ðŸŽ¯ Creating motivator with data:",v),console.log("ðŸŽ¯ Motivator arguments:",v.arguments);try{console.log("ðŸŽ¯ Calling onResult with:",v),await r(v);const I={role:"assistant",content:"Motivator created successfully! You can now view it in your motivators list.",timestamp:new Date};m(F=>[...F,I]),w(null),Le({title:"Motivator created!",description:"Your new motivator has been added to your collection"}),setTimeout(()=>{s()},2e3)}catch(I){console.error("Error creating motivator:",I),Le({title:"Error",description:"Failed to create motivator. Please try again.",variant:"destructive"})}}},fs=I=>{if(y?.motivators&&y.motivators[I]){const F=y.motivators[I];X(q=>({...q,[I]:{title:F.title||"",content:F.content||"",category:F.category||""}})),S(I)}},pa=I=>{const F=$[I];if(F&&y?.motivators){const q=[...y.motivators];q[I]={...q[I],title:F.title,content:F.content,category:F.category||q[I].category},b(K=>({...K,motivators:q})),S(null),X(K=>{const se={...K};return delete se[I],se})}},ps=I=>{S(null),X(F=>{const q={...F};return delete q[I],q})},ga=I=>{if(y?.motivators){const F=y.motivators.filter((q,K)=>K!==I);b(q=>({...q,motivators:F})),E===I&&(S(null),X(q=>{const K={...q};return delete K[I],K}))}},zn=async()=>{if(y?.motivators&&r){p(!0);try{await r({name:"create_multiple_motivators",arguments:{motivators:y.motivators}});const I={role:"assistant",content:`âœ… Created ${y.motivators.length} motivators successfully!`,timestamp:new Date};m(F=>[...F,I]),b(F=>({...F,added:!0})),setTimeout(()=>{s()},2e3)}catch(I){console.error("Error adding motivators:",I),Le({title:"Error",description:"Failed to create motivators. Please try again.",variant:"destructive"})}finally{p(!1)}}},xa=async(I,F)=>{try{const q=await oe(I,F);if(q.length===0){const nt={role:"assistant",content:`I couldn't find any ${F==="today"?"today's entries":F} matching "${I}". Try a different search term or check the specific location.`,timestamp:new Date};m(_e=>[..._e,nt]);return}const K=q.map(nt=>`â€¢ ${nt.name} (${nt.type==="today"?"Today":nt.type==="library"?"Library":"Template"})`).join(`
`),se={role:"assistant",content:`Found ${q.length} food(s) matching "${I}":

${K}

Tell me what you'd like to change. For example: "Change the chicken to 150g" or "Update the banana calories to 120".`,timestamp:new Date};m(nt=>[...nt,se])}catch(q){console.error("Error searching foods:",q),Le({title:"Search Error",description:"Failed to search for foods. Please try again.",variant:"destructive"})}},Mr=async(I,F,q)=>{try{const K=Y.find(Re=>Re.id===I);if(!K)throw new Error("Food item not found for editing");const se=O(K,F);M(Re=>[...Re,se]);const nt=Object.keys(F).map(Re=>{const Ps=K.current_values[Re],Wp=F[Re];return`${Re.replace("_"," ")}: ${Ps} â†’ ${Wp}`}).join(", "),_e={role:"assistant",content:`Ready to update ${K.name}: ${nt}. Please confirm the changes below.`,timestamp:new Date};m(Re=>[...Re,_e])}catch(K){console.error("Error creating edit preview:",K),Le({title:"Edit Error",description:"Failed to prepare food edit. Please try again.",variant:"destructive"})}},qn=async I=>{try{await Q(I),M(q=>q.filter(K=>K.id!==I.id));const F={role:"assistant",content:`âœ… Successfully updated ${I.name}!`,timestamp:new Date};m(q=>[...q,F])}catch(F){console.error("Error applying edit:",F)}},Pr=I=>{M(q=>q.filter(K=>K.id!==I.id));const F={role:"assistant",content:`Cancelled editing ${I.name}.`,timestamp:new Date};m(q=>[...q,F])},Yt=I=>{const F={role:"assistant",content:`Opening manual editor for ${I.name}. Tell me what specific changes you'd like to make.`,timestamp:new Date};m(q=>[...q,F])},Wn=async I=>{try{const F=I.goal_hours||16;await U(F*3600);const q={role:"assistant",content:`âœ… Started fasting! Your goal is ${F} hours. I'll be here to support you throughout your journey.`,timestamp:new Date};m(K=>[...K,q])}catch(F){const q={role:"assistant",content:`âŒ Failed to start fasting session. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},ye=async I=>{try{I.action==="complete"?await ee():await ue();const F={role:"assistant",content:I.action==="complete"?"ðŸŽ‰ Congratulations on completing your fast! Well done!":"Fast cancelled. No worries - you can start again whenever you're ready.",timestamp:new Date};m(q=>[...q,F])}catch(F){const q={role:"assistant",content:`âŒ Failed to ${I.action} fasting session. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},Ee=async I=>{try{const F=I.speed_mph||me?.default_walking_speed||3;await je(F);const q={role:"assistant",content:`ðŸš¶â€â™€ï¸ Started walking at ${F>=4?"fast":"normal"} pace! Enjoy your walk - I'll track your progress.`,timestamp:new Date};m(K=>[...K,q])}catch(F){const q={role:"assistant",content:`âŒ Failed to start walking session. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},ke=async()=>{try{await Ue();const I={role:"assistant",content:"ðŸŽ‰ Great walk! Session completed and calories have been logged.",timestamp:new Date};m(F=>[...F,I])}catch(I){const F={role:"assistant",content:`âŒ Failed to end walking session. ${I.message}`,timestamp:new Date};m(q=>[...q,F])}},Et=async()=>{let I="";if(H){const q=Math.floor((Date.now()-new Date(H.start_time).getTime())/36e5);I+=`ðŸ• Currently fasting for ${q} hours. `}if(be){const q=Math.floor((Date.now()-new Date(be.start_time).getTime())/6e4);I+=`ðŸš¶â€â™€ï¸ Currently walking for ${q} minutes. `}I||(I="No active sessions right now. Ready to start when you are!");const F={role:"assistant",content:I,timestamp:new Date};m(q=>[...q,F])},Tt=async()=>{if(!H){const se={role:"assistant",content:"You're not currently fasting. Ready to start when you are!",timestamp:new Date};m(nt=>[...nt,se]);return}const I=Math.floor((Date.now()-new Date(H.start_time).getTime())/(1e3*60*60)),F=Math.floor(I),q=Math.floor((I-F)*60),K={role:"assistant",content:`ðŸ• You've been fasting for ${F} hours and ${q} minutes. Keep going strong!`,timestamp:new Date};m(se=>[...se,K])},sr=async()=>{if(!be){const q={role:"assistant",content:"You're not currently walking. Ready for a walk?",timestamp:new Date};m(K=>[...K,q]);return}const F={role:"assistant",content:`ðŸš¶â€â™€ï¸ You've been walking for ${Math.floor((Date.now()-new Date(be.start_time).getTime())/(1e3*60))} minutes. Great job!`,timestamp:new Date};m(q=>[...q,F])},Bn=async()=>{const I=he?.todayDeficit||0,F=he?.caloriesConsumed||0,q=he?.totalCaloriesBurned||0,K={role:"assistant",content:`ðŸ“Š Today's progress: ${Math.abs(I)} calorie ${I>=0?"deficit":"surplus"}. You've consumed ${F} calories and burned ${q} calories.`,timestamp:new Date};m(se=>[...se,K])},Fp=async I=>{if(!z){const F={role:"assistant",content:"âŒ Admin access required for personal logs.",timestamp:new Date};m(q=>[...q,F]);return}try{const{error:F}=await P.from("fasting_hours").update({admin_personal_log:I.log_entry}).eq("hour",I.hour);if(F)throw F;const q={role:"assistant",content:`âœ… Added personal log for hour ${I.hour}.`,timestamp:new Date};m(K=>[...K,q])}catch(F){const q={role:"assistant",content:`âŒ Failed to add personal log. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},Op=async I=>{if(!z){const F={role:"assistant",content:"âŒ Admin access required for personal logs.",timestamp:new Date};m(q=>[...q,F]);return}try{let F=P.from("fasting_hours").select("hour, admin_personal_log").not("admin_personal_log","is",null);I.hour&&(F=F.eq("hour",I.hour));const{data:q,error:K}=await F.order("hour");if(K)throw K;if(!q||q.length===0){const _e={role:"assistant",content:I.hour?`No personal log found for hour ${I.hour}.`:"No personal logs found.",timestamp:new Date};m(Re=>[...Re,_e]);return}const nt={role:"assistant",content:q.map(_e=>`Hour ${_e.hour}: ${_e.admin_personal_log}`).join(`

`),timestamp:new Date};m(_e=>[..._e,nt])}catch(F){const q={role:"assistant",content:`âŒ Failed to get personal logs. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},Lp=async I=>{try{await ve({weight:I.weight_kg});const F={role:"assistant",content:`âœ… Updated your weight to ${I.weight_kg} kg.`,timestamp:new Date};m(q=>[...q,F])}catch(F){const q={role:"assistant",content:`âŒ Failed to update weight. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},$p=async I=>{try{await ve({goal_weight:I.goal_weight_kg});const F={role:"assistant",content:`âœ… Updated your goal weight to ${I.goal_weight_kg} kg.`,timestamp:new Date};m(q=>[...q,F])}catch(F){const q={role:"assistant",content:`âŒ Failed to update goal weight. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},Up=async I=>{try{const F={};I.daily_calorie_goal&&(F.daily_calorie_goal=I.daily_calorie_goal),I.daily_carb_goal&&(F.daily_carb_goal=I.daily_carb_goal),await ve(F);const q=[];I.daily_calorie_goal&&q.push(`calories to ${I.daily_calorie_goal}`),I.daily_carb_goal&&q.push(`carbs to ${I.daily_carb_goal}g`);const K={role:"assistant",content:`âœ… Updated your daily goals: ${q.join(", ")}.`,timestamp:new Date};m(se=>[...se,K])}catch(F){const q={role:"assistant",content:`âŒ Failed to update daily goals. ${F.message}`,timestamp:new Date};m(K=>[...K,q])}},zp=async()=>{if(!me?.weight||!me?.goal_weight){const I={role:"assistant",content:"Please set your current weight and goal weight first to get projections.",timestamp:new Date};m(F=>[...F,I]);return}try{const I=me.weight-me.goal_weight,F=I*1e3*.85,q=he?.todayDeficit||500,K=Math.ceil(F/q),se={role:"assistant",content:`ðŸ“ˆ Weight loss projection: You need to lose ${I.toFixed(1)} kg (${F.toFixed(0)}g of fat). At your current deficit rate of ${q} calories/day, you'll reach your goal in approximately ${K} days.`,timestamp:new Date};m(nt=>[...nt,se])}catch(I){const F={role:"assistant",content:`âŒ Failed to calculate projection. ${I.message}`,timestamp:new Date};m(q=>[...q,F])}},qp=I=>{const q=["calories","carbs","grams","add this","add it","food log"].some(se=>I.toLowerCase().includes(se));I.includes("?");const K=/\d+\s*(calories|cal|grams?|g\b)/i.test(I);return q&&!I.toLowerCase().includes("what food")&&(K||I.toLowerCase().includes("add"))};return t.jsxs(mt,{isOpen:e,onClose:s,title:n,variant:"standard",size:"sm",showCloseButton:!0,children:[t.jsxs("div",{className:"space-y-6 min-h-[300px] max-h-[400px] overflow-y-auto mb-4",children:[u.map((I,F)=>t.jsx("div",{className:`flex ${I.role==="user"?"justify-end":"justify-start"}`,children:t.jsx(ie,{className:`max-w-[85%] p-3 ${I.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:t.jsx("div",{className:"flex items-start gap-2",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:I.content}),I.role==="assistant"&&I.content.includes("Need to make adjustments?")&&t.jsx("div",{className:"flex justify-center mt-3",children:t.jsx(Bt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(fr,{onTranscription:J,isDisabled:h,size:"sm"})})}),i==="general"&&n==="Motivator Assistant"&&I.role==="assistant"&&v&&t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsx(A,{size:"sm",onClick:Tr,className:"text-xs bg-primary text-primary-foreground",children:"Create This Motivator"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>{C(!0),setTimeout(()=>{B.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},className:"text-xs",children:"Edit Language"})]}),t.jsx("p",{className:"text-xs opacity-70 mt-2",children:I.timestamp.toLocaleTimeString()})]})})})},F)),_&&v&&t.jsx("div",{ref:B,className:"mt-4 p-4 border-2 border-primary/50 rounded-lg bg-primary/5",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium text-sm",children:"Edit Your Motivator"}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"motivator-title",className:"text-sm font-medium",children:"Goal Title"}),t.jsx(ge,{id:"motivator-title",value:k.title||v.arguments.title,onChange:I=>T(F=>({...F,title:I.target.value})),className:"mt-1",placeholder:"Enter motivating title"})]}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"motivator-content",className:"text-sm font-medium",children:"Goal Description"}),t.jsx("textarea",{id:"motivator-content",value:k.content||v.arguments.content,onChange:I=>T(F=>({...F,content:I.target.value})),className:"mt-1 w-full p-2 border border-input rounded-md resize-none h-20 text-sm",placeholder:"Describe your motivating goal"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(A,{size:"sm",onClick:()=>{const I=k.title||v.arguments.title,F=k.content||v.arguments.content,q={...v.arguments,title:I,content:F};w(K=>({...K,arguments:q})),m(K=>K.map(se=>se.role==="assistant"&&se.content.includes(v.arguments.title)&&se.content.includes(v.arguments.content)?{...se,content:`${I}

${F}`}:se)),C(!1),T({title:"",content:""}),Le({title:"Changes saved",description:"Your motivator has been updated"})},className:"flex-1",children:"Save"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>{C(!1),T({title:"",content:""})},className:"flex-1",children:"Cancel"})]})]})}),R.length>0&&t.jsx("div",{className:"space-y-2",children:R.map((I,F)=>t.jsx(Ek,{preview:I,onConfirm:()=>qn(I),onCancel:()=>Pr(I),onEdit:()=>Yt(I)},`${I.id}-${F}`))}),y?.motivators&&y.motivators.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(ie,{className:"p-3 bg-muted/50",children:t.jsxs("div",{className:"text-sm font-medium",children:[y.motivators.length," Motivators Ready",y.added&&t.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"âœ… Created successfully"})]})}),y.motivators.map((I,F)=>t.jsx(ie,{className:"p-3 bg-background border",children:E===F?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Title"}),t.jsx(ge,{value:$[F]?.title||"",onChange:q=>X(K=>({...K,[F]:{...K[F],title:q.target.value}})),placeholder:"Motivator title",className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Content"}),t.jsx("textarea",{value:$[F]?.content||"",onChange:q=>X(K=>({...K,[F]:{...K[F],content:q.target.value}})),placeholder:"Motivational content",className:"w-full p-2 border border-input rounded-md resize-none h-16 text-sm"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(A,{size:"sm",onClick:()=>pa(F),className:"h-8 px-3 text-sm flex-1",children:"Save"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>ps(F),className:"h-8 px-3 text-sm flex-1",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium",children:I.title}),t.jsx("div",{className:"text-xs text-muted-foreground mt-1 leading-relaxed",children:I.content}),I.category&&t.jsxs("div",{className:"text-xs text-primary mt-1 font-medium",children:["#",I.category]})]}),!y.added&&t.jsxs("div",{className:"flex gap-1 ml-3",children:[t.jsx(A,{size:"sm",variant:"outline",onClick:()=>fs(F),className:"h-8 px-3 text-sm",children:"Edit"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>ga(F),className:"h-8 px-3 text-sm text-destructive",children:"Remove"})]})]})},F)),!y.added&&t.jsx("div",{className:"flex gap-2 mt-3",children:t.jsx(A,{size:"sm",onClick:zn,className:"flex-1",disabled:h,children:h?"Creating...":`Create All ${y.motivators.length} Motivators`})})]}),g?.foods&&g.foods.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(ie,{ref:de,className:"p-3 bg-muted/50",children:t.jsxs("div",{className:"text-sm font-medium",children:["Selected: ",Array.from(V).reduce((I,F)=>{const q=g.foods[F];return I+(q?.calories||0)},0)," calories, ",Math.round(Array.from(V).reduce((I,F)=>{const q=g.foods[F];return I+(q?.carbs||0)},0)),"g carbs",g.added&&t.jsx("span",{className:"ml-2 text-green-600 text-xs",children:"âœ… Added to log"})]})}),g.foods.map((I,F)=>t.jsx(ie,{className:"p-3 bg-background border",children:j===F?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{value:D[F]?.name||"",onChange:q=>W(K=>({...K,[F]:{...K[F],name:q.target.value}})),placeholder:"Food name",className:"h-8 text-sm"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Weight (g)"}),t.jsx(ge,{type:"number",value:D[F]?.portion||"",onChange:q=>W(K=>({...K,[F]:{...K[F],portion:q.target.value}})),className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Calories"}),t.jsx(ge,{type:"number",value:D[F]?.calories||"",onChange:q=>W(K=>({...K,[F]:{...K[F],calories:q.target.value}})),className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Carbs (g)"}),t.jsx(ge,{type:"number",value:D[F]?.carbs||"",onChange:q=>W(K=>({...K,[F]:{...K[F],carbs:q.target.value}})),className:"h-8 text-sm"})]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(A,{size:"sm",onClick:()=>it(F),className:"h-8 px-3 text-sm flex-1",children:"Save"}),t.jsx(A,{size:"sm",variant:"outline",onClick:()=>at(F),className:"h-8 px-3 text-sm flex-1",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[!g.added&&t.jsx(qi,{checked:V.has(F),onCheckedChange:q=>{const K=new Set(V);q?K.add(F):K.delete(F),G(K)},className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium truncate",children:I.name}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[I.serving_size,"g â€¢ ",I.calories," cal â€¢ ",Math.round(I.carbs),"g carbs"]})]}),!g.added&&t.jsxs("div",{className:"flex gap-1 shrink-0",children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>ce(F),className:"h-7 w-7 p-0",children:t.jsx(ut,{className:"h-3 w-3"})}),t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>Er(F),className:"h-7 w-7 p-0 text-destructive hover:text-destructive",children:t.jsx(Ie,{className:"h-3 w-3"})})]})]})},F)),!g.added&&t.jsxs("div",{className:"sticky bottom-0 bg-background/90 backdrop-blur supports-[backdrop-filter]:bg-background/70 border-t pt-3 pb-2 px-1 mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Add to"}),t.jsx("div",{className:"flex gap-1",children:["today","template","library"].map(I=>t.jsx(A,{size:"sm",variant:(g.destination||"today")===I?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>x(F=>({...F,destination:I})),children:I.charAt(0).toUpperCase()+I.slice(1)},I))})]}),t.jsx(A,{size:"sm",onClick:fa,className:"w-full bg-green-600 hover:bg-green-700 text-white",disabled:h||V.size===0,children:h?"Adding...":`Add ${V.size} Selected Food${V.size!==1?"s":""}`})]})]}),h&&t.jsx("div",{className:"flex justify-start",children:t.jsx(ie,{className:"max-w-[85%] p-3 bg-muted",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),t.jsx("p",{className:"text-sm",children:"AI is thinking..."})]})})}),t.jsx("div",{ref:L,className:"h-4"})]}),j===null&&t.jsx("div",{className:"border-t border-border pt-4 mt-4 space-y-3",children:t.jsx("div",{className:"w-full flex justify-center",children:t.jsx(Bt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(fr,{ref:te,onTranscription:J,isDisabled:h,size:"lg",autoStart:!0})})})})]})},Dk=[{value:"grams",label:"g"},{value:"milliliters",label:"ml"}],zc=()=>Dk,qc=()=>"grams",Ak=e=>{switch(e){case"grams":return"g";case"milliliters":case"ml":return"ml";default:return e.charAt(0).toUpperCase()+e.slice(1)}},Rk=e=>{if(!e)return null;const s=e.replace(/,/g,".").toLowerCase(),r=s.match(/(-?\d+(?:\.\d+)?)/);if(r){const d=parseFloat(r[1]);if(!Number.isNaN(d))return d}const a={zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90,hundred:100},n=s.split(/\s+/);let o=0,i=0,l=!1;for(const d of n)if(d in a){l=!0;const f=a[d];f===100&&i>0?i*=100:i+=f}else if(l)break;return o=i,l&&o>0?o:null},ka=({onTranscription:e,parseNumbers:s=!1,className:r=""})=>{const[a,n]=c.useState(!1),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[f,u]=c.useState(!1),m=w=>{if(d(!1),u(!0),s){const y=Rk(w);e(y!==null?y.toString():w)}else e(w);setTimeout(()=>{u(!1),n(!1)},1e3)},h=w=>{i(w),!w&&a&&d(!0)},p=()=>{a||n(!0)};let g=Ns,x="w-3 h-3",v=`absolute right-2 top-1/2 transform -translate-y-1/2 w-5 h-5 rounded-full transition-all duration-200 flex items-center justify-center z-10 ${r}`;return f?(g=Gs,v+=" bg-green-500 text-white"):l?(g=zt,x+=" animate-spin",v+=" bg-ai text-ai-foreground"):o?(g=Ns,v+=" bg-red-500 text-white animate-pulse"):v+=" bg-ai hover:bg-ai/90 text-ai-foreground",t.jsxs(t.Fragment,{children:[t.jsx(Bt,{feature:"Voice Input",showUpgrade:!1,children:t.jsx("button",{type:"button",onClick:p,className:v,disabled:a,children:t.jsx(g,{className:x})})}),a&&t.jsx("div",{className:"hidden",children:t.jsx(fr,{onTranscription:m,onRecordingStateChange:h,autoStart:!0,size:"sm"})})]})},Ik=({isOpen:e,onClose:s,onSave:r})=>{const{toast:a}=pe();Se();const{profile:n}=Te(),{hasPremiumFeatures:o}=Xe(),i=o,[l,d]=c.useState(null),[f,u]=c.useState(!1),[m,h]=c.useState(null),[p,g]=c.useState(null),[x,v]=c.useState(""),[w,y]=c.useState("100"),[b,j]=c.useState(""),[N,E]=c.useState(""),[S,_]=c.useState("0"),[C,k]=c.useState(1),[T,D]=c.useState(!1),[W,$]=c.useState("per100g"),[X,V]=c.useState(!1);c.useEffect(()=>{if(n&&!b){const R=qc();j(R)}},[n,b]);const G=async R=>{d(R),h(null),g(null),i&&await L(R)},L=async R=>{try{u(!0),g(null);const{data:M,error:H}=await P.functions.invoke("analyze-food-image",{body:{imageUrl:R}});if(H)throw H;const U=M;if(h(U),U.name&&!x&&v(U.name),U.estimated_serving_size&&!w&&y(U.estimated_serving_size.toString()),U.estimated_serving_size&&!N&&!S){const ee=U.calories_per_100g||0,ue=Math.round(ee*U.estimated_serving_size/100);E(ue.toString());const be=U.carbs_per_100g||0,je=Math.round(be*U.estimated_serving_size/100);_(je.toString())}a({title:"Analysis complete",description:"Food detected! Review and adjust if needed."})}catch(M){console.error("Analyze error",M),g("Failed to analyze image"),a({title:"Analysis failed",description:"Please try another photo or enter details manually.",variant:"destructive"})}finally{u(!1)}},B=async()=>{if(!x||!w||!b){a({title:"Missing information",description:"Please enter food name, amount, and unit first",variant:"destructive"});return}V(!0);try{const{data:R,error:M}=await P.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:'You are a nutrition expert. Respond with JSON format: {"calories": number, "carbs": number}. Always provide precise nutritional values for the EXACT amount requested.'},{role:"user",content:`For exactly ${w} ${b} of ${x}, provide the total calories and carbs in grams for that specific amount. Return only valid JSON.`}]}});if(M)throw new Error(M.message||"Unknown error from AI service");if(!R)throw new Error("No response from AI service");const H=R.completion||R.response||"";try{const U=JSON.parse(H);if(typeof U.calories=="number"&&typeof U.carbs=="number"){E(U.calories.toString()),_(U.carbs.toString()),a({title:"Nutrition estimated",description:`AI estimated ${U.calories} calories and ${U.carbs}g carbs for ${w} ${b}`});return}}catch{const U=H.match(/calories["\s:]+(\d+(?:\.\d+)?)/i),ee=H.match(/carbs["\s:]+(\d+(?:\.\d+)?)/i);if(U&&ee){E(U[1]),_(ee[1]),a({title:"Nutrition estimated",description:"AI estimates applied successfully"});return}}a({title:"Could not parse AI response",description:"Please enter manually.",variant:"destructive"})}catch(R){a({title:"AI estimation failed",description:`${R instanceof Error?R.message:"Unknown error"}`,variant:"destructive"})}finally{V(!1)}},de=R=>{const M=R.toLowerCase();return M.includes("milk")||M.includes("water")||M.includes("juice")||M.includes("drink")||M.includes("soda")||M.includes("coffee")?"milliliters":"grams"},te=R=>{if(v(R),R&&!b){const M=de(R);zc().some(U=>U.value===M)&&j(M)}},Y=async()=>{if(!x.trim()){a({title:"Food name required",variant:"destructive"});return}if(!N||!w){a({title:"Required fields missing",description:"Please fill in amount and calories",variant:"destructive"});return}D(!0);try{const R={name:x.trim(),serving_size:parseFloat(w)*C,calories:parseFloat(N)*C,carbs:(S?parseFloat(S):0)*C,consumed:!1,image_url:l};await r(R),Zo("add",l?"image":"manual"),oe(),s()}catch{a({title:"Failed to save food",description:"Please try again.",variant:"destructive"})}finally{D(!1)}},oe=()=>{d(null),h(null),g(null),v(""),y("100"),j(qc()),E(""),_("0"),k(1)},O=()=>{oe(),s()},Q=()=>{d(null),h(null),g(null)};return t.jsxs(mt,{isOpen:e,onClose:O,title:"Add Food",variant:"standard",size:"md",showCloseButton:!0,children:[l?t.jsxs("div",{className:"w-full h-48 mb-4 relative",children:[t.jsx("img",{src:l,alt:x||"Food",className:"w-full h-full object-cover rounded-lg"}),t.jsx(A,{variant:"outline",size:"sm",onClick:Q,className:"absolute top-2 right-2",children:t.jsx(ux,{className:"w-4 h-4"})})]}):t.jsx("div",{className:"mb-4",children:t.jsx(Bt,{feature:"Image Upload",grayOutForFree:!0,children:t.jsx(ol,{onImageUpload:G,currentImageUrl:l,bucket:"food-images"})})}),f&&t.jsxs("div",{className:"flex items-center justify-center p-4 bg-muted/50 rounded-lg mb-4",children:[t.jsx(zt,{className:"w-5 h-5 mr-3 animate-spin"}),t.jsx("span",{className:"text-sm",children:"Analyzing nutritional information..."})]}),p&&t.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg mb-4",children:t.jsx("p",{className:"text-sm text-destructive",children:p})}),m&&t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Br,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"AI Analysis"}),m.confidence&&t.jsxs(js,{variant:"default",className:"text-xs bg-primary/20 text-primary-foreground",children:[Math.round(m.confidence*100),"% confidence"]})]}),m.description&&t.jsx("p",{className:"text-xs text-muted-foreground",children:m.description})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs(fe,{htmlFor:"food-name",className:"text-sm font-medium mb-1 block",children:["Food Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{id:"food-name",value:x,onChange:R=>te(R.target.value),placeholder:"e.g., Grilled Chicken Breast",className:"h-9 pr-8",required:!0}),t.jsx(ka,{onTranscription:v,parseNumbers:!1})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs(fe,{className:"text-xs font-medium mb-1 block",children:["Amount ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"flex",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ge,{id:"serving-amount",type:"number",value:w,onChange:R=>y(R.target.value),className:"text-sm h-9 rounded-r-none border-r-0 focus-within:z-10 pr-8",min:"0.1",step:"0.1",required:!0}),t.jsx(ka,{onTranscription:y,parseNumbers:!0})]}),t.jsxs(es,{value:b,onValueChange:j,children:[t.jsx(qt,{className:"text-sm h-9 rounded-l-none w-24 border-l-0 focus-within:z-10",children:t.jsx(ts,{})}),t.jsx(Wt,{children:zc().map(R=>t.jsx(Fe,{value:R.value,children:Ak(R.value)},R.value))})]})]})]}),t.jsx("div",{className:"flex justify-center mb-2",children:t.jsx("button",{type:"button",onClick:()=>$(W==="per100g"?"total":"per100g"),className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors px-2 py-1 rounded-md hover:bg-muted",children:W==="per100g"?t.jsxs(t.Fragment,{children:[t.jsx(Mx,{className:"w-3 h-3"}),"Per 100g"]}):t.jsxs(t.Fragment,{children:[t.jsx(Dx,{className:"w-3 h-3"}),"Total"]})})}),t.jsxs("div",{className:"flex gap-2 items-end",children:[x.trim()&&t.jsx(Hs,{children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(Bt,{feature:"AI Estimation",grayOutForFree:!0,children:t.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:B,disabled:X||!x.trim()||!w.trim(),className:"h-9 w-9 p-0 bg-ai hover:bg-ai/90 text-ai-foreground border-ai flex-shrink-0",children:X?t.jsx(zt,{className:"w-4 h-4 animate-spin"}):t.jsx(Br,{className:"w-4 h-4"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"AI will estimate both calories and carbs for you"})})]})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs(fe,{htmlFor:"calories",className:"text-xs font-medium mb-1 block",children:["Calories ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{id:"calories",type:"number",value:N,onChange:R=>E(R.target.value),placeholder:"0",className:`text-sm h-9 pr-8 ${parseFloat(N)===0&&N!==""?"border-destructive text-destructive":""}`,required:!0}),t.jsx(ka,{onTranscription:E,parseNumbers:!0})]}),parseFloat(N)===0&&N!==""&&t.jsx("p",{className:"text-xs text-destructive mt-1",children:"Unlikely to be zero calories"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx(fe,{htmlFor:"carbs",className:"text-xs font-medium mb-1 block",children:"Carbs (g)"}),t.jsxs("div",{className:"relative",children:[t.jsx(ge,{id:"carbs",type:"number",value:S,onChange:R=>_(R.target.value),className:"text-sm h-9 pr-8"}),t.jsx(ka,{onTranscription:_,parseNumbers:!0})]})]})]})]}),l&&i&&t.jsx("div",{className:"flex justify-center",children:t.jsxs(A,{variant:"outline",onClick:()=>L(l),disabled:f,size:"sm",children:[t.jsx(Br,{className:"w-4 h-4 mr-2"}),"Re-analyze Photo"]})})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsxs("div",{className:"flex items-center border rounded-md",children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>k(Math.max(1,C-1)),disabled:C<=1,className:"h-8 w-8 p-0 rounded-r-none border-r",children:t.jsx(Kg,{className:"w-4 h-4"})}),t.jsx("div",{className:"px-3 py-1 min-w-[3rem] text-center text-sm font-medium",children:C}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>k(C+1),className:"h-8 w-8 p-0 rounded-l-none border-l",children:t.jsx(qe,{className:"w-4 h-4"})})]}),t.jsx(A,{onClick:Y,disabled:T||!x||!N||!w,className:"flex-1",children:T?t.jsxs(t.Fragment,{children:[t.jsx(zt,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add to Food Plan"})]})]})},Fk=()=>{const{profile:e}=Te(),s=c.useCallback((a,n=3)=>{if(!e?.weight||!a)return 0;const i={2:2.8,3:3.2,4:4.3,5:5.5}[Math.round(n)]||3.2,l=e.weight,d=i*l/60;return Math.ceil(a/d)},[e?.weight,e?.units]),r=c.useCallback(a=>{if(a<60)return`${a} min`;{const n=Math.floor(a/60),o=a%60;return o>0?`${n}h ${o}m`:`${n}h`}},[]);return{calculateWalkingMinutesForFood:s,formatWalkingTime:r}},Ok=()=>{const[e,s]=c.useState([]),{user:r}=Se(),{executeWithRetry:a}=am(),{loading:n,startLoading:o,stopLoading:i}=im("daily-template"),l=c.useCallback(async()=>{if(console.log("ðŸ½ï¸ loadTemplate called, user:",r?.id),!r){console.log("ðŸ½ï¸ No user, stopping loading"),i();return}o();try{console.log("ðŸ½ï¸ Fetching daily food templates for user:",r.id);const h=await a(async()=>await P.from("daily_food_templates").select("*").eq("user_id",r.id).order("sort_order",{ascending:!0}).order("created_at",{ascending:!1})),{data:p,error:g}=h;if(console.log("ðŸ½ï¸ Template fetch result:",{data:p,error:g,count:p?.length}),g)throw g;s(p||[]),console.log("ðŸ½ï¸ Template foods set:",p?.length||0,"items")}catch(h){console.error("ðŸ½ï¸ Error loading daily food template:",h)}finally{i()}},[r,a,o,i]),d=c.useCallback(async(h,p=!1)=>{if(!r)return{error:{message:"User not authenticated"}};o();try{if(p)console.log("ðŸ½ï¸ Appending to existing template for user:",r.id);else{console.log("ðŸ½ï¸ Saving template - clearing existing for user:",r.id);const{error:w}=await P.from("daily_food_templates").delete().eq("user_id",r.id);if(w)throw console.error("ðŸ½ï¸ Error clearing existing template:",w),w}const g=p?e.length:0,x=h.map((w,y)=>({...w,user_id:r.id,sort_order:g+y}));console.log("ðŸ½ï¸ Inserting template data:",x);const{error:v}=await P.from("daily_food_templates").insert(x);if(v)throw console.error("ðŸ½ï¸ Error inserting template data:",v),v;return console.log("ðŸ½ï¸ Template saved successfully, reloading..."),await new Promise(w=>setTimeout(w,500)),await l(),{error:null}}catch(g){return console.error("ðŸ½ï¸ Error saving daily template:",g),{error:g}}finally{i()}},[r,l,o,i,e.length]),f=c.useCallback(async()=>{if(!r)return{error:{message:"User not authenticated"}};o();try{const{error:h}=await P.from("daily_food_templates").delete().eq("user_id",r.id);if(h)throw h;return s([]),{error:null}}catch(h){return console.error("Error clearing daily template:",h),{error:h}}finally{i()}},[r,o,i]),u=c.useCallback(async()=>{if(!r||e.length===0)return{error:{message:"No template available"}};o();try{const h=new Date().toISOString().split("T")[0],p=e.map(x=>({name:x.name,calories:x.calories,carbs:x.carbs,serving_size:x.serving_size,image_url:x.image_url,user_id:r.id,consumed:!1,source_date:h})),{error:g}=await P.from("food_entries").insert(p);if(g)throw g;return{error:null}}catch(h){return console.error("Error applying daily template:",h),{error:h}}finally{i()}},[r,e,o,i]);c.useEffect(()=>{l()},[l]);const m=c.useCallback(async h=>await d(h,!0),[d]);return{templateFoods:e,loading:n,saveAsTemplate:d,addToTemplate:m,clearTemplate:f,applyTemplate:u,loadTemplate:l}},Lk=({entries:e})=>{const{profile:s}=Te(),r=e.filter(f=>!f.consumed).reduce((f,u)=>f+u.calories,0),a=e.filter(f=>f.consumed).reduce((f,u)=>f+u.calories,0),n=e.filter(f=>!f.consumed).reduce((f,u)=>f+u.carbs,0),o=e.filter(f=>f.consumed).reduce((f,u)=>f+u.carbs,0),i=s?.daily_calorie_goal||2e3,l=s?.daily_carb_goal||150,d=(f,u)=>{const m=f/u*100;return m>100?"text-red-600 dark:text-red-400":m>80?"text-amber-600 dark:text-amber-400":"text-accent-foreground"};return t.jsx("div",{className:"bg-muted/20 rounded-lg p-2 mb-4",children:t.jsx(ie,{className:"p-3",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[t.jsx("div",{}),t.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide text-center",children:"Calories"}),t.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide text-center",children:"Carbs (g)"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Planned:"}),t.jsxs("span",{className:"text-xs font-semibold text-center",children:[Math.round(r),"/",i]}),t.jsxs("span",{className:"text-xs font-semibold text-center",children:[Math.round(n),"/",l]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Eaten:"}),t.jsxs("span",{className:`text-xs font-bold text-center ${d(a,i)}`,children:[Math.round(a),"/",i]}),t.jsxs("span",{className:`text-xs font-bold text-center ${d(o,l)}`,children:[Math.round(o),"/",l]})]})]})})})},$k=()=>{c.useState(!0);const[e,s]=c.useState(null),[r,a]=c.useState(!1),[n,o]=c.useState(!1),[i,l]=c.useState(!1),[d,f]=c.useState(!1),[u,m]=c.useState(!1),[h,p]=c.useState("today"),[g,x]=c.useState(!1),[v,w]=c.useState(!1),[y,b]=c.useState(!1),[j,N]=c.useState(!1);c.useState("Daily Plan");const[E,S]=c.useState([]),{user:_}=Se(),{toast:C}=pe(),{profile:k,updateProfile:T}=Te();Xe();const{todayEntries:D,addFoodEntry:W,deleteFoodEntry:$,updateFoodEntry:X,toggleConsumption:V,refreshFoodEntries:G}=$n();Fk();const{templateFoods:L,loading:B,saveAsTemplate:de,addToTemplate:te,clearTemplate:Y,applyTemplate:oe,loadTemplate:O}=Ok(),{isInLibrary:Q,addLocal:R}=Nk(),M=async z=>{console.log("ðŸ½ï¸ handleAiChatResult called with:",z);let he=[];if(z.foodEntries&&Array.isArray(z.foodEntries)?(he=z.foodEntries,console.log("ðŸ½ï¸ Using old format (foodEntries):",he)):z.arguments?.foods&&Array.isArray(z.arguments.foods)?(he=z.arguments.foods,console.log("ðŸ½ï¸ Using new format (arguments.foods):",he)):z.name==="add_multiple_foods"&&z.arguments?.foods&&(he=z.arguments.foods,console.log("ðŸ½ï¸ Using function call format:",he)),he.length>0){console.log("ðŸ½ï¸ Adding foods sequentially to prevent duplicates:",he);let le=0;const J=[];for(const ce of he)try{console.log("ðŸ½ï¸ Processing food:",ce.name),await W({name:ce.name,calories:ce.calories,carbs:ce.carbs,serving_size:ce.serving_size,consumed:!1,image_url:ce.image_url}),console.log("ðŸ½ï¸ Successfully added food:",ce.name),le++}catch(it){console.error("ðŸ½ï¸ Error adding food:",ce.name,it),J.push(ce.name)}le>0&&C({title:"Foods Added",description:le===he.length?`Added ${le} food${le>1?"s":""} to your plan`:`Added ${le} of ${he.length} foods to your plan`}),J.length>0&&C({variant:"destructive",title:"Some Foods Failed",description:`Failed to add: ${J.join(", ")}`}),Zo("add","voice")}else console.warn("ðŸ½ï¸ No foods found in result:",z);f(!1)},H=()=>{m(!0)},U=async z=>{const he=await W({name:z.name,calories:z.calories,carbs:z.carbs,serving_size:z.serving_size,consumed:!1,image_url:z.image_url});!he||"error"in he?C({variant:"destructive",title:"Error",description:"Failed to save food entry"}):(C({title:"Food Added",description:`${z.name} has been added to your plan`}),Zo("add",z.image_url?"image":"manual")),m(!1)},ee=async(z,he)=>{await V(z)},ue=async z=>{await $(z),C({title:"Food Deleted",description:"Food entry has been removed from your plan"})},be=async()=>{try{const{error:z}=await P.from("food_entries").delete().eq("user_id",_?.id).gte("created_at",new Date().toISOString().split("T")[0]);if(z)throw z;await G(),C({title:"All Foods Cleared",description:"All food entries for today have been removed"})}catch(z){console.error("Error clearing foods:",z),C({variant:"destructive",title:"Error",description:"Failed to clear food entries"})}w(!1)},je=async()=>{try{const z=D.map(he=>({name:he.name,calories:he.calories,carbs:he.carbs,serving_size:he.serving_size,image_url:he.image_url}));S(z),x(!1),N(!0)}catch(z){console.error("Error preparing template save:",z),C({variant:"destructive",title:"Error",description:"Failed to prepare template save"})}},Ue=async()=>{try{console.log("ðŸ½ï¸ Saving template with foods:",E);const{error:z}=await de(E);z?(console.error("ðŸ½ï¸ Error saving template:",z),C({title:"Error",description:"Failed to save template",variant:"destructive"})):(console.log("ðŸ½ï¸ Successfully saved template"),C({title:"Template Saved",description:"Your daily food plan has been saved as a template"}),h==="template"&&(console.log("ðŸ½ï¸ On template tab, forcing immediate refresh..."),await O()),k?.enable_daily_reset||await T({enable_daily_reset:!0}))}catch(z){console.error("ðŸ½ï¸ Exception saving template:",z),C({title:"Error",description:"Failed to save template",variant:"destructive"})}N(!1),S([])},me=async()=>{try{console.log("ðŸ½ï¸ Applying template...");const{error:z}=await oe();z?(console.error("ðŸ½ï¸ Error applying template:",z),C({title:"Error",description:"Failed to apply template",variant:"destructive"})):(console.log("ðŸ½ï¸ Successfully applied template"),await G(),C({title:"Template Applied",description:"Your daily template has been applied to today's plan"}))}catch(z){console.error("ðŸ½ï¸ Exception applying template:",z),C({title:"Error",description:"Failed to apply template",variant:"destructive"})}},ve=async()=>{try{console.log("ðŸ—‘ï¸ Clearing template...");const{error:z}=await Y();z?(console.error("ðŸ—‘ï¸ Error clearing template:",z),C({title:"Error",description:"Failed to clear template",variant:"destructive"})):(console.log("ðŸ—‘ï¸ Successfully cleared template"),C({title:"Template Cleared",description:"Your daily template has been cleared"}))}catch(z){console.error("ðŸ—‘ï¸ Exception clearing template:",z),C({title:"Error",description:"Failed to clear template",variant:"destructive"})}b(!1)};return t.jsxs("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:[t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(_n,{})}),t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx(Ki,{onClick:()=>o(!0),title:"View food history"})}),t.jsx("div",{className:"px-4",children:t.jsxs("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent mb-1 flex items-center",children:[t.jsx(pi,{className:"w-6 h-6 mr-2"}),"Food Tracking"]})}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Lock your food intake"})]}),t.jsxs("div",{className:"mb-6 grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{variant:"action-primary",size:"action-tall",className:"w-full flex items-center justify-center",onClick:H,"aria-label":"Add food manually",children:t.jsx(qe,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add food by typing name, calories, and other details"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Add Food"})]}),t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(A,{variant:"action-secondary",size:"action-tall",className:"w-full flex items-center justify-center",onClick:()=>a(!0),"aria-label":"Browse food library",children:t.jsx(fd,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Browse and select from your saved food library"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"My Foods"})]})]}),t.jsx("div",{className:"mb-6",children:t.jsx(Pa,{children:t.jsx(Lk,{entries:D})})}),t.jsx("div",{className:"space-y-6",children:t.jsxs(Ja,{value:h,onValueChange:async z=>{p(z),z==="template"&&(console.log("ðŸ½ï¸ Switching to template tab, forcing refresh..."),await O())},className:"w-full",children:[t.jsxs(Rn,{className:"grid w-full grid-cols-2 p-1",children:[t.jsxs(zs,{value:"today",className:"text-sm font-medium flex items-center justify-between px-3",children:[t.jsx("span",{children:"Today"}),D.length>0&&h==="today"&&t.jsxs("div",{className:"flex items-center gap-4 ml-2",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-primary/10 text-primary",onClick:z=>{z.stopPropagation(),x(!0)},"aria-label":"Save as template",title:"Save current plan as template",children:t.jsx(ss,{className:"h-3 w-3"})}),t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-destructive/10 text-destructive mr-3 md:mr-0",onClick:z=>{z.stopPropagation(),w(!0)},"aria-label":"Clear all foods",title:"Clear all foods",children:t.jsx(We,{className:"h-3 w-3"})})]})]}),t.jsx(zs,{value:"template",className:"text-sm font-medium",children:"Daily Template"})]}),t.jsx(qs,{value:"today",className:"mt-4",children:D.length===0?t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(is,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{children:"No foods added yet"}),t.jsx("p",{className:"text-sm mt-2",children:"Add foods using the buttons above"})]}):t.jsx("div",{className:"space-y-1",children:D.map(z=>t.jsx("div",{className:`rounded-lg p-2 mb-1 transition-all duration-200 bg-card border border-ceramic-rim ${z.consumed?"opacity-60":""}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(oi,{children:[t.jsx(ii,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-secondary/80 rounded flex-shrink-0","aria-label":"More options",children:t.jsx(xo,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs(rn,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:[t.jsxs(ot,{onClick:()=>s(z),className:"py-2.5 px-3",children:[t.jsx(ut,{className:"w-4 h-4 mr-2"}),"Edit Food"]}),t.jsxs(ot,{className:"py-2.5 px-3",onClick:async()=>{const he=await W({name:z.name,calories:z.calories,carbs:z.carbs,serving_size:z.serving_size,consumed:!1,image_url:z.image_url});!he||"error"in he?C({variant:"destructive",title:"Error",description:"Failed to duplicate food"}):C({title:"Food Duplicated",description:`${z.name} has been duplicated`})},children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Duplicate Food"]}),t.jsxs(ot,{className:"py-2.5 px-3",onClick:async()=>{try{const he=[{name:z.name,calories:z.calories,carbs:z.carbs,serving_size:z.serving_size,image_url:z.image_url}],{error:le}=await te(he);C(le?{title:"Error",description:"Failed to add to template",variant:"destructive"}:{title:"Added to Template",description:`${z.name} added to your daily template`})}catch{C({title:"Error",description:"Failed to add to template",variant:"destructive"})}},children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Add to Template"]}),t.jsxs(ot,{onClick:()=>ue(z.id),className:"py-2.5 px-3 text-destructive focus:text-destructive",children:[t.jsx(We,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),t.jsx("div",{className:"w-10 h-10 bg-muted rounded-lg flex items-center justify-center flex-shrink-0",children:z.image_url?t.jsx("img",{src:z.image_url,alt:z.name,className:"w-10 h-10 object-cover rounded-lg"}):t.jsx(is,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 relative",children:[t.jsxs("div",{className:"mb-0 flex items-center gap-2 min-w-0",children:[t.jsx("h3",{className:`text-sm font-semibold truncate max-w-[180px] ${z.consumed?"text-muted-foreground line-through":"text-foreground"}`,children:z.name}),Q(z.name)&&t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full shrink-0",title:"Saved to library"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs("span",{className:`font-medium ${Math.round(z.serving_size)===0?"text-destructive":""}`,children:[Math.round(z.serving_size),"g"]}),t.jsx("span",{className:"text-muted-foreground/60",children:"â€¢"}),t.jsx(st,{content:"Calories",children:t.jsx("span",{className:`font-medium cursor-pointer ${Math.round(z.calories)===0?"text-destructive":""}`,children:Math.round(z.calories)})}),t.jsx("span",{className:"text-muted-foreground/60",children:"â€¢"}),t.jsx(st,{content:"Carbs",children:t.jsxs("span",{className:"font-medium cursor-pointer",children:[Math.round(z.carbs),"g"]})})]})]}),t.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:t.jsx(A,{size:"sm",variant:"default",onClick:()=>ee(z.id,!z.consumed),className:"h-5 w-5 p-1 bg-primary hover:bg-primary/90 rounded",title:z.consumed?"Mark as not eaten":"Mark as eaten","aria-label":z.consumed?"Mark as not eaten":"Mark as eaten",children:t.jsx(Gs,{className:"w-3 h-3 text-primary-foreground"})})})]})},z.id))})}),t.jsx(qs,{value:"template",className:"mt-4",children:t.jsx("div",{className:"space-y-4 pb-20",children:L.length>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground border-b border-border/50 pb-2",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(Mn,{id:"activate-daily",checked:k?.enable_daily_reset||!1,onCheckedChange:z=>{T({enable_daily_reset:z}).then(he=>{he.error?C({variant:"destructive",title:"Error",description:"Failed to update daily reset setting"}):C({title:z?"Daily Reset Activated":"Daily Reset Deactivated",description:z?"Your template will automatically apply each day at midnight":"Automatic daily reset has been disabled"})})},className:"scale-75"}),t.jsx(fe,{htmlFor:"activate-daily",className:"text-xs font-normal",children:"Auto-apply daily"}),t.jsx(st,{content:"When enabled, this template will automatically replace your current food plan every day at midnight",children:t.jsx(tt,{className:"w-3 h-3 text-muted-foreground/70 ml-1"})})]})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(A,{variant:"ghost",size:"sm",onClick:me,className:"h-5 w-5 p-0 text-primary hover:text-primary hover:bg-primary/10","aria-label":"Apply template to today's plan",title:"Apply template to today's plan",children:t.jsx(qe,{className:"w-3 h-3"})}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>b(!0),className:"h-5 w-5 p-0 hover:bg-destructive/10 text-destructive mr-1 md:mr-0","aria-label":"Clear template",title:"Clear template",children:t.jsx(We,{className:"w-3 h-3"})})]})]}),t.jsx("div",{className:"space-y-1",children:L.map(z=>{const he=z.id;return t.jsx("div",{className:"rounded-lg p-2 mb-1 transition-all duration-200 bg-card border border-ceramic-rim",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(oi,{children:[t.jsx(ii,{asChild:!0,children:t.jsx(A,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-secondary/80 rounded flex-shrink-0","aria-label":"More options",children:t.jsx(xo,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs(rn,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:[t.jsxs(ot,{className:"py-2.5 px-3",onClick:()=>{const le={id:z.id,name:z.name,calories:z.calories,carbs:z.carbs,serving_size:z.serving_size,image_url:z.image_url,consumed:!1,user_id:_?.id||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),source_date:new Date().toISOString().split("T")[0]};s(le)},children:[t.jsx(ut,{className:"w-4 h-4 mr-2"}),"Edit Food"]}),t.jsxs(ot,{className:"py-2.5 px-3",onClick:async()=>{const le=L.find(J=>J.id===he);if(!le){C({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const J=[{name:le.name,calories:le.calories,carbs:le.carbs,serving_size:le.serving_size,image_url:le.image_url}],{error:ce}=await te(J);C(ce?{title:"Error",description:"Failed to duplicate food",variant:"destructive"}:{title:"Food Duplicated",description:`${le.name} has been duplicated in template`})}catch{C({title:"Error",description:"Failed to duplicate food",variant:"destructive"})}},children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Duplicate Food"]}),t.jsxs(ot,{onClick:async()=>{const le=L.find(J=>J.id===he);if(!le){C({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const J=await W({name:le.name,calories:le.calories,carbs:le.carbs,serving_size:le.serving_size,image_url:le.image_url,consumed:!1});!J||"error"in J?C({variant:"destructive",title:"Error",description:"Failed to add to today's plan"}):C({title:"Added to Today",description:`${le.name} added to today's food plan`})}catch(J){C({variant:"destructive",title:"Error",description:`Failed to add to today's plan: ${J.message||"Unknown error"}`})}},className:"py-2.5 px-3",children:[t.jsx(qe,{className:"w-4 h-4 mr-2"}),"Add to Today"]}),t.jsxs(ot,{onClick:async()=>{const le=L.find(J=>J.id===he);if(!le){C({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const{data:J,error:ce}=await P.from("daily_food_templates").delete().eq("id",le.id).eq("user_id",_?.id).select();if(ce)throw ce;if(!J||J.length===0){C({variant:"destructive",title:"Error",description:"Food item not found or already deleted"});return}await G(),C({title:"Food Deleted",description:`${le.name} removed from template`})}catch(J){C({variant:"destructive",title:"Error",description:`Failed to delete food: ${J.message||"Unknown error"}`})}},className:"py-2.5 px-3 text-destructive focus:text-destructive",children:[t.jsx(We,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),t.jsx("div",{className:"w-10 h-10 bg-muted rounded-lg flex items-center justify-center flex-shrink-0",children:z.image_url?t.jsx("img",{src:z.image_url,alt:z.name,className:"w-10 h-10 object-cover rounded-lg"}):t.jsx(is,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 relative",children:[t.jsxs("div",{className:"mb-0 flex items-center gap-2 min-w-0",children:[t.jsx("h3",{className:"text-sm font-semibold truncate max-w-[180px] text-foreground",children:z.name}),Q(z.name)&&t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full shrink-0",title:"Saved to library"})]}),t.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:t.jsxs("span",{className:"font-medium",children:[z.calories," cal, ",z.carbs,"g carbs â€¢ ",z.serving_size,"g"]})})]})]})},z.id)})})]}):t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(ss,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("p",{children:"No daily template saved"}),t.jsx("p",{className:"text-sm mt-2",children:"Add foods to today's plan and save as template"})]})})})]})})]}),t.jsx(ca,{isOpen:i,onClose:()=>l(!1),title:"Food Tracking Guide",children:t.jsx("div",{children:"Food tracking onboarding content"})}),t.jsx(mt,{isOpen:n,onClose:()=>o(!1),title:"Food History",size:"lg",children:t.jsx(_k,{onClose:()=>o(!1),onCopySuccess:G})}),t.jsx(mt,{isOpen:r,onClose:()=>a(!1),title:"",size:"xl",variant:"fullscreen",children:t.jsx(jk,{onSelectFood:async(z,he=!1)=>{const le={name:z.name,calories:z.calories_per_100g||z.calories,carbs:z.carbs_per_100g||z.carbs,serving_size:100,consumed:he,image_url:z.image_url};await W(le)},onBack:()=>a(!1)})}),e&&t.jsx(Ck,{isOpen:!!e,onClose:()=>s(null),entry:e,onUpdate:async z=>{if(L.some(le=>le.id===e.id))try{const{error:le}=await P.from("daily_food_templates").update({name:z.name,calories:z.calories,carbs:z.carbs,serving_size:z.serving_size,image_url:z.image_url,updated_at:new Date().toISOString()}).eq("id",e.id).eq("user_id",_?.id);if(le)throw le;await O(),C({title:"Template Updated",description:"Template item has been updated successfully"})}catch(le){C({variant:"destructive",title:"Error",description:`Failed to update template item: ${le.message||"Unknown error"}`})}else await X({id:e.id,updates:z}),C({title:"Food Updated",description:"Food entry has been updated successfully"});s(null)}}),t.jsx(Pk,{isOpen:d,onClose:()=>f(!1),onResult:M,title:"Food Assistant",proactiveMessage:"Hi! What food would you like to add? You can add multiple at once - just tell me the name and the quantity"}),t.jsx(Ik,{isOpen:u,onClose:()=>m(!1),onSave:U}),t.jsx(rt,{open:g,onOpenChange:x,children:t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Save as Daily Template"}),t.jsx(Qe,{children:"This will save your current food plan as a daily template. You can then apply this template to future days."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:je,children:"Save Template"})]})]})}),t.jsx(rt,{open:j,onOpenChange:N,children:t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Confirm Template Save"}),t.jsxs(Qe,{children:["This will replace your existing daily template with ",E.length," food item",E.length!==1?"s":"","."]})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{onClick:()=>S([]),children:"Cancel"}),t.jsx(Ke,{onClick:Ue,children:"Confirm Save"})]})]})}),t.jsx(rt,{open:v,onOpenChange:w,children:t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Clear All Foods"}),t.jsx(Qe,{children:"This will remove all food entries from today's plan. This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:be,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear All"})]})]})}),t.jsx(rt,{open:y,onOpenChange:b,children:t.jsxs(Be,{children:[t.jsxs(Ge,{children:[t.jsx(He,{children:"Clear Daily Template"}),t.jsx(Qe,{children:"This will remove all items from your daily template. This action cannot be undone."})]}),t.jsxs(Ve,{children:[t.jsx(Ye,{children:"Cancel"}),t.jsx(Ke,{onClick:ve,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear Template"})]})]})})]})},Uk=()=>(c.useEffect(()=>{document.title="Health Check - OK"},[]),t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-green-600",children:"Health Check: OK"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"Application is running normally"}),t.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:[t.jsx("p",{className:"text-sm text-green-700",children:"Status: Healthy"}),t.jsxs("p",{className:"text-sm text-green-700",children:["Timestamp: ",new Date().toISOString()]})]})]})})),zk=()=>{const[e,s]=c.useState(new Set),{profile:r,isProfileComplete:a}=Te(),{user:n}=Se();c.useEffect(()=>{const g=localStorage.getItem("dismissed_notifications");g&&s(new Set(JSON.parse(g)))},[]);const o=g=>{localStorage.setItem("dismissed_notifications",JSON.stringify([...g]))},i=c.useMemo(()=>{if(!n)return[];const g=[];if(!a()){const x=[];r?.weight||x.push("weight"),r?.height||x.push("height"),r?.age||x.push("age");const v={id:"profile_incomplete",type:"profile_incomplete",priority:"high",title:"Profile Information Needed",message:`I need your ${x.join(", ")} to calculate your daily calorie burn and provide accurate recommendations. This is essential for the app to work properly.`,actions:{primary:{label:"Tell me now",action:"chat_input"},secondary:{label:"Go to Settings",action:"navigate",target:"/settings"}},autoShow:!0,persistent:!0,metadata:{missingFields:x}};e.has(v.id)||g.push(v)}return g},[n,r,a,e]),l=g=>{const x=new Set(e);x.add(g),s(x),o(x)};return{notifications:i,dismissNotification:l,clearNotification:g=>{l(g)},hasActiveNotifications:()=>r&&(!r.weight||!r.height||!r.age)?!0:i.length>0,getHighPriorityNotifications:()=>i.filter(g=>g.priority==="high"),getAutoShowNotifications:()=>i.filter(g=>g.autoShow),getNotificationIcon:g=>{switch(g){case"profile_incomplete":return"exclamation-triangle";case"subscription_upsell":return"crown";case"general":default:return"info"}},getNotificationColor:(g,x)=>g==="profile_incomplete"?"text-amber-500":g==="subscription_upsell"?"text-purple-500":x==="high"?"text-red-500":x==="medium"?"text-orange-500":"text-blue-500"}},qk=({time:e,isEating:s=!1,className:r=""})=>t.jsx("div",{className:`
        absolute -top-1 -right-1 
        text-white text-xs 
        px-1.5 py-0.5 
        rounded-full 
        font-mono
        flex items-center justify-center
        w-[72px] h-6
        whitespace-nowrap
        ${s?"bg-amber-500":"bg-accent"}
        ${r}
      `,children:t.jsx("span",{className:"text-center",children:e})}),Wk=({daysRemaining:e,className:s=""})=>{const a=(()=>{if(!e||e<=0)return{text:"0d",urgency:"expired",expired:!0};let o="low";return e<=1?o="critical":e<=3?o="high":e<=7&&(o="medium"),{text:`${e}d`,urgency:o,expired:!1}})(),n=(o,i)=>{if(i)return"bg-red-600 animate-pulse";switch(o){case"critical":return"bg-red-500 animate-pulse";case"high":return"bg-red-400";case"medium":return"bg-orange-400";case"low":default:return"bg-green-500"}};return t.jsx("div",{className:`
        absolute -top-1 right-0
        text-white text-xs 
        px-1.5 py-0.5 
        rounded-full 
        font-mono font-semibold
        flex items-center justify-center
        w-[28px] h-4
        whitespace-nowrap
        ${n(a.urgency,a.expired)}
        ${s}
      `,title:a.expired?"Trial expired":`Trial expires in ${a.text}`,children:t.jsx("span",{className:"text-center text-[10px]",children:a.text})})},Bk=()=>{const e=Kt(),{timerStatus:s,formatTime:r}=Uh();zk(),Te();const{currentSession:a,refreshActiveSession:n}=el(),{todayTotals:o}=$n(),{currentSession:i}=Js(),{isAnimationsSuspended:l}=Hm(),{isOnline:d}=bn(),{isTrial:f,daysRemaining:u,hasPremiumFeatures:m,access_level:h,createSubscription:p,refetch:g,testRole:x,isTestingMode:v}=Xe();u&&new Date(Date.now()+u*24*60*60*1e3).toISOString();const[w,y]=c.useState(Date.now()),{toast:b}=pe();c.useEffect(()=>{if(l)return;let _;const C=a&&a.status==="active",k=i&&i.status==="active";return(C||k)&&(_=setInterval(()=>{y(Date.now())},1e3)),()=>{_&&clearInterval(_)}},[l,a?.status,i?.status]),c.useEffect(()=>{n()},[n]),c.useEffect(()=>{console.log("ðŸ§­ Navigation mounted - initial access check")},[]);const j=c.useMemo(()=>{if(!a||a.status!=="active")return null;const _=new Date(a.start_time).getTime(),C=Math.floor((w-_)/1e3),k=a.goal_duration_seconds||0;if(k<=23*3600){const W=k+28800,$=C%W;if($>=k){const V=$-k,G=Math.max(0,28800-V);return{time:r(G),isEating:!0,label:"Eating"}}else return{time:r($),isEating:!1,label:"Fasting"}}return{time:r(C),isEating:!1,label:"Fasting"}},[a,w,r]),N=c.useMemo(()=>[{icon:Vt,label:"Fast",path:"/",badge:j?.time||null,isEating:j?.isEating||!1},{icon:vd,label:"Walk",path:"/walking",badge:i?.status==="active"?(()=>{const _=new Date(i.start_time).getTime();let C=Math.floor((w-_)/1e3);const k=i.total_pause_duration||0;let T=0;i.session_state==="paused"&&i.pause_start_time&&(T=Math.floor((w-new Date(i.pause_start_time).getTime())/1e3));const D=Math.max(0,C-k-T);return r(D)})():null,isEating:!1},{icon:is,label:"Food",path:"/food-tracking",isEating:!1,caloriesBadge:o.calories>0?Math.round(o.calories):null},{icon:pi,label:"Goals",path:"/motivators",isEating:!1},{icon:yx,label:"Settings",path:"/settings",isEating:!1}],[j,i,r,o.calories,w]),S=d?{color:"bg-green-500",tooltip:"Connected",shouldPulse:!1}:{color:"bg-red-500",tooltip:"Offline - Changes will sync when connected",shouldPulse:!1};return t.jsx(Hs,{children:t.jsx("nav",{className:"fixed bottom-0 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md bg-background/90 backdrop-blur supports-[backdrop-filter]:bg-background/80",children:t.jsx("div",{className:"bg-ceramic-plate px-4 py-2",children:t.jsx("div",{className:"flex justify-around gap-1 relative",children:N.map(({icon:_,label:C,path:k,badge:T,isEating:D,caloriesBadge:W})=>{const $=e.pathname===k,X=Y=>{switch(Y){case"Fast":return"Start or manage your fasting sessions";case"Walk":return"Track your walking sessions and burn calories";case"Food":return"Log your meals and track daily intake";case"Goals":return"View and create motivational content";case"Settings":return"Customize your app preferences";default:return Y}},V=v?x:h,G=v?x==="paid_user"||x==="admin":m,L=Y=>{if(!(V==="admin"||G)&&C==="Food"){Y.preventDefault(),Y.stopPropagation(),Y0(b,p);return}},de=C==="Food"&&!(V==="admin"||G),te=t.jsxs(ia,{to:k,className:`relative flex flex-col items-center py-2 px-2 rounded-xl transition-all duration-200 flex-1 min-w-0 ${$?"bg-primary text-primary-foreground shadow-lg":"text-muted-foreground hover:text-warm-text hover:bg-ceramic-rim bg-ceramic-base/20 border border-ceramic-rim/30"} ${de?"opacity-50":""}`,onClick:L,children:[t.jsx(_,{className:"w-5 h-5 mb-1"}),t.jsx("span",{className:"text-xs font-medium",children:C}),de&&C==="Food"&&t.jsx("div",{className:"absolute top-1 right-1",children:t.jsx(Vs,{className:"w-3 h-3 text-muted-foreground"})}),T&&(C==="Fast"||C==="Walk")&&t.jsx(qk,{time:T,isEating:D}),W&&C==="Food"&&t.jsx("span",{className:"absolute -top-1 -right-1 min-w-[16px] h-4 text-xs rounded-full flex items-center justify-center font-medium bg-accent text-white px-1",children:W}),C==="Settings"&&f&&u&&t.jsx(Wk,{daysRemaining:u}),C==="Settings"&&t.jsx("div",{className:"absolute -bottom-1 -right-1",children:t.jsx("div",{className:`w-2 h-2 rounded-full ${S.color} ${S.shouldPulse?"animate-pulse":""}`,title:S.tooltip})})]});return t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:te}),t.jsx(Me,{children:t.jsx("p",{children:X(C)})})]},k)})})})})})},Gk=({children:e,state:s,error:r,isOnline:a=!0,onRetry:n,onForceRefresh:o})=>{const[i,l]=c.useState(!1);c.useEffect(()=>{if(s==="loading"||s==="auth"||s==="profile"){const u=setTimeout(()=>{l(!0)},8e3);return()=>clearTimeout(u)}},[s]),c.useEffect(()=>{(s==="ready"||s==="error")&&l(!1)},[s]);const d=()=>{switch(s){case"auth":return"Checking authentication...";case"profile":return"Loading profile...";case"loading":default:return"Starting app..."}},f=i&&(s==="loading"||s==="auth"||s==="profile");return s==="ready"?t.jsx(t.Fragment,{children:e}):s==="error"||f?t.jsx("div",{className:"min-h-screen bg-muted/30 flex items-center justify-center p-4",children:t.jsx("div",{className:"w-full max-w-md space-y-6 text-center",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:a?t.jsxs(t.Fragment,{children:[t.jsx(Il,{className:"w-4 h-4"}),t.jsx("span",{children:"Online"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Rl,{className:"w-4 h-4"}),t.jsx("span",{children:"Offline"})]})}),t.jsx("div",{className:"w-16 h-16 mx-auto bg-destructive/10 rounded-full flex items-center justify-center",children:t.jsx(pd,{className:"w-8 h-8 text-destructive"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-lg font-semibold",children:s==="error"?"Startup Error":"Taking Too Long"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r||(f?`App is stuck ${d().toLowerCase()}`:"Something went wrong during startup")})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[n&&t.jsxs(A,{onClick:n,variant:"default",className:"w-full",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Try Again"]}),o&&t.jsxs(A,{onClick:o,variant:"outline",className:"w-full",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Force Refresh"]}),t.jsxs(A,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:[t.jsx(At,{className:"w-4 h-4 mr-2"}),"Reload Page"]})]}),(r||f)&&t.jsxs("div",{className:"text-xs text-muted-foreground border rounded p-2 bg-muted/50",children:[t.jsxs("div",{children:["State: ",s]}),t.jsxs("div",{children:["Online: ",a?"Yes":"No"]}),t.jsxs("div",{children:["Timeout: ",i?"Yes":"No"]}),t.jsxs("div",{children:["Env: ","production"]}),t.jsxs("div",{children:["Native: ",window.__IS_NATIVE_APP__?"Yes":"No"]}),r&&t.jsxs("div",{children:["Error: ",r]})]})]})})}):t.jsx("div",{className:"min-h-screen bg-muted/30 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md space-y-6 text-center",children:[t.jsx("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:a?t.jsxs(t.Fragment,{children:[t.jsx(Il,{className:"w-4 h-4"}),t.jsx("span",{children:"Online"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Rl,{className:"w-4 h-4"}),t.jsx("span",{children:"Offline"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative w-16 h-16 mx-auto",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary rounded-full animate-spin"}),t.jsx("div",{className:"absolute inset-2 border-2 border-primary/30 rounded-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-lg font-medium text-foreground",children:d()}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Please wait..."})]}),t.jsxs("div",{className:"flex justify-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]})})};performance.now();const Vk=e=>{performance.now()},Hk=e=>{const[s,r]=c.useState("loading"),[a,n]=c.useState(""),[o,i]=c.useState(0),{user:l,session:d,loading:f}=Ks(),{isOnline:u}=bn(),{profile:m,loading:h,loadProfile:p}=Te(),g=c.useCallback(()=>{try{typeof window<"u"&&(localStorage.clear(),sessionStorage.clear(),"caches"in window&&caches.keys().then(v=>{v.forEach(w=>caches.delete(w))})),window.location.reload()}catch(v){console.error("Force refresh failed:",v),window.location.reload()}},[]),x=c.useCallback(async()=>{i(v=>v+1),n(""),r("loading")},[]);return c.useEffect(()=>{(async()=>{try{if(r("auth"),f)return;if(l&&d&&(r("profile"),!m&&!h))try{await p()}catch(w){console.warn("Profile loading failed (non-blocking):",w)}r("ready"),Vk("ready")}catch(w){console.error("Startup failed:",w),n(w instanceof Error?w.message:"Startup failed"),r("error")}})()},[l,d,f,m,h,p]),c.useEffect(()=>{if(u&&s==="error"&&o<3){const v=setTimeout(()=>{x()},1e3);return()=>clearTimeout(v)}},[u,s,x,o]),{state:s,error:a,isOnline:u,isNativeApp:e,retry:x,forceRefresh:g,retryCount:o}};function Qk(e){const s=e.match(/(\d+)\s+(\d+)%\s+(\d+)%/);return s?{h:parseInt(s[1]),s:parseInt(s[2]),l:parseInt(s[3])}:null}const Kk=()=>{const[e,s]=c.useState({}),[r,a]=c.useState(!0),n=async()=>{try{const{data:l,error:d}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["brand_primary_color","brand_primary_hover","brand_accent_color","brand_ai_color"]);if(d){console.error("Error loading color settings:",d);return}const f={};l?.forEach(u=>{u.setting_key==="brand_primary_color"?f.primary_color=u.setting_value:u.setting_key==="brand_primary_hover"?f.secondary_color=u.setting_value:u.setting_key==="brand_accent_color"?f.accent_color=u.setting_value:u.setting_key==="brand_ai_color"&&(f.ai_color=u.setting_value)}),s(f),o(f),localStorage.setItem("admin_colors",JSON.stringify(f))}catch(l){console.error("Error in loadColors:",l)}finally{a(!1)}},o=l=>{const d=document.documentElement;if(l.primary_color){d.style.setProperty("--primary",l.primary_color),d.style.setProperty("--ring",l.primary_color);const f=Qk(l.primary_color);f&&(d.style.setProperty("--primary-glow",`${f.h} ${Math.min(f.s+10,100)}% ${Math.min(f.l+10,100)}%`),d.style.setProperty("--primary-hover",`${f.h} ${f.s}% ${Math.max(f.l-5,0)}%`))}l.secondary_color&&d.style.setProperty("--secondary",l.secondary_color),l.accent_color&&d.style.setProperty("--accent",l.accent_color),l.ai_color&&d.style.setProperty("--ai",l.ai_color)},i=()=>{const l=document.documentElement;l.style.setProperty("--primary","220 13% 45%"),l.style.setProperty("--ring","220 13% 45%"),l.style.setProperty("--primary-glow","220 13% 55%"),l.style.setProperty("--primary-hover","220 13% 40%"),l.style.setProperty("--secondary","220 13% 40%"),l.style.setProperty("--accent","220 13% 50%"),l.style.setProperty("--ai","220 13% 50%")};return c.useEffect(()=>{i(),n().then(()=>{const l=localStorage.getItem("admin_colors");if(l&&Object.keys(e).length===0)try{const d=JSON.parse(l);console.log("Applying cached colors as fallback"),o(d),s(d)}catch(d){console.error("Error parsing cached colors:",d)}})},[]),{colorSettings:e,loading:r,loadColors:n,applyColors:o}},Yk=e=>(c.useEffect(()=>{if(e)return;(async()=>{try{const{data:r}=await P.from("shared_settings").select("setting_value").eq("setting_key","app_favicon").maybeSingle();if(r?.setting_value){const a=document.getElementById("dynamic-favicon"),n=document.getElementById("dynamic-shortcut-icon");a&&(a.href=r.setting_value),n&&(n.href=r.setting_value)}}catch(r){console.error("Error loading dynamic favicon:",r)}})()},[]),null),Xk=e=>{c.useEffect(()=>{if(e)return;(async()=>{try{const{data:r}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["app_logo","app_favicon"]),a={};if(r?.forEach(i=>{a[i.setting_key]=i.setting_value}),a.app_favicon){const i=document.getElementById("dynamic-favicon"),l=document.getElementById("dynamic-shortcut-icon");i&&(i.href=a.app_favicon,console.log("Updated favicon link to:",a.app_favicon)),l&&(l.href=a.app_favicon,console.log("Updated shortcut icon link to:",a.app_favicon))}a.app_logo&&document.querySelectorAll('link[rel="apple-touch-icon"]').forEach(l=>{l.href=a.app_logo,console.log("Updated apple touch icon to:",a.app_logo)}),a.app_favicon&&document.querySelectorAll('link[rel="icon"]').forEach(l=>{l.href=a.app_favicon,console.log("Updated icon link to:",a.app_favicon)});const n=document.querySelector('link[rel="manifest"]');if(n){const i=new URL(n.href,window.location.origin);i.searchParams.set("v",Date.now().toString()),i.searchParams.set("bust",Math.random().toString(36)),i.searchParams.set("mobile",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"1":"0"),n.href=i.toString()}if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"caches"in window){const i=await caches.keys();await Promise.all(i.map(l=>caches.delete(l))),console.log("Cleared all caches for mobile device")}console.log("PWA assets updated with dynamic values")}catch(r){console.error("Error updating PWA assets:",r)}})()},[])},Jk=e=>{c.useEffect(()=>{if(e)return;(async()=>{try{const{data:r}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["pwa_app_name","pwa_short_name","pwa_description","app_logo","app_favicon","pwa_theme_color"]),a={};if(r?.forEach(o=>{a[o.setting_key]=o.setting_value}),a.pwa_app_name&&(document.title=a.pwa_app_name),a.pwa_description){const o=document.querySelector('meta[name="description"]');o&&o.setAttribute("content",a.pwa_description)}if(a.pwa_app_name){const o=document.querySelector('meta[property="og:title"]');o&&o.setAttribute("content",a.pwa_app_name)}if(a.pwa_description){const o=document.querySelector('meta[property="og:description"]');o&&o.setAttribute("content",a.pwa_description)}if(a.pwa_short_name){const o=document.querySelector('meta[name="apple-mobile-web-app-title"]');o&&o.setAttribute("content",a.pwa_short_name)}if(a.pwa_theme_color){const o=document.querySelector('meta[name="theme-color"]');o&&o.setAttribute("content",a.pwa_theme_color);const i=document.querySelector('meta[name="msapplication-TileColor"]');i&&i.setAttribute("content",a.pwa_theme_color)}const n=a.app_favicon||a.app_logo;if(n){const o=document.getElementById("dynamic-favicon"),i=document.getElementById("dynamic-shortcut-icon");o&&(o.href=n),i&&(i.href=n),document.querySelectorAll('link[rel="apple-touch-icon"]').forEach(f=>{f.href=n}),document.querySelectorAll('link[rel="icon"]').forEach(f=>{f.id!=="dynamic-favicon"&&(f.href=n)})}console.log("HTML meta tags updated with dynamic values")}catch(r){console.error("Error updating HTML meta tags:",r)}})()},[])},Zk=e=>{Kk(),Yk(e),Xk(e),Jk(e),c.useEffect(()=>{console.log(e?"Native app detected - PWA features disabled":"Web app detected - Dynamic assets loading deferred (non-blocking)")},[e])},e2=({onRetry:e,message:s="Taking longer than expected...",showError:r=!1})=>t.jsxs(ie,{className:"p-6 text-center space-y-4 border-muted",children:[t.jsx("div",{className:"flex justify-center",children:r?t.jsx(pd,{className:"w-8 h-8 text-destructive"}):t.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:s}),r&&t.jsx("p",{className:"text-xs text-destructive",children:"Something went wrong. Please try again."})]}),t.jsxs(A,{onClick:e,variant:"outline",size:"sm",className:"gap-2",children:[t.jsx(At,{className:"w-4 h-4"}),"Retry"]})]}),$t=({children:e})=>{const{user:s,loading:r}=Se(),a=ft(h=>h.oauthCompleting),n=kt(),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[f,u]=c.useState(0);c.useEffect(()=>{const h=setTimeout(()=>{i(!0)},200),p=setTimeout(()=>{(r||!s)&&d(!0)},5e3),g=setTimeout(()=>{(r||!s)&&(console.warn("ProtectedRoute: Forced timeout after 10s"),d(!0),window.__initializingApp=!1)},1e4);return()=>{clearTimeout(h),clearTimeout(p),clearTimeout(g)}},[r,s]),c.useEffect(()=>{r||(d(!1),u(0))},[r]),c.useEffect(()=>{const g=setTimeout(()=>{if(a||window.__initializingApp){console.log("ðŸ›¡ï¸ ProtectedRoute: Delaying redirect - OAuth completing or app initializing");return}!r&&!s&&(console.log("ðŸ”„ ProtectedRoute: Redirecting to auth - no user found"),n("/auth"))},a?500:50);return()=>clearTimeout(g)},[s,r,a,n]);const m=()=>{u(h=>h+1),d(!1),i(!1),window.__initializingApp=!1,f>=2?window.location.reload():setTimeout(()=>i(!0),100)};return l&&(r||!s)?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsx(e2,{onRetry:m,message:f>0?"Still having trouble loading...":"Taking longer than expected...",showError:f>1})}):(r||!s)&&o?t.jsx(ta,{}):r||!s?null:t.jsx(t.Fragment,{children:e})},$r=({children:e})=>{const{user:s,loading:r}=Se(),{isAdmin:a,loading:n}=Xe(),o=kt(),{toast:i}=pe();return c.useEffect(()=>{!r&&!n&&(s?a||(i({title:"Admins only",description:"You do not have access to this section.",variant:"destructive"}),o("/")):o("/auth"))},[r,n,a,s,o,i]),r||n?t.jsx(ta,{}):!s||!a?t.jsx(ta,{}):t.jsx(t.Fragment,{children:e})},t2=({onCalorieAdded:e})=>{const[s,r]=c.useState(!1),[a,n]=c.useState(""),[o,i]=c.useState(""),[l,d]=c.useState(!1),{toast:f}=pe(),{user:u}=Se(),m=async()=>{if(!a.trim()||!o.trim()||!u){f({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}const h=parseInt(o);if(h<=0||h>2e3){f({title:"Error",description:"Please enter a valid calorie amount (1-2000)",variant:"destructive"});return}d(!0);try{const{error:p}=await P.from("manual_calorie_burns").insert({user_id:u.id,activity_name:a.trim(),calories_burned:h});if(p)throw p;f({title:"Success",description:`Added ${h} calories burned from ${a}`}),n(""),i(""),r(!1),e()}catch(p){console.error("Error saving manual calorie burn:",p),f({title:"Error",description:"Failed to save calorie burn",variant:"destructive"})}finally{d(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs(A,{variant:"action-secondary",size:"action-secondary",className:"w-full",onClick:()=>r(!0),children:[t.jsx(qe,{className:"w-3 h-3 mr-1"}),"Add External Activity"]}),t.jsx(mt,{isOpen:s,onClose:()=>r(!1),title:"Add External Activity",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(A,{variant:"outline",onClick:()=>r(!1),className:"w-full h-10",size:"default",children:"Cancel"}),t.jsx(A,{onClick:m,disabled:l||!a.trim()||!o,className:"w-full h-10",size:"default",children:l?"Saving...":"Add Activity"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"activity-name",children:"Activity Name"}),t.jsx(ge,{id:"activity-name",value:a,onChange:h=>n(h.target.value),placeholder:"e.g., Weight Training",maxLength:100,onClick:h=>h.stopPropagation(),onFocus:h=>h.stopPropagation()})]}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"calories",children:"Calories Burned"}),t.jsx(ge,{id:"calories",type:"number",value:o,onChange:h=>i(h.target.value),placeholder:"e.g., 300",min:"1",max:"2000",onClick:h=>h.stopPropagation(),onFocus:h=>h.stopPropagation()})]})]})})]})},s2=({icon:e,label:s,value:r,subtitle:a,tooltip:n,className:o=""})=>t.jsxs(ie,{className:`p-3 bg-card border-border relative ${o}`,children:[t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx(st,{content:n,children:t.jsx(tt,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"flex items-center space-x-2 mb-1 pr-6",children:[e,t.jsx("span",{className:"text-xs font-medium text-warm-text",children:s})]}),t.jsxs("div",{className:"text-lg font-bold text-primary",children:[typeof r=="number"?Math.round(r).toLocaleString():r," cal"]}),a&&t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:a})]}),r2=({deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o="metric"})=>{const{color:i,icon:l}=c.useMemo(()=>{const f=e>0?"text-accent":e<0?"text-red-600 dark:text-red-400":"text-muted-foreground",u=e>0?Ix:dn;return{color:f,icon:u}},[e]),d=c.useMemo(()=>s&&e===0&&r===0?"...":`${Math.round(Math.abs(e)).toLocaleString()} cal`,[e,s,r]);return t.jsxs(ie,{className:"p-4 bg-card border-border relative",children:[t.jsx("div",{className:"absolute top-3 right-3",children:t.jsx(st,{content:"Your calorie deficit for today. A positive number means you're burning more than you consume (weight loss). This includes your base metabolism, activity level, walking, and any manual activities you've logged.",children:t.jsx(tt,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"text-center space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 pr-6",children:[t.jsx(l,{className:`w-6 h-6 ${i}`}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Today's Deficit"})]}),t.jsx("div",{className:`text-3xl font-bold ${i}`,children:d}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e>0?"Calorie deficit (weight loss)":"Calorie surplus (weight gain)"}),a!==void 0&&n!==void 0&&e>0&&t.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 pt-2 border-t border-ceramic-rim/50",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[t.jsx(Ag,{className:"w-3 h-3 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Today's Fat Loss"}),t.jsx(st,{content:"Fat burned today based on your current calorie deficit",children:t.jsx(tt,{className:"w-3 h-3 text-muted-foreground"})})]}),t.jsxs("div",{className:"text-sm font-semibold text-primary",children:[Math.round(a),"g"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[t.jsx(ln,{className:"w-3 h-3 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"30d Projection"}),t.jsx(st,{content:"Projected weight loss if you maintain today's deficit for 30 days",children:t.jsx(tt,{className:"w-3 h-3 text-muted-foreground"})})]}),t.jsx("div",{className:"text-sm font-semibold text-primary",children:o==="metric"?`${Math.round(n/1e3)}kg`:`${Math.round(n/453.592)}lbs`})]})]})]})]})},a2=()=>{const[e,s]=c.useState(null),[r,a]=c.useState(!0),n=async()=>{try{const{data:o,error:i}=await P.from("shared_settings").select("setting_value").eq("setting_key","app_logo").maybeSingle();if(i)throw i;s(o?.setting_value||null)}catch(o){console.error("Error fetching app logo:",o),s(null)}finally{a(!1)}};return c.useEffect(()=>{n()},[]),{appLogo:e,loading:r,refetch:n}},n2=({value:e,formatNumber:s,getDeficitColor:r,loading:a,tdee:n})=>{const{hasPremiumFeatures:o,isAdmin:i}=Xe();return i||o?t.jsx("span",{className:`text-sm font-bold ${r(e)}`,children:a&&e===0&&n===0?"...":`${s(e)} cal`}):t.jsx(Vs,{className:"w-3 h-3 text-muted-foreground"})},o2=({calories:e,carbs:s})=>(Xe(),t.jsx(Bt,{feature:"Food Tracking",grayOutForFree:!0,showUpgrade:!1,children:t.jsxs(ie,{className:"p-3 bg-card border-border relative",children:[t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx(st,{content:"Total calories consumed from food today",children:t.jsx(tt,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"flex items-center space-x-2 mb-1 pr-6",children:[t.jsx(is,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-xs font-medium text-warm-text",children:"Calories In"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-lg font-bold text-primary",children:[Math.round(e)," cal"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-px h-6 bg-border"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsxs("span",{className:"text-sm font-medium text-primary",children:[Math.round(s),"g"]}),t.jsx(st,{content:"Total carbs consumed from food today",children:t.jsx(tt,{className:"w-3 h-3 text-muted-foreground"})})]})]})]})]})})),i2=()=>{const{profile:e}=Te(),{weeksToGoal:s,currentWeight:r,goalWeight:a,weightToLose:n,fatInGrams:o,thirtyDayProjection:i}=jl();if(!r||!a)return null;const l=e?.units==="metric"?"kg":"lbs",d=e?.units==="metric"?r:r&&(r*2.20462).toFixed(1),f=e?.units==="metric"?a:a&&(a*2.20462).toFixed(1),u=e?.units==="metric"?n?.toFixed(1):n?(n*2.20462).toFixed(1):0;return t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(ie,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(yo,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Goal Progress"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-foreground",children:[u||0," ",l]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[d," â†’ ",f," ",l]})]})]}),t.jsxs(ie,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ln,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Time to Goal"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-lg font-bold text-foreground",children:s?`${s}w`:"N/A"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"at current deficit"})]})]}),t.jsxs(ie,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Jt,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Fat Burned"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-foreground",children:[o,"g"]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"today's deficit"})]})]}),t.jsxs(ie,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(dn,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"30-Day Loss"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-foreground",children:[i,"g"]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"projected fat loss"})]})]})]})},l2=()=>t.jsx(Bt,{feature:"Goal Metrics",grayOutForFree:!0,showUpgrade:!1,children:t.jsx(i2,{})}),c2=({deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o})=>{const{hasPremiumFeatures:i,isAdmin:l}=Xe();return l||i?t.jsx(r2,{deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o}):t.jsx(ie,{className:"p-4 bg-card border-border relative",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"flex items-center justify-center space-x-2",children:t.jsx("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Today's Deficit"})}),t.jsx("div",{className:"text-3xl font-bold text-muted-foreground",children:t.jsx(Vs,{className:"w-8 h-8 mx-auto"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Deficit tracking requires premium"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Unlock detailed calorie deficit analysis, fat loss projections, and more"})]})]})})},Wc={sedentary:"Low",moderately_active:"Medium",very_active:"High"},Bc=(e,s)=>{if(s===0)return 0;const r={sedentary:1.2,moderately_active:1.55,very_active:1.725},a=s*1.2,n=s*(r[e]||1.2);return Math.round(n-a)},d2=({currentDisplayLevel:e})=>{const[s,r]=c.useState(!1),{todayOverride:a,loading:n,setActivityOverride:o,clearTodayOverride:i}=Rp(),{profile:l,calculateBMR:d}=Te(),{refreshDeficit:f}=Un(),u=async p=>{try{p==="clear-override"&&a?await i():p!==m()&&await o(p,!1),await f(),setTimeout(()=>r(!1),300)}catch(g){console.error("Error handling activity level change:",g)}},m=()=>a?a.activity_level:l?.activity_level||"sedentary",h=p=>{const g=Wc[p]||p,x=d(),v=Bc(p,x);return v>0?`${g} (+${v} cal)`:`${g} (Base Rate)`};return t.jsx("div",{className:"space-y-2",children:t.jsxs(es,{value:m(),onValueChange:u,open:s,onOpenChange:r,disabled:n,children:[t.jsx(qt,{className:"h-7 text-xs bg-ceramic-base border-ceramic-rim hover:bg-ceramic-plate transition-colors",children:t.jsx(ts,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:h(m())}),a&&t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]})})}),t.jsxs(Wt,{className:"bg-ceramic-plate border-ceramic-rim z-50",children:[Object.entries(Wc).map(([p,g])=>t.jsx(Fe,{value:p,className:"text-xs hover:bg-ceramic-base focus:bg-ceramic-base",children:t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{children:g}),t.jsx("span",{className:"text-[10px] text-muted-foreground",children:(()=>{const x=d(),v=Bc(p,x);return v>0?`+${v} cal/day`:"Base metabolic rate"})()})]}),p===l?.activity_level&&!a&&t.jsx(js,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 ml-2",children:"Default"})]})},p)),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"border-t border-ceramic-rim my-1"}),t.jsxs("div",{className:"px-2 py-1 text-[10px] text-muted-foreground flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),t.jsx("span",{children:"Active for today only"})]}),t.jsx(Fe,{value:"clear-override",className:"text-xs text-muted-foreground hover:bg-ceramic-base focus:bg-ceramic-base",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(hx,{className:"w-3 h-3"}),t.jsx("span",{children:"Clear Override"})]})})]})]})]})})},u2=c.createContext(void 0),m2=()=>{const e=c.useContext(u2);return e===void 0?{walkingStats:{realTimeCalories:0,realTimeDistance:0,realTimeSteps:0,timeElapsed:0,isActive:!1,isPaused:!1,currentSessionId:null}}:e},h2=({totalCalories:e,walkingCalories:s,manualCalories:r,onRefresh:a})=>{const[n,o]=c.useState(!1),[i,l]=c.useState([]),[d,f]=c.useState(!1),[u,m]=c.useState(null),{user:h}=Se(),{walkingStats:p}=m2(),{profile:g}=Te(),{manualBurns:x,todayTotal:v,deleteManualBurn:w}=Ap(),y=async()=>{if(h){f(!0);try{const k=new Date,T=new Date(k.getFullYear(),k.getMonth(),k.getDate()),{data:D}=await P.from("walking_sessions").select("*").eq("user_id",h.id).eq("session_state","completed").gte("start_time",T.toISOString()).lt("start_time",new Date(T.getTime()+24*60*60*1e3).toISOString()).order("start_time",{ascending:!1});l(D||[])}catch(k){console.error("Error fetching walking sessions:",k)}finally{f(!1)}}};c.useEffect(()=>{y()},[h]),c.useEffect(()=>{!p.isActive&&p.currentSessionId===null&&setTimeout(()=>y(),1e3)},[p.isActive,p.currentSessionId]);const b=k=>new Date(k).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),j=(k,T)=>{const D=new Date(k),$=(T?new Date(T):new Date).getTime()-D.getTime();return Math.floor($/1e3/60)},N=k=>Zr(k,g?.units||"imperial"),E=i.length>0||p.isActive||x.length>0,S=i.length+(p.isActive?1:0)+x.length,_=async k=>{try{await w(k),a&&a()}catch(T){console.error("Failed to delete manual calorie burn:",T)}},C=()=>{y(),a&&a()};return E?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Activity Burn"}),t.jsx(st,{content:"Calories burned from walking and external activities today",children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-sm font-bold text-warm-text",children:[Math.round(e)," cal"]}),S>1&&t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>o(!n),className:"h-6 w-6 p-0",children:n?t.jsx(xi,{className:"w-4 h-4"}):t.jsx(Nt,{className:"w-4 h-4"})})]})]}),(s>0||r>0)&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s>0&&t.jsxs("span",{children:["Walking: ",s," cal"]}),s>0&&r>0&&t.jsx("span",{children:" â€¢ "}),r>0&&t.jsxs("span",{children:["External: ",r," cal"]})]}),n&&S>1&&t.jsxs("div",{className:"ml-6 space-y-2",children:[p.isActive&&t.jsxs(ie,{className:"p-2 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-xs font-medium text-green-700 dark:text-green-300",children:"Active Session"}),t.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[Math.floor(p.timeElapsed/60),"m ",p.timeElapsed%60,"s",p.isPaused&&" (Paused)"]})]}),t.jsxs("div",{className:"text-xs font-bold text-green-700 dark:text-green-300",children:[Math.round(p.realTimeCalories)," cal"]})]}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[Zr(p.realTimeDistance,g?.units||"imperial")," â€¢",p.realTimeSteps.toLocaleString()," steps"]})]}),i.map((k,T)=>t.jsxs(ie,{className:"p-2 bg-ceramic-base border-ceramic-rim",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Vt,{className:"w-3 h-3 text-muted-foreground"}),t.jsxs("span",{className:"text-xs font-medium text-warm-text",children:["Session ",i.length-T]}),k.is_edited&&t.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 px-1.5 py-0.5 rounded",children:"Edited"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[b(k.start_time)," - ",k.end_time?b(k.end_time):"Active"]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",j(k.start_time,k.end_time),"m)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-xs font-bold text-warm-text",children:[k.calories_burned||0," cal"]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>m(k),className:"h-4 w-4 p-0 text-muted-foreground hover:text-foreground",children:t.jsx(ut,{className:"w-3 h-3"})})]})]}),k.is_edited?t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Data removed due to edit"}):k.distance?t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[N(k.distance)," â€¢ ",k.estimated_steps?.toLocaleString()||0," steps"]}):null]},k.id)),x.map((k,T)=>t.jsx(ie,{className:"p-2 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(qe,{className:"w-3 h-3 text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:k.activity_name}),t.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:new Date(k.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[k.calories_burned," cal"]}),t.jsx(A,{variant:"ghost",size:"sm",onClick:()=>_(k.id),className:"h-4 w-4 p-0 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:t.jsx(Ie,{className:"w-3 h-3"})})]})]})},k.id))]}),!n&&S===1&&t.jsx("div",{className:"text-xs text-muted-foreground text-right",children:p.isActive?"Active session":x.length>0?"External activity":"Single session today"}),u&&t.jsx(Lf,{session:u,isOpen:!0,onClose:()=>m(null),onSessionEdited:C})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gr,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Activity Burn"})]}),t.jsx("div",{className:"text-sm font-bold text-warm-text",children:"0 cal"})]})},Ip=c.memo(()=>{const[e,s]=c.useState(!1),[r,a]=c.useState(null),{deficitData:n,loading:o,refreshDeficit:i}=Un(),{fatInGrams:l,thirtyDayProjection:d}=jl(),{profile:f}=Te(),{todayEntries:u,todayTotals:m}=$n(),{appLogo:h}=a2(),p=c.useRef(null),g=Kt(),x=g.pathname==="/admin"||g.pathname==="/auth"||g.pathname==="/reset-password"||g.pathname==="/update-password",v=N=>Math.round(Math.abs(N)).toLocaleString(),w=c.useMemo(()=>N=>N>0?"text-accent":N<0?"text-red-600 dark:text-red-400":"text-muted-foreground",[]),y=c.useMemo(()=>N=>({sedentary:"Low Activity",lightly_active:"Light Activity",moderately_active:"Moderate Activity",very_active:"High Activity",extremely_active:"Very High Activity"})[N]||N,[]),b=N=>{a(N.touches[0].clientY)},j=N=>{if(!r)return;const E=N.changedTouches[0].clientY,S=r-E;Math.abs(S)>50&&(S<0&&!e?s(!0):S>0&&e&&s(!1)),a(null)};return c.useEffect(()=>{const N=S=>{const _=S.target;p.current&&!p.current.contains(_)&&(_.closest('[role="dialog"]')||_.closest(".dialog-content")||_.closest("[data-radix-portal]")||_.closest("[data-radix-popper-content-wrapper]")||_.closest('[role="listbox"]')||s(!1))},E=S=>{S.key==="Escape"&&s(!1)};if(e){const S=setTimeout(()=>{document.addEventListener("mousedown",N),document.addEventListener("keydown",E)},100);return()=>{clearTimeout(S),document.removeEventListener("mousedown",N),document.removeEventListener("keydown",E)}}},[e]),x?null:t.jsx(Hs,{children:t.jsxs("div",{ref:p,className:"fixed top-0 left-0 right-0 z-30",children:[t.jsx("div",{className:"cursor-pointer transition-colors select-none",onClick:()=>s(!e),onTouchStart:b,onTouchEnd:j,children:t.jsxs("div",{className:`max-w-md mx-auto px-8 py-3 flex items-center justify-between bg-card hover:bg-card/95 transition-colors ${e?"border-l border-r border-muted-foreground":""}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[h?t.jsx("img",{src:h,alt:"App Logo",className:"w-5 h-5 object-contain"}):t.jsx(Jt,{className:"w-5 h-5 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Today's Deficit:"}),t.jsx(st,{content:"Updates every 15 minutes when walking, hourly when idle - optimized for performance",children:t.jsx(tt,{className:"w-3 h-3 text-muted-foreground"})}),t.jsx(n2,{value:n.todayDeficit,formatNumber:v,getDeficitColor:w,loading:o,tdee:n.tdee})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-muted-foreground hidden sm:inline",children:"Tap to expand"}),t.jsx(Nt,{className:`w-5 h-5 text-muted-foreground transition-transform duration-200 ${e?"rotate-180":""}`})]})]})}),e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/20 z-[-1]",onClick:()=>s(!1)}),t.jsx("div",{className:"bg-card max-w-md mx-auto z-50 rounded-b-lg border-l border-r border-b border-muted-foreground",children:t.jsxs("div",{className:"px-8 py-4 space-y-4",children:[t.jsx(c2,{deficit:n.todayDeficit,loading:o,tdee:n.tdee,fatInGrams:l,thirtyDayProjection:d,userUnits:f?.units}),t.jsxs("div",{className:"grid grid-cols-2 gap-1 px-0.5",children:[t.jsx(o2,{calories:n.caloriesConsumed,carbs:m.carbs}),t.jsx(s2,{icon:t.jsx(Gr,{className:"w-4 h-4 text-primary"}),label:"Calories Out",value:n.totalCaloriesBurned,tooltip:`Total calories burned today: Base (${v(n.tdee)}) + Walking (${v(n.walkingCalories)}) + Manual (${v(n.manualCalories)}) = ${v(n.totalCaloriesBurned)}`})]}),t.jsxs(ie,{className:"p-3 bg-card border-border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Jt,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Base Daily Burn"}),t.jsx(st,{content:`Your Total Daily Energy Expenditure (TDEE) based on BMR (${v(n.bmr)}) Ã— activity multiplier for ${y(n.activityLevel)}. This already includes your selected activity level.`,children:t.jsx(tt,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"text-sm font-bold text-warm-text",children:[v(n.tdee)," cal"]})]}),t.jsx("div",{className:"mb-3",children:t.jsx(d2,{currentDisplayLevel:n.activityLevel})}),t.jsx("div",{className:"border-t border-border my-3"}),t.jsx(h2,{totalCalories:n.walkingCalories+n.manualCalories,walkingCalories:n.walkingCalories,manualCalories:n.manualCalories,onRefresh:i})]}),t.jsx(l2,{}),t.jsx("div",{className:"mt-4",children:t.jsx(t2,{onCalorieAdded:i})}),t.jsx("div",{className:"flex justify-center pt-4",children:t.jsx("button",{onClick:()=>s(!1),className:"flex items-center justify-center p-2 rounded-full bg-card hover:bg-card/80 transition-colors","aria-label":"Close expanded view",children:t.jsx(Nt,{className:"w-5 h-5 text-muted-foreground rotate-180"})})})]})})]})]})})});Ip.displayName="DailyStatsPanel";const f2=()=>{const[e,s]=c.useState({indexHomepage:!1,indexOtherPages:!1}),r=Kt();return c.useEffect(()=>{(async()=>{try{const{data:n}=await P.from("shared_settings").select("setting_key, setting_value").in("setting_key",["seo_index_homepage","seo_index_other_pages"]);if(n){const o=n.reduce((i,l)=>(i[l.setting_key]=l.setting_value==="true",i),{});s({indexHomepage:o.seo_index_homepage||!1,indexOtherPages:o.seo_index_other_pages||!1})}}catch(n){console.warn("Failed to fetch SEO settings:",n)}})()},[]),c.useEffect(()=>{const n=r.pathname==="/"?e.indexHomepage:e.indexOtherPages,o=document.querySelector('meta[name="robots"]');o&&o.remove();const i=document.createElement("meta");return i.name="robots",i.content=n?"index, follow":"noindex, nofollow",document.head.appendChild(i),()=>{const l=document.querySelector('meta[name="robots"]');l&&l.remove()}},[e,r.pathname]),null},p2=()=>{const[e,s]=c.useState(!1),[r,a]=c.useState("web"),n=c.useRef(!1);return c.useEffect(()=>{if(n.current)return;(()=>{try{const i=Ft.isNativePlatform(),l=Ft.getPlatform();s(i),a(l),window.__IS_NATIVE_APP__=i,window.__PLATFORM__=l,i&&typeof window<"u"&&(window.__FORCE_PRODUCTION__=!0),n.current=!0}catch(i){console.error("Native app detection failed:",i),s(!1),a("web"),n.current=!0}})()},[]),{isNativeApp:e,platform:r,isAndroid:r==="android",isIOS:r==="ios",isWeb:r==="web"}};class g2 extends c.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(s){if(s.message.includes("Rendered fewer hooks")||s.message.includes("hook calls")||s.message.includes("Hook call"))return console.error("ðŸš¨ React hooks consistency error detected:",s.message),{hasError:!0,error:s};throw s}componentDidCatch(s,r){console.error("HookConsistencyBoundary caught error:",s,r)}render(){return this.state.hasError?this.props.fallback||t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs("div",{className:"max-w-md w-full text-center",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4 text-destructive",children:"App Rendering Error"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"The app encountered a rendering issue. Please refresh to continue."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90",children:"Refresh App"})]})}):this.props.children}}function x2(e){c.useEffect(()=>{let s;return(async()=>{if(!(typeof window>"u"||!e||!(window.__IS_NATIVE_APP__||Ft.isNativePlatform())))try{const{App:n}=await Bs(async()=>{const{App:i}=await import("./index-B9I_IFZh.js");return{App:i}},__vite__mapDeps([0,1,2,3]),import.meta.url),o=await n.addListener("appUrlOpen",({url:i})=>{typeof i=="string"&&i.length>0&&e(i)});s=()=>{try{o.remove()}catch{}}}catch{}})(),()=>{try{s?.()}catch{}}},[e])}function v2(){const e=kt(),{toast:s}=pe();return{handleOAuthCallback:c.useCallback(async a=>{if(!a.includes("oauth/callback")||!a.includes("#")){console.log("ðŸ”— Deep link received but not OAuth callback:",a);return}console.log("ðŸ”„ Processing OAuth deep link callback:",a);try{const{data:n,error:o}=await P.auth.exchangeCodeForSession(a);if(o){console.error("âŒ OAuth deep link exchange failed:",o),s({title:"Authentication Failed",description:o.message||"Failed to complete sign-in. Please try again.",variant:"destructive"}),e("/auth");return}n.session?.user?(console.log("âœ… OAuth deep link successful:",{userId:n.session.user.id,email:n.session.user.email}),s({title:"Welcome!",description:"Successfully signed in with Google."}),e("/")):(console.warn("âš ï¸ OAuth deep link completed but no session found"),s({title:"Authentication Incomplete",description:"Please try signing in again.",variant:"destructive"}),e("/auth"))}catch(n){console.error("âŒ Unexpected error in OAuth deep link:",n),s({title:"Authentication Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),e("/auth")}},[e,s])}}function y2(){const{handleOAuthCallback:e}=v2();x2(e)}c.lazy(()=>Bs(()=>import("./AdminOverview-D5zbDRjt.js"),__vite__mapDeps([4,3,2,1,5,6,7]),import.meta.url));const w2=c.lazy(()=>Bs(()=>import("./Operations-D9KA41dV.js"),__vite__mapDeps([8,3,2,9,10,1,11,12,13,14]),import.meta.url)),b2=c.lazy(()=>Bs(()=>import("./Content-CWxfsIUa.js"),__vite__mapDeps([15,3,2,9,16,1,7,17,6]),import.meta.url)),j2=c.lazy(()=>Bs(()=>import("./Branding-C8ogaTYQ.js"),__vite__mapDeps([18,3,2,9,19,20,1,21,22]),import.meta.url)),N2=c.lazy(()=>Bs(()=>import("./Payments-Bizeatb2.js"),__vite__mapDeps([23,3,2,9,24,20,1]),import.meta.url)),S2=c.lazy(()=>Bs(()=>import("./Dev-Bu1-D2UL.js"),__vite__mapDeps([25,3,2,9,5,6,1]),import.meta.url));if(typeof window<"u"){const e=vb({storage:window.localStorage,throttleTime:1e3});xb({queryClient:Rs,persister:e,maxAge:1e3*60*60*24})}const _2=({isNativeApp:e,platform:s})=>{y2();const r=Kt(),{user:a}=Ks(),{profile:n,isProfileComplete:o}=Te(),[i,l]=c.useState(!1);ft(g=>g.setOAuthCompleting),ft(g=>g.forceRefresh);const{state:d,error:f,isOnline:u,retry:m,forceRefresh:h}=Hk(e);Zk(e),c.useEffect(()=>{if(e){const g=document.querySelector('meta[name="viewport"]');g&&g.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),document.body.classList.add("native-app",`platform-${s}`),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"}},[e,s]);const p=r.pathname==="/auth"||r.pathname==="/reset-password"||r.pathname==="/update-password";return c.useEffect(()=>{setTimeout(async()=>{try{await d1()}catch(x){console.warn("Analytics initialization failed (non-critical):",x)}},1e3)},[]),c.useEffect(()=>{u1(r.pathname)},[r.pathname]),c.useEffect(()=>{if(a&&n!==null){const g=o();console.log("Profile onboarding check:",{user:!!a,profileComplete:g,weight:n?.weight,height:n?.height,age:n?.age}),l(!g)}else l(!1)},[a,n,o]),c.useEffect(()=>{const g=x=>{u||console.log("Offline navigation detected, using cached app shell")};return window.addEventListener("popstate",g),()=>window.removeEventListener("popstate",g)},[u]),t.jsxs(Gk,{state:d,error:f,isOnline:u,onRetry:m,onForceRefresh:h,children:[t.jsx("div",{className:"min-h-screen bg-frame-background overflow-x-hidden",children:t.jsxs("div",{className:`mx-auto max-w-md min-h-screen bg-background relative shadow-2xl overflow-x-hidden ${p?"":"px-4"}`,children:[t.jsx(f2,{}),!p&&t.jsx(Ip,{}),t.jsxs(c0,{children:[t.jsx(Je,{path:"/auth",element:t.jsx(lt,{children:t.jsx(CS,{})})}),t.jsx(Je,{path:"/auth/callback",element:t.jsx(lt,{children:t.jsx(kS,{})})}),t.jsx(Je,{path:"/reset-password",element:t.jsx(lt,{children:t.jsx(ES,{})})}),t.jsx(Je,{path:"/update-password",element:t.jsx(lt,{children:t.jsx(TS,{})})}),t.jsx(Je,{path:"/",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx(j1,{})})})}),t.jsx(Je,{path:"/motivators",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx(H1,{})})})}),t.jsx(Je,{path:"/motivator-ideas",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx(iS,{})})})}),t.jsx(Je,{path:"/settings",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx(vS,{})})})}),t.jsx(Je,{path:"/walking",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx(nC,{})})})}),t.jsx(Je,{path:"/food-tracking",element:t.jsx($t,{children:t.jsx(lt,{children:t.jsx($k,{})})})}),t.jsx(Je,{path:"/admin",element:t.jsx(l0,{to:"/admin/operations",replace:!0})}),t.jsx(Je,{path:"/admin/operations",element:t.jsx($t,{children:t.jsx($r,{children:t.jsx(lt,{children:t.jsx(c.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(w2,{})})})})})}),t.jsx(Je,{path:"/admin/content",element:t.jsx($t,{children:t.jsx($r,{children:t.jsx(lt,{children:t.jsx(c.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(b2,{})})})})})}),t.jsx(Je,{path:"/admin/branding",element:t.jsx($t,{children:t.jsx($r,{children:t.jsx(lt,{children:t.jsx(c.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(j2,{})})})})})}),t.jsx(Je,{path:"/admin/payments",element:t.jsx($t,{children:t.jsx($r,{children:t.jsx(lt,{children:t.jsx(c.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(N2,{})})})})})}),t.jsx(Je,{path:"/admin/dev",element:t.jsx($t,{children:t.jsx($r,{children:t.jsx(lt,{children:t.jsx(c.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(S2,{})})})})})}),t.jsx(Je,{path:"/health",element:t.jsx(lt,{children:t.jsx(Uk,{})})}),t.jsx(Je,{path:"*",element:t.jsx(lt,{children:t.jsx(MS,{})})})]}),!p&&t.jsx(Bk,{})]})}),t.jsx(_f,{isOpen:i,onClose:()=>l(!1)})]})};function C2(){const{isNativeApp:e,platform:s}=p2(),r=e?i0:x0;return c.useEffect(()=>{e&&typeof window<"u"&&(document.body.classList.add("native-app",`platform-${s}`),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden")},[e,s]),t.jsx(S0,{onError:(a,n)=>{console.error("App-level error:",a,n)},children:t.jsx(sb,{client:Rs,children:t.jsx(g2,{children:t.jsxs(Hs,{children:[t.jsx(Tv,{}),t.jsx(ay,{}),t.jsx(pS,{children:t.jsx(H0,{children:t.jsx(tC,{children:t.jsx(r,{children:t.jsx(_0,{children:t.jsx(_2,{isNativeApp:e,platform:s})})})})})})]})})})})}const k2=()=>{try{if(typeof window<"u"&&window.Capacitor){const e=Ft.getPlatform();if(e==="ios"||e==="android")return console.log("Native app detected via Capacitor.getPlatform():",e),!0}}catch(e){console.warn("Capacitor platform check failed:",e)}try{if(Ft.isNativePlatform())return console.log("Native app detected via Capacitor.isNativePlatform()"),!0}catch(e){console.warn("Capacitor.isNativePlatform() check failed:",e)}if(typeof window<"u"&&window.Capacitor)return console.log("Native app detected via window.Capacitor presence"),!0;if(typeof navigator<"u"){const e=navigator.userAgent;if(e.includes("CapacitorWebView")||e.includes("wv)"))return console.log("Native app detected via user agent"),!0}return!1},E2=()=>{k2()?console.log("Native app detected - Service worker disabled"):"serviceWorker"in navigator&&window.addEventListener("load",()=>{try{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registered: ",e)}).catch(e=>{console.log("SW registration failed: ",e)})}catch(e){console.error("Service worker registration error:",e)}})};function Gc(e,...s){try{console[e](...s)}catch{}}if(typeof window<"u"){window.addEventListener("error",s=>{Gc("error","[GlobalError]",s.message,s.filename,s.lineno,s.colno,s.error?.stack)}),window.addEventListener("unhandledrejection",s=>{Gc("error","[UnhandledRejection]",s.reason)});const e="[WEBVIEW]";["log","warn","error"].forEach(s=>{const r=console[s];console[s]=(...a)=>r.call(console,e,...a)})}const T2={version:"62",commit:"diagnostic-build",timestamp:new Date().toISOString()};typeof window<"u"&&console.log("[WEBVIEW] Build Info:",T2);class M2 extends re.Component{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(s,r){console.error("[ErrorBoundary]",s?.message||s,r?.componentStack)}render(){return this.state.hasError?t.jsxs("div",{style:{padding:16,color:"#fff",background:"#111",minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[t.jsx("h2",{children:"Something went wrong."}),t.jsx("p",{children:"Please restart the app."}),t.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:16,padding:"8px 16px",background:"#333",color:"#fff",border:"none",borderRadius:4},children:"Restart App"})]}):this.props.children}}console.debug=()=>{},console.info=()=>{};Lj();E2();const P2=()=>t.jsx(C2,{});dd(document.getElementById("root")).render(t.jsx(c.StrictMode,{children:t.jsx(M2,{children:t.jsx(wN,{children:t.jsx(P2,{})})})}));export{go as $,Ex as A,A as B,ie as C,Xe as D,Ml as E,js as F,gd as G,Fg as H,ge as I,va as J,Z as K,ta as L,on as M,bn as N,Xi as O,qe as P,$r as Q,At as R,Mn as S,_r as T,tt as U,es as V,qt as W,ts as X,Wt as Y,Fe as Z,hx as _,pt as a,Dl as a0,Kt as a1,L2 as a2,Ui as a3,Fu as a4,B2 as a5,Hs as a6,De as a7,Ae as a8,Me as a9,bd as aa,wo as ab,Xg as ac,yN as ad,si as ae,Kk as af,Tg as ag,Ct as ah,h1 as ai,Vt as aj,ut as ak,ea as al,gr as am,Pn as an,xr as ao,Ya as ap,ss as aq,Fs as ar,Ou as as,us as b,Ba as c,$e as d,zt as e,fe as f,NS as g,SS as h,yx as i,xi as j,Nt as k,_S as l,xS as m,Q1 as n,ne as o,Wh as p,We as q,Ja as r,P as s,Rn as t,pe as u,zs as v,tx as w,qs as x,Te as y,Br as z};
//# sourceMappingURL=index-D6Zlv4TB.js.map
