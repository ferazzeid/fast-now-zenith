import{j as e}from"./ui-4JzjGctU.js";import{r as l}from"./vendor-D63tyEUO.js";import{u as V,s as n,C as N,a as b,b as _,d as y,f as u,B as m,aj as w,ak as Q,w as X,a9 as Z,al as G,I as R}from"./index-CNtalSg2.js";import{S as ee}from"./smartphone-C3ZD5vgF.js";import"./supabase-CG8ZnHQM.js";const ne=()=>{const[x,I]=l.useState(null),[v,F]=l.useState(null),[j,U]=l.useState(null),[E,$]=l.useState(""),[D,T]=l.useState(""),[L,M]=l.useState(""),[o,p]=l.useState(!1),{toast:i}=V(),[q,k]=l.useState({image:"/lovable-uploads/default-author.png",name:"Admin",title:"Personal Insight"}),[h,B]=l.useState({name:"Admin",title:"Personal Insight"}),[C,S]=l.useState(!1);l.useEffect(()=>{W(),H()},[]);const W=async()=>{try{const{data:a,error:t}=await n.from("shared_settings").select("setting_key, setting_value").in("setting_key",["app_logo","app_favicon","app_icon_url"]);if(t){console.error("Error fetching brand assets:",t);return}a&&a.forEach(s=>{s.setting_key==="app_favicon"?T(s.setting_value||""):s.setting_key==="app_logo"?M(s.setting_value||""):s.setting_key==="app_icon_url"&&$(s.setting_value||"")})}catch(a){console.error("Error fetching current assets:",a)}},H=async()=>{try{const{data:a}=await n.from("shared_settings").select("setting_key, setting_value").in("setting_key",["author_tooltip_image","author_tooltip_name","author_tooltip_title"]);if(a){const t=a.reduce((s,r)=>(s[r.setting_key]=r.setting_value,s),{});k({image:t.author_tooltip_image||"/lovable-uploads/default-author.png",name:t.author_tooltip_name||"Admin",title:t.author_tooltip_title||"Personal Insight"}),B({name:t.author_tooltip_name||"Admin",title:t.author_tooltip_title||"Personal Insight"}),S(!1)}}catch(a){console.error("Failed to load author settings:",a)}},A=(a,t)=>{if(!a.type.startsWith("image/")){i({title:"Invalid file type",description:"Please select a valid image file (PNG, JPG, etc.)",variant:"destructive"});return}if(a.size>2*1024*1024){i({title:"File too large",description:"Please select an image smaller than 2MB",variant:"destructive"});return}t==="appIcon"?I(a):t==="favicon"?F(a):U(a)},Y=async(a,t)=>{const s=a.name.split(".").pop(),r=`${t}-${Date.now()}.${s}`,d=`brand-assets/${r}`;console.log(`Uploading ${t}:`,{fileName:r,filePath:d,fileSize:a.size,fileType:a.type});const{data:c,error:g}=await n.storage.from("website-images").upload(d,a,{cacheControl:"3600",upsert:!1});if(g)throw console.error(`Upload error for ${t}:`,g),new Error(`Upload failed: ${g.message}`);console.log(`Upload successful for ${t}:`,c);const{data:f}=n.storage.from("website-images").getPublicUrl(d);return console.log(`Public URL generated for ${t}:`,f.publicUrl),f.publicUrl},J=async a=>{if(!a.type.startsWith("image/")){i({title:"Invalid file type",description:"Please select an image file.",variant:"destructive"});return}if(a.size>5*1024*1024){i({title:"File too large",description:"Please select an image under 5MB.",variant:"destructive"});return}p(!0);try{const t=a.name.split(".").pop(),r=`author/${`author-${Math.random()}.${t}`}`,{error:d}=await n.storage.from("website-images").upload(r,a);if(d)throw d;const{data:{publicUrl:c}}=n.storage.from("website-images").getPublicUrl(r);await n.from("shared_settings").upsert({setting_key:"author_tooltip_image",setting_value:c},{onConflict:"setting_key"}),k(g=>({...g,image:c})),i({title:"Author image updated",description:"The author tooltip image has been updated successfully."})}catch(t){console.error("Error uploading author image:",t),i({title:"Upload failed",description:"Failed to upload the author image. Please try again.",variant:"destructive"})}finally{p(!1)}},K=async()=>{if(C){p(!0);try{await Promise.all([n.from("shared_settings").upsert({setting_key:"author_tooltip_name",setting_value:h.name},{onConflict:"setting_key"}),n.from("shared_settings").upsert({setting_key:"author_tooltip_title",setting_value:h.title},{onConflict:"setting_key"})]),k(a=>({...a,name:h.name,title:h.title})),S(!1),i({title:"Author info saved",description:"Author information has been updated successfully."})}catch(a){console.error("Error saving author info:",a),i({title:"Save failed",description:"Failed to save author information. Please try again.",variant:"destructive"})}finally{p(!1)}}},z=(a,t)=>{B(s=>({...s,[a]:t})),S(!0)},O=async()=>{if("serviceWorker"in navigator)try{const t=await navigator.serviceWorker.ready;t&&t.update()}catch(t){console.log("Service worker update failed (non-critical):",t)}const a=document.querySelector('link[rel="manifest"]');if(a){const t=new URL(a.href);t.searchParams.set("v",Date.now().toString()),a.href=t.toString()}console.log("Manifest and PWA cache updated")},P=async(a,t)=>{if(!a){i({title:"No file selected",description:`Please select a ${t} image first`,variant:"destructive"});return}p(!0);try{console.log(`Starting ${t} upload:`,a.name);const s=await Y(a,t);console.log(`${t} uploaded successfully:`,s);let r="";t==="appIcon"?r="app_icon_url":t==="favicon"?r="app_favicon":r="app_logo";const{data:d}=await n.from("shared_settings").select("setting_key").eq("setting_key",r).maybeSingle();let c;if(d){const{error:f}=await n.from("shared_settings").update({setting_value:s,updated_at:new Date().toISOString()}).eq("setting_key",r);c=f}else{const{error:f}=await n.from("shared_settings").insert({setting_key:r,setting_value:s});c=f}if(c)throw console.error("Database update error:",c),new Error(`Failed to save ${t} URL: ${c.message}`);t==="appIcon"?($(s),I(null)):t==="favicon"?(T(s),F(null)):(M(s),U(null)),await O(),i({title:"Success",description:{appIcon:"App icon updated successfully! This will be used for PWA installation and home screen icons.",favicon:"Favicon uploaded successfully! The new favicon will appear on browser tabs.",logo:"Logo updated successfully! This will be used for app branding and headers."}[t]}),await W()}catch(s){console.error(`Error uploading ${t}:`,s),i({title:"Upload Failed",description:s?.message||`Failed to upload ${t}. Please try again.`,variant:"destructive"})}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"App Icon · 192x192/512x512"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Main app icon for home screen and app stores (used for PWA)"})]}),e.jsxs(y,{className:"space-y-4",children:[E&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:E,alt:"Current app icon",className:"w-12 h-12 object-contain rounded",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current app icon"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"app-icon-upload",className:"text-sm font-medium",children:"Select App Icon (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"app-icon-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&A(a.target.files[0],"appIcon"),className:"hidden"}),e.jsxs(m,{variant:"outline",onClick:()=>document.getElementById("app-icon-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Choose File"]}),x&&e.jsx("span",{className:"text-sm text-muted-foreground",children:x.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:()=>P(x,"appIcon"),disabled:!x||o,className:"flex-1 sm:flex-none",children:o?"Uploading...":"Save"})})]})]}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Favicon · 32x32"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Small icon shown in browser tabs and bookmarks"})]}),e.jsxs(y,{className:"space-y-4",children:[D&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:D,alt:"Current favicon",className:"w-8 h-8 object-contain",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current favicon"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"favicon-upload",className:"text-sm font-medium",children:"Select Favicon (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"favicon-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&A(a.target.files[0],"favicon"),className:"hidden"}),e.jsxs(m,{variant:"outline",onClick:()=>document.getElementById("favicon-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Choose File"]}),v&&e.jsx("span",{className:"text-sm text-muted-foreground",children:v.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:()=>P(v,"favicon"),disabled:!v||o,className:"flex-1 sm:flex-none",children:o?"Uploading...":"Save"})})]})]}),e.jsxs(N,{children:[e.jsxs(b,{children:[e.jsxs(_,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Logo · Variable Size"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Main brand logo for headers, splash screens, and general branding"})]}),e.jsxs(y,{className:"space-y-4",children:[L&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:L,alt:"Current logo",className:"w-12 h-12 object-contain rounded",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current logo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"logo-upload",className:"text-sm font-medium",children:"Select Logo (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"logo-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&A(a.target.files[0],"logo"),className:"hidden"}),e.jsxs(m,{variant:"outline",onClick:()=>document.getElementById("logo-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Choose File"]}),j&&e.jsx("span",{className:"text-sm text-muted-foreground",children:j.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:()=>P(j,"logo"),disabled:!j||o,className:"flex-1 sm:flex-none",children:o?"Uploading...":"Save"})})]})]}),e.jsxs(N,{className:"mt-6",children:[e.jsx(b,{children:e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{children:"Author Profile"}),e.jsx(G,{content:"This configures the author information shown in tooltips throughout the app where you can leave personal insights for users."})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Author Image"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:q.image,alt:"Author",className:"w-16 h-16 rounded-full object-cover border-2 border-border"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:a=>{const t=a.target.files?.[0];t&&J(t)},className:"hidden",id:"author-image-upload",disabled:o}),e.jsxs("label",{htmlFor:"author-image-upload",className:`flex items-center space-x-2 px-4 py-2 border border-dashed border-border rounded-lg cursor-pointer hover:bg-accent transition-colors ${o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Upload author image"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Recommended: Square image, max 5MB"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"author-name",children:"Author Name"}),e.jsx(R,{id:"author-name",value:h.name,onChange:a=>z("name",a.target.value),placeholder:"Enter author name",disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"author-title",children:"Tooltip Title"}),e.jsx(R,{id:"author-title",value:h.title,onChange:a=>z("title",a.target.value),placeholder:"e.g., Personal Insight, Author Note",disabled:o})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:K,disabled:!C||o,className:"flex-1 sm:flex-none",children:o?"Saving...":"Save Author Info"}),C&&e.jsx("p",{className:"text-xs text-muted-foreground self-center",children:"You have unsaved changes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Preview"}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-border rounded-lg bg-muted/30",children:[e.jsx(G,{content:"This is how your tooltips will appear throughout the app. You can customize the image, name, and title above."}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hover or click the icon to see your tooltip"})]})]})]})]})]})};export{ne as default};
