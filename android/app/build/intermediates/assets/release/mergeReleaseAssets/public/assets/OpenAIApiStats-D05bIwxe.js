import{j as e}from"./ui-4JzjGctU.js";import{r as l}from"./vendor-D63tyEUO.js";import{s as w,C as m,a as f,b as g,d as h,L as C}from"./index-CNtalSg2.js";import"./supabase-CG8ZnHQM.js";const P=()=>{const[a,j]=l.useState({totalRequests:0,totalCost:0,requestsToday:0,costToday:0,averageRequestsPerDay:0,mostUsedModel:"N/A",successRate:0}),[p,c]=l.useState(!0);l.useEffect(()=>{y()},[]);const y=async()=>{try{c(!0);const r=new Date;r.setDate(r.getDate()-30);const i=new Date;i.setHours(0,0,0,0);const{data:t,error:u}=await w.from("ai_usage_logs").select("*").gte("created_at",r.toISOString()).order("created_at",{ascending:!1});if(u){console.error("Error fetching API stats:",u);return}if(!t||t.length===0){c(!1);return}const n=t.length,N=t.reduce((s,o)=>s+(o.estimated_cost||0),0),x=t.filter(s=>new Date(s.created_at)>=i),b=x.length,R=x.reduce((s,o)=>s+(o.estimated_cost||0),0),S=Math.round(n/30),d={};t.forEach(s=>{s.model_used&&(d[s.model_used]=(d[s.model_used]||0)+1)});const q=Object.keys(d).length>0?Object.entries(d).sort(([,s],[,o])=>o-s)[0][0]:"N/A",v=t.filter(s=>!s.request_type?.includes("error")).length,A=n>0?Math.round(v/n*100):0;j({totalRequests:n,totalCost:N,requestsToday:b,costToday:R,averageRequestsPerDay:S,mostUsedModel:q,successRate:A})}catch(r){console.error("Error calculating API stats:",r)}finally{c(!1)}};return p?e.jsxs(m,{children:[e.jsx(f,{children:e.jsx(g,{children:"OpenAI API Statistics"})}),e.jsx(h,{className:"flex items-center justify-center py-8",children:e.jsx(C,{})})]}):e.jsxs(m,{children:[e.jsx(f,{children:e.jsx(g,{className:"text-lg",children:"OpenAI API Statistics"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Requests"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:a.totalRequests.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Requests Today"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:a.requestsToday.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Daily Average"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:a.averageRequestsPerDay.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Cost"}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:["$",a.totalCost.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:"Today's Cost"}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:["$",a.costToday.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Success Rate"}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[a.successRate,"%"]})]})]})]})})]})};export{P as OpenAIApiStats};
