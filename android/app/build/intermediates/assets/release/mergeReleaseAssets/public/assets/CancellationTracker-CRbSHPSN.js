import{j as e}from"./ui-4JzjGctU.js";import{r as i}from"./vendor-D63tyEUO.js";import{C as m,L as N,a as b,b as _,B as v,d as T,s as a}from"./index-CNtalSg2.js";import"./supabase-CG8ZnHQM.js";const C=()=>{const[s,d]=i.useState({trialEndingsToday:0,trialEndingsMonth:0,cancellationsToday:0,cancellationsMonth:0,upgradestoday:0,upgradesMonth:0}),[x,l]=i.useState(!0),o=async()=>{try{l(!0);const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=new Date(n.getTime()+24*60*60*1e3),{data:u}=await a.from("profiles").select("id").gte("trial_ends_at",n.toISOString()).lt("trial_ends_at",c.toISOString()).eq("subscription_status","free"),{data:h}=await a.from("profiles").select("id").gte("trial_ends_at",r.toISOString()).eq("subscription_status","free"),{data:f}=await a.from("usage_analytics").select("id").eq("event_type","subscription_cancelled").gte("created_at",n.toISOString()),{data:p}=await a.from("usage_analytics").select("id").eq("event_type","subscription_cancelled").gte("created_at",r.toISOString()),{data:j}=await a.from("profiles").select("id").in("subscription_status",["active","trialing"]).gte("trial_started_at",n.toISOString()).lt("trial_started_at",c.toISOString()),{data:y}=await a.from("profiles").select("id").in("subscription_status",["active","trialing"]).gte("trial_started_at",r.toISOString());d({trialEndingsToday:u?.length||0,trialEndingsMonth:h?.length||0,cancellationsToday:f?.length||0,cancellationsMonth:p?.length||0,upgradestoday:j?.length||0,upgradesMonth:y?.length||0})}catch(t){console.error("Error fetching user activity data:",t),d({trialEndingsToday:0,trialEndingsMonth:0,cancellationsToday:0,cancellationsMonth:0,upgradestoday:0,upgradesMonth:0})}finally{l(!1)}},g=async()=>{await o()};return i.useEffect(()=>{o()},[]),x?e.jsx(m,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(N,{})})}):e.jsxs(m,{children:[e.jsx(b,{children:e.jsxs(_,{className:"text-lg flex items-center justify-between",children:["User Activity Tracking",e.jsx(v,{variant:"outline",size:"sm",onClick:g,children:"Refresh"})]})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3 text-center",children:"Trial Endings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Today"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.trialEndingsToday})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"This Month"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.trialEndingsMonth})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3 text-center",children:"Cancellations"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Today"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.cancellationsToday})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"This Month"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.cancellationsMonth})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3 text-center",children:"Upgrades to Paid"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Today"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.upgradestoday})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"This Month"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:s.upgradesMonth})]})]})]})]})})]})};export{C as CancellationTracker};
