import{j as e}from"./ui-4JzjGctU.js";import{r as l}from"./vendor-D63tyEUO.js";import{C as m,a as k,b as C,d as E,s as i}from"./index-D6Zlv4TB.js";import"./supabase-DmvLFwnu.js";const R=()=>{const[a,v]=l.useState({activeUsers:0,todayUsers:0,yesterdayUsers:0,activeFastingSessions:0,activeWalkingSessions:0,aiRequestsToday:0}),[x,h]=l.useState(!0),[p,_]=l.useState(!1),U=async()=>{try{const{data:t,error:c}=await i.from("shared_settings").select("setting_value, setting_key").in("setting_key",["google_analytics_service_account","google_analytics_property_id"]),r=t?.find(s=>s.setting_key==="google_analytics_service_account"),n=t?.find(s=>s.setting_key==="google_analytics_property_id"),d=!c&&r?.setting_value&&r.setting_value!=="{}"&&n?.setting_value&&n.setting_value!=="";_(!!d);const{data:S,error:g}=await i.from("fasting_sessions").select("id").eq("status","active"),{data:w,error:y}=await i.from("walking_sessions").select("id").eq("status","active"),{data:b,error:u}=await i.from("ai_usage_logs").select("id").gte("created_at",new Date().toISOString().split("T")[0]);g&&console.error("Error fetching fasting sessions:",g),y&&console.error("Error fetching walking sessions:",y),u&&console.error("Error fetching AI requests:",u);let o={activeUsers:0,todayUsers:0,yesterdayUsers:0};if(d)try{const{data:s,error:f}=await i.functions.invoke("google-analytics-data");!f&&s&&!s.error?o={activeUsers:s.activeUsers||0,todayUsers:s.todayUsers||0,yesterdayUsers:s.yesterdayUsers||0}:console.warn("Failed to fetch Google Analytics data:",f||s?.error)}catch(s){console.warn("Error calling Google Analytics function:",s)}v(s=>({...s,activeFastingSessions:S?.length||0,activeWalkingSessions:w?.length||0,aiRequestsToday:b?.length||0,activeUsers:o.activeUsers,todayUsers:o.todayUsers,yesterdayUsers:o.yesterdayUsers}))}catch(t){console.error("Error fetching analytics data:",t)}finally{h(!1)}};if(l.useEffect(()=>{U()},[]),x)return e.jsx(m,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-16",children:e.jsx("span",{className:"text-muted-foreground",children:"Loading..."})})});const j=[{title:"Active Users Now",items:[{label:"Count",value:a.activeUsers}]},{title:"Users Today",items:[{label:"Count",value:a.todayUsers}]},{title:"Users Yesterday",items:[{label:"Count",value:a.yesterdayUsers}]},{title:"Active Fasting",items:[{label:"Sessions",value:a.activeFastingSessions}]},{title:"Active Walking",items:[{label:"Sessions",value:a.activeWalkingSessions}]},{title:"AI Requests Today",items:[{label:"Count",value:a.aiRequestsToday}]}];return e.jsxs(m,{children:[e.jsx(k,{children:e.jsx(C,{className:"text-lg",children:"Real-Time Analytics"})}),e.jsxs(E,{children:[!p&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Configure Google Analytics tracking ID in API Configuration to see real user data"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:j.map((t,c)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-foreground mb-3 text-center",children:t.title}),e.jsx("div",{className:"space-y-2",children:t.items.map((r,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:r.label}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:r.value})]},n))})]},c))})]})]})};export{R as SimpleAnalyticsWidget};
//# sourceMappingURL=SimpleAnalyticsWidget-CjyADUOB.js.map
