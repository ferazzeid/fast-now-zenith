const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverview-B4IWcpIM.js","assets/ui-4JzjGctU.js","assets/vendor-D63tyEUO.js","assets/supabase-CG8ZnHQM.js","assets/AdminRoleTester-DsA0kw4G.js","assets/AdminQuoteSettings-hH5AO4BH.js","assets/Operations-CK0g1Pgi.js","assets/AdminSubnav-Bw1kytFe.js","assets/SimpleAnalyticsWidget-C8-9VhbZ.js","assets/CancellationTracker-CRbSHPSN.js","assets/AdminTierStats-By7Nei8C.js","assets/UserRequestLimits-DzWOs74V.js","assets/OpenAIApiStats-D05bIwxe.js","assets/Content-D4_P9vij.js","assets/AdminTimelineSettings-BB7LE_6b.js","assets/PromptManagement-C5uY2jjB.js","assets/Branding-C0c2ntYP.js","assets/BrandAssetsManager-Ci-19AlT.js","assets/smartphone-C3ZD5vgF.js","assets/ColorManagement-CY4RVXOm.js","assets/AdminSEOSettings-DbtG9d52.js","assets/globe-BkLxb4-L.js","assets/Payments-Bv3gsP7P.js","assets/PaymentProviderSettings-DYPbOi4H.js","assets/Dev-UgvawLyk.js"])))=>i.map(i=>d[i]);
import{j as t,V as Pc,R as Dc,A as Ac,C as Rc,T as Ic,D as Fc,P as Ap,a as pe,u as wt,b as we,c as Et,d as jt,e as re,f as Nt,g as ei,S as Oc,h as Rp,i as ts,k as Lt,l as ti,m as en,n as Lc,o as $c,p as Uc,F as zc,q as Ip,r as qc,O as si,s as ri,t as ai,v as ni,w as Bc,x as Wc,y as Gc,z as Fp,W as Op,B as Vc,E as Hc,G as Lp}from"./ui-4JzjGctU.js";import{a as tn,r as l,e as X,G as $p,R as Up}from"./vendor-D63tyEUO.js";import{c as zp,_ as cr}from"./supabase-CG8ZnHQM.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var Qc,pl=tn;Qc=pl.createRoot,pl.hydrateRoot;const qp=1,Bp=1e6;let Un=0;function Wp(){return Un=(Un+1)%Number.MAX_SAFE_INTEGER,Un.toString()}const zn=new Map,gl=e=>{if(zn.has(e))return;const s=setTimeout(()=>{zn.delete(e),zr({type:"REMOVE_TOAST",toastId:e})},Bp);zn.set(e,s)},Gp=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,qp)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?gl(r):e.toasts.forEach(a=>{gl(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==s.toastId)}}},_a=[];let Ca={toasts:[]};function zr(e){Ca=Gp(Ca,e),_a.forEach(s=>{s(Ca)})}function Ke({...e}){const s=Wp(),r=n=>zr({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>zr({type:"DISMISS_TOAST",toastId:s});return zr({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function he(){const[e,s]=l.useState(Ca);return l.useEffect(()=>(_a.push(s),()=>{const r=_a.indexOf(s);r>-1&&_a.splice(r,1)}),[e]),{...e,toast:Ke,dismiss:r=>zr({type:"DISMISS_TOAST",toastId:r})}}function Kc(e){var s,r,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(s=0;s<n;s++)e[s]&&(r=Kc(e[s]))&&(a&&(a+=" "),a+=r)}else for(r in e)e[r]&&(a&&(a+=" "),a+=r);return a}function Yc(){for(var e,s,r=0,a="",n=arguments.length;r<n;r++)(e=arguments[r])&&(s=Kc(e))&&(a&&(a+=" "),a+=s);return a}const xl=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,vl=Yc,sn=(e,s)=>r=>{var a;if(s?.variants==null)return vl(e,r?.class,r?.className);const{variants:n,defaultVariants:o}=s,i=Object.keys(n).map(f=>{const u=r?.[f],m=o?.[f];if(u===null)return null;const h=xl(u)||xl(m);return n[f][h]}),c=r&&Object.entries(r).reduce((f,u)=>{let[m,h]=u;return h===void 0||(f[m]=h),f},{}),d=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((f,u)=>{let{class:m,className:h,...p}=u;return Object.entries(p).every(x=>{let[g,v]=x;return Array.isArray(v)?v.includes({...o,...c}[g]):{...o,...c}[g]===v})?[...f,m,h]:f},[]);return vl(e,i,d,r?.class,r?.className)};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Hp=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,r,a)=>a?a.toUpperCase():r.toLowerCase()),yl=e=>{const s=Hp(e);return s.charAt(0).toUpperCase()+s.slice(1)},Xc=(...e)=>e.filter((s,r,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===r).join(" ").trim(),Qp=e=>{for(const s in e)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kp={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=l.forwardRef(({color:e="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,iconNode:i,...c},d)=>l.createElement("svg",{ref:d,...Kp,width:s,height:s,stroke:e,strokeWidth:a?Number(r)*24/Number(s):r,className:Xc("lucide",n),...!o&&!Qp(c)&&{"aria-hidden":"true"},...c},[...i.map(([f,u])=>l.createElement(f,u)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=(e,s)=>{const r=l.forwardRef(({className:a,...n},o)=>l.createElement(Yp,{ref:o,iconNode:s,className:Xc(`lucide-${Vp(yl(e))}`,`lucide-${e}`,a),...n}));return r.displayName=yl(e),r};/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Br=ie("activity",Xp);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jp=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],oi=ie("arrow-left",Jp);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Jc=ie("book-open",Zp);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eg=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],tg=ie("bookmark",eg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ii=ie("brain",sg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],rn=ie("calendar",rg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],tr=ie("camera",ag);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],dr=ie("check",ng);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],bt=ie("chevron-down",og);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],li=ie("chevron-right",ig);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],cg=ie("chevron-left",lg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ci=ie("chevron-up",dg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ug=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Zc=ie("circle-check-big",ug);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ed=ie("circle",mg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Kt=ie("clock",hg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],wl=ie("cloud-upload",fg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],gg=ie("coffee",pg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],co=ie("crown",xg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vg=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],bl=ie("download",vg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],uo=ie("ellipsis-vertical",yg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],bg=ie("flame",wg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],td=ie("footprints",jg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Sg=ie("history",Ng);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],mo=ie("house",_g);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Wr=ie("image",Cg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],at=ie("info",kg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],an=ie("lightbulb",Eg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Yt=ie("loader-circle",Tg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ur=ie("lock",Mg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pg=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],sd=ie("mail",Pg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],jl=ie("map-pin",Dg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],js=ie("mic",Ag);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ig=ie("minus",Rg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Og=ie("monitor",Fg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],$g=ie("moon",Lg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],zg=ie("palette",Ug);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],rd=ie("pause",qg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Wg=ie("pen-line",Bg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Ea=ie("play",Gg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ze=ie("plus",Vg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hg=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],Qg=ie("quote",Hg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kg=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],hs=ie("refresh-cw",Kg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],Xg=ie("refresh-ccw",Yg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jg=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Zg=ie("rotate-ccw",Jg);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Mt=ie("save",ex);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tx=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],ho=ie("scale",tx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],rx=ie("search",sx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ad=ie("send",ax);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ox=ie("settings",nx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Nl=ie("shield",ix);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Xs=ie("sparkles",lx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cx=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],mt=ie("square-pen",cx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dx=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Sl=ie("star",dx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ux=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],mx=ie("sun",ux);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Gt=ie("target",hx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],px=ie("timer",fx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Je=ie("trash-2",gx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],vx=ie("trending-down",xx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yx=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],nn=ie("trending-up",yx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Qt=ie("triangle-alert",wx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],qr=ie("upload",bx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],_l=ie("user",jx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],ps=ie("utensils",Nx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Cl=ie("volume-2",Sx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _x=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Cx=ie("volume-x",_x);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Pe=ie("x",kx);/**
 * @license lucide-react v0.526.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ex=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ta=ie("zap",Ex),di="-",Tx=e=>{const s=Px(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:i=>{const c=i.split(di);return c[0]===""&&c.length!==1&&c.shift(),nd(c,s)||Mx(i)},getConflictingClassGroupIds:(i,c)=>{const d=r[i]||[];return c&&a[i]?[...d,...a[i]]:d}}},nd=(e,s)=>{if(e.length===0)return s.classGroupId;const r=e[0],a=s.nextPart.get(r),n=a?nd(e.slice(1),a):void 0;if(n)return n;if(s.validators.length===0)return;const o=e.join(di);return s.validators.find(({validator:i})=>i(o))?.classGroupId},kl=/^\[(.+)\]$/,Mx=e=>{if(kl.test(e)){const s=kl.exec(e)[1],r=s?.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},Px=e=>{const{theme:s,prefix:r}=e,a={nextPart:new Map,validators:[]};return Ax(Object.entries(e.classGroups),r).forEach(([o,i])=>{fo(i,a,o,s)}),a},fo=(e,s,r,a)=>{e.forEach(n=>{if(typeof n=="string"){const o=n===""?s:El(s,n);o.classGroupId=r;return}if(typeof n=="function"){if(Dx(n)){fo(n(a),s,r,a);return}s.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([o,i])=>{fo(i,El(s,o),r,a)})})},El=(e,s)=>{let r=e;return s.split(di).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},Dx=e=>e.isThemeGetter,Ax=(e,s)=>s?e.map(([r,a])=>{const n=a.map(o=>typeof o=="string"?s+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,c])=>[s+i,c])):o);return[r,n]}):e,Rx=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const n=(o,i)=>{r.set(o,i),s++,s>e&&(s=0,a=r,r=new Map)};return{get(o){let i=r.get(o);if(i!==void 0)return i;if((i=a.get(o))!==void 0)return n(o,i),i},set(o,i){r.has(o)?r.set(o,i):n(o,i)}}},od="!",Ix=e=>{const{separator:s,experimentalParseClassName:r}=e,a=s.length===1,n=s[0],o=s.length,i=c=>{const d=[];let f=0,u=0,m;for(let v=0;v<c.length;v++){let w=c[v];if(f===0){if(w===n&&(a||c.slice(v,v+o)===s)){d.push(c.slice(u,v)),u=v+o;continue}if(w==="/"){m=v;continue}}w==="["?f++:w==="]"&&f--}const h=d.length===0?c:c.substring(u),p=h.startsWith(od),x=p?h.substring(1):h,g=m&&m>u?m-u:void 0;return{modifiers:d,hasImportantModifier:p,baseClassName:x,maybePostfixModifierPosition:g}};return r?c=>r({className:c,parseClassName:i}):i},Fx=e=>{if(e.length<=1)return e;const s=[];let r=[];return e.forEach(a=>{a[0]==="["?(s.push(...r.sort(),a),r=[]):r.push(a)}),s.push(...r.sort()),s},Ox=e=>({cache:Rx(e.cacheSize),parseClassName:Ix(e),...Tx(e)}),Lx=/\s+/,$x=(e,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:n}=s,o=[],i=e.trim().split(Lx);let c="";for(let d=i.length-1;d>=0;d-=1){const f=i[d],{modifiers:u,hasImportantModifier:m,baseClassName:h,maybePostfixModifierPosition:p}=r(f);let x=!!p,g=a(x?h.substring(0,p):h);if(!g){if(!x){c=f+(c.length>0?" "+c:c);continue}if(g=a(h),!g){c=f+(c.length>0?" "+c:c);continue}x=!1}const v=Fx(u).join(":"),w=m?v+od:v,y=w+g;if(o.includes(y))continue;o.push(y);const b=n(g,x);for(let j=0;j<b.length;++j){const N=b[j];o.push(w+N)}c=f+(c.length>0?" "+c:c)}return c};function Ux(){let e=0,s,r,a="";for(;e<arguments.length;)(s=arguments[e++])&&(r=id(s))&&(a&&(a+=" "),a+=r);return a}const id=e=>{if(typeof e=="string")return e;let s,r="";for(let a=0;a<e.length;a++)e[a]&&(s=id(e[a]))&&(r&&(r+=" "),r+=s);return r};function zx(e,...s){let r,a,n,o=i;function i(d){const f=s.reduce((u,m)=>m(u),e());return r=Ox(f),a=r.cache.get,n=r.cache.set,o=c,c(d)}function c(d){const f=a(d);if(f)return f;const u=$x(d,r);return n(d,u),u}return function(){return o(Ux.apply(null,arguments))}}const Ee=e=>{const s=r=>r[e]||[];return s.isThemeGetter=!0,s},ld=/^\[(?:([a-z-]+):)?(.+)\]$/i,qx=/^\d+\/\d+$/,Bx=new Set(["px","full","screen"]),Wx=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Gx=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Vx=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Hx=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Qx=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,es=e=>Js(e)||Bx.has(e)||qx.test(e),ds=e=>mr(e,"length",sv),Js=e=>!!e&&!Number.isNaN(Number(e)),qn=e=>mr(e,"number",Js),Mr=e=>!!e&&Number.isInteger(Number(e)),Kx=e=>e.endsWith("%")&&Js(e.slice(0,-1)),ye=e=>ld.test(e),us=e=>Wx.test(e),Yx=new Set(["length","size","percentage"]),Xx=e=>mr(e,Yx,cd),Jx=e=>mr(e,"position",cd),Zx=new Set(["image","url"]),ev=e=>mr(e,Zx,av),tv=e=>mr(e,"",rv),Pr=()=>!0,mr=(e,s,r)=>{const a=ld.exec(e);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):r(a[2]):!1},sv=e=>Gx.test(e)&&!Vx.test(e),cd=()=>!1,rv=e=>Hx.test(e),av=e=>Qx.test(e),nv=()=>{const e=Ee("colors"),s=Ee("spacing"),r=Ee("blur"),a=Ee("brightness"),n=Ee("borderColor"),o=Ee("borderRadius"),i=Ee("borderSpacing"),c=Ee("borderWidth"),d=Ee("contrast"),f=Ee("grayscale"),u=Ee("hueRotate"),m=Ee("invert"),h=Ee("gap"),p=Ee("gradientColorStops"),x=Ee("gradientColorStopPositions"),g=Ee("inset"),v=Ee("margin"),w=Ee("opacity"),y=Ee("padding"),b=Ee("saturate"),j=Ee("scale"),N=Ee("sepia"),C=Ee("skew"),_=Ee("space"),k=Ee("translate"),S=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",ye,s],I=()=>[ye,s],z=()=>["",es,ds],W=()=>["auto",Js,ye],Y=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],G=()=>["solid","dashed","dotted","double","none"],te=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$=()=>["start","end","center","between","around","evenly","stretch"],q=()=>["","0",ye],de=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Z=()=>[Js,ye];return{cacheSize:500,separator:":",theme:{colors:[Pr],spacing:[es,ds],blur:["none","",us,ye],brightness:Z(),borderColor:[e],borderRadius:["none","","full",us,ye],borderSpacing:I(),borderWidth:z(),contrast:Z(),grayscale:q(),hueRotate:Z(),invert:q(),gap:I(),gradientColorStops:[e],gradientColorStopPositions:[Kx,ds],inset:A(),margin:A(),opacity:Z(),padding:I(),saturate:Z(),scale:Z(),sepia:q(),skew:Z(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",ye]}],container:["container"],columns:[{columns:[us]}],"break-after":[{"break-after":de()}],"break-before":[{"break-before":de()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Y(),ye]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:S()}],"overscroll-x":[{"overscroll-x":S()}],"overscroll-y":[{"overscroll-y":S()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Mr,ye]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ye]}],grow:[{grow:q()}],shrink:[{shrink:q()}],order:[{order:["first","last","none",Mr,ye]}],"grid-cols":[{"grid-cols":[Pr]}],"col-start-end":[{col:["auto",{span:["full",Mr,ye]},ye]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[Pr]}],"row-start-end":[{row:["auto",{span:[Mr,ye]},ye]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ye]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ye]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...$()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...$(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...$(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ye,s]}],"min-w":[{"min-w":[ye,s,"min","max","fit"]}],"max-w":[{"max-w":[ye,s,"none","full","min","max","fit","prose",{screen:[us]},us]}],h:[{h:[ye,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ye,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ye,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ye,s,"auto","min","max","fit"]}],"font-size":[{text:["base",us,ds]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",qn]}],"font-family":[{font:[Pr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ye]}],"line-clamp":[{"line-clamp":["none",Js,qn]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",es,ye]}],"list-image":[{"list-image":["none",ye]}],"list-style-type":[{list:["none","disc","decimal",ye]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",es,ds]}],"underline-offset":[{"underline-offset":["auto",es,ye]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Y(),Jx]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Xx]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},ev]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...G(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:G()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...G()]}],"outline-offset":[{"outline-offset":[es,ye]}],"outline-w":[{outline:[es,ds]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:z()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[es,ds]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",us,tv]}],"shadow-color":[{shadow:[Pr]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...te(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":te()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[a]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",us,ye]}],grayscale:[{grayscale:[f]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[m]}],saturate:[{saturate:[b]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[f]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ye]}],duration:[{duration:Z()}],ease:[{ease:["linear","in","out","in-out",ye]}],delay:[{delay:Z()}],animate:[{animate:["none","spin","ping","pulse","bounce",ye]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Mr,ye]}],"translate-x":[{"translate-x":[k]}],"translate-y":[{"translate-y":[k]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ye]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ye]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ye]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[es,ds,qn]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ov=zx(nv);function K(...e){return ov(Yc(e))}const iv=Ap,dd=l.forwardRef(({className:e,...s},r)=>t.jsx(Pc,{ref:r,className:K("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));dd.displayName=Pc.displayName;const lv=sn("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ud=l.forwardRef(({className:e,variant:s,...r},a)=>t.jsx(Dc,{ref:a,className:K(lv({variant:s}),e),...r}));ud.displayName=Dc.displayName;const cv=l.forwardRef(({className:e,...s},r)=>t.jsx(Ac,{ref:r,className:K("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...s}));cv.displayName=Ac.displayName;const md=l.forwardRef(({className:e,...s},r)=>t.jsx(Rc,{ref:r,className:K("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:t.jsx(Pe,{className:"h-4 w-4"})}));md.displayName=Rc.displayName;const hd=l.forwardRef(({className:e,...s},r)=>t.jsx(Ic,{ref:r,className:K("text-sm font-semibold",e),...s}));hd.displayName=Ic.displayName;const fd=l.forwardRef(({className:e,...s},r)=>t.jsx(Fc,{ref:r,className:K("text-sm opacity-90",e),...s}));fd.displayName=Fc.displayName;function dv(){const{toasts:e}=he();return t.jsxs(iv,{children:[e.map(function({id:s,title:r,description:a,action:n,...o}){return t.jsxs(ud,{...o,children:[t.jsxs("div",{className:"grid gap-1",children:[r&&t.jsx(hd,{children:r}),a&&t.jsx(fd,{children:a})]}),n,t.jsx(md,{})]},s)}),t.jsx(dd,{})]})}var Tl=["light","dark"],uv="(prefers-color-scheme: dark)",mv=l.createContext(void 0),hv={setTheme:e=>{},themes:[]},fv=()=>{var e;return(e=l.useContext(mv))!=null?e:hv};l.memo(({forcedTheme:e,storageKey:s,attribute:r,enableSystem:a,enableColorScheme:n,defaultTheme:o,value:i,attrs:c,nonce:d})=>{let f=o==="system",u=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(x=>`'${x}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,m=n?Tl.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(x,g=!1,v=!0)=>{let w=i?i[x]:x,y=g?x+"|| ''":`'${w}'`,b="";return n&&v&&!g&&Tl.includes(x)&&(b+=`d.style.colorScheme = '${x}';`),r==="class"?g||w?b+=`c.add(${y})`:b+="null":w&&(b+=`d[s](n,${y})`),b},p=e?`!function(){${u}${h(e)}}()`:a?`!function(){try{${u}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${f})){var t='${uv}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${i?`var x=${JSON.stringify(i)};`:""}${h(i?"x[e]":"e",!0)}}${f?"":"else{"+h(o,!1,!1)+"}"}${m}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${s}');if(e){${i?`var x=${JSON.stringify(i)};`:""}${h(i?"x[e]":"e",!0)}}else{${h(o,!1,!1)};}${m}}catch(t){}}();`;return l.createElement("script",{nonce:d,dangerouslySetInnerHTML:{__html:p}})});var pv=e=>{switch(e){case"success":return vv;case"info":return wv;case"warning":return yv;case"error":return bv;default:return null}},gv=Array(12).fill(0),xv=({visible:e})=>X.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},X.createElement("div",{className:"sonner-spinner"},gv.map((s,r)=>X.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),vv=X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},X.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),yv=X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},X.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),wv=X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},X.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),bv=X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},X.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),jv=()=>{let[e,s]=X.useState(document.hidden);return X.useEffect(()=>{let r=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},po=1,Nv=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let s=this.subscribers.indexOf(e);this.subscribers.splice(s,1)}),this.publish=e=>{this.subscribers.forEach(s=>s(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var s;let{message:r,...a}=e,n=typeof e?.id=="number"||((s=e.id)==null?void 0:s.length)>0?e.id:po++,o=this.toasts.find(c=>c.id===n),i=e.dismissible===void 0?!0:e.dismissible;return o?this.toasts=this.toasts.map(c=>c.id===n?(this.publish({...c,...e,id:n,title:r}),{...c,...e,id:n,dismissible:i,title:r}):c):this.addToast({title:r,...a,dismissible:i,id:n}),n},this.dismiss=e=>(e||this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:e,dismiss:!0})),e),this.message=(e,s)=>this.create({...s,message:e}),this.error=(e,s)=>this.create({...s,message:e,type:"error"}),this.success=(e,s)=>this.create({...s,type:"success",message:e}),this.info=(e,s)=>this.create({...s,type:"info",message:e}),this.warning=(e,s)=>this.create({...s,type:"warning",message:e}),this.loading=(e,s)=>this.create({...s,type:"loading",message:e}),this.promise=(e,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:e,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let a=e instanceof Promise?e:e(),n=r!==void 0;return a.then(async o=>{if(_v(o)&&!o.ok){n=!1;let i=typeof s.error=="function"?await s.error(`HTTP error! status: ${o.status}`):s.error,c=typeof s.description=="function"?await s.description(`HTTP error! status: ${o.status}`):s.description;this.create({id:r,type:"error",message:i,description:c})}else if(s.success!==void 0){n=!1;let i=typeof s.success=="function"?await s.success(o):s.success,c=typeof s.description=="function"?await s.description(o):s.description;this.create({id:r,type:"success",message:i,description:c})}}).catch(async o=>{if(s.error!==void 0){n=!1;let i=typeof s.error=="function"?await s.error(o):s.error,c=typeof s.description=="function"?await s.description(o):s.description;this.create({id:r,type:"error",message:i,description:c})}}).finally(()=>{var o;n&&(this.dismiss(r),r=void 0),(o=s.finally)==null||o.call(s)}),r},this.custom=(e,s)=>{let r=s?.id||po++;return this.create({jsx:e(r),id:r,...s}),r},this.subscribers=[],this.toasts=[]}},pt=new Nv,Sv=(e,s)=>{let r=s?.id||po++;return pt.addToast({title:e,...s,id:r}),r},_v=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",Cv=Sv,kv=()=>pt.toasts,ga=Object.assign(Cv,{success:pt.success,info:pt.info,warning:pt.warning,error:pt.error,custom:pt.custom,message:pt.message,promise:pt.promise,dismiss:pt.dismiss,loading:pt.loading},{getHistory:kv});function Ev(e,{insertAt:s}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",s==="top"&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}Ev(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function xa(e){return e.label!==void 0}var Tv=3,Mv="32px",Pv=4e3,Dv=356,Av=14,Rv=20,Iv=200;function Fv(...e){return e.filter(Boolean).join(" ")}var Ov=e=>{var s,r,a,n,o,i,c,d,f,u;let{invert:m,toast:h,unstyled:p,interacting:x,setHeights:g,visibleToasts:v,heights:w,index:y,toasts:b,expanded:j,removeToast:N,defaultRichColors:C,closeButton:_,style:k,cancelButtonStyle:S,actionButtonStyle:E,className:A="",descriptionClassName:I="",duration:z,position:W,gap:Y,loadingIcon:G,expandByDefault:te,classNames:$,icons:q,closeButtonAriaLabel:de="Close toast",pauseWhenPageIsHidden:Z,cn:F}=e,[Q,ae]=X.useState(!1),[R,B]=X.useState(!1),[L,se]=X.useState(!1),[J,ne]=X.useState(!1),[H,me]=X.useState(0),[le,be]=X.useState(0),ke=X.useRef(null),Te=X.useRef(null),ct=y===0,O=y+1<=v,ue=h.type,ce=h.dismissible!==!1,je=h.className||"",tt=h.descriptionClassName||"",is=X.useMemo(()=>w.findIndex(xe=>xe.toastId===h.id)||0,[w,h.id]),In=X.useMemo(()=>{var xe;return(xe=h.closeButton)!=null?xe:_},[h.closeButton,_]),ma=X.useMemo(()=>h.duration||z||Pv,[h.duration,z]),Cr=X.useRef(0),ls=X.useRef(0),ha=X.useRef(0),cs=X.useRef(null),[fa,Fn]=W.split("-"),pa=X.useMemo(()=>w.reduce((xe,_e,Se)=>Se>=is?xe:xe+_e.height,0),[w,is]),kr=jv(),On=h.invert||m,Er=ue==="loading";ls.current=X.useMemo(()=>is*Y+pa,[is,pa]),X.useEffect(()=>{ae(!0)},[]),X.useLayoutEffect(()=>{if(!Q)return;let xe=Te.current,_e=xe.style.height;xe.style.height="auto";let Se=xe.getBoundingClientRect().height;xe.style.height=_e,be(Se),g(St=>St.find(_t=>_t.toastId===h.id)?St.map(_t=>_t.toastId===h.id?{..._t,height:Se}:_t):[{toastId:h.id,height:Se,position:h.position},...St])},[Q,h.title,h.description,g,h.id]);let Bt=X.useCallback(()=>{B(!0),me(ls.current),g(xe=>xe.filter(_e=>_e.toastId!==h.id)),setTimeout(()=>{N(h)},Iv)},[h,N,g,ls]);X.useEffect(()=>{if(h.promise&&ue==="loading"||h.duration===1/0||h.type==="loading")return;let xe,_e=ma;return j||x||Z&&kr?(()=>{if(ha.current<Cr.current){let Se=new Date().getTime()-Cr.current;_e=_e-Se}ha.current=new Date().getTime()})():_e!==1/0&&(Cr.current=new Date().getTime(),xe=setTimeout(()=>{var Se;(Se=h.onAutoClose)==null||Se.call(h,h),Bt()},_e)),()=>clearTimeout(xe)},[j,x,te,h,ma,Bt,h.promise,ue,Z,kr]),X.useEffect(()=>{let xe=Te.current;if(xe){let _e=xe.getBoundingClientRect().height;return be(_e),g(Se=>[{toastId:h.id,height:_e,position:h.position},...Se]),()=>g(Se=>Se.filter(St=>St.toastId!==h.id))}},[g,h.id]),X.useEffect(()=>{h.delete&&Bt()},[Bt,h.delete]);function Ln(){return q!=null&&q.loading?X.createElement("div",{className:"sonner-loader","data-visible":ue==="loading"},q.loading):G?X.createElement("div",{className:"sonner-loader","data-visible":ue==="loading"},G):X.createElement(xv,{visible:ue==="loading"})}return X.createElement("li",{"aria-live":h.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Te,className:F(A,je,$?.toast,(s=h?.classNames)==null?void 0:s.toast,$?.default,$?.[ue],(r=h?.classNames)==null?void 0:r[ue]),"data-sonner-toast":"","data-rich-colors":(a=h.richColors)!=null?a:C,"data-styled":!(h.jsx||h.unstyled||p),"data-mounted":Q,"data-promise":!!h.promise,"data-removed":R,"data-visible":O,"data-y-position":fa,"data-x-position":Fn,"data-index":y,"data-front":ct,"data-swiping":L,"data-dismissible":ce,"data-type":ue,"data-invert":On,"data-swipe-out":J,"data-expanded":!!(j||te&&Q),style:{"--index":y,"--toasts-before":y,"--z-index":b.length-y,"--offset":`${R?H:ls.current}px`,"--initial-height":te?"auto":`${le}px`,...k,...h.style},onPointerDown:xe=>{Er||!ce||(ke.current=new Date,me(ls.current),xe.target.setPointerCapture(xe.pointerId),xe.target.tagName!=="BUTTON"&&(se(!0),cs.current={x:xe.clientX,y:xe.clientY}))},onPointerUp:()=>{var xe,_e,Se,St;if(J||!ce)return;cs.current=null;let _t=Number(((xe=Te.current)==null?void 0:xe.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Vs=new Date().getTime()-((_e=ke.current)==null?void 0:_e.getTime()),$n=Math.abs(_t)/Vs;if(Math.abs(_t)>=Rv||$n>.11){me(ls.current),(Se=h.onDismiss)==null||Se.call(h,h),Bt(),ne(!0);return}(St=Te.current)==null||St.style.setProperty("--swipe-amount","0px"),se(!1)},onPointerMove:xe=>{var _e;if(!cs.current||!ce)return;let Se=xe.clientY-cs.current.y,St=xe.clientX-cs.current.x,_t=(fa==="top"?Math.min:Math.max)(0,Se),Vs=xe.pointerType==="touch"?10:2;Math.abs(_t)>Vs?(_e=Te.current)==null||_e.style.setProperty("--swipe-amount",`${Se}px`):Math.abs(St)>Vs&&(cs.current=null)}},In&&!h.jsx?X.createElement("button",{"aria-label":de,"data-disabled":Er,"data-close-button":!0,onClick:Er||!ce?()=>{}:()=>{var xe;Bt(),(xe=h.onDismiss)==null||xe.call(h,h)},className:F($?.closeButton,(n=h?.classNames)==null?void 0:n.closeButton)},X.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},X.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),X.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,h.jsx||X.isValidElement(h.title)?h.jsx||h.title:X.createElement(X.Fragment,null,ue||h.icon||h.promise?X.createElement("div",{"data-icon":"",className:F($?.icon,(o=h?.classNames)==null?void 0:o.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||Ln():null,h.type!=="loading"?h.icon||q?.[ue]||pv(ue):null):null,X.createElement("div",{"data-content":"",className:F($?.content,(i=h?.classNames)==null?void 0:i.content)},X.createElement("div",{"data-title":"",className:F($?.title,(c=h?.classNames)==null?void 0:c.title)},h.title),h.description?X.createElement("div",{"data-description":"",className:F(I,tt,$?.description,(d=h?.classNames)==null?void 0:d.description)},h.description):null),X.isValidElement(h.cancel)?h.cancel:h.cancel&&xa(h.cancel)?X.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||S,onClick:xe=>{var _e,Se;xa(h.cancel)&&ce&&((Se=(_e=h.cancel).onClick)==null||Se.call(_e,xe),Bt())},className:F($?.cancelButton,(f=h?.classNames)==null?void 0:f.cancelButton)},h.cancel.label):null,X.isValidElement(h.action)?h.action:h.action&&xa(h.action)?X.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||E,onClick:xe=>{var _e,Se;xa(h.action)&&(xe.defaultPrevented||((Se=(_e=h.action).onClick)==null||Se.call(_e,xe),Bt()))},className:F($?.actionButton,(u=h?.classNames)==null?void 0:u.actionButton)},h.action.label):null))};function Ml(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var Lv=e=>{let{invert:s,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:n,closeButton:o,className:i,offset:c,theme:d="light",richColors:f,duration:u,style:m,visibleToasts:h=Tv,toastOptions:p,dir:x=Ml(),gap:g=Av,loadingIcon:v,icons:w,containerAriaLabel:y="Notifications",pauseWhenPageIsHidden:b,cn:j=Fv}=e,[N,C]=X.useState([]),_=X.useMemo(()=>Array.from(new Set([r].concat(N.filter(Z=>Z.position).map(Z=>Z.position)))),[N,r]),[k,S]=X.useState([]),[E,A]=X.useState(!1),[I,z]=X.useState(!1),[W,Y]=X.useState(d!=="system"?d:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),G=X.useRef(null),te=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),$=X.useRef(null),q=X.useRef(!1),de=X.useCallback(Z=>{var F;(F=N.find(Q=>Q.id===Z.id))!=null&&F.delete||pt.dismiss(Z.id),C(Q=>Q.filter(({id:ae})=>ae!==Z.id))},[N]);return X.useEffect(()=>pt.subscribe(Z=>{if(Z.dismiss){C(F=>F.map(Q=>Q.id===Z.id?{...Q,delete:!0}:Q));return}setTimeout(()=>{$p.flushSync(()=>{C(F=>{let Q=F.findIndex(ae=>ae.id===Z.id);return Q!==-1?[...F.slice(0,Q),{...F[Q],...Z},...F.slice(Q+1)]:[Z,...F]})})})}),[]),X.useEffect(()=>{if(d!=="system"){Y(d);return}d==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Y("dark"):Y("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:Z})=>{Y(Z?"dark":"light")})},[d]),X.useEffect(()=>{N.length<=1&&A(!1)},[N]),X.useEffect(()=>{let Z=F=>{var Q,ae;a.every(R=>F[R]||F.code===R)&&(A(!0),(Q=G.current)==null||Q.focus()),F.code==="Escape"&&(document.activeElement===G.current||(ae=G.current)!=null&&ae.contains(document.activeElement))&&A(!1)};return document.addEventListener("keydown",Z),()=>document.removeEventListener("keydown",Z)},[a]),X.useEffect(()=>{if(G.current)return()=>{$.current&&($.current.focus({preventScroll:!0}),$.current=null,q.current=!1)}},[G.current]),N.length?X.createElement("section",{"aria-label":`${y} ${te}`,tabIndex:-1},_.map((Z,F)=>{var Q;let[ae,R]=Z.split("-");return X.createElement("ol",{key:Z,dir:x==="auto"?Ml():x,tabIndex:-1,ref:G,className:i,"data-sonner-toaster":!0,"data-theme":W,"data-y-position":ae,"data-x-position":R,style:{"--front-toast-height":`${((Q=k[0])==null?void 0:Q.height)||0}px`,"--offset":typeof c=="number"?`${c}px`:c||Mv,"--width":`${Dv}px`,"--gap":`${g}px`,...m},onBlur:B=>{q.current&&!B.currentTarget.contains(B.relatedTarget)&&(q.current=!1,$.current&&($.current.focus({preventScroll:!0}),$.current=null))},onFocus:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||q.current||(q.current=!0,$.current=B.relatedTarget)},onMouseEnter:()=>A(!0),onMouseMove:()=>A(!0),onMouseLeave:()=>{I||A(!1)},onPointerDown:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||z(!0)},onPointerUp:()=>z(!1)},N.filter(B=>!B.position&&F===0||B.position===Z).map((B,L)=>{var se,J;return X.createElement(Ov,{key:B.id,icons:w,index:L,toast:B,defaultRichColors:f,duration:(se=p?.duration)!=null?se:u,className:p?.className,descriptionClassName:p?.descriptionClassName,invert:s,visibleToasts:h,closeButton:(J=p?.closeButton)!=null?J:o,interacting:I,position:Z,style:p?.style,unstyled:p?.unstyled,classNames:p?.classNames,cancelButtonStyle:p?.cancelButtonStyle,actionButtonStyle:p?.actionButtonStyle,removeToast:de,toasts:N.filter(ne=>ne.position==B.position),heights:k.filter(ne=>ne.position==B.position),setHeights:S,expandByDefault:n,gap:g,loadingIcon:v,expanded:E,pauseWhenPageIsHidden:b,cn:j})}))})):null};const $v=({...e})=>{const{theme:s="system"}=fv();return t.jsx(Lv,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},Uv=["top","right","bottom","left"],Ns=Math.min,gt=Math.max,Ma=Math.round,va=Math.floor,Ss=e=>({x:e,y:e}),zv={left:"right",right:"left",bottom:"top",top:"bottom"},qv={start:"end",end:"start"};function go(e,s,r){return gt(e,Ns(s,r))}function ss(e,s){return typeof e=="function"?e(s):e}function rs(e){return e.split("-")[0]}function hr(e){return e.split("-")[1]}function ui(e){return e==="x"?"y":"x"}function mi(e){return e==="y"?"height":"width"}function _s(e){return["top","bottom"].includes(rs(e))?"y":"x"}function hi(e){return ui(_s(e))}function Bv(e,s,r){r===void 0&&(r=!1);const a=hr(e),n=hi(e),o=mi(n);let i=n==="x"?a===(r?"end":"start")?"right":"left":a==="start"?"bottom":"top";return s.reference[o]>s.floating[o]&&(i=Pa(i)),[i,Pa(i)]}function Wv(e){const s=Pa(e);return[xo(e),s,xo(s)]}function xo(e){return e.replace(/start|end/g,s=>qv[s])}function Gv(e,s,r){const a=["left","right"],n=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(e){case"top":case"bottom":return r?s?n:a:s?a:n;case"left":case"right":return s?o:i;default:return[]}}function Vv(e,s,r,a){const n=hr(e);let o=Gv(rs(e),r==="start",a);return n&&(o=o.map(i=>i+"-"+n),s&&(o=o.concat(o.map(xo)))),o}function Pa(e){return e.replace(/left|right|bottom|top/g,s=>zv[s])}function Hv(e){return{top:0,right:0,bottom:0,left:0,...e}}function pd(e){return typeof e!="number"?Hv(e):{top:e,right:e,bottom:e,left:e}}function Da(e){const{x:s,y:r,width:a,height:n}=e;return{width:a,height:n,top:r,left:s,right:s+a,bottom:r+n,x:s,y:r}}function Pl(e,s,r){let{reference:a,floating:n}=e;const o=_s(s),i=hi(s),c=mi(i),d=rs(s),f=o==="y",u=a.x+a.width/2-n.width/2,m=a.y+a.height/2-n.height/2,h=a[c]/2-n[c]/2;let p;switch(d){case"top":p={x:u,y:a.y-n.height};break;case"bottom":p={x:u,y:a.y+a.height};break;case"right":p={x:a.x+a.width,y:m};break;case"left":p={x:a.x-n.width,y:m};break;default:p={x:a.x,y:a.y}}switch(hr(s)){case"start":p[i]-=h*(r&&f?-1:1);break;case"end":p[i]+=h*(r&&f?-1:1);break}return p}const Qv=async(e,s,r)=>{const{placement:a="bottom",strategy:n="absolute",middleware:o=[],platform:i}=r,c=o.filter(Boolean),d=await(i.isRTL==null?void 0:i.isRTL(s));let f=await i.getElementRects({reference:e,floating:s,strategy:n}),{x:u,y:m}=Pl(f,a,d),h=a,p={},x=0;for(let g=0;g<c.length;g++){const{name:v,fn:w}=c[g],{x:y,y:b,data:j,reset:N}=await w({x:u,y:m,initialPlacement:a,placement:h,strategy:n,middlewareData:p,rects:f,platform:i,elements:{reference:e,floating:s}});u=y??u,m=b??m,p={...p,[v]:{...p[v],...j}},N&&x<=50&&(x++,typeof N=="object"&&(N.placement&&(h=N.placement),N.rects&&(f=N.rects===!0?await i.getElementRects({reference:e,floating:s,strategy:n}):N.rects),{x:u,y:m}=Pl(f,h,d)),g=-1)}return{x:u,y:m,placement:h,strategy:n,middlewareData:p}};async function Gr(e,s){var r;s===void 0&&(s={});const{x:a,y:n,platform:o,rects:i,elements:c,strategy:d}=e,{boundary:f="clippingAncestors",rootBoundary:u="viewport",elementContext:m="floating",altBoundary:h=!1,padding:p=0}=ss(s,e),x=pd(p),v=c[h?m==="floating"?"reference":"floating":m],w=Da(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(v)))==null||r?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(c.floating)),boundary:f,rootBoundary:u,strategy:d})),y=m==="floating"?{x:a,y:n,width:i.floating.width,height:i.floating.height}:i.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c.floating)),j=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},N=Da(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:y,offsetParent:b,strategy:d}):y);return{top:(w.top-N.top+x.top)/j.y,bottom:(N.bottom-w.bottom+x.bottom)/j.y,left:(w.left-N.left+x.left)/j.x,right:(N.right-w.right+x.right)/j.x}}const Kv=e=>({name:"arrow",options:e,async fn(s){const{x:r,y:a,placement:n,rects:o,platform:i,elements:c,middlewareData:d}=s,{element:f,padding:u=0}=ss(e,s)||{};if(f==null)return{};const m=pd(u),h={x:r,y:a},p=hi(n),x=mi(p),g=await i.getDimensions(f),v=p==="y",w=v?"top":"left",y=v?"bottom":"right",b=v?"clientHeight":"clientWidth",j=o.reference[x]+o.reference[p]-h[p]-o.floating[x],N=h[p]-o.reference[p],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(f));let _=C?C[b]:0;(!_||!await(i.isElement==null?void 0:i.isElement(C)))&&(_=c.floating[b]||o.floating[x]);const k=j/2-N/2,S=_/2-g[x]/2-1,E=Ns(m[w],S),A=Ns(m[y],S),I=E,z=_-g[x]-A,W=_/2-g[x]/2+k,Y=go(I,W,z),G=!d.arrow&&hr(n)!=null&&W!==Y&&o.reference[x]/2-(W<I?E:A)-g[x]/2<0,te=G?W<I?W-I:W-z:0;return{[p]:h[p]+te,data:{[p]:Y,centerOffset:W-Y-te,...G&&{alignmentOffset:te}},reset:G}}}),Yv=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(s){var r,a;const{placement:n,middlewareData:o,rects:i,initialPlacement:c,platform:d,elements:f}=s,{mainAxis:u=!0,crossAxis:m=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...v}=ss(e,s);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const w=rs(n),y=_s(c),b=rs(c)===c,j=await(d.isRTL==null?void 0:d.isRTL(f.floating)),N=h||(b||!g?[Pa(c)]:Wv(c)),C=x!=="none";!h&&C&&N.push(...Vv(c,g,x,j));const _=[c,...N],k=await Gr(s,v),S=[];let E=((a=o.flip)==null?void 0:a.overflows)||[];if(u&&S.push(k[w]),m){const W=Bv(n,i,j);S.push(k[W[0]],k[W[1]])}if(E=[...E,{placement:n,overflows:S}],!S.every(W=>W<=0)){var A,I;const W=(((A=o.flip)==null?void 0:A.index)||0)+1,Y=_[W];if(Y)return{data:{index:W,overflows:E},reset:{placement:Y}};let G=(I=E.filter(te=>te.overflows[0]<=0).sort((te,$)=>te.overflows[1]-$.overflows[1])[0])==null?void 0:I.placement;if(!G)switch(p){case"bestFit":{var z;const te=(z=E.filter($=>{if(C){const q=_s($.placement);return q===y||q==="y"}return!0}).map($=>[$.placement,$.overflows.filter(q=>q>0).reduce((q,de)=>q+de,0)]).sort(($,q)=>$[1]-q[1])[0])==null?void 0:z[0];te&&(G=te);break}case"initialPlacement":G=c;break}if(n!==G)return{reset:{placement:G}}}return{}}}};function Dl(e,s){return{top:e.top-s.height,right:e.right-s.width,bottom:e.bottom-s.height,left:e.left-s.width}}function Al(e){return Uv.some(s=>e[s]>=0)}const Xv=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(s){const{rects:r}=s,{strategy:a="referenceHidden",...n}=ss(e,s);switch(a){case"referenceHidden":{const o=await Gr(s,{...n,elementContext:"reference"}),i=Dl(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:Al(i)}}}case"escaped":{const o=await Gr(s,{...n,altBoundary:!0}),i=Dl(o,r.floating);return{data:{escapedOffsets:i,escaped:Al(i)}}}default:return{}}}}};async function Jv(e,s){const{placement:r,platform:a,elements:n}=e,o=await(a.isRTL==null?void 0:a.isRTL(n.floating)),i=rs(r),c=hr(r),d=_s(r)==="y",f=["left","top"].includes(i)?-1:1,u=o&&d?-1:1,m=ss(s,e);let{mainAxis:h,crossAxis:p,alignmentAxis:x}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return c&&typeof x=="number"&&(p=c==="end"?x*-1:x),d?{x:p*u,y:h*f}:{x:h*f,y:p*u}}const Zv=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(s){var r,a;const{x:n,y:o,placement:i,middlewareData:c}=s,d=await Jv(s,e);return i===((r=c.offset)==null?void 0:r.placement)&&(a=c.arrow)!=null&&a.alignmentOffset?{}:{x:n+d.x,y:o+d.y,data:{...d,placement:i}}}}},ey=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(s){const{x:r,y:a,placement:n}=s,{mainAxis:o=!0,crossAxis:i=!1,limiter:c={fn:v=>{let{x:w,y}=v;return{x:w,y}}},...d}=ss(e,s),f={x:r,y:a},u=await Gr(s,d),m=_s(rs(n)),h=ui(m);let p=f[h],x=f[m];if(o){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",y=p+u[v],b=p-u[w];p=go(y,p,b)}if(i){const v=m==="y"?"top":"left",w=m==="y"?"bottom":"right",y=x+u[v],b=x-u[w];x=go(y,x,b)}const g=c.fn({...s,[h]:p,[m]:x});return{...g,data:{x:g.x-r,y:g.y-a,enabled:{[h]:o,[m]:i}}}}}},ty=function(e){return e===void 0&&(e={}),{options:e,fn(s){const{x:r,y:a,placement:n,rects:o,middlewareData:i}=s,{offset:c=0,mainAxis:d=!0,crossAxis:f=!0}=ss(e,s),u={x:r,y:a},m=_s(n),h=ui(m);let p=u[h],x=u[m];const g=ss(c,s),v=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(d){const b=h==="y"?"height":"width",j=o.reference[h]-o.floating[b]+v.mainAxis,N=o.reference[h]+o.reference[b]-v.mainAxis;p<j?p=j:p>N&&(p=N)}if(f){var w,y;const b=h==="y"?"width":"height",j=["top","left"].includes(rs(n)),N=o.reference[m]-o.floating[b]+(j&&((w=i.offset)==null?void 0:w[m])||0)+(j?0:v.crossAxis),C=o.reference[m]+o.reference[b]+(j?0:((y=i.offset)==null?void 0:y[m])||0)-(j?v.crossAxis:0);x<N?x=N:x>C&&(x=C)}return{[h]:p,[m]:x}}}},sy=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(s){var r,a;const{placement:n,rects:o,platform:i,elements:c}=s,{apply:d=()=>{},...f}=ss(e,s),u=await Gr(s,f),m=rs(n),h=hr(n),p=_s(n)==="y",{width:x,height:g}=o.floating;let v,w;m==="top"||m==="bottom"?(v=m,w=h===(await(i.isRTL==null?void 0:i.isRTL(c.floating))?"start":"end")?"left":"right"):(w=m,v=h==="end"?"top":"bottom");const y=g-u.top-u.bottom,b=x-u.left-u.right,j=Ns(g-u[v],y),N=Ns(x-u[w],b),C=!s.middlewareData.shift;let _=j,k=N;if((r=s.middlewareData.shift)!=null&&r.enabled.x&&(k=b),(a=s.middlewareData.shift)!=null&&a.enabled.y&&(_=y),C&&!h){const E=gt(u.left,0),A=gt(u.right,0),I=gt(u.top,0),z=gt(u.bottom,0);p?k=x-2*(E!==0||A!==0?E+A:gt(u.left,u.right)):_=g-2*(I!==0||z!==0?I+z:gt(u.top,u.bottom))}await d({...s,availableWidth:k,availableHeight:_});const S=await i.getDimensions(c.floating);return x!==S.width||g!==S.height?{reset:{rects:!0}}:{}}}};function on(){return typeof window<"u"}function fr(e){return gd(e)?(e.nodeName||"").toLowerCase():"#document"}function vt(e){var s;return(e==null||(s=e.ownerDocument)==null?void 0:s.defaultView)||window}function Jt(e){var s;return(s=(gd(e)?e.ownerDocument:e.document)||window.document)==null?void 0:s.documentElement}function gd(e){return on()?e instanceof Node||e instanceof vt(e).Node:!1}function $t(e){return on()?e instanceof Element||e instanceof vt(e).Element:!1}function Xt(e){return on()?e instanceof HTMLElement||e instanceof vt(e).HTMLElement:!1}function Rl(e){return!on()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof vt(e).ShadowRoot}function sa(e){const{overflow:s,overflowX:r,overflowY:a,display:n}=Ut(e);return/auto|scroll|overlay|hidden|clip/.test(s+a+r)&&!["inline","contents"].includes(n)}function ry(e){return["table","td","th"].includes(fr(e))}function ln(e){return[":popover-open",":modal"].some(s=>{try{return e.matches(s)}catch{return!1}})}function fi(e){const s=pi(),r=$t(e)?Ut(e):e;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!s&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!s&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(a=>(r.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(r.contain||"").includes(a))}function ay(e){let s=Cs(e);for(;Xt(s)&&!sr(s);){if(fi(s))return s;if(ln(s))return null;s=Cs(s)}return null}function pi(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function sr(e){return["html","body","#document"].includes(fr(e))}function Ut(e){return vt(e).getComputedStyle(e)}function cn(e){return $t(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Cs(e){if(fr(e)==="html")return e;const s=e.assignedSlot||e.parentNode||Rl(e)&&e.host||Jt(e);return Rl(s)?s.host:s}function xd(e){const s=Cs(e);return sr(s)?e.ownerDocument?e.ownerDocument.body:e.body:Xt(s)&&sa(s)?s:xd(s)}function Vr(e,s,r){var a;s===void 0&&(s=[]),r===void 0&&(r=!0);const n=xd(e),o=n===((a=e.ownerDocument)==null?void 0:a.body),i=vt(n);if(o){const c=vo(i);return s.concat(i,i.visualViewport||[],sa(n)?n:[],c&&r?Vr(c):[])}return s.concat(n,Vr(n,[],r))}function vo(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function vd(e){const s=Ut(e);let r=parseFloat(s.width)||0,a=parseFloat(s.height)||0;const n=Xt(e),o=n?e.offsetWidth:r,i=n?e.offsetHeight:a,c=Ma(r)!==o||Ma(a)!==i;return c&&(r=o,a=i),{width:r,height:a,$:c}}function gi(e){return $t(e)?e:e.contextElement}function Zs(e){const s=gi(e);if(!Xt(s))return Ss(1);const r=s.getBoundingClientRect(),{width:a,height:n,$:o}=vd(s);let i=(o?Ma(r.width):r.width)/a,c=(o?Ma(r.height):r.height)/n;return(!i||!Number.isFinite(i))&&(i=1),(!c||!Number.isFinite(c))&&(c=1),{x:i,y:c}}const ny=Ss(0);function yd(e){const s=vt(e);return!pi()||!s.visualViewport?ny:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function oy(e,s,r){return s===void 0&&(s=!1),!r||s&&r!==vt(e)?!1:s}function Fs(e,s,r,a){s===void 0&&(s=!1),r===void 0&&(r=!1);const n=e.getBoundingClientRect(),o=gi(e);let i=Ss(1);s&&(a?$t(a)&&(i=Zs(a)):i=Zs(e));const c=oy(o,r,a)?yd(o):Ss(0);let d=(n.left+c.x)/i.x,f=(n.top+c.y)/i.y,u=n.width/i.x,m=n.height/i.y;if(o){const h=vt(o),p=a&&$t(a)?vt(a):a;let x=h,g=vo(x);for(;g&&a&&p!==x;){const v=Zs(g),w=g.getBoundingClientRect(),y=Ut(g),b=w.left+(g.clientLeft+parseFloat(y.paddingLeft))*v.x,j=w.top+(g.clientTop+parseFloat(y.paddingTop))*v.y;d*=v.x,f*=v.y,u*=v.x,m*=v.y,d+=b,f+=j,x=vt(g),g=vo(x)}}return Da({width:u,height:m,x:d,y:f})}function iy(e){let{elements:s,rect:r,offsetParent:a,strategy:n}=e;const o=n==="fixed",i=Jt(a),c=s?ln(s.floating):!1;if(a===i||c&&o)return r;let d={scrollLeft:0,scrollTop:0},f=Ss(1);const u=Ss(0),m=Xt(a);if((m||!m&&!o)&&((fr(a)!=="body"||sa(i))&&(d=cn(a)),Xt(a))){const h=Fs(a);f=Zs(a),u.x=h.x+a.clientLeft,u.y=h.y+a.clientTop}return{width:r.width*f.x,height:r.height*f.y,x:r.x*f.x-d.scrollLeft*f.x+u.x,y:r.y*f.y-d.scrollTop*f.y+u.y}}function ly(e){return Array.from(e.getClientRects())}function yo(e,s){const r=cn(e).scrollLeft;return s?s.left+r:Fs(Jt(e)).left+r}function cy(e){const s=Jt(e),r=cn(e),a=e.ownerDocument.body,n=gt(s.scrollWidth,s.clientWidth,a.scrollWidth,a.clientWidth),o=gt(s.scrollHeight,s.clientHeight,a.scrollHeight,a.clientHeight);let i=-r.scrollLeft+yo(e);const c=-r.scrollTop;return Ut(a).direction==="rtl"&&(i+=gt(s.clientWidth,a.clientWidth)-n),{width:n,height:o,x:i,y:c}}function dy(e,s){const r=vt(e),a=Jt(e),n=r.visualViewport;let o=a.clientWidth,i=a.clientHeight,c=0,d=0;if(n){o=n.width,i=n.height;const f=pi();(!f||f&&s==="fixed")&&(c=n.offsetLeft,d=n.offsetTop)}return{width:o,height:i,x:c,y:d}}function uy(e,s){const r=Fs(e,!0,s==="fixed"),a=r.top+e.clientTop,n=r.left+e.clientLeft,o=Xt(e)?Zs(e):Ss(1),i=e.clientWidth*o.x,c=e.clientHeight*o.y,d=n*o.x,f=a*o.y;return{width:i,height:c,x:d,y:f}}function Il(e,s,r){let a;if(s==="viewport")a=dy(e,r);else if(s==="document")a=cy(Jt(e));else if($t(s))a=uy(s,r);else{const n=yd(e);a={...s,x:s.x-n.x,y:s.y-n.y}}return Da(a)}function wd(e,s){const r=Cs(e);return r===s||!$t(r)||sr(r)?!1:Ut(r).position==="fixed"||wd(r,s)}function my(e,s){const r=s.get(e);if(r)return r;let a=Vr(e,[],!1).filter(c=>$t(c)&&fr(c)!=="body"),n=null;const o=Ut(e).position==="fixed";let i=o?Cs(e):e;for(;$t(i)&&!sr(i);){const c=Ut(i),d=fi(i);!d&&c.position==="fixed"&&(n=null),(o?!d&&!n:!d&&c.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||sa(i)&&!d&&wd(e,i))?a=a.filter(u=>u!==i):n=c,i=Cs(i)}return s.set(e,a),a}function hy(e){let{element:s,boundary:r,rootBoundary:a,strategy:n}=e;const i=[...r==="clippingAncestors"?ln(s)?[]:my(s,this._c):[].concat(r),a],c=i[0],d=i.reduce((f,u)=>{const m=Il(s,u,n);return f.top=gt(m.top,f.top),f.right=Ns(m.right,f.right),f.bottom=Ns(m.bottom,f.bottom),f.left=gt(m.left,f.left),f},Il(s,c,n));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function fy(e){const{width:s,height:r}=vd(e);return{width:s,height:r}}function py(e,s,r){const a=Xt(s),n=Jt(s),o=r==="fixed",i=Fs(e,!0,o,s);let c={scrollLeft:0,scrollTop:0};const d=Ss(0);if(a||!a&&!o)if((fr(s)!=="body"||sa(n))&&(c=cn(s)),a){const p=Fs(s,!0,o,s);d.x=p.x+s.clientLeft,d.y=p.y+s.clientTop}else n&&(d.x=yo(n));let f=0,u=0;if(n&&!a&&!o){const p=n.getBoundingClientRect();u=p.top+c.scrollTop,f=p.left+c.scrollLeft-yo(n,p)}const m=i.left+c.scrollLeft-d.x-f,h=i.top+c.scrollTop-d.y-u;return{x:m,y:h,width:i.width,height:i.height}}function Bn(e){return Ut(e).position==="static"}function Fl(e,s){if(!Xt(e)||Ut(e).position==="fixed")return null;if(s)return s(e);let r=e.offsetParent;return Jt(e)===r&&(r=r.ownerDocument.body),r}function bd(e,s){const r=vt(e);if(ln(e))return r;if(!Xt(e)){let n=Cs(e);for(;n&&!sr(n);){if($t(n)&&!Bn(n))return n;n=Cs(n)}return r}let a=Fl(e,s);for(;a&&ry(a)&&Bn(a);)a=Fl(a,s);return a&&sr(a)&&Bn(a)&&!fi(a)?r:a||ay(e)||r}const gy=async function(e){const s=this.getOffsetParent||bd,r=this.getDimensions,a=await r(e.floating);return{reference:py(e.reference,await s(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function xy(e){return Ut(e).direction==="rtl"}const vy={convertOffsetParentRelativeRectToViewportRelativeRect:iy,getDocumentElement:Jt,getClippingRect:hy,getOffsetParent:bd,getElementRects:gy,getClientRects:ly,getDimensions:fy,getScale:Zs,isElement:$t,isRTL:xy};function yy(e,s){let r=null,a;const n=Jt(e);function o(){var c;clearTimeout(a),(c=r)==null||c.disconnect(),r=null}function i(c,d){c===void 0&&(c=!1),d===void 0&&(d=1),o();const{left:f,top:u,width:m,height:h}=e.getBoundingClientRect();if(c||s(),!m||!h)return;const p=va(u),x=va(n.clientWidth-(f+m)),g=va(n.clientHeight-(u+h)),v=va(f),y={rootMargin:-p+"px "+-x+"px "+-g+"px "+-v+"px",threshold:gt(0,Ns(1,d))||1};let b=!0;function j(N){const C=N[0].intersectionRatio;if(C!==d){if(!b)return i();C?i(!1,C):a=setTimeout(()=>{i(!1,1e-7)},1e3)}b=!1}try{r=new IntersectionObserver(j,{...y,root:n.ownerDocument})}catch{r=new IntersectionObserver(j,y)}r.observe(e)}return i(!0),o}function wy(e,s,r,a){a===void 0&&(a={});const{ancestorScroll:n=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:d=!1}=a,f=gi(e),u=n||o?[...f?Vr(f):[],...Vr(s)]:[];u.forEach(w=>{n&&w.addEventListener("scroll",r,{passive:!0}),o&&w.addEventListener("resize",r)});const m=f&&c?yy(f,r):null;let h=-1,p=null;i&&(p=new ResizeObserver(w=>{let[y]=w;y&&y.target===f&&p&&(p.unobserve(s),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=p)==null||b.observe(s)})),r()}),f&&!d&&p.observe(f),p.observe(s));let x,g=d?Fs(e):null;d&&v();function v(){const w=Fs(e);g&&(w.x!==g.x||w.y!==g.y||w.width!==g.width||w.height!==g.height)&&r(),g=w,x=requestAnimationFrame(v)}return r(),()=>{var w;u.forEach(y=>{n&&y.removeEventListener("scroll",r),o&&y.removeEventListener("resize",r)}),m?.(),(w=p)==null||w.disconnect(),p=null,d&&cancelAnimationFrame(x)}}const by=Zv,jy=ey,Ny=Yv,Sy=sy,_y=Xv,Ol=Kv,Cy=ty,ky=(e,s,r)=>{const a=new Map,n={platform:vy,...r},o={...n.platform,_c:a};return Qv(e,s,{...n,platform:o})};var ka=typeof document<"u"?l.useLayoutEffect:l.useEffect;function Aa(e,s){if(e===s)return!0;if(typeof e!=typeof s)return!1;if(typeof e=="function"&&e.toString()===s.toString())return!0;let r,a,n;if(e&&s&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==s.length)return!1;for(a=r;a--!==0;)if(!Aa(e[a],s[a]))return!1;return!0}if(n=Object.keys(e),r=n.length,r!==Object.keys(s).length)return!1;for(a=r;a--!==0;)if(!{}.hasOwnProperty.call(s,n[a]))return!1;for(a=r;a--!==0;){const o=n[a];if(!(o==="_owner"&&e.$$typeof)&&!Aa(e[o],s[o]))return!1}return!0}return e!==e&&s!==s}function jd(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Ll(e,s){const r=jd(e);return Math.round(s*r)/r}function Wn(e){const s=l.useRef(e);return ka(()=>{s.current=e}),s}function Ey(e){e===void 0&&(e={});const{placement:s="bottom",strategy:r="absolute",middleware:a=[],platform:n,elements:{reference:o,floating:i}={},transform:c=!0,whileElementsMounted:d,open:f}=e,[u,m]=l.useState({x:0,y:0,strategy:r,placement:s,middlewareData:{},isPositioned:!1}),[h,p]=l.useState(a);Aa(h,a)||p(a);const[x,g]=l.useState(null),[v,w]=l.useState(null),y=l.useCallback($=>{$!==C.current&&(C.current=$,g($))},[]),b=l.useCallback($=>{$!==_.current&&(_.current=$,w($))},[]),j=o||x,N=i||v,C=l.useRef(null),_=l.useRef(null),k=l.useRef(u),S=d!=null,E=Wn(d),A=Wn(n),I=Wn(f),z=l.useCallback(()=>{if(!C.current||!_.current)return;const $={placement:s,strategy:r,middleware:h};A.current&&($.platform=A.current),ky(C.current,_.current,$).then(q=>{const de={...q,isPositioned:I.current!==!1};W.current&&!Aa(k.current,de)&&(k.current=de,tn.flushSync(()=>{m(de)}))})},[h,s,r,A,I]);ka(()=>{f===!1&&k.current.isPositioned&&(k.current.isPositioned=!1,m($=>({...$,isPositioned:!1})))},[f]);const W=l.useRef(!1);ka(()=>(W.current=!0,()=>{W.current=!1}),[]),ka(()=>{if(j&&(C.current=j),N&&(_.current=N),j&&N){if(E.current)return E.current(j,N,z);z()}},[j,N,z,E,S]);const Y=l.useMemo(()=>({reference:C,floating:_,setReference:y,setFloating:b}),[y,b]),G=l.useMemo(()=>({reference:j,floating:N}),[j,N]),te=l.useMemo(()=>{const $={position:r,left:0,top:0};if(!G.floating)return $;const q=Ll(G.floating,u.x),de=Ll(G.floating,u.y);return c?{...$,transform:"translate("+q+"px, "+de+"px)",...jd(G.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:q,top:de}},[r,c,G.floating,u.x,u.y]);return l.useMemo(()=>({...u,update:z,refs:Y,elements:G,floatingStyles:te}),[u,z,Y,G,te])}const Ty=e=>{function s(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:a,padding:n}=typeof e=="function"?e(r):e;return a&&s(a)?a.current!=null?Ol({element:a.current,padding:n}).fn(r):{}:a?Ol({element:a,padding:n}).fn(r):{}}}},My=(e,s)=>({...by(e),options:[e,s]}),Py=(e,s)=>({...jy(e),options:[e,s]}),Dy=(e,s)=>({...Cy(e),options:[e,s]}),Ay=(e,s)=>({...Ny(e),options:[e,s]}),Ry=(e,s)=>({...Sy(e),options:[e,s]}),Iy=(e,s)=>({..._y(e),options:[e,s]}),Fy=(e,s)=>({...Ty(e),options:[e,s]});var Oy="Arrow",Nd=l.forwardRef((e,s)=>{const{children:r,width:a=10,height:n=5,...o}=e;return t.jsx(pe.svg,{...o,ref:s,width:a,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:t.jsx("polygon",{points:"0,0 30,0 15,10"})})});Nd.displayName=Oy;var Ly=Nd;function $y(e,s=[]){let r=[];function a(o,i){const c=l.createContext(i),d=r.length;r=[...r,i];function f(m){const{scope:h,children:p,...x}=m,g=h?.[e][d]||c,v=l.useMemo(()=>x,Object.values(x));return t.jsx(g.Provider,{value:v,children:p})}function u(m,h){const p=h?.[e][d]||c,x=l.useContext(p);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${o}\``)}return f.displayName=o+"Provider",[f,u]}const n=()=>{const o=r.map(i=>l.createContext(i));return function(c){const d=c?.[e]||o;return l.useMemo(()=>({[`__scope${e}`]:{...c,[e]:d}}),[c,d])}};return n.scopeName=e,[a,Uy(n,...s)]}function Uy(...e){const s=e[0];if(e.length===1)return s;const r=()=>{const a=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(o){const i=a.reduce((c,{useScope:d,scopeName:f})=>{const m=d(o)[`__scope${f}`];return{...c,...m}},{});return l.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}function ra(e){const[s,r]=l.useState(void 0);return wt(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const o=n[0];let i,c;if("borderBoxSize"in o){const d=o.borderBoxSize,f=Array.isArray(d)?d[0]:d;i=f.inlineSize,c=f.blockSize}else i=e.offsetWidth,c=e.offsetHeight;r({width:i,height:c})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else r(void 0)},[e]),s}var xi="Popper",[Sd,pr]=$y(xi),[zy,_d]=Sd(xi),Cd=e=>{const{__scopePopper:s,children:r}=e,[a,n]=l.useState(null);return t.jsx(zy,{scope:s,anchor:a,onAnchorChange:n,children:r})};Cd.displayName=xi;var kd="PopperAnchor",Ed=l.forwardRef((e,s)=>{const{__scopePopper:r,virtualRef:a,...n}=e,o=_d(kd,r),i=l.useRef(null),c=we(s,i);return l.useEffect(()=>{o.onAnchorChange(a?.current||i.current)}),a?null:t.jsx(pe.div,{...n,ref:c})});Ed.displayName=kd;var vi="PopperContent",[qy,By]=Sd(vi),Td=l.forwardRef((e,s)=>{const{__scopePopper:r,side:a="bottom",sideOffset:n=0,align:o="center",alignOffset:i=0,arrowPadding:c=0,avoidCollisions:d=!0,collisionBoundary:f=[],collisionPadding:u=0,sticky:m="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:x,...g}=e,v=_d(vi,r),[w,y]=l.useState(null),b=we(s,L=>y(L)),[j,N]=l.useState(null),C=ra(j),_=C?.width??0,k=C?.height??0,S=a+(o!=="center"?"-"+o:""),E=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},A=Array.isArray(f)?f:[f],I=A.length>0,z={padding:E,boundary:A.filter(Gy),altBoundary:I},{refs:W,floatingStyles:Y,placement:G,isPositioned:te,middlewareData:$}=Ey({strategy:"fixed",placement:S,whileElementsMounted:(...L)=>wy(...L,{animationFrame:p==="always"}),elements:{reference:v.anchor},middleware:[My({mainAxis:n+k,alignmentAxis:i}),d&&Py({mainAxis:!0,crossAxis:!1,limiter:m==="partial"?Dy():void 0,...z}),d&&Ay({...z}),Ry({...z,apply:({elements:L,rects:se,availableWidth:J,availableHeight:ne})=>{const{width:H,height:me}=se.reference,le=L.floating.style;le.setProperty("--radix-popper-available-width",`${J}px`),le.setProperty("--radix-popper-available-height",`${ne}px`),le.setProperty("--radix-popper-anchor-width",`${H}px`),le.setProperty("--radix-popper-anchor-height",`${me}px`)}}),j&&Fy({element:j,padding:c}),Vy({arrowWidth:_,arrowHeight:k}),h&&Iy({strategy:"referenceHidden",...z})]}),[q,de]=Dd(G),Z=Et(x);wt(()=>{te&&Z?.()},[te,Z]);const F=$.arrow?.x,Q=$.arrow?.y,ae=$.arrow?.centerOffset!==0,[R,B]=l.useState();return wt(()=>{w&&B(window.getComputedStyle(w).zIndex)},[w]),t.jsx("div",{ref:W.setFloating,"data-radix-popper-content-wrapper":"",style:{...Y,transform:te?Y.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:R,"--radix-popper-transform-origin":[$.transformOrigin?.x,$.transformOrigin?.y].join(" "),...$.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:t.jsx(qy,{scope:r,placedSide:q,onArrowChange:N,arrowX:F,arrowY:Q,shouldHideArrow:ae,children:t.jsx(pe.div,{"data-side":q,"data-align":de,...g,ref:b,style:{...g.style,animation:te?void 0:"none"}})})})});Td.displayName=vi;var Md="PopperArrow",Wy={top:"bottom",right:"left",bottom:"top",left:"right"},Pd=l.forwardRef(function(s,r){const{__scopePopper:a,...n}=s,o=By(Md,a),i=Wy[o.placedSide];return t.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:t.jsx(Ly,{...n,ref:r,style:{...n.style,display:"block"}})})});Pd.displayName=Md;function Gy(e){return e!==null}var Vy=e=>({name:"transformOrigin",options:e,fn(s){const{placement:r,rects:a,middlewareData:n}=s,i=n.arrow?.centerOffset!==0,c=i?0:e.arrowWidth,d=i?0:e.arrowHeight,[f,u]=Dd(r),m={start:"0%",center:"50%",end:"100%"}[u],h=(n.arrow?.x??0)+c/2,p=(n.arrow?.y??0)+d/2;let x="",g="";return f==="bottom"?(x=i?m:`${h}px`,g=`${-d}px`):f==="top"?(x=i?m:`${h}px`,g=`${a.floating.height+d}px`):f==="right"?(x=`${-d}px`,g=i?m:`${p}px`):f==="left"&&(x=`${a.floating.width+d}px`,g=i?m:`${p}px`),{data:{x,y:g}}}});function Dd(e){const[s,r="center"]=e.split("-");return[s,r]}var yi=Cd,wi=Ed,bi=Td,ji=Pd,[dn,G2]=jt("Tooltip",[pr]),un=pr(),Ad="TooltipProvider",Hy=700,wo="tooltip.open",[Qy,Ni]=dn(Ad),Rd=e=>{const{__scopeTooltip:s,delayDuration:r=Hy,skipDelayDuration:a=300,disableHoverableContent:n=!1,children:o}=e,[i,c]=l.useState(!0),d=l.useRef(!1),f=l.useRef(0);return l.useEffect(()=>{const u=f.current;return()=>window.clearTimeout(u)},[]),t.jsx(Qy,{scope:s,isOpenDelayed:i,delayDuration:r,onOpen:l.useCallback(()=>{window.clearTimeout(f.current),c(!1)},[]),onClose:l.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>c(!0),a)},[a]),isPointerInTransitRef:d,onPointerInTransitChange:l.useCallback(u=>{d.current=u},[]),disableHoverableContent:n,children:o})};Rd.displayName=Ad;var mn="Tooltip",[Ky,hn]=dn(mn),Id=e=>{const{__scopeTooltip:s,children:r,open:a,defaultOpen:n=!1,onOpenChange:o,disableHoverableContent:i,delayDuration:c}=e,d=Ni(mn,e.__scopeTooltip),f=un(s),[u,m]=l.useState(null),h=ts(),p=l.useRef(0),x=i??d.disableHoverableContent,g=c??d.delayDuration,v=l.useRef(!1),[w=!1,y]=Lt({prop:a,defaultProp:n,onChange:_=>{_?(d.onOpen(),document.dispatchEvent(new CustomEvent(wo))):d.onClose(),o?.(_)}}),b=l.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),j=l.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v.current=!1,y(!0)},[y]),N=l.useCallback(()=>{window.clearTimeout(p.current),p.current=0,y(!1)},[y]),C=l.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,y(!0),p.current=0},g)},[g,y]);return l.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),t.jsx(yi,{...f,children:t.jsx(Ky,{scope:s,contentId:h,open:w,stateAttribute:b,trigger:u,onTriggerChange:m,onTriggerEnter:l.useCallback(()=>{d.isOpenDelayed?C():j()},[d.isOpenDelayed,C,j]),onTriggerLeave:l.useCallback(()=>{x?N():(window.clearTimeout(p.current),p.current=0)},[N,x]),onOpen:j,onClose:N,disableHoverableContent:x,children:r})})};Id.displayName=mn;var bo="TooltipTrigger",Fd=l.forwardRef((e,s)=>{const{__scopeTooltip:r,...a}=e,n=hn(bo,r),o=Ni(bo,r),i=un(r),c=l.useRef(null),d=we(s,c,n.onTriggerChange),f=l.useRef(!1),u=l.useRef(!1),m=l.useCallback(()=>f.current=!1,[]);return l.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),t.jsx(wi,{asChild:!0,...i,children:t.jsx(pe.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...a,ref:d,onPointerMove:re(e.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!o.isPointerInTransitRef.current&&(n.onTriggerEnter(),u.current=!0)}),onPointerLeave:re(e.onPointerLeave,()=>{n.onTriggerLeave(),u.current=!1}),onPointerDown:re(e.onPointerDown,()=>{f.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:re(e.onFocus,()=>{f.current||n.onOpen()}),onBlur:re(e.onBlur,n.onClose),onClick:re(e.onClick,n.onClose)})})});Fd.displayName=bo;var Yy="TooltipPortal",[V2,Xy]=dn(Yy,{forceMount:void 0}),rr="TooltipContent",Od=l.forwardRef((e,s)=>{const r=Xy(rr,e.__scopeTooltip),{forceMount:a=r.forceMount,side:n="top",...o}=e,i=hn(rr,e.__scopeTooltip);return t.jsx(Nt,{present:a||i.open,children:i.disableHoverableContent?t.jsx(Ld,{side:n,...o,ref:s}):t.jsx(Jy,{side:n,...o,ref:s})})}),Jy=l.forwardRef((e,s)=>{const r=hn(rr,e.__scopeTooltip),a=Ni(rr,e.__scopeTooltip),n=l.useRef(null),o=we(s,n),[i,c]=l.useState(null),{trigger:d,onClose:f}=r,u=n.current,{onPointerInTransitChange:m}=a,h=l.useCallback(()=>{c(null),m(!1)},[m]),p=l.useCallback((x,g)=>{const v=x.currentTarget,w={x:x.clientX,y:x.clientY},y=sw(w,v.getBoundingClientRect()),b=rw(w,y),j=aw(g.getBoundingClientRect()),N=ow([...b,...j]);c(N),m(!0)},[m]);return l.useEffect(()=>()=>h(),[h]),l.useEffect(()=>{if(d&&u){const x=v=>p(v,u),g=v=>p(v,d);return d.addEventListener("pointerleave",x),u.addEventListener("pointerleave",g),()=>{d.removeEventListener("pointerleave",x),u.removeEventListener("pointerleave",g)}}},[d,u,p,h]),l.useEffect(()=>{if(i){const x=g=>{const v=g.target,w={x:g.clientX,y:g.clientY},y=d?.contains(v)||u?.contains(v),b=!nw(w,i);y?h():b&&(h(),f())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[d,u,i,f,h]),t.jsx(Ld,{...e,ref:o})}),[Zy,ew]=dn(mn,{isInside:!1}),Ld=l.forwardRef((e,s)=>{const{__scopeTooltip:r,children:a,"aria-label":n,onEscapeKeyDown:o,onPointerDownOutside:i,...c}=e,d=hn(rr,r),f=un(r),{onClose:u}=d;return l.useEffect(()=>(document.addEventListener(wo,u),()=>document.removeEventListener(wo,u)),[u]),l.useEffect(()=>{if(d.trigger){const m=h=>{h.target?.contains(d.trigger)&&u()};return window.addEventListener("scroll",m,{capture:!0}),()=>window.removeEventListener("scroll",m,{capture:!0})}},[d.trigger,u]),t.jsx(ei,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:m=>m.preventDefault(),onDismiss:u,children:t.jsxs(bi,{"data-state":d.stateAttribute,...f,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[t.jsx(Oc,{children:a}),t.jsx(Zy,{scope:r,isInside:!0,children:t.jsx(Rp,{id:d.contentId,role:"tooltip",children:n||a})})]})})});Od.displayName=rr;var $d="TooltipArrow",tw=l.forwardRef((e,s)=>{const{__scopeTooltip:r,...a}=e,n=un(r);return ew($d,r).isInside?null:t.jsx(ji,{...n,...a,ref:s})});tw.displayName=$d;function sw(e,s){const r=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),n=Math.abs(s.right-e.x),o=Math.abs(s.left-e.x);switch(Math.min(r,a,n,o)){case o:return"left";case n:return"right";case r:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function rw(e,s,r=5){const a=[];switch(s){case"top":a.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":a.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":a.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":a.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return a}function aw(e){const{top:s,right:r,bottom:a,left:n}=e;return[{x:n,y:s},{x:r,y:s},{x:r,y:a},{x:n,y:a}]}function nw(e,s){const{x:r,y:a}=e;let n=!1;for(let o=0,i=s.length-1;o<s.length;i=o++){const c=s[o].x,d=s[o].y,f=s[i].x,u=s[i].y;d>a!=u>a&&r<(f-c)*(a-d)/(u-d)+c&&(n=!n)}return n}function ow(e){const s=e.slice();return s.sort((r,a)=>r.x<a.x?-1:r.x>a.x?1:r.y<a.y?-1:r.y>a.y?1:0),iw(s)}function iw(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const n=e[a];for(;s.length>=2;){const o=s[s.length-1],i=s[s.length-2];if((o.x-i.x)*(n.y-i.y)>=(o.y-i.y)*(n.x-i.x))s.pop();else break}s.push(n)}s.pop();const r=[];for(let a=e.length-1;a>=0;a--){const n=e[a];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(n.y-i.y)>=(o.y-i.y)*(n.x-i.x))r.pop();else break}r.push(n)}return r.pop(),s.length===1&&r.length===1&&s[0].x===r[0].x&&s[0].y===r[0].y?s:s.concat(r)}var lw=Rd,cw=Id,dw=Fd,Ud=Od;const gr=lw,De=cw,Ae=dw,Me=l.forwardRef(({className:e,sideOffset:s=4,...r},a)=>t.jsx(Ud,{ref:a,sideOffset:s,className:K("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));Me.displayName=Ud.displayName;var xr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Os=typeof window>"u"||"Deno"in globalThis;function nt(){}function uw(e,s){return typeof e=="function"?e(s):e}function jo(e){return typeof e=="number"&&e>=0&&e!==1/0}function zd(e,s){return Math.max(e+(s||0)-Date.now(),0)}function gs(e,s){return typeof e=="function"?e(s):e}function kt(e,s){return typeof e=="function"?e(s):e}function $l(e,s){const{type:r="all",exact:a,fetchStatus:n,predicate:o,queryKey:i,stale:c}=e;if(i){if(a){if(s.queryHash!==Si(i,s.options))return!1}else if(!Hr(s.queryKey,i))return!1}if(r!=="all"){const d=s.isActive();if(r==="active"&&!d||r==="inactive"&&d)return!1}return!(typeof c=="boolean"&&s.isStale()!==c||n&&n!==s.state.fetchStatus||o&&!o(s))}function Ul(e,s){const{exact:r,status:a,predicate:n,mutationKey:o}=e;if(o){if(!s.options.mutationKey)return!1;if(r){if(Ls(s.options.mutationKey)!==Ls(o))return!1}else if(!Hr(s.options.mutationKey,o))return!1}return!(a&&s.state.status!==a||n&&!n(s))}function Si(e,s){return(s?.queryKeyHashFn||Ls)(e)}function Ls(e){return JSON.stringify(e,(s,r)=>No(r)?Object.keys(r).sort().reduce((a,n)=>(a[n]=r[n],a),{}):r)}function Hr(e,s){return e===s?!0:typeof e!=typeof s?!1:e&&s&&typeof e=="object"&&typeof s=="object"?Object.keys(s).every(r=>Hr(e[r],s[r])):!1}function qd(e,s){if(e===s)return e;const r=zl(e)&&zl(s);if(r||No(e)&&No(s)){const a=r?e:Object.keys(e),n=a.length,o=r?s:Object.keys(s),i=o.length,c=r?[]:{},d=new Set(a);let f=0;for(let u=0;u<i;u++){const m=r?u:o[u];(!r&&d.has(m)||r)&&e[m]===void 0&&s[m]===void 0?(c[m]=void 0,f++):(c[m]=qd(e[m],s[m]),c[m]===e[m]&&e[m]!==void 0&&f++)}return n===i&&f===n?e:c}return s}function Ra(e,s){if(!s||Object.keys(e).length!==Object.keys(s).length)return!1;for(const r in e)if(e[r]!==s[r])return!1;return!0}function zl(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function No(e){if(!ql(e))return!1;const s=e.constructor;if(s===void 0)return!0;const r=s.prototype;return!(!ql(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function ql(e){return Object.prototype.toString.call(e)==="[object Object]"}function mw(e){return new Promise(s=>{setTimeout(s,e)})}function So(e,s,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,s):r.structuralSharing!==!1?qd(e,s):s}function hw(e,s,r=0){const a=[...e,s];return r&&a.length>r?a.slice(1):a}function fw(e,s,r=0){const a=[s,...e];return r&&a.length>r?a.slice(0,-1):a}var _i=Symbol();function Bd(e,s){return!e.queryFn&&s?.initialPromise?()=>s.initialPromise:!e.queryFn||e.queryFn===_i?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Wd(e,s){return typeof e=="function"?e(...s):!!e}var pw=class extends xr{#t;#e;#s;constructor(){super(),this.#s=e=>{if(!Os&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(e){this.#s=e,this.#e?.(),this.#e=e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()})}setFocused(e){this.#t!==e&&(this.#t=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){return typeof this.#t=="boolean"?this.#t:globalThis.document?.visibilityState!=="hidden"}},Ci=new pw,gw=class extends xr{#t=!0;#e;#s;constructor(){super(),this.#s=e=>{if(!Os&&window.addEventListener){const s=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#e||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#e?.(),this.#e=void 0)}setEventListener(e){this.#s=e,this.#e?.(),this.#e=e(this.setOnline.bind(this))}setOnline(e){this.#t!==e&&(this.#t=e,this.listeners.forEach(r=>{r(e)}))}isOnline(){return this.#t}},Ia=new gw;function _o(){let e,s;const r=new Promise((n,o)=>{e=n,s=o});r.status="pending",r.catch(()=>{});function a(n){Object.assign(r,n),delete r.resolve,delete r.reject}return r.resolve=n=>{a({status:"fulfilled",value:n}),e(n)},r.reject=n=>{a({status:"rejected",reason:n}),s(n)},r}function xw(e){let s;if(e.then(r=>(s=r,r),nt)?.catch(nt),s!==void 0)return{data:s}}function vw(e){return Math.min(1e3*2**e,3e4)}function Gd(e){return(e??"online")==="online"?Ia.isOnline():!0}var Vd=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function Gn(e){return e instanceof Vd}function Hd(e){let s=!1,r=0,a=!1,n;const o=_o(),i=g=>{a||(h(new Vd(g)),e.abort?.())},c=()=>{s=!0},d=()=>{s=!1},f=()=>Ci.isFocused()&&(e.networkMode==="always"||Ia.isOnline())&&e.canRun(),u=()=>Gd(e.networkMode)&&e.canRun(),m=g=>{a||(a=!0,e.onSuccess?.(g),n?.(),o.resolve(g))},h=g=>{a||(a=!0,e.onError?.(g),n?.(),o.reject(g))},p=()=>new Promise(g=>{n=v=>{(a||f())&&g(v)},e.onPause?.()}).then(()=>{n=void 0,a||e.onContinue?.()}),x=()=>{if(a)return;let g;const v=r===0?e.initialPromise:void 0;try{g=v??e.fn()}catch(w){g=Promise.reject(w)}Promise.resolve(g).then(m).catch(w=>{if(a)return;const y=e.retry??(Os?0:3),b=e.retryDelay??vw,j=typeof b=="function"?b(r,w):b,N=y===!0||typeof y=="number"&&r<y||typeof y=="function"&&y(r,w);if(s||!N){h(w);return}r++,e.onFail?.(r,w),mw(j).then(()=>f()?void 0:p()).then(()=>{s?h(w):x()})})};return{promise:o,cancel:i,continue:()=>(n?.(),o),cancelRetry:c,continueRetry:d,canStart:u,start:()=>(u()?x():p().then(x),o)}}var yw=e=>setTimeout(e,0);function ww(){let e=[],s=0,r=c=>{c()},a=c=>{c()},n=yw;const o=c=>{s?e.push(c):n(()=>{r(c)})},i=()=>{const c=e;e=[],c.length&&n(()=>{a(()=>{c.forEach(d=>{r(d)})})})};return{batch:c=>{let d;s++;try{d=c()}finally{s--,s||i()}return d},batchCalls:c=>(...d)=>{o(()=>{c(...d)})},schedule:o,setNotifyFunction:c=>{r=c},setBatchNotifyFunction:c=>{a=c},setScheduler:c=>{n=c}}}var Ye=ww(),Qd=class{#t;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),jo(this.gcTime)&&(this.#t=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Os?1/0:5*60*1e3))}clearGcTimeout(){this.#t&&(clearTimeout(this.#t),this.#t=void 0)}},bw=class extends Qd{#t;#e;#s;#r;#a;#o;#i;constructor(e){super(),this.#i=!1,this.#o=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#r=e.client,this.#s=this.#r.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#t=jw(this.options),this.state=e.state??this.#t,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#a?.promise}setOptions(e){this.options={...this.#o,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(e,s){const r=So(this.state.data,e,this.options);return this.#n({data:r,type:"success",dataUpdatedAt:s?.updatedAt,manual:s?.manual}),r}setState(e,s){this.#n({type:"setState",state:e,setStateOptions:s})}cancel(e){const s=this.#a?.promise;return this.#a?.cancel(e),s?s.then(nt).catch(nt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#t)}isActive(){return this.observers.some(e=>kt(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===_i||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>gs(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!zd(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(s=>s.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#a?.continue()}onOnline(){this.observers.find(s=>s.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#a?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(s=>s!==e),this.observers.length||(this.#a&&(this.#i?this.#a.cancel({revert:!0}):this.#a.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#n({type:"invalidate"})}fetch(e,s){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&s?.cancelRefetch)this.cancel({silent:!0});else if(this.#a)return this.#a.continueRetry(),this.#a.promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,a=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(this.#i=!0,r.signal)})},n=()=>{const d=Bd(this.options,s),u=(()=>{const m={client:this.#r,queryKey:this.queryKey,meta:this.meta};return a(m),m})();return this.#i=!1,this.options.persister?this.options.persister(d,u,this):d(u)},i=(()=>{const d={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:n};return a(d),d})();this.options.behavior?.onFetch(i,this),this.#e=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==i.fetchOptions?.meta)&&this.#n({type:"fetch",meta:i.fetchOptions?.meta});const c=d=>{Gn(d)&&d.silent||this.#n({type:"error",error:d}),Gn(d)||(this.#s.config.onError?.(d,this),this.#s.config.onSettled?.(this.state.data,d,this)),this.scheduleGc()};return this.#a=Hd({initialPromise:s?.initialPromise,fn:i.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{if(d===void 0){c(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(f){c(f);return}this.#s.config.onSuccess?.(d,this),this.#s.config.onSettled?.(d,this.state.error,this),this.scheduleGc()},onError:c,onFail:(d,f)=>{this.#n({type:"failed",failureCount:d,error:f})},onPause:()=>{this.#n({type:"pause"})},onContinue:()=>{this.#n({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0}),this.#a.start()}#n(e){const s=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...Kd(r.data,this.options),fetchMeta:e.meta??null};case"success":return this.#e=void 0,{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const a=e.error;return Gn(a)&&a.revert&&this.#e?{...this.#e,fetchStatus:"idle"}:{...r,error:a,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=s(this.state),Ye.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:e})})}};function Kd(e,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Gd(s.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function jw(e){const s=typeof e.initialData=="function"?e.initialData():e.initialData,r=s!==void 0,a=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:r?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Yd=class extends xr{constructor(e={}){super(),this.config=e,this.#t=new Map}#t;build(e,s,r){const a=s.queryKey,n=s.queryHash??Si(a,s);let o=this.get(n);return o||(o=new bw({client:e,queryKey:a,queryHash:n,options:e.defaultQueryOptions(s),state:r,defaultOptions:e.getQueryDefaults(a)}),this.add(o)),o}add(e){this.#t.has(e.queryHash)||(this.#t.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=this.#t.get(e.queryHash);s&&(e.destroy(),s===e&&this.#t.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ye.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#t.get(e)}getAll(){return[...this.#t.values()]}find(e){const s={exact:!0,...e};return this.getAll().find(r=>$l(s,r))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter(r=>$l(e,r)):s}notify(e){Ye.batch(()=>{this.listeners.forEach(s=>{s(e)})})}onFocus(){Ye.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ye.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Nw=class extends Qd{#t;#e;#s;constructor(e){super(),this.mutationId=e.mutationId,this.#e=e.mutationCache,this.#t=[],this.state=e.state||Xd(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(s=>s!==e),this.scheduleGc(),this.#e.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#e.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const s=()=>{this.#r({type:"continue"})};this.#s=Hd({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(n,o)=>{this.#r({type:"failed",failureCount:n,error:o})},onPause:()=>{this.#r({type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#e.canRun(this)});const r=this.state.status==="pending",a=!this.#s.canStart();try{if(r)s();else{this.#r({type:"pending",variables:e,isPaused:a}),await this.#e.config.onMutate?.(e,this);const o=await this.options.onMutate?.(e);o!==this.state.context&&this.#r({type:"pending",context:o,variables:e,isPaused:a})}const n=await this.#s.start();return await this.#e.config.onSuccess?.(n,e,this.state.context,this),await this.options.onSuccess?.(n,e,this.state.context),await this.#e.config.onSettled?.(n,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(n,null,e,this.state.context),this.#r({type:"success",data:n}),n}catch(n){try{throw await this.#e.config.onError?.(n,e,this.state.context,this),await this.options.onError?.(n,e,this.state.context),await this.#e.config.onSettled?.(void 0,n,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,n,e,this.state.context),n}finally{this.#r({type:"error",error:n})}}finally{this.#e.runNext(this)}}#r(e){const s=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=s(this.state),Ye.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(e)}),this.#e.notify({mutation:this,type:"updated",action:e})})}};function Xd(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Jd=class extends xr{constructor(e={}){super(),this.config=e,this.#t=new Set,this.#e=new Map,this.#s=0}#t;#e;#s;build(e,s,r){const a=new Nw({mutationCache:this,mutationId:++this.#s,options:e.defaultMutationOptions(s),state:r});return this.add(a),a}add(e){this.#t.add(e);const s=ya(e);if(typeof s=="string"){const r=this.#e.get(s);r?r.push(e):this.#e.set(s,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#t.delete(e)){const s=ya(e);if(typeof s=="string"){const r=this.#e.get(s);if(r)if(r.length>1){const a=r.indexOf(e);a!==-1&&r.splice(a,1)}else r[0]===e&&this.#e.delete(s)}}this.notify({type:"removed",mutation:e})}canRun(e){const s=ya(e);if(typeof s=="string"){const a=this.#e.get(s)?.find(n=>n.state.status==="pending");return!a||a===e}else return!0}runNext(e){const s=ya(e);return typeof s=="string"?this.#e.get(s)?.find(a=>a!==e&&a.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ye.batch(()=>{this.#t.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#t.clear(),this.#e.clear()})}getAll(){return Array.from(this.#t)}find(e){const s={exact:!0,...e};return this.getAll().find(r=>Ul(s,r))}findAll(e={}){return this.getAll().filter(s=>Ul(e,s))}notify(e){Ye.batch(()=>{this.listeners.forEach(s=>{s(e)})})}resumePausedMutations(){const e=this.getAll().filter(s=>s.state.isPaused);return Ye.batch(()=>Promise.all(e.map(s=>s.continue().catch(nt))))}};function ya(e){return e.options.scope?.id}function Bl(e){return{onFetch:(s,r)=>{const a=s.options,n=s.fetchOptions?.meta?.fetchMore?.direction,o=s.state.data?.pages||[],i=s.state.data?.pageParams||[];let c={pages:[],pageParams:[]},d=0;const f=async()=>{let u=!1;const m=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(s.signal.aborted?u=!0:s.signal.addEventListener("abort",()=>{u=!0}),s.signal)})},h=Bd(s.options,s.fetchOptions),p=async(x,g,v)=>{if(u)return Promise.reject();if(g==null&&x.pages.length)return Promise.resolve(x);const y=(()=>{const C={client:s.client,queryKey:s.queryKey,pageParam:g,direction:v?"backward":"forward",meta:s.options.meta};return m(C),C})(),b=await h(y),{maxPages:j}=s.options,N=v?fw:hw;return{pages:N(x.pages,b,j),pageParams:N(x.pageParams,g,j)}};if(n&&o.length){const x=n==="backward",g=x?Sw:Wl,v={pages:o,pageParams:i},w=g(a,v);c=await p(v,w,x)}else{const x=e??o.length;do{const g=d===0?i[0]??a.initialPageParam:Wl(a,c);if(d>0&&g==null)break;c=await p(c,g),d++}while(d<x)}return c};s.options.persister?s.fetchFn=()=>s.options.persister?.(f,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},r):s.fetchFn=f}}}function Wl(e,{pages:s,pageParams:r}){const a=s.length-1;return s.length>0?e.getNextPageParam(s[a],s,r[a],r):void 0}function Sw(e,{pages:s,pageParams:r}){return s.length>0?e.getPreviousPageParam?.(s[0],s,r[0],r):void 0}var _w=class{#t;#e;#s;#r;#a;#o;#i;#n;constructor(e={}){this.#t=e.queryCache||new Yd,this.#e=e.mutationCache||new Jd,this.#s=e.defaultOptions||{},this.#r=new Map,this.#a=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#i=Ci.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#t.onFocus())}),this.#n=Ia.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#t.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#i?.(),this.#i=void 0,this.#n?.(),this.#n=void 0)}isFetching(e){return this.#t.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#e.findAll({...e,status:"pending"}).length}getQueryData(e){const s=this.defaultQueryOptions({queryKey:e});return this.#t.get(s.queryHash)?.state.data}ensureQueryData(e){const s=this.defaultQueryOptions(e),r=this.#t.build(this,s),a=r.state.data;return a===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(gs(s.staleTime,r))&&this.prefetchQuery(s),Promise.resolve(a))}getQueriesData(e){return this.#t.findAll(e).map(({queryKey:s,state:r})=>{const a=r.data;return[s,a]})}setQueryData(e,s,r){const a=this.defaultQueryOptions({queryKey:e}),o=this.#t.get(a.queryHash)?.state.data,i=uw(s,o);if(i!==void 0)return this.#t.build(this,a).setData(i,{...r,manual:!0})}setQueriesData(e,s,r){return Ye.batch(()=>this.#t.findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,s,r)]))}getQueryState(e){const s=this.defaultQueryOptions({queryKey:e});return this.#t.get(s.queryHash)?.state}removeQueries(e){const s=this.#t;Ye.batch(()=>{s.findAll(e).forEach(r=>{s.remove(r)})})}resetQueries(e,s){const r=this.#t;return Ye.batch(()=>(r.findAll(e).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...e},s)))}cancelQueries(e,s={}){const r={revert:!0,...s},a=Ye.batch(()=>this.#t.findAll(e).map(n=>n.cancel(r)));return Promise.all(a).then(nt).catch(nt)}invalidateQueries(e,s={}){return Ye.batch(()=>(this.#t.findAll(e).forEach(r=>{r.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},s)))}refetchQueries(e,s={}){const r={...s,cancelRefetch:s.cancelRefetch??!0},a=Ye.batch(()=>this.#t.findAll(e).filter(n=>!n.isDisabled()&&!n.isStatic()).map(n=>{let o=n.fetch(void 0,r);return r.throwOnError||(o=o.catch(nt)),n.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(a).then(nt)}fetchQuery(e){const s=this.defaultQueryOptions(e);s.retry===void 0&&(s.retry=!1);const r=this.#t.build(this,s);return r.isStaleByTime(gs(s.staleTime,r))?r.fetch(s):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(nt).catch(nt)}fetchInfiniteQuery(e){return e.behavior=Bl(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(nt).catch(nt)}ensureInfiniteQueryData(e){return e.behavior=Bl(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Ia.isOnline()?this.#e.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#t}getMutationCache(){return this.#e}getDefaultOptions(){return this.#s}setDefaultOptions(e){this.#s=e}setQueryDefaults(e,s){this.#r.set(Ls(e),{queryKey:e,defaultOptions:s})}getQueryDefaults(e){const s=[...this.#r.values()],r={};return s.forEach(a=>{Hr(e,a.queryKey)&&Object.assign(r,a.defaultOptions)}),r}setMutationDefaults(e,s){this.#a.set(Ls(e),{mutationKey:e,defaultOptions:s})}getMutationDefaults(e){const s=[...this.#a.values()],r={};return s.forEach(a=>{Hr(e,a.mutationKey)&&Object.assign(r,a.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const s={...this.#s.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return s.queryHash||(s.queryHash=Si(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===_i&&(s.enabled=!1),s}defaultMutationOptions(e){return e?._defaulted?e:{...this.#s.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#t.clear(),this.#e.clear()}},Cw=class extends xr{constructor(e,s){super(),this.options=s,this.#t=e,this.#n=null,this.#i=_o(),this.options.experimental_prefetchInRender||this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}#t;#e=void 0;#s=void 0;#r=void 0;#a;#o;#i;#n;#p;#m;#h;#c;#d;#l;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),Gl(this.#e,this.options)?this.#u():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Co(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Co(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#b(),this.#e.removeObserver(this)}setOptions(e){const s=this.options,r=this.#e;if(this.options=this.#t.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof kt(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#e.setOptions(this.options),s._defaulted&&!Ra(this.options,s)&&this.#t.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const a=this.hasListeners();a&&Vl(this.#e,r,this.options,s)&&this.#u(),this.updateResult(),a&&(this.#e!==r||kt(this.options.enabled,this.#e)!==kt(s.enabled,this.#e)||gs(this.options.staleTime,this.#e)!==gs(s.staleTime,this.#e))&&this.#g();const n=this.#x();a&&(this.#e!==r||kt(this.options.enabled,this.#e)!==kt(s.enabled,this.#e)||n!==this.#l)&&this.#v(n)}getOptimisticResult(e){const s=this.#t.getQueryCache().build(this.#t,e),r=this.createResult(s,e);return Ew(this,r)&&(this.#r=r,this.#o=this.options,this.#a=this.#e.state),r}getCurrentResult(){return this.#r}trackResult(e,s){return new Proxy(e,{get:(r,a)=>(this.trackProp(a),s?.(a),Reflect.get(r,a))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=this.#t.defaultQueryOptions(e),r=this.#t.getQueryCache().build(this.#t,s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#u(e){this.#j();let s=this.#e.fetch(this.options,e);return e?.throwOnError||(s=s.catch(nt)),s}#g(){this.#w();const e=gs(this.options.staleTime,this.#e);if(Os||this.#r.isStale||!jo(e))return;const r=zd(this.#r.dataUpdatedAt,e)+1;this.#c=setTimeout(()=>{this.#r.isStale||this.updateResult()},r)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#v(e){this.#b(),this.#l=e,!(Os||kt(this.options.enabled,this.#e)===!1||!jo(this.#l)||this.#l===0)&&(this.#d=setInterval(()=>{(this.options.refetchIntervalInBackground||Ci.isFocused())&&this.#u()},this.#l))}#y(){this.#g(),this.#v(this.#x())}#w(){this.#c&&(clearTimeout(this.#c),this.#c=void 0)}#b(){this.#d&&(clearInterval(this.#d),this.#d=void 0)}createResult(e,s){const r=this.#e,a=this.options,n=this.#r,o=this.#a,i=this.#o,d=e!==r?e.state:this.#s,{state:f}=e;let u={...f},m=!1,h;if(s._optimisticResults){const k=this.hasListeners(),S=!k&&Gl(e,s),E=k&&Vl(e,r,s,a);(S||E)&&(u={...u,...Kd(f.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:p,errorUpdatedAt:x,status:g}=u;h=u.data;let v=!1;if(s.placeholderData!==void 0&&h===void 0&&g==="pending"){let k;n?.isPlaceholderData&&s.placeholderData===i?.placeholderData?(k=n.data,v=!0):k=typeof s.placeholderData=="function"?s.placeholderData(this.#h?.state.data,this.#h):s.placeholderData,k!==void 0&&(g="success",h=So(n?.data,k,s),m=!0)}if(s.select&&h!==void 0&&!v)if(n&&h===o?.data&&s.select===this.#p)h=this.#m;else try{this.#p=s.select,h=s.select(h),h=So(n?.data,h,s),this.#m=h,this.#n=null}catch(k){this.#n=k}this.#n&&(p=this.#n,h=this.#m,x=Date.now(),g="error");const w=u.fetchStatus==="fetching",y=g==="pending",b=g==="error",j=y&&w,N=h!==void 0,_={status:g,fetchStatus:u.fetchStatus,isPending:y,isSuccess:g==="success",isError:b,isInitialLoading:j,isLoading:j,data:h,dataUpdatedAt:u.dataUpdatedAt,error:p,errorUpdatedAt:x,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>d.dataUpdateCount||u.errorUpdateCount>d.errorUpdateCount,isFetching:w,isRefetching:w&&!y,isLoadingError:b&&!N,isPaused:u.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:b&&N,isStale:ki(e,s),refetch:this.refetch,promise:this.#i,isEnabled:kt(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const k=A=>{_.status==="error"?A.reject(_.error):_.data!==void 0&&A.resolve(_.data)},S=()=>{const A=this.#i=_.promise=_o();k(A)},E=this.#i;switch(E.status){case"pending":e.queryHash===r.queryHash&&k(E);break;case"fulfilled":(_.status==="error"||_.data!==E.value)&&S();break;case"rejected":(_.status!=="error"||_.error!==E.reason)&&S();break}}return _}updateResult(){const e=this.#r,s=this.createResult(this.#e,this.options);if(this.#a=this.#e.state,this.#o=this.options,this.#a.data!==void 0&&(this.#h=this.#e),Ra(s,e))return;this.#r=s;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:a}=this.options,n=typeof a=="function"?a():a;if(n==="all"||!n&&!this.#f.size)return!0;const o=new Set(n??this.#f);return this.options.throwOnError&&o.add("error"),Object.keys(this.#r).some(i=>{const c=i;return this.#r[c]!==e[c]&&o.has(c)})};this.#N({listeners:r()})}#j(){const e=this.#t.getQueryCache().build(this.#t,this.options);if(e===this.#e)return;const s=this.#e;this.#e=e,this.#s=e.state,this.hasListeners()&&(s?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#N(e){Ye.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(this.#r)}),this.#t.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function kw(e,s){return kt(s.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&s.retryOnMount===!1)}function Gl(e,s){return kw(e,s)||e.state.data!==void 0&&Co(e,s,s.refetchOnMount)}function Co(e,s,r){if(kt(s.enabled,e)!==!1&&gs(s.staleTime,e)!=="static"){const a=typeof r=="function"?r(e):r;return a==="always"||a!==!1&&ki(e,s)}return!1}function Vl(e,s,r,a){return(e!==s||kt(a.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&ki(e,r)}function ki(e,s){return kt(s.enabled,e)!==!1&&e.isStaleByTime(gs(s.staleTime,e))}function Ew(e,s){return!Ra(e.getCurrentResult(),s)}var Tw=class extends xr{#t;#e=void 0;#s;#r;constructor(s,r){super(),this.#t=s,this.setOptions(r),this.bindMethods(),this.#a()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const r=this.options;this.options=this.#t.defaultMutationOptions(s),Ra(this.options,r)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),r?.mutationKey&&this.options.mutationKey&&Ls(r.mutationKey)!==Ls(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(s){this.#a(),this.#o(s)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#a(),this.#o()}mutate(s,r){return this.#r=r,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(s)}#a(){const s=this.#s?.state??Xd();this.#e={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#o(s){Ye.batch(()=>{if(this.#r&&this.hasListeners()){const r=this.#e.variables,a=this.#e.context;s?.type==="success"?(this.#r.onSuccess?.(s.data,r,a),this.#r.onSettled?.(s.data,null,r,a)):s?.type==="error"&&(this.#r.onError?.(s.error,r,a),this.#r.onSettled?.(void 0,s.error,r,a))}this.listeners.forEach(r=>{r(this.#e)})})}};function Zd(e){return e}function Mw(e){return{mutationKey:e.options.mutationKey,state:e.state,...e.options.scope&&{scope:e.options.scope},...e.meta&&{meta:e.meta}}}function Pw(e,s,r){return{dehydratedAt:Date.now(),state:{...e.state,...e.state.data!==void 0&&{data:s(e.state.data)}},queryKey:e.queryKey,queryHash:e.queryHash,...e.state.status==="pending"&&{promise:e.promise?.then(s).catch(a=>r(a)?Promise.reject(new Error("redacted")):Promise.reject(a))},...e.meta&&{meta:e.meta}}}function Dw(e){return e.state.isPaused}function Aw(e){return e.state.status==="success"}function Rw(e){return!0}function Iw(e,s={}){const r=s.shouldDehydrateMutation??e.getDefaultOptions().dehydrate?.shouldDehydrateMutation??Dw,a=e.getMutationCache().getAll().flatMap(d=>r(d)?[Mw(d)]:[]),n=s.shouldDehydrateQuery??e.getDefaultOptions().dehydrate?.shouldDehydrateQuery??Aw,o=s.shouldRedactErrors??e.getDefaultOptions().dehydrate?.shouldRedactErrors??Rw,i=s.serializeData??e.getDefaultOptions().dehydrate?.serializeData??Zd,c=e.getQueryCache().getAll().flatMap(d=>n(d)?[Pw(d,i,o)]:[]);return{mutations:a,queries:c}}function Fw(e,s,r){if(typeof s!="object"||s===null)return;const a=e.getMutationCache(),n=e.getQueryCache(),o=r?.defaultOptions?.deserializeData??e.getDefaultOptions().hydrate?.deserializeData??Zd,i=s.mutations||[],c=s.queries||[];i.forEach(({state:d,...f})=>{a.build(e,{...e.getDefaultOptions().hydrate?.mutations,...r?.defaultOptions?.mutations,...f},d)}),c.forEach(({queryKey:d,state:f,queryHash:u,meta:m,promise:h,dehydratedAt:p})=>{const x=h?xw(h):void 0,g=f.data===void 0?x?.data:f.data,v=g===void 0?g:o(g);let w=n.get(u);const y=w?.state.status==="pending",b=w?.state.fetchStatus==="fetching";if(w){const j=x&&p!==void 0&&p>w.state.dataUpdatedAt;if(f.dataUpdatedAt>w.state.dataUpdatedAt||j){const{fetchStatus:N,...C}=f;w.setState({...C,data:v})}}else w=n.build(e,{...e.getDefaultOptions().hydrate?.queries,...r?.defaultOptions?.queries,queryKey:d,queryHash:u,meta:m},{...f,data:v,fetchStatus:"idle",status:v!==void 0?"success":f.status});h&&!y&&!b&&(p===void 0||p>w.state.dataUpdatedAt)&&w.fetch(void 0,{initialPromise:Promise.resolve(h).then(o)})})}var eu=l.createContext(void 0),ft=e=>{const s=l.useContext(eu);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},Ow=({client:e,children:s})=>(l.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),t.jsx(eu.Provider,{value:e,children:s})),tu=l.createContext(!1),Lw=()=>l.useContext(tu);tu.Provider;function $w(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Uw=l.createContext($w()),zw=()=>l.useContext(Uw),qw=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},Bw=e=>{l.useEffect(()=>{e.clearReset()},[e])},Ww=({result:e,errorResetBoundary:s,throwOnError:r,query:a,suspense:n})=>e.isError&&!s.isReset()&&!e.isFetching&&a&&(n&&e.data===void 0||Wd(r,[e.error,a])),Gw=e=>{if(e.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>s(r(...a)):s(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Vw=(e,s)=>e.isLoading&&e.isFetching&&!s,Hw=(e,s)=>e?.suspense&&s.isPending,Hl=(e,s,r)=>s.fetchOptimistic(e).catch(()=>{r.clearReset()});function Qw(e,s,r){const a=Lw(),n=zw(),o=ft(),i=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(i),i._optimisticResults=a?"isRestoring":"optimistic",Gw(i),qw(i,n),Bw(n);const c=!o.getQueryCache().get(i.queryHash),[d]=l.useState(()=>new s(o,i)),f=d.getOptimisticResult(i),u=!a&&e.subscribed!==!1;if(l.useSyncExternalStore(l.useCallback(m=>{const h=u?d.subscribe(Ye.batchCalls(m)):nt;return d.updateResult(),h},[d,u]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),l.useEffect(()=>{d.setOptions(i)},[i,d]),Hw(i,f))throw Hl(i,d,n);if(Ww({result:f,errorResetBoundary:n,throwOnError:i.throwOnError,query:o.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw f.error;return o.getDefaultOptions().queries?._experimental_afterQuery?.(i,f),i.experimental_prefetchInRender&&!Os&&Vw(f,a)&&(c?Hl(i,d,n):o.getQueryCache().get(i.queryHash)?.promise)?.catch(nt).finally(()=>{d.updateResult()}),i.notifyOnChangeProps?f:d.trackResult(f)}function ut(e,s){return Qw(e,Cw)}function xt(e,s){const r=ft(),[a]=l.useState(()=>new Tw(r,e));l.useEffect(()=>{a.setOptions(e)},[a,e]);const n=l.useSyncExternalStore(l.useCallback(i=>a.subscribe(Ye.batchCalls(i)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),o=l.useCallback((i,c)=>{a.mutate(i,c).catch(nt)},[a]);if(n.error&&Wd(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:o,mutateAsync:n.mutate}}const Rs=new _w({queryCache:new Yd({onError:(e,s)=>{console.error("Query error:",e,"Query key:",s.queryKey),s.meta?.showErrorToast}}),mutationCache:new Jd({onError:(e,s,r,a)=>{console.error("Mutation error:",e,"Variables:",s)}}),defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnReconnect:"always",refetchOnMount:!0,retry:(e,s)=>s?.status>=400&&s?.status<500?!1:e<3,retryDelay:e=>Math.min(1e3*2**e,3e4),networkMode:"offlineFirst"},mutations:{retry:1,networkMode:"online"}}});var Kw=["added","removed","updated"];function Ql(e){return Kw.includes(e)}async function Yw({queryClient:e,persister:s,maxAge:r=1e3*60*60*24,buster:a="",hydrateOptions:n}){try{const o=await s.restoreClient();if(o)if(o.timestamp){const i=Date.now()-o.timestamp>r,c=o.buster!==a;if(i||c)return s.removeClient();Fw(e,o.clientState,n)}else return s.removeClient()}catch(o){throw await s.removeClient(),o}}async function Kl({queryClient:e,persister:s,buster:r="",dehydrateOptions:a}){const n={buster:r,timestamp:Date.now(),clientState:Iw(e,a)};await s.persistClient(n)}function Xw(e){const s=e.queryClient.getQueryCache().subscribe(a=>{Ql(a.type)&&Kl(e)}),r=e.queryClient.getMutationCache().subscribe(a=>{Ql(a.type)&&Kl(e)});return()=>{s(),r()}}function Jw(e){let s=!1,r;const a=()=>{s=!0,r?.()},n=Yw(e).then(()=>{s||(r=Xw(e))});return[a,n]}function Vn(){}function Zw({storage:e,key:s="REACT_QUERY_OFFLINE_CACHE",throttleTime:r=1e3,serialize:a=JSON.stringify,deserialize:n=JSON.parse,retry:o}){if(e){const i=c=>{try{e.setItem(s,a(c));return}catch(d){return d}};return{persistClient:eb(c=>{let d=c,f=i(d),u=0;for(;f&&d;)u++,d=o?.({persistedClient:d,error:f,errorCount:u}),d&&(f=i(d))},r),restoreClient:()=>{const c=e.getItem(s);if(c)return n(c)},removeClient:()=>{e.removeItem(s)}}}return{persistClient:Vn,restoreClient:Vn,removeClient:Vn}}function eb(e,s=100){let r=null,a;return function(...n){a=n,r===null&&(r=setTimeout(()=>{e(...a),r=null},s))}}/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qr(){return Qr=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Qr.apply(this,arguments)}var fs;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(fs||(fs={}));const Yl="popstate";function tb(e){e===void 0&&(e={});function s(a,n){let{pathname:o,search:i,hash:c}=a.location;return ko("",{pathname:o,search:i,hash:c},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(a,n){return typeof n=="string"?n:Fa(n)}return rb(s,r,null,e)}function Re(e,s){if(e===!1||e===null||typeof e>"u")throw new Error(s)}function su(e,s){if(!e){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function sb(){return Math.random().toString(36).substr(2,8)}function Xl(e,s){return{usr:e.state,key:e.key,idx:s}}function ko(e,s,r,a){return r===void 0&&(r=null),Qr({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof s=="string"?vr(s):s,{state:r,key:s&&s.key||a||sb()})}function Fa(e){let{pathname:s="/",search:r="",hash:a=""}=e;return r&&r!=="?"&&(s+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function vr(e){let s={};if(e){let r=e.indexOf("#");r>=0&&(s.hash=e.substr(r),e=e.substr(0,r));let a=e.indexOf("?");a>=0&&(s.search=e.substr(a),e=e.substr(0,a)),e&&(s.pathname=e)}return s}function rb(e,s,r,a){a===void 0&&(a={});let{window:n=document.defaultView,v5Compat:o=!1}=a,i=n.history,c=fs.Pop,d=null,f=u();f==null&&(f=0,i.replaceState(Qr({},i.state,{idx:f}),""));function u(){return(i.state||{idx:null}).idx}function m(){c=fs.Pop;let v=u(),w=v==null?null:v-f;f=v,d&&d({action:c,location:g.location,delta:w})}function h(v,w){c=fs.Push;let y=ko(g.location,v,w);f=u()+1;let b=Xl(y,f),j=g.createHref(y);try{i.pushState(b,"",j)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;n.location.assign(j)}o&&d&&d({action:c,location:g.location,delta:1})}function p(v,w){c=fs.Replace;let y=ko(g.location,v,w);f=u();let b=Xl(y,f),j=g.createHref(y);i.replaceState(b,"",j),o&&d&&d({action:c,location:g.location,delta:0})}function x(v){let w=n.location.origin!=="null"?n.location.origin:n.location.href,y=typeof v=="string"?v:Fa(v);return y=y.replace(/ $/,"%20"),Re(w,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,w)}let g={get action(){return c},get location(){return e(n,i)},listen(v){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(Yl,m),d=v,()=>{n.removeEventListener(Yl,m),d=null}},createHref(v){return s(n,v)},createURL:x,encodeLocation(v){let w=x(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:h,replace:p,go(v){return i.go(v)}};return g}var Jl;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Jl||(Jl={}));function ab(e,s,r){return r===void 0&&(r="/"),nb(e,s,r,!1)}function nb(e,s,r,a){let n=typeof s=="string"?vr(s):s,o=ar(n.pathname||"/",r);if(o==null)return null;let i=ru(e);ob(i);let c=null;for(let d=0;c==null&&d<i.length;++d){let f=xb(o);c=pb(i[d],f,a)}return c}function ru(e,s,r,a){s===void 0&&(s=[]),r===void 0&&(r=[]),a===void 0&&(a="");let n=(o,i,c)=>{let d={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};d.relativePath.startsWith("/")&&(Re(d.relativePath.startsWith(a),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(a.length));let f=xs([a,d.relativePath]),u=r.concat(d);o.children&&o.children.length>0&&(Re(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),ru(o.children,s,u,f)),!(o.path==null&&!o.index)&&s.push({path:f,score:hb(f,o.index),routesMeta:u})};return e.forEach((o,i)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))n(o,i);else for(let d of au(o.path))n(o,i,d)}),s}function au(e){let s=e.split("/");if(s.length===0)return[];let[r,...a]=s,n=r.endsWith("?"),o=r.replace(/\?$/,"");if(a.length===0)return n?[o,""]:[o];let i=au(a.join("/")),c=[];return c.push(...i.map(d=>d===""?o:[o,d].join("/"))),n&&c.push(...i),c.map(d=>e.startsWith("/")&&d===""?"/":d)}function ob(e){e.sort((s,r)=>s.score!==r.score?r.score-s.score:fb(s.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const ib=/^:[\w-]+$/,lb=3,cb=2,db=1,ub=10,mb=-2,Zl=e=>e==="*";function hb(e,s){let r=e.split("/"),a=r.length;return r.some(Zl)&&(a+=mb),s&&(a+=cb),r.filter(n=>!Zl(n)).reduce((n,o)=>n+(ib.test(o)?lb:o===""?db:ub),a)}function fb(e,s){return e.length===s.length&&e.slice(0,-1).every((a,n)=>a===s[n])?e[e.length-1]-s[s.length-1]:0}function pb(e,s,r){let{routesMeta:a}=e,n={},o="/",i=[];for(let c=0;c<a.length;++c){let d=a[c],f=c===a.length-1,u=o==="/"?s:s.slice(o.length)||"/",m=Oa({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},u),h=d.route;if(!m&&f&&r&&!a[a.length-1].route.index&&(m=Oa({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},u)),!m)return null;Object.assign(n,m.params),i.push({params:n,pathname:xs([o,m.pathname]),pathnameBase:bb(xs([o,m.pathnameBase])),route:h}),m.pathnameBase!=="/"&&(o=xs([o,m.pathnameBase]))}return i}function Oa(e,s){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,a]=gb(e.path,e.caseSensitive,e.end),n=s.match(r);if(!n)return null;let o=n[0],i=o.replace(/(.)\/+$/,"$1"),c=n.slice(1);return{params:a.reduce((f,u,m)=>{let{paramName:h,isOptional:p}=u;if(h==="*"){let g=c[m]||"";i=o.slice(0,o.length-g.length).replace(/(.)\/+$/,"$1")}const x=c[m];return p&&!x?f[h]=void 0:f[h]=(x||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:i,pattern:e}}function gb(e,s,r){s===void 0&&(s=!1),r===void 0&&(r=!0),su(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,c,d)=>(a.push({paramName:c,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,s?void 0:"i"),a]}function xb(e){try{return e.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return su(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),e}}function ar(e,s){if(s==="/")return e;if(!e.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,a=e.charAt(r);return a&&a!=="/"?null:e.slice(r)||"/"}function vb(e,s){s===void 0&&(s="/");let{pathname:r,search:a="",hash:n=""}=typeof e=="string"?vr(e):e;return{pathname:r?r.startsWith("/")?r:yb(r,s):s,search:jb(a),hash:Nb(n)}}function yb(e,s){let r=s.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function Hn(e,s,r,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wb(e){return e.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function Ei(e,s){let r=wb(e);return s?r.map((a,n)=>n===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function Ti(e,s,r,a){a===void 0&&(a=!1);let n;typeof e=="string"?n=vr(e):(n=Qr({},e),Re(!n.pathname||!n.pathname.includes("?"),Hn("?","pathname","search",n)),Re(!n.pathname||!n.pathname.includes("#"),Hn("#","pathname","hash",n)),Re(!n.search||!n.search.includes("#"),Hn("#","search","hash",n)));let o=e===""||n.pathname==="",i=o?"/":n.pathname,c;if(i==null)c=r;else{let m=s.length-1;if(!a&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),m-=1;n.pathname=h.join("/")}c=m>=0?s[m]:"/"}let d=vb(n,c),f=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(f||u)&&(d.pathname+="/"),d}const xs=e=>e.join("/").replace(/\/\/+/g,"/"),bb=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),jb=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Nb=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Sb(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const nu=["post","put","patch","delete"];new Set(nu);const _b=["get",...nu];new Set(_b);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kr(){return Kr=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Kr.apply(this,arguments)}const fn=l.createContext(null),ou=l.createContext(null),ns=l.createContext(null),pn=l.createContext(null),ks=l.createContext({outlet:null,matches:[],isDataRoute:!1}),iu=l.createContext(null);function Cb(e,s){let{relative:r}=s===void 0?{}:s;yr()||Re(!1);let{basename:a,navigator:n}=l.useContext(ns),{hash:o,pathname:i,search:c}=gn(e,{relative:r}),d=i;return a!=="/"&&(d=i==="/"?a:xs([a,i])),n.createHref({pathname:d,search:c,hash:o})}function yr(){return l.useContext(pn)!=null}function zt(){return yr()||Re(!1),l.useContext(pn).location}function lu(e){l.useContext(ns).static||l.useLayoutEffect(e)}function qt(){let{isDataRoute:e}=l.useContext(ks);return e?$b():kb()}function kb(){yr()||Re(!1);let e=l.useContext(fn),{basename:s,future:r,navigator:a}=l.useContext(ns),{matches:n}=l.useContext(ks),{pathname:o}=zt(),i=JSON.stringify(Ei(n,r.v7_relativeSplatPath)),c=l.useRef(!1);return lu(()=>{c.current=!0}),l.useCallback(function(f,u){if(u===void 0&&(u={}),!c.current)return;if(typeof f=="number"){a.go(f);return}let m=Ti(f,JSON.parse(i),o,u.relative==="path");e==null&&s!=="/"&&(m.pathname=m.pathname==="/"?s:xs([s,m.pathname])),(u.replace?a.replace:a.push)(m,u.state,u)},[s,a,i,o,e])}function gn(e,s){let{relative:r}=s===void 0?{}:s,{future:a}=l.useContext(ns),{matches:n}=l.useContext(ks),{pathname:o}=zt(),i=JSON.stringify(Ei(n,a.v7_relativeSplatPath));return l.useMemo(()=>Ti(e,JSON.parse(i),o,r==="path"),[e,i,o,r])}function Eb(e,s){return Tb(e,s)}function Tb(e,s,r,a){yr()||Re(!1);let{navigator:n}=l.useContext(ns),{matches:o}=l.useContext(ks),i=o[o.length-1],c=i?i.params:{};i&&i.pathname;let d=i?i.pathnameBase:"/";i&&i.route;let f=zt(),u;if(s){var m;let v=typeof s=="string"?vr(s):s;d==="/"||(m=v.pathname)!=null&&m.startsWith(d)||Re(!1),u=v}else u=f;let h=u.pathname||"/",p=h;if(d!=="/"){let v=d.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let x=ab(e,{pathname:p}),g=Rb(x&&x.map(v=>Object.assign({},v,{params:Object.assign({},c,v.params),pathname:xs([d,n.encodeLocation?n.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?d:xs([d,n.encodeLocation?n.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,r,a);return s&&g?l.createElement(pn.Provider,{value:{location:Kr({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:fs.Pop}},g):g}function Mb(){let e=Lb(),s=Sb(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return l.createElement(l.Fragment,null,l.createElement("h2",null,"Unexpected Application Error!"),l.createElement("h3",{style:{fontStyle:"italic"}},s),r?l.createElement("pre",{style:n},r):null,null)}const Pb=l.createElement(Mb,null);class Db extends l.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,r){return r.location!==s.location||r.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:r.error,location:r.location,revalidation:s.revalidation||r.revalidation}}componentDidCatch(s,r){console.error("React Router caught the following error during render",s,r)}render(){return this.state.error!==void 0?l.createElement(ks.Provider,{value:this.props.routeContext},l.createElement(iu.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ab(e){let{routeContext:s,match:r,children:a}=e,n=l.useContext(fn);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),l.createElement(ks.Provider,{value:s},a)}function Rb(e,s,r,a){var n;if(s===void 0&&(s=[]),r===void 0&&(r=null),a===void 0&&(a=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=a)!=null&&o.v7_partialHydration&&s.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,c=(n=r)==null?void 0:n.errors;if(c!=null){let u=i.findIndex(m=>m.route.id&&c?.[m.route.id]!==void 0);u>=0||Re(!1),i=i.slice(0,Math.min(i.length,u+1))}let d=!1,f=-1;if(r&&a&&a.v7_partialHydration)for(let u=0;u<i.length;u++){let m=i[u];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(f=u),m.route.id){let{loaderData:h,errors:p}=r,x=m.route.loader&&h[m.route.id]===void 0&&(!p||p[m.route.id]===void 0);if(m.route.lazy||x){d=!0,f>=0?i=i.slice(0,f+1):i=[i[0]];break}}}return i.reduceRight((u,m,h)=>{let p,x=!1,g=null,v=null;r&&(p=c&&m.route.id?c[m.route.id]:void 0,g=m.route.errorElement||Pb,d&&(f<0&&h===0?(x=!0,v=null):f===h&&(x=!0,v=m.route.hydrateFallbackElement||null)));let w=s.concat(i.slice(0,h+1)),y=()=>{let b;return p?b=g:x?b=v:m.route.Component?b=l.createElement(m.route.Component,null):m.route.element?b=m.route.element:b=u,l.createElement(Ab,{match:m,routeContext:{outlet:u,matches:w,isDataRoute:r!=null},children:b})};return r&&(m.route.ErrorBoundary||m.route.errorElement||h===0)?l.createElement(Db,{location:r.location,revalidation:r.revalidation,component:g,error:p,children:y(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):y()},null)}var cu=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(cu||{}),La=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(La||{});function Ib(e){let s=l.useContext(fn);return s||Re(!1),s}function Fb(e){let s=l.useContext(ou);return s||Re(!1),s}function Ob(e){let s=l.useContext(ks);return s||Re(!1),s}function du(e){let s=Ob(),r=s.matches[s.matches.length-1];return r.route.id||Re(!1),r.route.id}function Lb(){var e;let s=l.useContext(iu),r=Fb(La.UseRouteError),a=du(La.UseRouteError);return s!==void 0?s:(e=r.errors)==null?void 0:e[a]}function $b(){let{router:e}=Ib(cu.UseNavigateStable),s=du(La.UseNavigateStable),r=l.useRef(!1);return lu(()=>{r.current=!0}),l.useCallback(function(n,o){o===void 0&&(o={}),r.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,Kr({fromRouteId:s},o)))},[e,s])}function Ub(e){let{to:s,replace:r,state:a,relative:n}=e;yr()||Re(!1);let{future:o,static:i}=l.useContext(ns),{matches:c}=l.useContext(ks),{pathname:d}=zt(),f=qt(),u=Ti(s,Ei(c,o.v7_relativeSplatPath),d,n==="path"),m=JSON.stringify(u);return l.useEffect(()=>f(JSON.parse(m),{replace:r,state:a,relative:n}),[f,m,n,r,a]),null}function rt(e){Re(!1)}function zb(e){let{basename:s="/",children:r=null,location:a,navigationType:n=fs.Pop,navigator:o,static:i=!1,future:c}=e;yr()&&Re(!1);let d=s.replace(/^\/*/,"/"),f=l.useMemo(()=>({basename:d,navigator:o,static:i,future:Kr({v7_relativeSplatPath:!1},c)}),[d,c,o,i]);typeof a=="string"&&(a=vr(a));let{pathname:u="/",search:m="",hash:h="",state:p=null,key:x="default"}=a,g=l.useMemo(()=>{let v=ar(u,d);return v==null?null:{location:{pathname:v,search:m,hash:h,state:p,key:x},navigationType:n}},[d,u,m,h,p,x,n]);return g==null?null:l.createElement(ns.Provider,{value:f},l.createElement(pn.Provider,{children:r,value:g}))}function qb(e){let{children:s,location:r}=e;return Eb(Eo(s),r)}new Promise(()=>{});function Eo(e,s){s===void 0&&(s=[]);let r=[];return l.Children.forEach(e,(a,n)=>{if(!l.isValidElement(a))return;let o=[...s,n];if(a.type===l.Fragment){r.push.apply(r,Eo(a.props.children,o));return}a.type!==rt&&Re(!1),!a.props.index||!a.props.children||Re(!1);let i={id:a.props.id||o.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(i.children=Eo(a.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $a(){return $a=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},$a.apply(this,arguments)}function uu(e,s){if(e==null)return{};var r={},a=Object.keys(e),n,o;for(o=0;o<a.length;o++)n=a[o],!(s.indexOf(n)>=0)&&(r[n]=e[n]);return r}function Bb(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Wb(e,s){return e.button===0&&(!s||s==="_self")&&!Bb(e)}const Gb=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Vb=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Hb="6";try{window.__reactRouterVersion=Hb}catch{}const Qb=l.createContext({isTransitioning:!1}),Kb="startTransition",ec=Up[Kb];function Yb(e){let{basename:s,children:r,future:a,window:n}=e,o=l.useRef();o.current==null&&(o.current=tb({window:n,v5Compat:!0}));let i=o.current,[c,d]=l.useState({action:i.action,location:i.location}),{v7_startTransition:f}=a||{},u=l.useCallback(m=>{f&&ec?ec(()=>d(m)):d(m)},[d,f]);return l.useLayoutEffect(()=>i.listen(u),[i,u]),l.createElement(zb,{basename:s,children:r,location:c.location,navigationType:c.action,navigator:i,future:a})}const Xb=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Jb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,aa=l.forwardRef(function(s,r){let{onClick:a,relative:n,reloadDocument:o,replace:i,state:c,target:d,to:f,preventScrollReset:u,viewTransition:m}=s,h=uu(s,Gb),{basename:p}=l.useContext(ns),x,g=!1;if(typeof f=="string"&&Jb.test(f)&&(x=f,Xb))try{let b=new URL(window.location.href),j=f.startsWith("//")?new URL(b.protocol+f):new URL(f),N=ar(j.pathname,p);j.origin===b.origin&&N!=null?f=N+j.search+j.hash:g=!0}catch{}let v=Cb(f,{relative:n}),w=e0(f,{replace:i,state:c,target:d,preventScrollReset:u,relative:n,viewTransition:m});function y(b){a&&a(b),b.defaultPrevented||w(b)}return l.createElement("a",$a({},h,{href:x||v,onClick:g||o?a:y,ref:r,target:d}))}),Q2=l.forwardRef(function(s,r){let{"aria-current":a="page",caseSensitive:n=!1,className:o="",end:i=!1,style:c,to:d,viewTransition:f,children:u}=s,m=uu(s,Vb),h=gn(d,{relative:m.relative}),p=zt(),x=l.useContext(ou),{navigator:g,basename:v}=l.useContext(ns),w=x!=null&&t0(h)&&f===!0,y=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,b=p.pathname,j=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(b=b.toLowerCase(),j=j?j.toLowerCase():null,y=y.toLowerCase()),j&&v&&(j=ar(j,v)||j);const N=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let C=b===y||!i&&b.startsWith(y)&&b.charAt(N)==="/",_=j!=null&&(j===y||!i&&j.startsWith(y)&&j.charAt(y.length)==="/"),k={isActive:C,isPending:_,isTransitioning:w},S=C?a:void 0,E;typeof o=="function"?E=o(k):E=[o,C?"active":null,_?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let A=typeof c=="function"?c(k):c;return l.createElement(aa,$a({},m,{"aria-current":S,className:E,ref:r,style:A,to:d,viewTransition:f}),typeof u=="function"?u(k):u)});var To;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(To||(To={}));var tc;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(tc||(tc={}));function Zb(e){let s=l.useContext(fn);return s||Re(!1),s}function e0(e,s){let{target:r,replace:a,state:n,preventScrollReset:o,relative:i,viewTransition:c}=s===void 0?{}:s,d=qt(),f=zt(),u=gn(e,{relative:i});return l.useCallback(m=>{if(Wb(m,r)){m.preventDefault();let h=a!==void 0?a:Fa(f)===Fa(u);d(e,{replace:h,state:n,preventScrollReset:o,relative:i,viewTransition:c})}},[f,d,u,a,n,r,e,o,i,c])}function t0(e,s){s===void 0&&(s={});let r=l.useContext(Qb);r==null&&Re(!1);let{basename:a}=Zb(To.useViewTransitionState),n=gn(e,{relative:s.relative});if(!r.isTransitioning)return!1;let o=ar(r.currentLocation.pathname,a)||r.currentLocation.pathname,i=ar(r.nextLocation.pathname,a)||r.nextLocation.pathname;return Oa(n.pathname,i)!=null||Oa(n.pathname,o)!=null}const Mi=sn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-muted hover:text-muted-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-muted hover:text-muted-foreground",link:"text-primary underline-offset-4 hover:underline",neutral:"bg-muted text-muted-foreground hover:bg-muted/80 border-muted","action-primary":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm","action-secondary":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm","action-compact":"bg-primary text-primary-foreground hover:bg-primary/90 text-sm font-medium shadow-sm",ai:"bg-ai text-ai-foreground hover:bg-ai/90 text-sm font-medium shadow-sm"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","action-main":"h-12 px-6 py-3","action-secondary":"h-12 px-4 py-3","action-compact":"h-10 px-4 py-2","action-tall":"h-12 px-4 py-3","start-button":"h-16 px-8 py-4 text-lg"}},defaultVariants:{variant:"default",size:"default"}}),D=l.forwardRef(({className:e,variant:s,size:r,asChild:a=!1,...n},o)=>{const i=a?ti:"button";return t.jsx(i,{className:K(Mi({variant:s,size:r,className:e})),ref:o,...n})});D.displayName="Button";const oe=l.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:K("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));oe.displayName="Card";const dt=l.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:K("flex flex-col space-y-1.5 p-6",e),...s}));dt.displayName="CardHeader";const as=l.forwardRef(({className:e,...s},r)=>t.jsx("h3",{ref:r,className:K("text-2xl font-semibold leading-none tracking-tight",e),...s}));as.displayName="CardTitle";const Ua=l.forwardRef(({className:e,...s},r)=>t.jsx("p",{ref:r,className:K("text-sm text-muted-foreground",e),...s}));Ua.displayName="CardDescription";const Le=l.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:K("p-6 pt-0",e),...s}));Le.displayName="CardContent";const s0=l.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:K("flex items-center p-6 pt-0",e),...s}));s0.displayName="CardFooter";class mu extends l.Component{retryTimeout=null;constructor(s){super(s),this.state={hasError:!1,error:null,retryCount:0,autoRetrying:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ComprehensiveErrorBoundary caught an error:",s,r),this.props.onError?.(s,r),this.props.autoRetry&&this.props.level==="component"&&this.state.retryCount<(this.props.maxRetries||2)&&(this.setState({autoRetrying:!0}),this.retryTimeout=setTimeout(()=>{this.handleRetry()},2e3))}componentWillUnmount(){this.retryTimeout&&clearTimeout(this.retryTimeout)}handleRetry=()=>{this.setState(s=>({hasError:!1,error:null,retryCount:s.retryCount+1,autoRetrying:!1}))};handleGoHome=()=>{window.location.href="/"};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const{level:s="component"}=this.props,{autoRetrying:r,retryCount:a}=this.state;return r?t.jsx(oe,{className:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/20",children:t.jsx(Le,{className:"p-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 text-amber-700 dark:text-amber-300",children:[t.jsx(hs,{className:"w-4 h-4 animate-spin"}),t.jsx("span",{className:"text-sm",children:"Recovering automatically..."})]})})}):s==="critical"?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsx(oe,{className:"max-w-md w-full border-destructive/20",children:t.jsxs(Le,{className:"p-6 text-center space-y-4",children:[t.jsx(Qt,{className:"w-12 h-12 text-destructive mx-auto"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Critical Error"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"The application encountered a critical error and needs to be restarted."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{onClick:this.handleRetry,className:"w-full",children:[t.jsx(hs,{className:"w-4 h-4 mr-2"}),"Restart Application"]}),t.jsxs(D,{variant:"outline",onClick:this.handleGoHome,className:"w-full",children:[t.jsx(mo,{className:"w-4 h-4 mr-2"}),"Go to Home"]})]})]})})}):s==="page"?t.jsx("div",{className:"min-h-[50vh] flex items-center justify-center p-4",children:t.jsx(oe,{className:"max-w-sm w-full",children:t.jsxs(Le,{className:"p-6 text-center space-y-4",children:[t.jsx(Qt,{className:"w-8 h-8 text-muted-foreground mx-auto"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-foreground",children:"Page Error"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This page couldn't load properly."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(D,{onClick:this.handleRetry,size:"sm",className:"w-full",children:[t.jsx(hs,{className:"w-4 h-4 mr-2"}),"Try Again"]}),t.jsxs(D,{variant:"outline",onClick:this.handleGoHome,size:"sm",className:"w-full",children:[t.jsx(mo,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})]})})}):t.jsx(oe,{className:"border-muted bg-muted/5",children:t.jsxs(Le,{className:"p-4 text-center space-y-3",children:[t.jsx(Qt,{className:"w-6 h-6 text-muted-foreground mx-auto"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Something went wrong with this component."}),a<(this.props.maxRetries||2)&&t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Attempt ",a+1," of ",(this.props.maxRetries||2)+1]})]}),t.jsxs(D,{onClick:this.handleRetry,size:"sm",variant:"outline",children:[t.jsx(hs,{className:"w-4 h-4 mr-2"}),"Retry"]})]})})}return this.props.children}}const r0=({children:e,onError:s})=>t.jsx(mu,{level:"critical",onError:s,children:e}),ot=({children:e,onError:s})=>t.jsx(mu,{level:"page",onError:s,children:e}),a0=({children:e,fallback:s,onError:r})=>{const[a,n]=l.useState(null),{toast:o}=he();return l.useEffect(()=>{const i=async d=>{const f=String(d.reason);if(f.includes("Extension context invalidated")||f.includes("chrome-extension://")||f.includes("moz-extension://")||f.includes("safari-extension://")||f.includes("MetaMask")||f.includes("connect to MetaMask")){console.log("Ignoring browser extension error:",f),d.preventDefault();return}if(d.reason?.name==="VersionError"||f.includes("VersionError")){console.log("VersionError detected - clearing IndexedDB");try{if("indexedDB"in window){const m=await indexedDB.databases();await Promise.all(m.map(h=>{if(h.name)return new Promise((p,x)=>{const g=indexedDB.deleteDatabase(h.name);g.onsuccess=()=>p(),g.onerror=()=>x(g.error)})}))}o({title:"Database updated",description:"Fixed version conflict. Please refresh the page."}),setTimeout(()=>{location.reload()},2e3)}catch(m){console.error("Failed to clear IndexedDB:",m),o({title:"Database issue detected",description:"Please clear your browser cache or try refreshing.",variant:"destructive"})}d.preventDefault();return}console.error("Unhandled promise rejection:",d.reason);const u=d.reason instanceof Error?d.reason:new Error(f);n(u),r?.(u),o({title:"Something went wrong",description:`Error: ${f}`,variant:"destructive"}),d.preventDefault()},c=d=>{const f=String(d.error?.message||d.message||d.error);if(f.includes("Extension context invalidated")||f.includes("chrome-extension://")||f.includes("moz-extension://")||f.includes("safari-extension://")){console.log("Ignoring browser extension error:",f);return}console.error("Global error:",d.error);const u=d.error instanceof Error?d.error:new Error(f);n(u),r?.(u)};return window.addEventListener("unhandledrejection",i),window.addEventListener("error",c),()=>{window.removeEventListener("unhandledrejection",i),window.removeEventListener("error",c)}},[r,o]),l.useEffect(()=>{a&&n(null)},[e]),a?s?t.jsx(t.Fragment,{children:s}):t.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 text-center",children:t.jsx("div",{className:"text-sm text-muted-foreground",children:"An error occurred. Please try again."})}):t.jsx(t.Fragment,{children:e})},n0="https://texnkijwcygodtywgedm.supabase.co",o0="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRleG5raWp3Y3lnb2R0eXdnZWRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxODQ3MDAsImV4cCI6MjA2ODc2MDcwMH0.xiOD9aVsKZCadtKiwPGnFQONjLQlaqk-ASUdLDZHNqI",T=zp(n0,o0,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Yr=X.forwardRef(({onTranscription:e,isDisabled:s=!1,size:r="md",autoStart:a=!1,onRecordingStateChange:n},o)=>{const[i,c]=l.useState(!1),[d,f]=l.useState(!1),u=l.useRef(null),m=l.useRef([]),{toast:h}=he();l.useEffect(()=>{a&&!s&&!i&&!d&&(console.log(" Auto-starting recording..."),v())},[a,s]),X.useImperativeHandle(o,()=>({stopRecording:()=>{i&&(console.log(" Stopping recording via ref..."),y())},cancelRecording:()=>{i&&(console.log(" Canceling recording via ref..."),w())}}),[i]),l.useEffect(()=>{n?.(i)},[i,n]);const p={sm:"h-8 w-8",md:"h-12 w-12",lg:"h-16 w-16"},x={sm:"h-3 w-3",md:"h-5 w-5",lg:"h-6 w-6"},g=()=>{const j=["audio/webm;codecs=opus","audio/webm","audio/mp4;codecs=mp4a.40.2","audio/mp4"];try{for(const N of j)if(typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(N))return N}catch{console.warn(" mimeType detection failed, using default")}},v=async()=>{try{console.log(" Starting recording...");const j=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});console.log(" MediaStream obtained, creating MediaRecorder...");const N=g();console.log(" Selected mimeType:",N||"default"),u.current=N?new MediaRecorder(j,{mimeType:N}):new MediaRecorder(j),m.current=[],u.current.ondataavailable=_=>{console.log(" Audio data available, size:",_.data.size),_.data.size>0&&m.current.push(_.data)},u.current.onstop=()=>{console.log(" Recording stopped, cleaning up stream..."),j.getTracks().forEach(_=>_.stop())},u.current.onerror=_=>{console.error(" MediaRecorder error:",_)};const C=setTimeout(()=>{i&&u.current?.state==="recording"&&(console.log(" Recording timeout reached"),h({title:" Recording Timeout",description:"Recording automatically stopped after 60 seconds.",variant:"destructive"}),y())},6e4);u.current.start(100),c(!0),console.log(" Recording started successfully"),u.current.timeout=C}catch(j){console.error(" Error starting recording:",j),h({title:"Error",description:"Could not access microphone. Please check permissions.",variant:"destructive"})}},w=()=>{console.log(" Canceling recording..."),u.current&&u.current.timeout&&clearTimeout(u.current.timeout),i&&u.current&&(console.log(" Stopping MediaRecorder (canceling)..."),u.current.stop(),c(!1)),m.current=[],console.log(" Recording canceled, no processing will occur")},y=async()=>{if(console.log(" Stopping and processing recording..."),u.current&&u.current.timeout&&clearTimeout(u.current.timeout),i&&u.current&&(console.log(" Stopping MediaRecorder..."),u.current.stop(),c(!1),await new Promise(j=>setTimeout(j,200))),console.log(" Audio chunks collected:",m.current.length),m.current.length===0){console.error(" No audio chunks available"),h({title:"No Recording",description:"Please try recording again",variant:"destructive"});return}f(!0);try{console.log(" Creating audio blob...");const j=new Blob(m.current,{type:"audio/webm"});if(console.log(" Audio blob size:",j.size,"bytes"),j.size===0)throw new Error("Audio blob is empty");console.log(" Converting to base64...");const N=await j.arrayBuffer(),C=new Uint8Array(N);let _="";const k=32768;for(let I=0;I<C.length;I+=k){const z=C.subarray(I,Math.min(I+k,C.length));_+=String.fromCharCode.apply(null,Array.from(z))}const S=btoa(_);console.log(" Base64 length:",S.length),console.log(" Sending to transcribe function...");const{data:E,error:A}=await T.functions.invoke("transcribe",{body:{audio:S}});if(A)throw console.error(" Supabase function error:",A),A;if(console.log(" Transcription response:",E),E?.text)console.log(" Transcription successful:",E.text),e(E.text),h({title:"",description:"",className:"w-16 h-8 p-2 text-center bg-green-600 text-white border-0 fixed bottom-4 right-4 text-xs",duration:1500}),m.current=[];else throw new Error("No transcription received")}catch(j){console.error(" Transcription error:",j),h({title:"Failed to Process",description:"Please try recording again",variant:"destructive"})}finally{f(!1)}},b=()=>{d||(i?y():v())};return t.jsx(D,{onClick:b,disabled:s||d,className:`
        ${p[r]} 
        rounded-full 
        transition-all 
        duration-200 
        ${i?"bg-orange-500 hover:bg-orange-600 recording-pulse":"bg-green-500 hover:bg-green-600"}
        text-white
      `,children:d?t.jsx("div",{className:`animate-spin rounded-full border-2 border-white border-t-transparent ${x[r]}`}):i?t.jsx(ad,{className:`${x[r]}`}):t.jsx(js,{className:x[r]})})}),i0=({content:e,role:s,index:r})=>{const[a,n]=l.useState(!1);l.useEffect(()=>{const i=setTimeout(()=>n(!0),r*200);return()=>clearTimeout(i)},[r]);const o=s==="user";return t.jsx("div",{className:K("w-full mb-4 transition-all duration-500 ease-out px-4","flex",o?"justify-end":"justify-start",a?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:t.jsxs("div",{className:K("max-w-[85%] p-4 rounded-2xl shadow-lg relative","border",o?"bg-ai/90 border-ai/50 text-white rounded-tr-sm":"bg-primary/90 border-primary/50 text-white rounded-tl-sm"),children:[t.jsx("p",{className:"text-sm leading-relaxed font-medium",children:e}),t.jsx("div",{className:K("absolute w-2 h-2 rounded-full",o?"bg-ai -bottom-1 -right-1":"bg-primary -bottom-1 -left-1","animate-pulse")})]})})},sc=e=>{let s;const r=new Set,a=(f,u)=>{const m=typeof f=="function"?f(s):f;if(!Object.is(m,s)){const h=s;s=u??(typeof m!="object"||m===null)?m:Object.assign({},s,m),r.forEach(p=>p(s,h))}},n=()=>s,c={setState:a,getState:n,getInitialState:()=>d,subscribe:f=>(r.add(f),()=>r.delete(f))},d=s=e(a,n,c);return c},l0=e=>e?sc(e):sc,c0=e=>e;function d0(e,s=c0){const r=X.useSyncExternalStore(e.subscribe,X.useCallback(()=>s(e.getState()),[e,s]),X.useCallback(()=>s(e.getInitialState()),[e,s]));return X.useDebugValue(r),r}const rc=e=>{const s=l0(e),r=a=>d0(s,a);return Object.assign(r,s),r},Pi=e=>e?rc(e):rc;function u0(e,s){let r;try{r=e()}catch{return}return{getItem:n=>{var o;const i=d=>d===null?null:JSON.parse(d,void 0),c=(o=r.getItem(n))!=null?o:null;return c instanceof Promise?c.then(i):i(c)},setItem:(n,o)=>r.setItem(n,JSON.stringify(o,void 0)),removeItem:n=>r.removeItem(n)}}const Mo=e=>s=>{try{const r=e(s);return r instanceof Promise?r:{then(a){return Mo(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return Mo(a)(r)}}}},m0=(e,s)=>(r,a,n)=>{let o={storage:u0(()=>localStorage),partialize:g=>g,version:0,merge:(g,v)=>({...v,...g}),...s},i=!1;const c=new Set,d=new Set;let f=o.storage;if(!f)return e((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...g)},a,n);const u=()=>{const g=o.partialize({...a()});return f.setItem(o.name,{state:g,version:o.version})},m=n.setState;n.setState=(g,v)=>{m(g,v),u()};const h=e((...g)=>{r(...g),u()},a,n);n.getInitialState=()=>h;let p;const x=()=>{var g,v;if(!f)return;i=!1,c.forEach(y=>{var b;return y((b=a())!=null?b:h)});const w=((v=o.onRehydrateStorage)==null?void 0:v.call(o,(g=a())!=null?g:h))||void 0;return Mo(f.getItem.bind(f))(o.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==o.version){if(o.migrate){const b=o.migrate(y.state,y.version);return b instanceof Promise?b.then(j=>[!0,j]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var b;const[j,N]=y;if(p=o.merge(N,(b=a())!=null?b:h),r(p,!0),j)return u()}).then(()=>{w?.(p,void 0),p=a(),i=!0,d.forEach(y=>y(p))}).catch(y=>{w?.(void 0,y)})};return n.persist={setOptions:g=>{o={...o,...g},g.storage&&(f=g.storage)},clearStorage:()=>{f?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>x(),hasHydrated:()=>i,onHydrate:g=>(c.add(g),()=>{c.delete(g)}),onFinishHydration:g=>(d.add(g),()=>{d.delete(g)})},o.skipHydration||x(),p||h},h0=m0,wr=Pi()(h0((e,s)=>({user:null,session:null,loading:!0,isConnected:!0,connectionChecking:!1,initialize:async()=>{if(s().loading)try{const a=s().checkConnection(),n=new Promise(f=>setTimeout(()=>f(!0),2e3));await Promise.race([a,n]);const{data:{subscription:o}}=T.auth.onAuthStateChange((f,u)=>{e({session:u,user:u?.user??null,loading:!1}),window.__authInitialized=!0}),i=T.auth.getSession(),c=new Promise(f=>setTimeout(()=>f({data:{session:null}}),3e3)),{data:{session:d}}=await Promise.race([i,c]);e({session:d,user:d?.user??null,loading:!1}),window.__authSubscription=o,window.__authInitialized=!0}catch(a){console.error("Auth initialization failed:",a),e({loading:!1,isConnected:!1}),window.__authInitialized=!0}},signIn:async(r,a)=>{const{error:n}=await T.auth.signInWithPassword({email:r,password:a});return{error:n}},signUp:async(r,a)=>{const n=`${window.location.origin}/`,{error:o}=await T.auth.signUp({email:r,password:a,options:{emailRedirectTo:n}});return{error:o}},signInWithGoogle:async()=>{const r=`${window.location.origin}/`,{error:a}=await T.auth.signInWithOAuth({provider:"google",options:{redirectTo:r}});return{error:a}},resetPassword:async r=>{const a=`${window.location.origin}/update-password`,{error:n}=await T.auth.resetPasswordForEmail(r,{redirectTo:a});return{error:n}},updatePassword:async r=>{const{error:a}=await T.auth.updateUser({password:r});return{error:a}},signOut:async()=>{const{error:r}=await T.auth.signOut();return r||e({user:null,session:null}),{error:r}},checkConnection:async()=>{if(s().connectionChecking)return s().isConnected;e({connectionChecking:!0});try{const r=T.from("profiles").select("id").limit(1),a=new Promise((i,c)=>setTimeout(()=>c(new Error("Connection timeout")),5e3)),{error:n}=await Promise.race([r,a]),o=!n;return e({isConnected:o,connectionChecking:!1}),o}catch{return e({isConnected:!0,connectionChecking:!1}),!0}},setLoading:r=>e({loading:r})}),{name:"auth-storage",partialize:e=>({user:e.user,session:e.session})})),nr=Pi((e,s)=>({isOnline:typeof navigator<"u"?navigator.onLine:!0,lastChecked:Date.now(),isTestingConnection:!1,testConnection:async()=>{const r=s();if(r.isTestingConnection)return r.isOnline;e({isTestingConnection:!0});try{const a=new AbortController,n=setTimeout(()=>a.abort(),3e3),o=await fetch("/favicon.ico",{method:"HEAD",cache:"no-cache",signal:a.signal});clearTimeout(n);const i=o.ok;return e({isOnline:i,lastChecked:Date.now(),isTestingConnection:!1}),i}catch{return e({isOnline:!1,lastChecked:Date.now(),isTestingConnection:!1}),!1}},startMonitoring:()=>{const{testConnection:r}=s(),a=()=>{e({isOnline:!0,lastChecked:Date.now()}),setTimeout(()=>r(),1e3)},n=()=>{e({isOnline:!1,lastChecked:Date.now()})};if(typeof window<"u"){window.addEventListener("online",a),window.addEventListener("offline",n);const o=setInterval(()=>{const i=s();i.isOnline&&Date.now()-i.lastChecked>3e4&&r()},3e4);window.__connectionListeners={handleOnline:a,handleOffline:n,intervalId:o},setTimeout(()=>r(),500)}},stopMonitoring:()=>{const r=window.__connectionListeners;r&&(window.removeEventListener("online",r.handleOnline),window.removeEventListener("offline",r.handleOffline),r.intervalId&&clearInterval(r.intervalId),delete window.__connectionListeners)}})),ve=()=>{const{toast:e}=he(),s=wr(),{isOnline:r}=nr(),a=async(f,u)=>{const m=async()=>{const h=await s.signIn(f,u);return h.error?e({title:"Sign In Failed",description:h.error.message,variant:"destructive"}):e({title:"Welcome back!",description:"You have successfully signed in."}),h};return r?await m():(e({title:"No connection",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:new Error("No connection")})},n=async(f,u)=>{const m=async()=>{const h=await s.signUp(f,u);return h.error?e({title:"Sign Up Failed",description:h.error.message,variant:"destructive"}):e({title:"Account Created!",description:"Please check your email to verify your account."}),h};return r?await m():(e({title:"No connection",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:new Error("No connection")})},o=async()=>{const f=await s.signInWithGoogle();return f.error&&e({title:"Google Sign In Failed",description:f.error.message,variant:"destructive"}),f},i=async f=>{const u=async()=>{const m=await s.resetPassword(f);return m.error?e({title:"Password Reset Failed",description:m.error.message,variant:"destructive"}):e({title:"Reset Link Sent",description:"Check your email for a password reset link."}),m};return r?await u():(e({title:"No connection",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:new Error("No connection")})},c=async f=>{const u=async()=>{const m=await s.updatePassword(f);return m.error?e({title:"Password Update Failed",description:m.error.message,variant:"destructive"}):e({title:"Password Updated",description:"Your password has been successfully updated."}),m};return r?await u():(e({title:"No connection",description:"Please check your internet connection and try again.",variant:"destructive"}),{error:new Error("No connection")})},d=async()=>await(async()=>{const u=await s.signOut();u?.error?e({title:"Sign Out Failed",description:u.error.message,variant:"destructive"}):e({title:"Signed Out",description:"You have been successfully signed out."})})();return{user:s.user,session:s.session,loading:s.loading,signIn:a,signUp:n,signOut:d,signInWithGoogle:o,resetPassword:i,updatePassword:c}},hu=()=>{if(typeof window>"u")return"web";if(window.Capacitor){const s=window.Capacitor.getPlatform();return s==="ios"?"ios":s==="android"?"android":"web"}const e=navigator.userAgent;return e.includes("iPhone")||e.includes("iPad")?"ios":e.includes("Android")?"android":"web"},f0=e=>{switch(e){case"android":return"google_play";case"ios":return"apple_app_store";default:return"stripe"}},fu=l.createContext(void 0),p0=({children:e})=>{const[s,r]=l.useState(null);return t.jsx(fu.Provider,{value:{testRole:s,setTestRole:r,isTestingMode:s!==null,originalRole:"admin"},children:e})},pu=()=>{const e=l.useContext(fu);if(e===void 0)throw new Error("useRoleTestingContext must be used within a RoleTestingProvider");return e},gu={subscribed:!1,subscription_status:"free",subscription_tier:"free_user",requests_used:0,request_limit:0,isPaidUser:!1,hasPremiumFeatures:!1,inTrial:!1,platform:"web",payment_provider:"stripe"},g0=async(e,s)=>{const r=hu(),a=f0(r);try{const{data:n,error:o}=await T.from("profiles").select(`
        subscription_tier,
        subscription_status,
        subscription_end_date,
        trial_ends_at,
        stripe_customer_id,
        google_play_purchase_token,
        apple_transaction_id,
        user_tier,
        created_at
      `).eq("user_id",e).single();if(o)throw console.error("Profile fetch error:",o),o;const{data:i}=await T.from("shared_settings").select("setting_value").eq("setting_key","free_tier_request_limit").single(),c=i?.setting_value?parseInt(i.setting_value):5,d=new Date,f=n?.subscription_end_date?new Date(n.subscription_end_date):null,u=n?.trial_ends_at?new Date(n.trial_ends_at):null,m=u?u>d:!1;let h=!1,p="free";n?.subscription_status==="active"&&f&&f>d?(h=!0,p="active"):m?p="trial":p="free";const x=r==="android"&&n?.google_play_purchase_token||r==="ios"&&n?.apple_transaction_id||r==="web"&&n?.stripe_customer_id&&h,g=n?.user_tier||"free_user",v=n?.subscription_tier||"free",w=h||m||g==="paid_user",y=w,b=w?"paid":"free",{data:{user:j}}=await T.auth.getUser(),N=j?.app_metadata?.provider||"email";return{subscribed:h||!!x,subscription_status:p,subscription_tier:b,subscription_end_date:n?.subscription_end_date,inTrial:m,trialEndsAt:n?.trial_ends_at,requests_used:0,request_limit:w?1e3:c,isPaidUser:w,hasPremiumFeatures:y,platform:r,payment_provider:a,login_method:N,debug:{source:"unified_fetch",cached:!1,timestamp:Date.now(),platform_detection:{detected_platform:r,user_agent:navigator.userAgent,capacitor:!!window.Capacitor,subscription_sources:{stripe:!!n?.stripe_customer_id,google_play:!!n?.google_play_purchase_token,apple:!!n?.apple_transaction_id}}}}}catch(n){return console.error(" Unified subscription fetch error:",n),{...gu,platform:r,payment_provider:a,debug:{source:"error_fallback",cached:!1,timestamp:Date.now(),platform_detection:{error:n.message}}}}},Es=()=>{const{user:e,session:s}=ve(),{toast:r}=he(),a=ft(),[n]=l.useState(()=>hu()),{testRole:o,isTestingMode:i}=pu(),{data:c=gu,isLoading:d,error:f,refetch:u}=ut({queryKey:["unified-subscription",e?.id],queryFn:()=>g0(e.id,s?.access_token),enabled:!!e?.id,staleTime:5*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:2}),m=l.useCallback(()=>{a.invalidateQueries({queryKey:["unified-subscription"]}),a.refetchQueries({queryKey:["unified-subscription"]})},[a]),h=l.useCallback(async()=>{if(!e||!s){r({title:"Authentication required",description:"Please sign in to upgrade to premium",variant:"destructive"});return}try{if(n==="web"){const{data:g,error:v}=await T.functions.invoke("create-subscription",{headers:{Authorization:`Bearer ${s.access_token}`}});if(v)throw v;if(g?.url)return window.open(g.url,"_blank"),{success:!0}}else{const g=n==="ios"?"App Store":"Google Play Store";return r({title:`${g} Purchase Required`,description:`To upgrade to premium, please use the ${g} billing system.`}),{platform:n,requiresNativePurchase:!0}}}catch(g){return console.error("Error creating subscription:",g),r({title:"Subscription Error",description:"Failed to start subscription process. Please try again.",variant:"destructive"}),{error:g}}},[n,e,s,r]),p=l.useCallback(async()=>{if(!(!e||!s))try{if(n==="web"){const{data:g,error:v}=await T.functions.invoke("customer-portal",{headers:{Authorization:`Bearer ${s.access_token}`}});if(v)throw v;g?.url&&window.open(g.url,"_blank")}else{const g=n==="ios"?"https://apps.apple.com/account/subscriptions":"https://play.google.com/store/account/subscriptions";window.open(g,"_blank")}}catch(g){console.error("Error opening customer portal:",g),r({title:"Error",description:"Failed to open subscription management. Please try again.",variant:"destructive"})}},[n,e,s,r]);return{...i&&o?{...c,...o==="trial_user"&&{subscription_status:"trial",subscription_tier:"paid",inTrial:!0,trialEndsAt:new Date(Date.now()+7*24*60*60*1e3).toISOString(),isPaidUser:!1,hasPremiumFeatures:!0,request_limit:1e3},...o==="free_user"&&{subscription_status:"free",subscription_tier:"free",inTrial:!1,trialEndsAt:void 0,isPaidUser:!1,hasPremiumFeatures:!1,request_limit:5},...o==="paid_user"&&{subscription_status:"active",subscription_tier:"paid",inTrial:!1,isPaidUser:!0,hasPremiumFeatures:!0,request_limit:1e3}}:c,loading:d,error:f,refetch:u,invalidate:m,createSubscription:h,openCustomerPortal:p}},xu=()=>({executeWithRetry:l.useCallback(async(s,r=3)=>{for(let a=1;a<=r;a++)try{return await s()}catch(n){if(console.log(`Attempt ${a} failed:`,n),a===r)throw n;await new Promise(o=>setTimeout(o,Math.pow(2,a)*1e3))}},[])}),za="fastnow_cache_",Di=(e,s,r=24)=>{try{const a={data:s,cached_at:Date.now(),expires_at:Date.now()+r*60*60*1e3};localStorage.setItem(`${za}${e}`,JSON.stringify(a))}catch(a){console.warn("Failed to cache data:",a)}},Ai=e=>{try{const s=localStorage.getItem(`${za}${e}`);if(!s)return null;const r=JSON.parse(s);return Date.now()>r.expires_at?(localStorage.removeItem(`${za}${e}`),null):r.data}catch(s){return console.warn("Failed to retrieve cached data:",s),null}},ac=(e,s,r=24)=>{Di(`profile_${e}`,s,r)},x0=e=>Ai(`profile_${e}`),v0=(e,s)=>{Di(`subscription_${e}`,s,24)},y0=e=>Ai(`subscription_${e}`),w0=(e,s,r=5)=>{const a=r/60;Di(`request_${e}`,s,a)},nc=e=>Ai(`request_${e}`),oc=()=>{try{const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r?.startsWith(za))try{const a=localStorage.getItem(r);if(a){const n=JSON.parse(a);Date.now()>n.expires_at&&e.push(r)}}catch{e.push(r)}}e.forEach(s=>localStorage.removeItem(s))}catch(e){console.warn("Failed to cleanup expired data:",e)}},Dr=new Map,vu=async(e,s,r=5,a=!0)=>{if(a&&typeof document<"u"&&document.hidden){console.log(`Skipping request ${e} - page not visible`);const i=nc(e);if(i)return i}const n=nc(e);if(n)return n;if(Dr.has(e))return Dr.get(e);const o=s().then(async i=>(w0(e,i,r),Dr.delete(e),i)).catch(i=>{throw Dr.delete(e),i});return Dr.set(e,o),o};let ic=!1;const b0=()=>{ic||(oc(),setInterval(oc,60*60*1e3),ic=!0)},Ie=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(!1),{user:n}=ve(),{toast:o}=he(),{executeWithRetry:i}=xu(),c=l.useCallback(async(h=!1)=>{if(!n){s(null),a(!1);return}if(!h){const p=x0(n.id);if(p&&p.weight&&p.height&&p.age){console.log("Using cached profile data:",p),s(p),a(!1);return}else console.log("Cache invalid or incomplete, fetching fresh profile data")}a(!0);try{let p=null;if(h){const x=await i(async()=>await T.from("profiles").select("*").eq("user_id",n.id).maybeSingle()),{data:g,error:v}=x;if(v)throw console.error("Profile load error (force):",v),v;p=g}else p=await vu(`profile_${n.id}`,async()=>{const x=await i(async()=>await T.from("profiles").select("*").eq("user_id",n.id).maybeSingle()),{data:g,error:v}=x;if(v)throw console.error("Profile load error:",v),v;return g},30);console.log("Profile loaded successfully:",p),p&&ac(n.id,p,24),s(p||null)}catch(p){console.error("Error loading profile:",p),s(null),o({variant:"destructive",title:"Connection Error",description:"Unable to load profile. Please check your internet connection."})}finally{a(!1)}},[n?.id,i,o]),d=l.useCallback(async h=>{if(!n)return console.error("updateProfile: User not authenticated"),{error:{message:"User not authenticated"}};console.log("updateProfile: Starting update for user:",n.id),a(!0);try{const{data:{session:p}}=await T.auth.getSession();if(!p)throw console.error("updateProfile: No valid session found"),new Error("No valid session. Please log in again.");console.log("updateProfile: Valid session found, executing update with data:",h);const x=await i(async()=>{console.log("updateProfile: Making database upsert call with user_id:",n.id);const{data:b,error:j}=await T.from("profiles").upsert({user_id:n.id,...h},{onConflict:"user_id"}).select().single();return console.log("updateProfile: Database response:",{data:b,error:j}),{data:b,error:j}}),{data:g,error:v}=x;if(console.log("Database response:",{data:g,error:v}),v)throw console.error("Database error:",v),v;if(!g)throw console.error("No data returned from database"),new Error("No data returned from database");console.log("Updating profile state with:",g),s(g);const w=`profile_${n.id}`,y=`profile_${n.id}`;return typeof window<"u"&&(localStorage.removeItem(`cache_${w}`),localStorage.removeItem(`dedupe_${y}`)),ac(n.id,g,24),{data:g,error:null}}catch(p){return console.error("Error updating profile:",p),o({variant:"destructive",title:"Update failed",description:`Unable to save profile: ${p.message||"Please try again."}`}),{error:p,data:null}}finally{a(!1)}},[n,i,o,c]),f=l.useCallback(()=>{const h=!!(e&&e.weight&&e.height&&e.age&&(e.activity_level||e["activity-level"]));return console.log("Profile completion check:",{complete:h,weight:e?.weight,height:e?.height,age:e?.age,activity_level:e?.activity_level,profile:e}),h},[e?.weight,e?.height,e?.age,e?.activity_level]),u=()=>{if(!e||!e.weight||!e.height||!e.age)return 0;let h,p;return e.units==="metric"?(h=e.weight,p=e.height):(h=e.weight*.453592,p=e.height*2.54),Math.round(10*h+6.25*p-5*e.age-78)},m=(h,p=3)=>{if(!e||!e.weight)return 0;const g={2:2.8,3:3.2,4:4.3,5:5.5}[p]||3.2;let v;return e.units==="metric"?v=e.weight:v=e.weight*.453592,Math.round(g*v*(h/60))};return l.useEffect(()=>{n?.id?c():(s(null),a(!1))},[n?.id,c]),{profile:e,loading:r,updateProfile:d,loadProfile:c,isProfileComplete:f,calculateBMR:u,calculateWalkingCalories:m}},j0=()=>{const{user:e}=ve(),{profile:s,loading:r}=Ie();return{isAdmin:!!(e?.email==="test@test.com"||e?.email?.includes("admin")||s?.display_name?.toLowerCase().includes("admin")),loading:r}},N0=()=>{const{isAdmin:e}=j0(),s=he();return{...s,toast:a=>{if(!(!e&&a.variant==="destructive"&&(a.description?.includes("subscription")||a.description?.includes("API")||a.description?.includes("database")||a.description?.includes("server")||a.description?.includes("connection")||a.description?.includes("network")||a.title?.includes("Error checking")||a.title?.includes("Failed to")||a.title?.includes("Subscription error")||a.title?.includes("Connection error")||a.title?.includes("Network error"))))return s.toast(a)}}},Ri=()=>{const[e,s]=l.useState({subscribed:!1,subscription_status:"free",subscription_tier:"free_user",requests_used:0,request_limit:0,isPaidUser:!1,hasPremiumFeatures:!1,inTrial:!1}),[r,a]=l.useState(!0),{user:n,session:o}=ve(),{toast:i}=N0(),c=async()=>{if(!n||!o){console.log("UseSubscription: No user or session, setting defaults"),s({subscribed:!1,subscription_status:"free",subscription_tier:"free_user",requests_used:0,request_limit:0,isPaidUser:!1,hasPremiumFeatures:!1,inTrial:!1}),a(!1);return}try{const h=y0(n.id);if(h){console.log("UseSubscription: Using cached data"),s(h),a(!1);return}console.log("UseSubscription: Fetching fresh subscription data for user:",n.id);const p=await vu(`subscription_${n.id}`,async()=>{const{error:x}=await T.rpc("update_user_tier",{_user_id:n.id});x&&console.error("Error updating user tier:",x);const{data:g,error:v}=await T.from("profiles").select("*").eq("user_id",n.id).single();if(v)throw v;const w=g?.user_tier||"free_user",y=g?.monthly_ai_requests||0,b=g?.trial_ends_at,j=b?new Date(b)>new Date:!1,N=g?.subscription_status==="active",C=j||N,_=C,{data:k}=await T.from("shared_settings").select("setting_value").eq("setting_key","monthly_request_limit").maybeSingle(),S=parseInt(k?.setting_value||"1000"),E=C?S:0;return{subscribed:N,subscription_status:N?"active":j?"trial":"free",subscription_tier:w,subscription_end_date:g?.subscription_end_date,requests_used:y,request_limit:E,isPaidUser:C,hasPremiumFeatures:_,inTrial:j,trialEndsAt:b}},30);v0(n.id,p),s(p),console.log("UseSubscription: Final status:",{tier:p.subscription_tier,isPaidUser:p.isPaidUser,hasPremiumFeatures:p.hasPremiumFeatures,inTrial:p.inTrial,requestLimit:p.request_limit})}catch(h){console.error("Error checking subscription:",h)}finally{a(!1)}},d=async()=>{if(!(!n||!o))try{const{data:h,error:p}=await T.functions.invoke("create-subscription");if(p)throw p;h?.url&&window.open(h.url,"_blank")}catch(h){console.error("Error creating subscription:",h),i({title:"Error starting subscription",description:"Please try again later",variant:"destructive"})}},f=async()=>{if(!(!n||!o))try{const{data:h,error:p}=await T.functions.invoke("customer-portal");if(p)throw p;h?.url&&window.open(h.url,"_blank")}catch(h){console.error("Error opening customer portal:",h),i({title:"Error opening billing portal",description:"Please try again later",variant:"destructive"})}},u=async h=>{if(n)try{await T.rpc("track_usage_event",{_user_id:n.id,_event_type:h,_requests_count:e.requests_used,_subscription_status:e.subscription_status})}catch(p){console.error("Error tracking usage event:",p)}},m=()=>{const{inTrial:h,trialEndsAt:p,subscription_status:x}=e;if(x==="free"&&!h)return{level:"critical",message:"Trial expired. Upgrade to premium to access Food tracking and AI features."};if(h&&p){const g=Math.ceil((new Date(p).getTime()-Date.now())/864e5);if(g<=1)return{level:"warning",message:`Trial expires in ${g} day${g===1?"":"s"}. Upgrade to keep access to premium features.`};if(g<=3)return{level:"info",message:`${g} days left in your trial. Upgrade anytime to continue access.`}}return null};return l.useEffect(()=>{c()},[n,o]),{...e,loading:r,checkSubscription:c,createSubscription:d,openCustomerPortal:f,trackUsageEvent:u,getUsageWarning:m}},S0=({isOpen:e,onClose:s,feature:r})=>{const{createSubscription:a,inTrial:n}=Ri(),{toast:o}=he(),i=async()=>{try{await a(),o({title:"Redirecting to checkout",description:"Opening payment page..."})}catch{o({title:"Error",description:"Failed to create subscription. Please try again.",variant:"destructive"})}};return e?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[9999]",onClick:s,children:t.jsx("div",{className:"bg-background rounded-2xl p-6 w-full max-w-sm border border-border",onClick:c=>c.stopPropagation(),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center",children:t.jsx(co,{className:"w-4 h-4 text-white"})}),t.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Premium Feature"})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:s,className:"w-8 h-8 p-0",children:t.jsx(Pe,{className:"w-4 h-4"})})]}),t.jsx("p",{className:"text-sm text-muted-foreground text-center",children:n?"This feature requires a premium subscription.":"Your trial has expired. Upgrade to premium to access this feature."}),t.jsxs(D,{onClick:i,className:"w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white border-0",children:[t.jsx(co,{className:"w-4 h-4 mr-2"}),"Upgrade to Premium"]})]})})}):null},yt=({children:e,feature:s,className:r="",showUpgrade:a=!0,grayOutForFree:n=!1})=>{const{subscribed:o,subscription_tier:i,isPaidUser:c,hasPremiumFeatures:d,loading:f,createSubscription:u,inTrial:m}=Es();pu();const[h,p]=X.useState(!1),x=i==="admin"||d;if(f)return t.jsx(t.Fragment,{children:e});if(x)return t.jsx(t.Fragment,{children:e});const g=y=>{y.preventDefault(),y.stopPropagation(),a&&p(!0)},v=y=>X.Children.map(y,b=>{if(l.isValidElement(b)){const j={...b.props,onClick:g,onDoubleClick:void 0,onMouseDown:void 0,onMouseUp:void 0};return b.type===ps||b.type===js?t.jsx(ur,{className:b.props.className,onClick:g}):b.props?.children?l.cloneElement(b,{...j,children:v(b.props.children)}):l.cloneElement(b,j)}return b}),w=v(e);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:K("opacity-50 cursor-pointer",r),onClick:g,style:{position:"relative"},children:w}),t.jsx(S0,{isOpen:h,onClose:()=>p(!1),feature:s})]})};var _0=l.createContext(void 0);function zs(e){const s=l.useContext(_0);return e||s||"ltr"}function Xr(e,[s,r]){return Math.min(r,Math.max(s,e))}function C0(e,s){return l.useReducer((r,a)=>s[r][a]??r,e)}var Ii="ScrollArea",[yu,K2]=jt(Ii),[k0,Dt]=yu(Ii),wu=l.forwardRef((e,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:n,scrollHideDelay:o=600,...i}=e,[c,d]=l.useState(null),[f,u]=l.useState(null),[m,h]=l.useState(null),[p,x]=l.useState(null),[g,v]=l.useState(null),[w,y]=l.useState(0),[b,j]=l.useState(0),[N,C]=l.useState(!1),[_,k]=l.useState(!1),S=we(s,A=>d(A)),E=zs(n);return t.jsx(k0,{scope:r,type:a,dir:E,scrollHideDelay:o,scrollArea:c,viewport:f,onViewportChange:u,content:m,onContentChange:h,scrollbarX:p,onScrollbarXChange:x,scrollbarXEnabled:N,onScrollbarXEnabledChange:C,scrollbarY:g,onScrollbarYChange:v,scrollbarYEnabled:_,onScrollbarYEnabledChange:k,onCornerWidthChange:y,onCornerHeightChange:j,children:t.jsx(pe.div,{dir:E,...i,ref:S,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":b+"px",...e.style}})})});wu.displayName=Ii;var bu="ScrollAreaViewport",ju=l.forwardRef((e,s)=>{const{__scopeScrollArea:r,children:a,asChild:n,nonce:o,...i}=e,c=Dt(bu,r),d=l.useRef(null),f=we(s,d,c.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:o}),t.jsx(pe.div,{"data-radix-scroll-area-viewport":"",...i,asChild:n,ref:f,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:O0({asChild:n,children:a},u=>t.jsx("div",{"data-radix-scroll-area-content":"",ref:c.onContentChange,style:{minWidth:c.scrollbarXEnabled?"fit-content":void 0},children:u}))})]})});ju.displayName=bu;var Zt="ScrollAreaScrollbar",Fi=l.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Dt(Zt,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:i}=n,c=e.orientation==="horizontal";return l.useEffect(()=>(c?o(!0):i(!0),()=>{c?o(!1):i(!1)}),[c,o,i]),n.type==="hover"?t.jsx(E0,{...a,ref:s,forceMount:r}):n.type==="scroll"?t.jsx(T0,{...a,ref:s,forceMount:r}):n.type==="auto"?t.jsx(Nu,{...a,ref:s,forceMount:r}):n.type==="always"?t.jsx(Oi,{...a,ref:s}):null});Fi.displayName=Zt;var E0=l.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Dt(Zt,e.__scopeScrollArea),[o,i]=l.useState(!1);return l.useEffect(()=>{const c=n.scrollArea;let d=0;if(c){const f=()=>{window.clearTimeout(d),i(!0)},u=()=>{d=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return c.addEventListener("pointerenter",f),c.addEventListener("pointerleave",u),()=>{window.clearTimeout(d),c.removeEventListener("pointerenter",f),c.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),t.jsx(Nt,{present:r||o,children:t.jsx(Nu,{"data-state":o?"visible":"hidden",...a,ref:s})})}),T0=l.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Dt(Zt,e.__scopeScrollArea),o=e.orientation==="horizontal",i=vn(()=>d("SCROLL_END"),100),[c,d]=C0("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(c==="idle"){const f=window.setTimeout(()=>d("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(f)}},[c,n.scrollHideDelay,d]),l.useEffect(()=>{const f=n.viewport,u=o?"scrollLeft":"scrollTop";if(f){let m=f[u];const h=()=>{const p=f[u];m!==p&&(d("SCROLL"),i()),m=p};return f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[n.viewport,o,d,i]),t.jsx(Nt,{present:r||c!=="hidden",children:t.jsx(Oi,{"data-state":c==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:re(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:re(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),Nu=l.forwardRef((e,s)=>{const r=Dt(Zt,e.__scopeScrollArea),{forceMount:a,...n}=e,[o,i]=l.useState(!1),c=e.orientation==="horizontal",d=vn(()=>{if(r.viewport){const f=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;i(c?f:u)}},10);return or(r.viewport,d),or(r.content,d),t.jsx(Nt,{present:a||o,children:t.jsx(Oi,{"data-state":o?"visible":"hidden",...n,ref:s})})}),Oi=l.forwardRef((e,s)=>{const{orientation:r="vertical",...a}=e,n=Dt(Zt,e.__scopeScrollArea),o=l.useRef(null),i=l.useRef(0),[c,d]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),f=Eu(c.viewport,c.content),u={...a,sizes:c,onSizesChange:d,hasThumb:f>0&&f<1,onThumbChange:h=>o.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function m(h,p){return I0(h,i.current,c,p)}return r==="horizontal"?t.jsx(M0,{...u,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollLeft,p=lc(h,c,n.dir);o.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=m(h,n.dir))}}):r==="vertical"?t.jsx(P0,{...u,ref:s,onThumbPositionChange:()=>{if(n.viewport&&o.current){const h=n.viewport.scrollTop,p=lc(h,c);o.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=m(h))}}):null}),M0=l.forwardRef((e,s)=>{const{sizes:r,onSizesChange:a,...n}=e,o=Dt(Zt,e.__scopeScrollArea),[i,c]=l.useState(),d=l.useRef(null),f=we(s,d,o.onScrollbarXChange);return l.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),t.jsx(_u,{"data-orientation":"horizontal",...n,ref:f,sizes:r,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":xn(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,m)=>{if(o.viewport){const h=o.viewport.scrollLeft+u.deltaX;e.onWheelScroll(h),Mu(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&o.viewport&&i&&a({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:Ba(i.paddingLeft),paddingEnd:Ba(i.paddingRight)}})}})}),P0=l.forwardRef((e,s)=>{const{sizes:r,onSizesChange:a,...n}=e,o=Dt(Zt,e.__scopeScrollArea),[i,c]=l.useState(),d=l.useRef(null),f=we(s,d,o.onScrollbarYChange);return l.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),t.jsx(_u,{"data-orientation":"vertical",...n,ref:f,sizes:r,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":xn(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,m)=>{if(o.viewport){const h=o.viewport.scrollTop+u.deltaY;e.onWheelScroll(h),Mu(h,m)&&u.preventDefault()}},onResize:()=>{d.current&&o.viewport&&i&&a({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:Ba(i.paddingTop),paddingEnd:Ba(i.paddingBottom)}})}})}),[D0,Su]=yu(Zt),_u=l.forwardRef((e,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:n,onThumbChange:o,onThumbPointerUp:i,onThumbPointerDown:c,onThumbPositionChange:d,onDragScroll:f,onWheelScroll:u,onResize:m,...h}=e,p=Dt(Zt,r),[x,g]=l.useState(null),v=we(s,S=>g(S)),w=l.useRef(null),y=l.useRef(""),b=p.viewport,j=a.content-a.viewport,N=Et(u),C=Et(d),_=vn(m,10);function k(S){if(w.current){const E=S.clientX-w.current.left,A=S.clientY-w.current.top;f({x:E,y:A})}}return l.useEffect(()=>{const S=E=>{const A=E.target;x?.contains(A)&&N(E,j)};return document.addEventListener("wheel",S,{passive:!1}),()=>document.removeEventListener("wheel",S,{passive:!1})},[b,x,j,N]),l.useEffect(C,[a,C]),or(x,_),or(p.content,_),t.jsx(D0,{scope:r,scrollbar:x,hasThumb:n,onThumbChange:Et(o),onThumbPointerUp:Et(i),onThumbPositionChange:C,onThumbPointerDown:Et(c),children:t.jsx(pe.div,{...h,ref:v,style:{position:"absolute",...h.style},onPointerDown:re(e.onPointerDown,S=>{S.button===0&&(S.target.setPointerCapture(S.pointerId),w.current=x.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),k(S))}),onPointerMove:re(e.onPointerMove,k),onPointerUp:re(e.onPointerUp,S=>{const E=S.target;E.hasPointerCapture(S.pointerId)&&E.releasePointerCapture(S.pointerId),document.body.style.webkitUserSelect=y.current,p.viewport&&(p.viewport.style.scrollBehavior=""),w.current=null})})})}),qa="ScrollAreaThumb",Cu=l.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=Su(qa,e.__scopeScrollArea);return t.jsx(Nt,{present:r||n.hasThumb,children:t.jsx(A0,{ref:s,...a})})}),A0=l.forwardRef((e,s)=>{const{__scopeScrollArea:r,style:a,...n}=e,o=Dt(qa,r),i=Su(qa,r),{onThumbPositionChange:c}=i,d=we(s,m=>i.onThumbChange(m)),f=l.useRef(),u=vn(()=>{f.current&&(f.current(),f.current=void 0)},100);return l.useEffect(()=>{const m=o.viewport;if(m){const h=()=>{if(u(),!f.current){const p=F0(m,c);f.current=p,c()}};return c(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[o.viewport,u,c]),t.jsx(pe.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:re(e.onPointerDownCapture,m=>{const p=m.target.getBoundingClientRect(),x=m.clientX-p.left,g=m.clientY-p.top;i.onThumbPointerDown({x,y:g})}),onPointerUp:re(e.onPointerUp,i.onThumbPointerUp)})});Cu.displayName=qa;var Li="ScrollAreaCorner",ku=l.forwardRef((e,s)=>{const r=Dt(Li,e.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?t.jsx(R0,{...e,ref:s}):null});ku.displayName=Li;var R0=l.forwardRef((e,s)=>{const{__scopeScrollArea:r,...a}=e,n=Dt(Li,r),[o,i]=l.useState(0),[c,d]=l.useState(0),f=!!(o&&c);return or(n.scrollbarX,()=>{const u=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(u),d(u)}),or(n.scrollbarY,()=>{const u=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(u),i(u)}),f?t.jsx(pe.div,{...a,ref:s,style:{width:o,height:c,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Ba(e){return e?parseInt(e,10):0}function Eu(e,s){const r=e/s;return isNaN(r)?0:r}function xn(e){const s=Eu(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-r)*s;return Math.max(a,18)}function I0(e,s,r,a="ltr"){const n=xn(r),o=n/2,i=s||o,c=n-i,d=r.scrollbar.paddingStart+i,f=r.scrollbar.size-r.scrollbar.paddingEnd-c,u=r.content-r.viewport,m=a==="ltr"?[0,u]:[u*-1,0];return Tu([d,f],m)(e)}function lc(e,s,r="ltr"){const a=xn(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,o=s.scrollbar.size-n,i=s.content-s.viewport,c=o-a,d=r==="ltr"?[0,i]:[i*-1,0],f=Xr(e,d);return Tu([0,i],[0,c])(f)}function Tu(e,s){return r=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(r-e[0])}}function Mu(e,s){return e>0&&e<s}var F0=(e,s=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},a=0;return function n(){const o={left:e.scrollLeft,top:e.scrollTop},i=r.left!==o.left,c=r.top!==o.top;(i||c)&&s(),r=o,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function vn(e,s){const r=Et(e),a=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),l.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function or(e,s){const r=Et(s);wt(()=>{let a=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(a),n.unobserve(e)}}},[e,r])}function O0(e,s){const{asChild:r,children:a}=e;if(!r)return typeof s=="function"?s(a):s;const n=l.Children.only(a);return l.cloneElement(n,{children:typeof s=="function"?s(n.props.children):s})}var Pu=wu,L0=ju,$0=ku;const Du=l.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Pu,{ref:a,className:K("relative overflow-hidden",e),...r,children:[t.jsx(L0,{className:"h-full w-full rounded-[inherit]",children:s}),t.jsx(Au,{}),t.jsx($0,{})]}));Du.displayName=Pu.displayName;const Au=l.forwardRef(({className:e,orientation:s="vertical",...r},a)=>t.jsx(Fi,{ref:a,orientation:s,className:K("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:t.jsx(Cu,{className:"relative flex-1 rounded-full bg-border"})}));Au.displayName=Fi.displayName;const yn=()=>{const[e,s]=l.useState(!1),[r,a]=l.useState([]),[n,o]=l.useState(!1),{user:i}=ve();l.useEffect(()=>{const h=x=>{x.key==="Escape"&&e&&s(!1)},p=x=>{const g=x.target;e&&g.closest(".aquarium-container")===null&&g.closest(".ai-voice-button")===null&&s(!1)};return document.addEventListener("keydown",h),document.addEventListener("mousedown",p),()=>{document.removeEventListener("keydown",h),document.removeEventListener("mousedown",p)}},[e]),l.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[e]);const c=(h,p)=>{const x={id:Date.now().toString()+Math.random(),role:h,content:p,timestamp:new Date};return a(g=>[...g,x]),x.id},d=async(h,p=!1)=>{if(!(!i||n)){c("user",h),o(!0);try{const x=window.location.pathname,v=`You are a helpful assistant for a fasting and health tracking app. Help users with app features, calculations, unit conversions, and guidance. Current page: ${u(x)}`,{data:w,error:y}=await T.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:v},{role:"user",content:h}]}});if(y)throw y;w?.completion?(c("assistant",w.completion),p&&await f(w.completion)):c("assistant","Sorry, I had trouble processing your request. Please try again.")}catch(x){console.error("AI Chat error:",x),Ke({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"})}finally{o(!1)}}},f=async h=>{try{const{data:p,error:x}=await T.functions.invoke("text-to-speech",{body:{text:h.slice(0,500)}});if(x)throw x;p?.audioUrl&&new Audio(p.audioUrl).play()}catch(p){console.error("Text-to-speech error:",p)}},u=h=>{switch(h){case"/walking":return"Walking page - user can start/stop walking sessions, view walking history, and track calories burned";case"/timer":return"Fasting timer page - user can start/stop fasting sessions and see fasting progress";case"/food-tracking":return"Food tracking page - user can add food entries, track calories and carbs";case"/motivators":return"Motivators page - user can view and manage personal motivation cards";case"/settings":return"Settings page - user can configure their profile, goals, and app preferences";default:return"Main app interface for fasting and health tracking"}},m=h=>{h.trim()&&(s(!0),d(h,!0))};return t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>s(!0),className:"ai-voice-button w-8 h-8 p-0 rounded-full bg-ai/20 backdrop-blur-sm border border-ai/30 hover:bg-ai/30 hover:scale-110 transition-all duration-200",title:"AI Voice Assistant",children:t.jsx(js,{className:"w-4 h-4 text-ai"})}),e&&t.jsx("div",{className:"fixed inset-0 z-50 flex justify-center bg-frame-background/50",children:t.jsxs("div",{className:"relative max-w-md w-full bg-background/5 backdrop-blur-lg",children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>s(!1),className:"absolute top-4 right-4 z-10 w-12 h-12 p-0 rounded-full bg-background/80 backdrop-blur-sm border border-border/50 hover:bg-background/90 hover:scale-110 transition-all duration-200",title:"Close",children:t.jsx(Pe,{className:"w-6 h-6 text-foreground"})}),t.jsxs("div",{className:"aquarium-container relative w-full h-screen flex flex-col",children:[t.jsx("div",{className:"flex-1 overflow-hidden pt-20 pb-24",children:t.jsx(Du,{className:"h-full",children:t.jsxs("div",{className:"max-w-full mx-auto space-y-0",children:[r.map((h,p)=>t.jsx(i0,{content:h.content,role:h.role,index:p},h.id)),n&&t.jsx("div",{className:"w-full mb-4 flex justify-start px-4",children:t.jsx("div",{className:"bg-primary/90 border border-primary/50 rounded-2xl rounded-tl-sm p-4 animate-pulse",children:t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"0ms"}}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"150ms"}}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]})})}),t.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2",children:t.jsx(yt,{feature:"voice_chat",children:t.jsx(Yr,{onTranscription:m,isDisabled:n,size:"lg"})})})]})]})})]})},$i=({onClick:e,title:s="View past entries"})=>t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 p-0 rounded-full bg-ceramic-plate/80 backdrop-blur-sm border border-ceramic-rim hover:bg-ceramic-plate hover:scale-110 transition-all duration-200",title:s,children:t.jsx(Sg,{className:"w-4 h-4 text-warm-text"})}),na=({isOpen:e,onClose:s,title:r,subtitle:a,heroQuote:n,backgroundImage:o,children:i})=>e?t.jsx("div",{className:"fixed inset-0 z-50 bg-background/95 backdrop-blur-sm flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md max-h-[90vh] bg-card/90 backdrop-blur-sm rounded-2xl border border-border overflow-hidden flex flex-col relative",children:[o&&t.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-30 rounded-2xl",style:{backgroundImage:`url('${o}')`}}),t.jsxs("div",{className:"flex justify-between items-start p-4 border-b border-border/30 relative z-10",children:[t.jsxs("div",{className:"flex-1 mr-3",children:[t.jsx("h1",{className:"text-xl font-bold text-warm-text mb-1",children:r}),a&&t.jsx("p",{className:"text-sm text-warm-text/80 leading-relaxed",children:a})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:s,className:"w-12 h-12 rounded-full bg-muted/50 hover:bg-muted/70 hover:scale-110 transition-all duration-200 flex-shrink-0",title:"Close onboarding",children:t.jsx(Pe,{className:"w-8 h-8 text-warm-text"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 relative z-10",children:[n&&t.jsxs("div",{className:"bg-muted/30 rounded-xl border border-border/50 p-4 relative mt-4",children:[t.jsx(Qg,{className:"w-5 h-5 text-warm-text/40 absolute top-3 left-3"}),t.jsxs("blockquote",{className:"text-sm italic text-warm-text/90 leading-relaxed pl-8",children:['"',n,'"']})]}),t.jsx("div",{className:"space-y-4 mt-4",children:i})]})]})}):null,Xe={profile:{title:"Complete Your Profile",subtitle:"Tell us about yourself to unlock personalized calorie calculations and recommendations.",heroQuote:"Your body is unique. Your plan should be too.",sections:[{icon:Gt,title:"Personalized Calculations",description:"We'll calculate your exact daily calorie needs based on your weight, height, age, and sex using proven metabolic formulas."},{icon:ho,title:"Accurate Tracking",description:"Get precise calorie burn estimates for walking and activities. Your profile enables smart deficit tracking."},{icon:Ta,title:"Smarter Recommendations",description:"Unlock personalized food suggestions, goal recommendations, and motivational content tailored to your journey."}]},timer:{title:"Start With the Fast",subtitle:"60 hours of silence. No food. Just water. This is where change begins.",heroQuote:"Without this fast, I couldn't begin to lose weight. It trains your body and your mind.",backgroundImage:"/lovable-uploads/08d0d0e5-750c-42c4-ac24-cf0bc1157dea.png",sections:[{icon:Ta,title:"The Reset",description:"60-72 hours with just water and coffee shifts your body from burning sugar to burning fat. This breaks the addiction to carbs and emotional eating."},{icon:gg,title:"Embrace the Hunger",description:"Hunger becomes something you sit with  not something you fear. This is hard. That's the point. It's the reset your body needs."},{icon:Gt,title:"Start Your Change",description:"Without this fast, you stay stuck. This is where real change begins  training both your body and your mind for what's ahead."}]},walking:{title:"Walk. Don't Run.",subtitle:"Cardio you don't hate. A tool that actually works.",heroQuote:"This isn't about performance. It's about output. Walking lets you go far without quitting.",backgroundImage:"/lovable-uploads/3b7ad479-e7aa-4ee5-a451-692444a5e96a.png",sections:[{icon:td,title:"Underrated Fat Burner",description:"Walking is the most underrated fat-burning tool on Earth. You can walk for 10 minutes or 3 hours. No pressure, no burnout."},{icon:Kt,title:"All-Day Output",description:"Especially in a city or while traveling  walk all day, burn all day. This is how you build a calorie deficit without tracking every bite."},{icon:Gt,title:"Sustainable Cardio",description:"It's not glamorous. It works. Most people hate running  it doesn't matter. Walking is cardio you can actually stick with."}]},food:{title:"What You Eat, You Become",subtitle:"Calories go in. Fat stays in. Let's reverse that.",heroQuote:"I don't count obsessively. I just don't lie to myself. I know what I eat.",backgroundImage:"/lovable-uploads/12356bb7-5258-4eb6-a64c-d30333b69779.png",sections:[{icon:ho,title:"Simple Math",description:"You burn calories all day, even doing nothing. Eat less than you burn  that's the only way fat disappears."},{icon:Gt,title:"Make It a System",description:"Use the app to track. Keep it simple. Save 'safe foods' and log them fast. Hit your daily target without obsession."},{icon:tr,title:"AI Estimation",description:"Estimate with AI tools when labels are missing. This is how you make food a system, not a struggle."}]},motivators:{title:"What You Want Is Waiting",subtitle:"This isn't motivation. This is fuel.",heroQuote:"It's not about the weight. It's about getting back to the person you know is in there.",backgroundImage:"/lovable-uploads/21db3143-c864-43f3-ae91-d6bbbf67b687.png",sections:[{icon:Gt,title:"Real Motivators",description:"These aren't just goals  they're fuel. Clothes that don't fit. People you want to surprise. Moments you don't want to miss."},{icon:tr,title:"Lock Them In",description:"Add your own photos, events, test results. I've included 10 real ones from my own journey to get you started."},{icon:Kt,title:"When You Need Them",description:"The app will show them to you when you need them most. These motivators remind you what matters when it gets hard."}]}},cc=Pi((e,s)=>({loadingStates:{},timeouts:{},setLoading:(r,a)=>{const{timeouts:n,clearTimeout:o}=s();if(n[r]&&o(r),a){e(c=>({loadingStates:{...c.loadingStates,[r]:!0}}));const i=setTimeout(()=>{console.warn(`Loading timeout for ${r} - forcing to false`),e(c=>({loadingStates:{...c.loadingStates,[r]:!1},timeouts:{...c.timeouts,[r]:void 0}}))},1e4);e(c=>({timeouts:{...c.timeouts,[r]:i}}))}else e(i=>({loadingStates:{...i.loadingStates,[r]:!1}})),n[r]&&o(r)},isLoading:r=>s().loadingStates[r]||!1,clearTimeout:r=>{const{timeouts:a}=s();a[r]&&(clearTimeout(a[r]),e(n=>({timeouts:{...n.timeouts,[r]:void 0}})))}})),Ru=e=>{const{setLoading:s,isLoading:r,clearTimeout:a}=cc(),n=cc(c=>c.loadingStates[e]||!1),o=l.useCallback(()=>{s(e,!0)},[e,s]),i=l.useCallback(()=>{s(e,!1)},[e,s]);return l.useEffect(()=>()=>{a(e),s(e,!1)},[e,a,s]),{loading:n,startLoading:o,stopLoading:i,setLoading:c=>s(e,c)}};let dc=0;const U0=()=>{const e=()=>!document.hidden&&document.visibilityState==="visible",s=()=>e()&&Date.now()-dc<3e4,r=()=>{dc=Date.now()};return typeof window<"u"&&["click","scroll","keydown","touchstart"].forEach(a=>{window.addEventListener(a,r,{passive:!0})}),{isTabVisible:e,shouldRefetch:s,trackUserInteraction:r}},Qn="motivators_cache",uc=24*60*60*1e3,z0=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(0),{user:n}=ve(),{shouldRefetch:o}=U0();l.useEffect(()=>{if(n){try{const f=localStorage.getItem(`${Qn}_${n.id}`);if(f){const u=JSON.parse(f);if(Date.now()-u.timestamp<u.ttl){s(u.data),a(u.timestamp);return}}}catch(f){console.error("Error loading cached motivators:",f)}s(null)}},[n?.id]);const i=l.useCallback(()=>{if(!n)return!1;if(!e)return!0;const u=Date.now()-r;return u>uc||u>30*60*1e3&&o()},[n,e,r,o]),c=l.useCallback(f=>{if(n)try{const u={data:f,timestamp:Date.now(),ttl:uc};localStorage.setItem(`${Qn}_${n.id}`,JSON.stringify(u)),s(f),a(Date.now())}catch(u){console.error("Error caching motivators:",u)}},[n?.id]),d=l.useCallback(()=>{if(n)try{localStorage.removeItem(`${Qn}_${n.id}`),s(null),a(0)}catch(f){console.error("Error invalidating motivator cache:",f)}},[n?.id]);return{cachedMotivators:e,shouldFetchMotivators:i,cacheMotivators:c,invalidateCache:d}},qs=()=>{const[e,s]=l.useState([]),{user:r}=ve(),{toast:a}=he(),{loading:n,startLoading:o,stopLoading:i}=Ru("motivators"),{cachedMotivators:c,shouldFetchMotivators:d,cacheMotivators:f,invalidateCache:u}=z0(),m=async(w=!1)=>{if(!r){i();return}if(!w&&c&&!d()){console.log("Using cached motivators, skipping API call"),s(c),i();return}o();try{const{data:y,error:b}=await T.from("motivators").select("*, image_url").eq("user_id",r.id).eq("is_active",!0).order("created_at",{ascending:!1});if(b)throw b;const j=(y||[]).map(N=>({...N,imageUrl:N.image_url||N.imageUrl||null}));s(j),f(j),console.log("Loaded fresh motivators from API:",j.length)}catch(y){console.error("Error loading motivators:",y),c&&c.length>0?(console.log("Using cached motivators as fallback"),s(c)):a({title:"Error loading motivators",description:"Please check your connection and try again.",variant:"destructive"})}finally{i()}},h=async w=>{if(!r)return null;try{const{data:y,error:b}=await T.from("motivators").insert({user_id:r.id,title:w.title,content:w.content,category:w.category,image_url:w.imageUrl,is_active:!0}).select().single();if(b)throw b;if(y){const j={...y,imageUrl:y.image_url};return s(N=>[j,...N]),a({title:" Motivator Created!",description:"Your new motivator has been saved."}),y.id}return null}catch(y){return console.error("Error creating motivator:",y),a({title:"Error creating motivator",description:"Please try again.",variant:"destructive"}),null}},p=async(w,y)=>{if(!r)return!1;try{const b={...y};y.imageUrl!==void 0&&(b.image_url=y.imageUrl,delete b.imageUrl);const{error:j}=await T.from("motivators").update(b).eq("id",w).eq("user_id",r.id);if(j)throw j;return s(N=>N.map(C=>C.id===w?{...C,...y}:C)),a({title:" Motivator Updated!",description:"Your changes have been saved."}),!0}catch(b){return console.error("Error updating motivator:",b),a({title:"Error updating motivator",description:"Please try again.",variant:"destructive"}),!1}},x=async w=>{if(!r||!w.length)return[];try{const y=w.map(N=>({user_id:r.id,title:N.title,content:N.content,category:N.category||"general",image_url:N.imageUrl,is_active:!0})),{data:b,error:j}=await T.from("motivators").insert(y).select();if(j)throw j;if(b&&b.length>0){const N=b.map(C=>({...C,imageUrl:C.image_url}));return s(C=>[...N,...C]),a({title:" Motivators Created!",description:`Successfully created ${b.length} motivator${b.length>1?"s":""}`}),b.map(C=>C.id)}return[]}catch(y){return console.error("Error creating multiple motivators:",y),a({title:"Error creating motivators",description:"Please try again.",variant:"destructive"}),[]}},g=async w=>{if(!r)return null;try{const y=w.text.length>50?`${w.text.substring(0,47)}...`:w.text,b=`"${w.text}"${w.author?`  ${w.author}`:""}`,{data:j,error:N}=await T.from("motivators").insert({user_id:r.id,title:y,content:b,category:"saved_quote",is_active:!0}).select().single();if(N)throw N;if(j){const C={...j,imageUrl:j.image_url};return s(_=>[C,..._]),a({title:" Quote Saved!",description:"Quote has been saved to your goals."}),j.id}return null}catch(y){return console.error("Error saving quote:",y),a({title:"Error saving quote",description:"Please try again.",variant:"destructive"}),null}},v=async w=>{if(!r)return!1;try{const{error:y}=await T.from("motivators").update({is_active:!1}).eq("id",w).eq("user_id",r.id);if(y)throw y;return s(b=>b.filter(j=>j.id!==w)),a({title:" Motivator Removed",description:"Motivator has been deleted."}),!0}catch(y){return console.error("Error deleting motivator:",y),a({title:"Error deleting motivator",description:"Please try again.",variant:"destructive"}),!1}};return l.useEffect(()=>{r&&(c&&(s(c),i()),m())},[r?.id]),{motivators:e,loading:n,createMotivator:async w=>{const y=await h(w);return y&&(u(),await m(!0)),y},createMultipleMotivators:async w=>{const y=await x(w);return y.length>0&&(u(),await m(!0)),y},updateMotivator:async(w,y)=>{const b=await p(w,y);return b&&(u(),await m(!0)),b},deleteMotivator:async w=>{const y=await v(w);return y&&u(),y},saveQuoteAsGoal:async w=>{const y=await g(w);return y&&(u(),await m(!0)),y},refreshMotivators:()=>m(!0)}},q0="/assets/motivator-placeholder-BSpsGp9Z.jpg",oa=({src:e,alt:s,className:r="",style:a,onError:n,onAddImageClick:o,showAddImagePrompt:i=!0})=>{const[c,d]=l.useState(!1),[f,u]=l.useState(!1),m=()=>{d(!0),n?.()},h=()=>{u(!0)};return!e||c&&f?i&&o&&!e?t.jsxs("div",{className:`bg-muted/40 flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-muted/60 transition-colors ${r}`,style:a,onClick:o,children:[t.jsx(ze,{className:"w-8 h-8 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:"add image"})]}):t.jsx("div",{className:`bg-muted flex items-center justify-center ${r}`,style:a,children:t.jsx(Wr,{className:"w-10 h-10 text-muted-foreground"})}):c?t.jsx("img",{src:q0,alt:s,className:r,style:a,onError:h,loading:"lazy"}):t.jsx("img",{src:e,alt:s,className:r,style:a,onError:m,loading:"lazy"})},Iu=({isActive:e,onModeChange:s,className:r="",timerDurationMs:a=5e3,imageLeadMs:n=2e3,textDurationMs:o=4e3})=>{const{motivators:i}=qs(),c=i.filter(y=>y?.title),[d,f]=l.useState(0),[u,m]=l.useState("timer"),h=l.useRef(0),p=l.useRef(null),x=l.useRef("timer-focused");if(l.useEffect(()=>{if(!e||c.length===0){m("timer"),x.current!=="timer-focused"&&(s?.("timer-focused"),x.current="timer-focused"),p.current&&clearTimeout(p.current),h.current+=1;return}const y=++h.current,b=N=>{m(N);const C=N==="timer"?"timer-focused":"motivator-focused";x.current!==C&&(s?.(C),x.current=C)},j=()=>{h.current===y&&(b("timer"),p.current=setTimeout(()=>{if(h.current!==y)return;!!c[d]?.imageUrl?(b("image"),p.current=setTimeout(()=>{h.current===y&&(b("text"),p.current=setTimeout(()=>{h.current===y&&(f(_=>(_+1)%c.length),j())},o))},n)):(b("text"),p.current=setTimeout(()=>{h.current===y&&(f(_=>(_+1)%c.length),j())},o))},a))};return j(),()=>{p.current&&clearTimeout(p.current),h.current+=1}},[e,c.length,d,a,n,o,s]),!e||c.length===0)return null;const g=c[d],v=(u==="image"||u==="text")&&g?.imageUrl,w=u==="text"&&g?.title;return t.jsxs("div",{className:`absolute inset-0 ${r}`,children:[v&&t.jsx("div",{className:"absolute inset-0 overflow-hidden transition-opacity duration-700",style:{zIndex:8},children:t.jsx(oa,{src:g.imageUrl,alt:g.title||"Motivator image",className:"absolute inset-0 w-full h-full object-cover",style:{filter:"brightness(0.95) saturate(1.05) contrast(1.02)"}})}),w&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{zIndex:15},children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute -inset-6 rounded-full border-2 border-primary/20 animate-pulse pointer-events-none"}),t.jsx("div",{className:"absolute -inset-3 rounded-full border border-primary/30 animate-pulse pointer-events-none",style:{animationDelay:"0.15s"}}),t.jsx("div",{className:"absolute -inset-1 rounded-full border border-primary/40 animate-pulse pointer-events-none",style:{animationDelay:"0.3s"}}),t.jsx("div",{className:"w-44 h-44 rounded-full bg-black/40 text-white backdrop-blur-sm border border-white/10 shadow-lg animate-scale-in flex items-center justify-center px-6 text-center",style:{textShadow:"0 2px 8px rgba(0,0,0,0.4)"},children:t.jsx("span",{className:"font-semibold text-sm tracking-wide leading-snug",children:g.title.toUpperCase()})})]})})]})},B0=({isActive:e,animationType:s,onAnimationEnd:r})=>{const[a,n]=l.useState(!1),[o,i]=l.useState(0),c=3;if(l.useEffect(()=>{if(e){n(!0),i(0);const u=2e3,m=u*c,h=setTimeout(()=>{n(!1),i(0),r()},m),p=setInterval(()=>{i(x=>x+1)},u);return()=>{clearTimeout(h),clearInterval(p)}}},[e,s,r]),!a)return null;const d=()=>`${s}-${o}`,f=()=>{switch(s){case"ring-pulse":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full border-8 border-primary animate-pulse shadow-2xl shadow-primary/60"},d()),t.jsx("div",{className:"absolute inset-4 rounded-full border-4 border-accent animate-pulse shadow-xl shadow-accent/40",style:{animationDelay:"0.5s"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-4xl font-bold text-white animate-pulse bg-ceramic-base/80 rounded-full px-6 py-3 border-2 border-white/30 backdrop-blur-sm",children:"GOAL!"})})]});case"particle-burst":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 rounded-full animate-bounce border-4 border-accent shadow-xl shadow-accent/50"},d()),t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(8)].map((u,m)=>t.jsx("div",{className:"absolute w-2 h-2 bg-accent rounded-full animate-ping",style:{top:"50%",left:"50%",animationDelay:`${m*.1}s`,transform:`rotate(${m*45}deg) translateY(-120px)`,animationDuration:"1.5s"}},`${d()}-particle-${m}`))}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-bounce bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:""})})]});case"color-wave":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-2 rounded-full bg-gradient-to-r from-primary via-accent to-secondary animate-spin border-4",style:{animationDuration:"2s"}},d()),t.jsx("div",{className:"absolute inset-6 rounded-full bg-gradient-to-r from-secondary via-primary to-accent animate-spin",style:{animationDuration:"1.5s",animationDirection:"reverse"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-pulse bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:""})})]});case"fireworks":return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(12)].map((u,m)=>t.jsx("div",{className:"absolute w-1 h-4 bg-gradient-to-t from-yellow-400 via-orange-500 to-red-500 rounded-full animate-pulse",style:{top:"50%",left:"50%",animationDelay:`${m*.1}s`,transform:`rotate(${m*30}deg) translateY(-140px)`,transformOrigin:"bottom",animationDuration:"1s"}},`${d()}-firework-${m}`))}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"text-5xl animate-spin bg-ceramic-base/80 rounded-full px-4 py-2 border-2 border-white/30 backdrop-blur-sm",children:""})})]});default:return null}};return t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:f()})},W0=({progress:e,displayTime:s,isActive:r,showSlideshow:a=!1,countDirection:n,onToggleCountDirection:o,fastType:i,goalDuration:c,className:d,celebrationAnimation:f})=>{const[u,m]=l.useState("timer-focused"),h=2*Math.PI*45,p=h-e/100*h;return t.jsx("div",{className:K("relative flex items-center justify-center",d),children:t.jsxs("div",{className:"relative w-80 h-80 rounded-full",style:{background:"var(--gradient-ceramic)",boxShadow:"var(--shadow-plate)"},children:[t.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"var(--gradient-rim)",boxShadow:"var(--shadow-rim)"}}),t.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-52 h-52 rounded-full flex items-center justify-center",style:{background:"var(--gradient-well)",boxShadow:"var(--shadow-well)"},children:[a&&t.jsx("div",{className:"absolute inset-0 rounded-full overflow-hidden",children:t.jsx(Iu,{isActive:r,onModeChange:m,className:"rounded-full"})}),t.jsxs("svg",{className:"absolute inset-0 w-full h-full transform -rotate-90",viewBox:"0 0 100 100",style:{zIndex:12},children:[t.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"hsl(var(--ceramic-deep))",strokeWidth:"2",opacity:"0.3"}),e>0&&t.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"hsl(var(--primary))",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:h,strokeDashoffset:p,className:"transition-all duration-1000 ease-out",style:{filter:r?"drop-shadow(0 0 6px hsl(var(--primary) / 0.4))":"none"}})]}),t.jsx("div",{className:K("absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-1000",u==="motivator-focused"?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:13},children:t.jsxs("div",{className:"text-center space-y-1",children:[t.jsx("div",{className:K("text-sm font-medium transition-colors duration-300",r?"text-primary":"text-muted-foreground"),children:r&&i?`${Math.round(c||0)}h goal`:r?"Fasting":"Ready to Fast"}),t.jsx("div",{className:K("font-mono font-bold tracking-wide transition-colors duration-300","text-4xl",r?"text-warm-text":"text-muted-foreground"),style:{textShadow:"0 2px 4px rgba(0,0,0,0.1)",fontFeatureSettings:'"tnum" 1',lineHeight:"1.1",transform:"translateY(-4px)"},children:s}),r&&i==="longterm"&&c&&t.jsxs("div",{className:"text-xs text-muted-foreground font-medium",children:[Math.round(c),"h goal"]}),r&&e>0&&t.jsxs("div",{className:"text-xs text-primary/70 font-medium",children:[Math.max(1,Math.round(e)),"% fasted"]}),r&&t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mx-auto mt-2"})]})})]}),t.jsx("div",{className:"absolute inset-1 rounded-full pointer-events-none",style:{zIndex:5,background:"conic-gradient(from 45deg, transparent 0deg, hsl(0 0% 100% / 0.1) 90deg, transparent 180deg, hsl(0 0% 100% / 0.05) 270deg, transparent 360deg)"}}),t.jsx("div",{className:"absolute rounded-full pointer-events-none",style:{top:"12%",left:"12%",right:"12%",bottom:"12%",zIndex:5,background:"radial-gradient(circle, transparent 60%, hsl(var(--ceramic-shadow) / 0.2) 65%, transparent 70%)"}}),r&&n&&o&&t.jsx("button",{onClick:o,className:"absolute bottom-16 right-4 w-8 h-8 rounded-full bg-ceramic-base/80 hover:bg-ceramic-base border border-ceramic-rim flex items-center justify-center text-xs text-muted-foreground hover:text-warm-text transition-all duration-200 backdrop-blur-sm z-10",title:n==="up"?"Switch to Countdown":"Switch to Count Up",children:n==="up"?"":""}),f&&t.jsx(B0,{isActive:f.isActive,animationType:f.type,onAnimationEnd:f.onAnimationEnd})]})})};function ia(e){const s=l.useRef({value:e,previous:e});return l.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}var G0=[" ","Enter","ArrowUp","ArrowDown"],V0=[" ","Enter"],la="Select",[wn,bn,H0]=en(la),[br,Y2]=jt(la,[H0,pr]),jn=pr(),[Q0,Ts]=br(la),[K0,Y0]=br(la),Fu=e=>{const{__scopeSelect:s,children:r,open:a,defaultOpen:n,onOpenChange:o,value:i,defaultValue:c,onValueChange:d,dir:f,name:u,autoComplete:m,disabled:h,required:p,form:x}=e,g=jn(s),[v,w]=l.useState(null),[y,b]=l.useState(null),[j,N]=l.useState(!1),C=zs(f),[_=!1,k]=Lt({prop:a,defaultProp:n,onChange:o}),[S,E]=Lt({prop:i,defaultProp:c,onChange:d}),A=l.useRef(null),I=v?x||!!v.closest("form"):!0,[z,W]=l.useState(new Set),Y=Array.from(z).map(G=>G.props.value).join(";");return t.jsx(yi,{...g,children:t.jsxs(Q0,{required:p,scope:s,trigger:v,onTriggerChange:w,valueNode:y,onValueNodeChange:b,valueNodeHasChildren:j,onValueNodeHasChildrenChange:N,contentId:ts(),value:S,onValueChange:E,open:_,onOpenChange:k,dir:C,triggerPointerDownPosRef:A,disabled:h,children:[t.jsx(wn.Provider,{scope:s,children:t.jsx(K0,{scope:e.__scopeSelect,onNativeOptionAdd:l.useCallback(G=>{W(te=>new Set(te).add(G))},[]),onNativeOptionRemove:l.useCallback(G=>{W(te=>{const $=new Set(te);return $.delete(G),$})},[]),children:r})}),I?t.jsxs(im,{"aria-hidden":!0,required:p,tabIndex:-1,name:u,autoComplete:m,value:S,onChange:G=>E(G.target.value),disabled:h,form:x,children:[S===void 0?t.jsx("option",{value:""}):null,Array.from(z)]},Y):null]})})};Fu.displayName=la;var Ou="SelectTrigger",Lu=l.forwardRef((e,s)=>{const{__scopeSelect:r,disabled:a=!1,...n}=e,o=jn(r),i=Ts(Ou,r),c=i.disabled||a,d=we(s,i.onTriggerChange),f=bn(r),u=l.useRef("touch"),[m,h,p]=lm(g=>{const v=f().filter(b=>!b.disabled),w=v.find(b=>b.value===i.value),y=cm(v,g,w);y!==void 0&&i.onValueChange(y.value)}),x=g=>{c||(i.onOpenChange(!0),p()),g&&(i.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return t.jsx(wi,{asChild:!0,...o,children:t.jsx(pe.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":om(i.value)?"":void 0,...n,ref:d,onClick:re(n.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&x(g)}),onPointerDown:re(n.onPointerDown,g=>{u.current=g.pointerType;const v=g.target;v.hasPointerCapture(g.pointerId)&&v.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(x(g),g.preventDefault())}),onKeyDown:re(n.onKeyDown,g=>{const v=m.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&h(g.key),!(v&&g.key===" ")&&G0.includes(g.key)&&(x(),g.preventDefault())})})})});Lu.displayName=Ou;var $u="SelectValue",Uu=l.forwardRef((e,s)=>{const{__scopeSelect:r,className:a,style:n,children:o,placeholder:i="",...c}=e,d=Ts($u,r),{onValueNodeHasChildrenChange:f}=d,u=o!==void 0,m=we(s,d.onValueNodeChange);return wt(()=>{f(u)},[f,u]),t.jsx(pe.span,{...c,ref:m,style:{pointerEvents:"none"},children:om(d.value)?t.jsx(t.Fragment,{children:i}):o})});Uu.displayName=$u;var X0="SelectIcon",zu=l.forwardRef((e,s)=>{const{__scopeSelect:r,children:a,...n}=e;return t.jsx(pe.span,{"aria-hidden":!0,...n,ref:s,children:a||""})});zu.displayName=X0;var J0="SelectPortal",qu=e=>t.jsx(qc,{asChild:!0,...e});qu.displayName=J0;var $s="SelectContent",Bu=l.forwardRef((e,s)=>{const r=Ts($s,e.__scopeSelect),[a,n]=l.useState();if(wt(()=>{n(new DocumentFragment)},[]),!r.open){const o=a;return o?tn.createPortal(t.jsx(Wu,{scope:e.__scopeSelect,children:t.jsx(wn.Slot,{scope:e.__scopeSelect,children:t.jsx("div",{children:e.children})})}),o):null}return t.jsx(Gu,{...e,ref:s})});Bu.displayName=$s;var It=10,[Wu,Ms]=br($s),Z0="SelectContentImpl",Gu=l.forwardRef((e,s)=>{const{__scopeSelect:r,position:a="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:o,onPointerDownOutside:i,side:c,sideOffset:d,align:f,alignOffset:u,arrowPadding:m,collisionBoundary:h,collisionPadding:p,sticky:x,hideWhenDetached:g,avoidCollisions:v,...w}=e,y=Ts($s,r),[b,j]=l.useState(null),[N,C]=l.useState(null),_=we(s,L=>j(L)),[k,S]=l.useState(null),[E,A]=l.useState(null),I=bn(r),[z,W]=l.useState(!1),Y=l.useRef(!1);l.useEffect(()=>{if(b)return Lc(b)},[b]),$c();const G=l.useCallback(L=>{const[se,...J]=I().map(me=>me.ref.current),[ne]=J.slice(-1),H=document.activeElement;for(const me of L)if(me===H||(me?.scrollIntoView({block:"nearest"}),me===se&&N&&(N.scrollTop=0),me===ne&&N&&(N.scrollTop=N.scrollHeight),me?.focus(),document.activeElement!==H))return},[I,N]),te=l.useCallback(()=>G([k,b]),[G,k,b]);l.useEffect(()=>{z&&te()},[z,te]);const{onOpenChange:$,triggerPointerDownPosRef:q}=y;l.useEffect(()=>{if(b){let L={x:0,y:0};const se=ne=>{L={x:Math.abs(Math.round(ne.pageX)-(q.current?.x??0)),y:Math.abs(Math.round(ne.pageY)-(q.current?.y??0))}},J=ne=>{L.x<=10&&L.y<=10?ne.preventDefault():b.contains(ne.target)||$(!1),document.removeEventListener("pointermove",se),q.current=null};return q.current!==null&&(document.addEventListener("pointermove",se),document.addEventListener("pointerup",J,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",se),document.removeEventListener("pointerup",J,{capture:!0})}}},[b,$,q]),l.useEffect(()=>{const L=()=>$(!1);return window.addEventListener("blur",L),window.addEventListener("resize",L),()=>{window.removeEventListener("blur",L),window.removeEventListener("resize",L)}},[$]);const[de,Z]=lm(L=>{const se=I().filter(H=>!H.disabled),J=se.find(H=>H.ref.current===document.activeElement),ne=cm(se,L,J);ne&&setTimeout(()=>ne.ref.current.focus())}),F=l.useCallback((L,se,J)=>{const ne=!Y.current&&!J;(y.value!==void 0&&y.value===se||ne)&&(S(L),ne&&(Y.current=!0))},[y.value]),Q=l.useCallback(()=>b?.focus(),[b]),ae=l.useCallback((L,se,J)=>{const ne=!Y.current&&!J;(y.value!==void 0&&y.value===se||ne)&&A(L)},[y.value]),R=a==="popper"?Po:Vu,B=R===Po?{side:c,sideOffset:d,align:f,alignOffset:u,arrowPadding:m,collisionBoundary:h,collisionPadding:p,sticky:x,hideWhenDetached:g,avoidCollisions:v}:{};return t.jsx(Wu,{scope:r,content:b,viewport:N,onViewportChange:C,itemRefCallback:F,selectedItem:k,onItemLeave:Q,itemTextRefCallback:ae,focusSelectedItem:te,selectedItemText:E,position:a,isPositioned:z,searchRef:de,children:t.jsx(Uc,{as:ti,allowPinchZoom:!0,children:t.jsx(zc,{asChild:!0,trapped:y.open,onMountAutoFocus:L=>{L.preventDefault()},onUnmountAutoFocus:re(n,L=>{y.trigger?.focus({preventScroll:!0}),L.preventDefault()}),children:t.jsx(ei,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:L=>L.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:t.jsx(R,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:L=>L.preventDefault(),...w,...B,onPlaced:()=>W(!0),ref:_,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:re(w.onKeyDown,L=>{const se=L.ctrlKey||L.altKey||L.metaKey;if(L.key==="Tab"&&L.preventDefault(),!se&&L.key.length===1&&Z(L.key),["ArrowUp","ArrowDown","Home","End"].includes(L.key)){let ne=I().filter(H=>!H.disabled).map(H=>H.ref.current);if(["ArrowUp","End"].includes(L.key)&&(ne=ne.slice().reverse()),["ArrowUp","ArrowDown"].includes(L.key)){const H=L.target,me=ne.indexOf(H);ne=ne.slice(me+1)}setTimeout(()=>G(ne)),L.preventDefault()}})})})})})})});Gu.displayName=Z0;var ej="SelectItemAlignedPosition",Vu=l.forwardRef((e,s)=>{const{__scopeSelect:r,onPlaced:a,...n}=e,o=Ts($s,r),i=Ms($s,r),[c,d]=l.useState(null),[f,u]=l.useState(null),m=we(s,_=>u(_)),h=bn(r),p=l.useRef(!1),x=l.useRef(!0),{viewport:g,selectedItem:v,selectedItemText:w,focusSelectedItem:y}=i,b=l.useCallback(()=>{if(o.trigger&&o.valueNode&&c&&f&&g&&v&&w){const _=o.trigger.getBoundingClientRect(),k=f.getBoundingClientRect(),S=o.valueNode.getBoundingClientRect(),E=w.getBoundingClientRect();if(o.dir!=="rtl"){const H=E.left-k.left,me=S.left-H,le=_.left-me,be=_.width+le,ke=Math.max(be,k.width),Te=window.innerWidth-It,ct=Xr(me,[It,Math.max(It,Te-ke)]);c.style.minWidth=be+"px",c.style.left=ct+"px"}else{const H=k.right-E.right,me=window.innerWidth-S.right-H,le=window.innerWidth-_.right-me,be=_.width+le,ke=Math.max(be,k.width),Te=window.innerWidth-It,ct=Xr(me,[It,Math.max(It,Te-ke)]);c.style.minWidth=be+"px",c.style.right=ct+"px"}const A=h(),I=window.innerHeight-It*2,z=g.scrollHeight,W=window.getComputedStyle(f),Y=parseInt(W.borderTopWidth,10),G=parseInt(W.paddingTop,10),te=parseInt(W.borderBottomWidth,10),$=parseInt(W.paddingBottom,10),q=Y+G+z+$+te,de=Math.min(v.offsetHeight*5,q),Z=window.getComputedStyle(g),F=parseInt(Z.paddingTop,10),Q=parseInt(Z.paddingBottom,10),ae=_.top+_.height/2-It,R=I-ae,B=v.offsetHeight/2,L=v.offsetTop+B,se=Y+G+L,J=q-se;if(se<=ae){const H=A.length>0&&v===A[A.length-1].ref.current;c.style.bottom="0px";const me=f.clientHeight-g.offsetTop-g.offsetHeight,le=Math.max(R,B+(H?Q:0)+me+te),be=se+le;c.style.height=be+"px"}else{const H=A.length>0&&v===A[0].ref.current;c.style.top="0px";const le=Math.max(ae,Y+g.offsetTop+(H?F:0)+B)+J;c.style.height=le+"px",g.scrollTop=se-ae+g.offsetTop}c.style.margin=`${It}px 0`,c.style.minHeight=de+"px",c.style.maxHeight=I+"px",a?.(),requestAnimationFrame(()=>p.current=!0)}},[h,o.trigger,o.valueNode,c,f,g,v,w,o.dir,a]);wt(()=>b(),[b]);const[j,N]=l.useState();wt(()=>{f&&N(window.getComputedStyle(f).zIndex)},[f]);const C=l.useCallback(_=>{_&&x.current===!0&&(b(),y?.(),x.current=!1)},[b,y]);return t.jsx(sj,{scope:r,contentWrapper:c,shouldExpandOnScrollRef:p,onScrollButtonChange:C,children:t.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:t.jsx(pe.div,{...n,ref:m,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});Vu.displayName=ej;var tj="SelectPopperPosition",Po=l.forwardRef((e,s)=>{const{__scopeSelect:r,align:a="start",collisionPadding:n=It,...o}=e,i=jn(r);return t.jsx(bi,{...i,...o,ref:s,align:a,collisionPadding:n,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Po.displayName=tj;var[sj,Ui]=br($s,{}),Do="SelectViewport",Hu=l.forwardRef((e,s)=>{const{__scopeSelect:r,nonce:a,...n}=e,o=Ms(Do,r),i=Ui(Do,r),c=we(s,o.onViewportChange),d=l.useRef(0);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),t.jsx(wn.Slot,{scope:r,children:t.jsx(pe.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:re(n.onScroll,f=>{const u=f.currentTarget,{contentWrapper:m,shouldExpandOnScrollRef:h}=i;if(h?.current&&m){const p=Math.abs(d.current-u.scrollTop);if(p>0){const x=window.innerHeight-It*2,g=parseFloat(m.style.minHeight),v=parseFloat(m.style.height),w=Math.max(g,v);if(w<x){const y=w+p,b=Math.min(x,y),j=y-b;m.style.height=b+"px",m.style.bottom==="0px"&&(u.scrollTop=j>0?j:0,m.style.justifyContent="flex-end")}}}d.current=u.scrollTop})})})]})});Hu.displayName=Do;var Qu="SelectGroup",[rj,aj]=br(Qu),nj=l.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=ts();return t.jsx(rj,{scope:r,id:n,children:t.jsx(pe.div,{role:"group","aria-labelledby":n,...a,ref:s})})});nj.displayName=Qu;var Ku="SelectLabel",Yu=l.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=aj(Ku,r);return t.jsx(pe.div,{id:n.id,...a,ref:s})});Yu.displayName=Ku;var Wa="SelectItem",[oj,Xu]=br(Wa),Ju=l.forwardRef((e,s)=>{const{__scopeSelect:r,value:a,disabled:n=!1,textValue:o,...i}=e,c=Ts(Wa,r),d=Ms(Wa,r),f=c.value===a,[u,m]=l.useState(o??""),[h,p]=l.useState(!1),x=we(s,y=>d.itemRefCallback?.(y,a,n)),g=ts(),v=l.useRef("touch"),w=()=>{n||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return t.jsx(oj,{scope:r,value:a,disabled:n,textId:g,isSelected:f,onItemTextChange:l.useCallback(y=>{m(b=>b||(y?.textContent??"").trim())},[]),children:t.jsx(wn.ItemSlot,{scope:r,value:a,disabled:n,textValue:u,children:t.jsx(pe.div,{role:"option","aria-labelledby":g,"data-highlighted":h?"":void 0,"aria-selected":f&&h,"data-state":f?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...i,ref:x,onFocus:re(i.onFocus,()=>p(!0)),onBlur:re(i.onBlur,()=>p(!1)),onClick:re(i.onClick,()=>{v.current!=="mouse"&&w()}),onPointerUp:re(i.onPointerUp,()=>{v.current==="mouse"&&w()}),onPointerDown:re(i.onPointerDown,y=>{v.current=y.pointerType}),onPointerMove:re(i.onPointerMove,y=>{v.current=y.pointerType,n?d.onItemLeave?.():v.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:re(i.onPointerLeave,y=>{y.currentTarget===document.activeElement&&d.onItemLeave?.()}),onKeyDown:re(i.onKeyDown,y=>{d.searchRef?.current!==""&&y.key===" "||(V0.includes(y.key)&&w(),y.key===" "&&y.preventDefault())})})})})});Ju.displayName=Wa;var Lr="SelectItemText",Zu=l.forwardRef((e,s)=>{const{__scopeSelect:r,className:a,style:n,...o}=e,i=Ts(Lr,r),c=Ms(Lr,r),d=Xu(Lr,r),f=Y0(Lr,r),[u,m]=l.useState(null),h=we(s,w=>m(w),d.onItemTextChange,w=>c.itemTextRefCallback?.(w,d.value,d.disabled)),p=u?.textContent,x=l.useMemo(()=>t.jsx("option",{value:d.value,disabled:d.disabled,children:p},d.value),[d.disabled,d.value,p]),{onNativeOptionAdd:g,onNativeOptionRemove:v}=f;return wt(()=>(g(x),()=>v(x)),[g,v,x]),t.jsxs(t.Fragment,{children:[t.jsx(pe.span,{id:d.textId,...o,ref:h}),d.isSelected&&i.valueNode&&!i.valueNodeHasChildren?tn.createPortal(o.children,i.valueNode):null]})});Zu.displayName=Lr;var em="SelectItemIndicator",tm=l.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e;return Xu(em,r).isSelected?t.jsx(pe.span,{"aria-hidden":!0,...a,ref:s}):null});tm.displayName=em;var Ao="SelectScrollUpButton",sm=l.forwardRef((e,s)=>{const r=Ms(Ao,e.__scopeSelect),a=Ui(Ao,e.__scopeSelect),[n,o]=l.useState(!1),i=we(s,a.onScrollButtonChange);return wt(()=>{if(r.viewport&&r.isPositioned){let c=function(){const f=d.scrollTop>0;o(f)};const d=r.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),n?t.jsx(am,{...e,ref:i,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=r;c&&d&&(c.scrollTop=c.scrollTop-d.offsetHeight)}}):null});sm.displayName=Ao;var Ro="SelectScrollDownButton",rm=l.forwardRef((e,s)=>{const r=Ms(Ro,e.__scopeSelect),a=Ui(Ro,e.__scopeSelect),[n,o]=l.useState(!1),i=we(s,a.onScrollButtonChange);return wt(()=>{if(r.viewport&&r.isPositioned){let c=function(){const f=d.scrollHeight-d.clientHeight,u=Math.ceil(d.scrollTop)<f;o(u)};const d=r.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),n?t.jsx(am,{...e,ref:i,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=r;c&&d&&(c.scrollTop=c.scrollTop+d.offsetHeight)}}):null});rm.displayName=Ro;var am=l.forwardRef((e,s)=>{const{__scopeSelect:r,onAutoScroll:a,...n}=e,o=Ms("SelectScrollButton",r),i=l.useRef(null),c=bn(r),d=l.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return l.useEffect(()=>()=>d(),[d]),wt(()=>{c().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),t.jsx(pe.div,{"aria-hidden":!0,...n,ref:s,style:{flexShrink:0,...n.style},onPointerDown:re(n.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(a,50))}),onPointerMove:re(n.onPointerMove,()=>{o.onItemLeave?.(),i.current===null&&(i.current=window.setInterval(a,50))}),onPointerLeave:re(n.onPointerLeave,()=>{d()})})}),ij="SelectSeparator",nm=l.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e;return t.jsx(pe.div,{"aria-hidden":!0,...a,ref:s})});nm.displayName=ij;var Io="SelectArrow",lj=l.forwardRef((e,s)=>{const{__scopeSelect:r,...a}=e,n=jn(r),o=Ts(Io,r),i=Ms(Io,r);return o.open&&i.position==="popper"?t.jsx(ji,{...n,...a,ref:s}):null});lj.displayName=Io;function om(e){return e===""||e===void 0}var im=l.forwardRef((e,s)=>{const{value:r,...a}=e,n=l.useRef(null),o=we(s,n),i=ia(r);return l.useEffect(()=>{const c=n.current,d=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(d,"value").set;if(i!==r&&u){const m=new Event("change",{bubbles:!0});u.call(c,r),c.dispatchEvent(m)}},[i,r]),t.jsx(Ip,{asChild:!0,children:t.jsx("select",{...a,ref:o,defaultValue:r})})});im.displayName="BubbleSelect";function lm(e){const s=Et(e),r=l.useRef(""),a=l.useRef(0),n=l.useCallback(i=>{const c=r.current+i;s(c),function d(f){r.current=f,window.clearTimeout(a.current),f!==""&&(a.current=window.setTimeout(()=>d(""),1e3))}(c)},[s]),o=l.useCallback(()=>{r.current="",window.clearTimeout(a.current)},[]);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),[r,n,o]}function cm(e,s,r){const n=s.length>1&&Array.from(s).every(f=>f===s[0])?s[0]:s,o=r?e.indexOf(r):-1;let i=cj(e,Math.max(o,0));n.length===1&&(i=i.filter(f=>f!==r));const d=i.find(f=>f.textValue.toLowerCase().startsWith(n.toLowerCase()));return d!==r?d:void 0}function cj(e,s){return e.map((r,a)=>e[(s+a)%e.length])}var dj=Fu,dm=Lu,uj=Uu,mj=zu,hj=qu,um=Bu,fj=Hu,mm=Yu,hm=Ju,pj=Zu,gj=tm,fm=sm,pm=rm,gm=nm;const Vt=dj,Ht=uj,Ft=l.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(dm,{ref:a,className:K("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[s,t.jsx(mj,{asChild:!0,children:t.jsx(bt,{className:"h-4 w-4 opacity-50"})})]}));Ft.displayName=dm.displayName;const xm=l.forwardRef(({className:e,...s},r)=>t.jsx(fm,{ref:r,className:K("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(ci,{className:"h-4 w-4"})}));xm.displayName=fm.displayName;const vm=l.forwardRef(({className:e,...s},r)=>t.jsx(pm,{ref:r,className:K("flex cursor-default items-center justify-center py-1",e),...s,children:t.jsx(bt,{className:"h-4 w-4"})}));vm.displayName=pm.displayName;const Ot=l.forwardRef(({className:e,children:s,position:r="popper",...a},n)=>t.jsx(hj,{children:t.jsxs(um,{ref:n,className:K("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[t.jsx(xm,{}),t.jsx(fj,{className:K("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),t.jsx(vm,{})]})}));Ot.displayName=um.displayName;const xj=l.forwardRef(({className:e,...s},r)=>t.jsx(mm,{ref:r,className:K("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s}));xj.displayName=mm.displayName;const Ue=l.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(hm,{ref:a,className:K("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(gj,{children:t.jsx(dr,{className:"h-4 w-4"})})}),t.jsx(pj,{children:s})]}));Ue.displayName=hm.displayName;const vj=l.forwardRef(({className:e,...s},r)=>t.jsx(gm,{ref:r,className:K("-mx-1 my-1 h-px bg-muted",e),...s}));vj.displayName=gm.displayName;const Kn=768;function zi(){const[e,s]=l.useState(void 0);return l.useEffect(()=>{const r=window.matchMedia(`(max-width: ${Kn-1}px)`),a=()=>{s(window.innerWidth<Kn)};return r.addEventListener("change",a),s(window.innerWidth<Kn),()=>r.removeEventListener("change",a)},[]),!!e}const Ze=({children:e,content:s,className:r=""})=>{const[a,n]=l.useState(!1),[o,i]=l.useState(!1),[c,d]=l.useState(!1),f=zi(),u=l.useRef(null),m=l.useRef(null),h=()=>{if(!m.current)return;const v=m.current.getBoundingClientRect(),w=v.top,y=window.innerWidth-v.right;i(w<120),d(y<180)},p=v=>{v.preventDefault(),v.stopPropagation(),f&&(n(!a),a||h())},x=()=>{f||(n(!0),h())},g=()=>{f||n(!1)};return l.useEffect(()=>{const v=w=>{f&&a&&u.current&&m.current&&!u.current.contains(w.target)&&!m.current.contains(w.target)&&n(!1)};if(f&&a)return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[f,a]),t.jsxs("div",{className:"relative inline-block",children:[t.jsx("div",{ref:m,className:K("cursor-pointer transition-colors duration-200",f&&"active:bg-accent/20 rounded-md p-1 -m-1",r),onClick:p,onMouseEnter:x,onMouseLeave:g,children:e}),a&&t.jsxs(t.Fragment,{children:[f&&t.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:()=>n(!1)}),t.jsxs("div",{ref:u,className:K("absolute z-50 px-3 py-2 text-sm text-popover-foreground bg-popover border border-border rounded-md shadow-lg","w-[180px] max-w-[calc(100vw-32px)] text-left leading-relaxed","animate-in fade-in-0 zoom-in-95 duration-200",o?c?"top-full left-0 mt-2":"top-full right-0 mt-2":c?"bottom-full left-0 mb-2":"bottom-full right-0 mb-2"),children:[s,t.jsx("div",{className:K("absolute",c?"left-4":"right-4",o?"top-0 -mt-1 w-2 h-2 bg-popover border-l border-t border-border rotate-45":"bottom-0 -mb-1 w-2 h-2 bg-popover border-r border-b border-border rotate-45")})]})]})]})},Ps=()=>{const{user:e}=ve(),{data:s,isLoading:r}=ut({queryKey:["userRole",e?.id],queryFn:async()=>{if(!e?.id)return{isAdmin:!1};const{data:n,error:o}=await T.from("user_roles").select("role").eq("user_id",e.id).eq("role","admin").single();return o&&o.code!=="PGRST116"?(console.error("Error checking admin role:",o),{isAdmin:!1}):{isAdmin:!!n}},enabled:!!e?.id,staleTime:5*60*1e3});return{isAdmin:s?.isAdmin||!1,loading:r}},jr=l.forwardRef(({className:e,...s},r)=>t.jsx("textarea",{className:K("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...s}));jr.displayName="Textarea";const yj=({contentKey:e,content:s,size:r="md",className:a})=>{const[n,o]=l.useState(!1),[i,c]=l.useState("top"),[d,f]=l.useState(!1),[u,m]=l.useState(!1),[h,p]=l.useState(s),[x,g]=l.useState(s),[v,w]=l.useState(!1),[y,b]=l.useState({image:"/lovable-uploads/default-author.png",name:"Admin",title:"Personal Insight"}),j=zi(),{isAdmin:N,loading:C}=Ps(),{toast:_}=he(),k=l.useRef(null),S=l.useRef(null);l.useEffect(()=>{(async()=>{try{const{data:q}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["author_tooltip_image","author_tooltip_name","author_tooltip_title"]);if(q){const de=q.reduce((Z,F)=>(Z[F.setting_key]=F.setting_value,Z),{});b({image:de.author_tooltip_image||"/lovable-uploads/default-author.png",name:de.author_tooltip_name||"Admin",title:de.author_tooltip_title||"Personal Insight"})}if(e){const{data:de}=await T.from("tooltip_content").select("content").eq("content_key",e).maybeSingle();de&&(g(de.content),p(de.content))}}catch(q){console.error("Failed to load author data:",q)}})()},[e]);const E=()=>{if(!S.current||!k.current)return;const $=S.current.getBoundingClientRect(),q=280,de=160,Z=$.top;window.innerHeight-$.bottom;const F=window.innerWidth-$.right;$.left,c(Z>=de?"top":"bottom"),f(F<q)},A=$=>{$.preventDefault(),$.stopPropagation(),j&&(o(!n),n||E())},I=()=>{j||(o(!0),E())},z=$=>{if(!j){const q=$.relatedTarget;if(k.current&&q&&k.current.contains(q))return;o(!1)}},W=$=>{if(!j){const q=$.relatedTarget;if(S.current&&q&&S.current.contains(q))return;o(!1)}};l.useEffect(()=>{const $=q=>{j&&n&&k.current&&S.current&&!k.current.contains(q.target)&&!S.current.contains(q.target)&&o(!1)};if(j&&n)return document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[j,n]);const Y=()=>{u&&p(x),m(!u)},G=async()=>{if(!(!e||!N)){w(!0);try{await T.from("tooltip_content").upsert({content_key:e,content:h},{onConflict:"content_key"}),g(h),m(!1),_({title:"Content saved",description:"Tooltip content has been updated successfully."})}catch($){console.error("Error saving content:",$),_({title:"Save failed",description:"Failed to save content. Please try again.",variant:"destructive"})}finally{w(!1)}}},te={sm:"w-10 h-10",md:"w-12 h-12",lg:"w-14 h-14"};return t.jsxs("div",{className:"relative inline-block",children:[t.jsxs("div",{ref:S,className:K("relative cursor-pointer transition-all duration-500 group","border-2 border-[#dac471] bg-gradient-to-br from-[#dac471]/20 to-[#dac471]/10","author-tooltip-bubble shadow-lg hover:shadow-xl","animate-elegant-pulse hover:animate-border-pulse",te[r],j&&"active:scale-95",a),onClick:A,onMouseEnter:I,onMouseLeave:z,style:{borderRadius:"50% 50% 50% 10%"},children:[t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",style:{background:"radial-gradient(circle, #dac471 0%, rgba(218, 196, 113, 0.4) 50%, transparent 70%)",borderRadius:"50% 50% 50% 10%",filter:"blur(8px)",transform:"scale(1.2)"}}),t.jsx("img",{src:y.image,alt:y.name,className:K("w-full h-full object-cover transition-all duration-300","filter grayscale group-hover:grayscale-0 group-hover:scale-110"),style:{borderRadius:"50% 50% 50% 10%"}})]}),n&&t.jsxs(t.Fragment,{children:[j&&t.jsx("div",{className:"fixed inset-0 z-40 bg-transparent",onClick:()=>o(!1)}),t.jsxs("div",{ref:k,onMouseLeave:W,className:K("absolute z-50 px-4 py-3 bg-popover border border-border rounded-lg shadow-xl","w-[320px] max-w-[calc(100vw-32px)] text-left","animate-fade-in",i==="bottom"?"top-full left-0 mt-3":"bottom-full left-0 mb-3"),children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("img",{src:y.image,alt:y.name,className:"w-8 h-8 rounded-full object-cover"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm text-foreground",children:y.name}),t.jsx("div",{className:"text-xs text-muted-foreground",children:y.title})]})]}),u?t.jsxs("div",{className:"space-y-3",children:[t.jsx(jr,{value:h,onChange:$=>p($.target.value),className:"text-sm leading-relaxed min-h-[80px] resize-none",placeholder:"Enter tooltip content..."}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsxs(D,{size:"sm",variant:"outline",onClick:Y,disabled:v,children:[t.jsx(Pe,{className:"w-3 h-3 mr-1"}),"Cancel"]}),t.jsxs(D,{size:"sm",onClick:G,disabled:v||h.trim()==="",children:[t.jsx(Mt,{className:"w-3 h-3 mr-1"}),v?"Saving...":"Save"]})]})]}):t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-popover-foreground leading-relaxed mb-2",children:x}),N&&!C&&e&&t.jsxs(D,{size:"sm",variant:"ghost",onClick:Y,className:"text-xs h-6 px-2 hover:bg-muted",children:[t.jsx(mt,{className:"w-3 h-3 mr-1"}),"Edit"]})]}),t.jsx("div",{className:K("absolute w-3 h-3 bg-popover border-border rotate-45","left-6",i==="bottom"?"top-0 -mt-1.5 border-l border-t":"bottom-0 -mb-1.5 border-r border-b")})]})]})]})},ym=l.createContext(void 0),wm=()=>{const e=l.useContext(ym);if(!e)throw new Error("useAnimationControl must be used within AnimationProvider");return e},wj=({children:e})=>{const[s,r]=l.useState(!1),a=()=>{r(!0);const o=document.createElement("style");o.id="suspend-animations",o.textContent=`
      .modal-root * {
        animation-duration: 0.2s;
        transition-duration: 0.2s;
      }
      .modal-root {
        transform: translate3d(0, 0, 0);
        will-change: transform;
        backface-visibility: hidden;
      }
    `,document.head.appendChild(o)},n=()=>{r(!1);const o=document.getElementById("suspend-animations");o&&o.remove()};return t.jsx(ym.Provider,{value:{isAnimationsSuspended:s,suspendAnimations:a,resumeAnimations:n},children:e})},bj=({displayTime:e,isActive:s,isPaused:r=!1,onStart:a,onPause:n,onResume:o,onStop:i,onCancel:c,className:d="",showSlideshow:f=!1,realTimeStats:u,units:m="imperial",selectedSpeed:h,onSpeedChange:p})=>{const[x,g]=l.useState("timer-focused"),{isAnimationsSuspended:v}=wm(),{toast:w}=he(),y=l.useMemo(()=>[{displaySpeed:"normal",storageSpeed:3.1,label:"Normal",description:"Sustainable pace, light-moderate cardio"},{displaySpeed:"fast",storageSpeed:4.3,label:"Fast",description:"Intense pace, higher calorie burn"}],[]),b=l.useCallback(C=>y.find(_=>Math.abs(_.storageSpeed-C)<.2)||y[0],[y]),j=l.useCallback(C=>{const _=y.find(k=>k.displaySpeed===C);_&&p(_.storageSpeed)},[y,p]),N=b(h);return t.jsx(gr,{children:t.jsxs("div",{className:`relative ${d}`,children:[t.jsxs("div",{className:"w-full space-y-4",children:[t.jsxs(oe,{className:"p-6 text-center relative overflow-hidden",children:[f&&s&&!r&&t.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:t.jsx(Iu,{isActive:f&&s&&!r,onModeChange:g,className:"rounded-lg"})}),t.jsxs("div",{className:K("mb-4 transition-opacity duration-1000 relative flex flex-col justify-center items-center",x==="motivator-focused"?"opacity-0 pointer-events-none":"opacity-100"),style:{zIndex:13},children:[t.jsx("div",{className:"text-5xl font-mono font-bold text-warm-text mb-2 tracking-wide",style:{fontFeatureSettings:'"tnum" 1',textShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:e}),t.jsx("div",{className:K("text-lg font-medium transition-colors duration-300",s&&!r?"text-primary":r?"text-primary/70":"text-muted-foreground"),children:r?"Paused":s?"Walking":"Ready to Walk"}),s&&u&&t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 text-sm text-muted-foreground",children:[t.jsx(Kt,{className:"w-4 h-4"}),t.jsxs("span",{children:["Started ",new Date(u.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]}),s&&t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsxs("div",{className:"flex gap-2 flex-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{onClick:async()=>{try{const C=r?await o?.():await n?.();C&&"error"in C&&C.error&&w({title:"Error",description:C.error.message||`Failed to ${r?"resume":"pause"} session`,variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-secondary",className:"flex-1",children:r?t.jsx(Ea,{className:"w-6 h-6"}):t.jsx(rd,{className:"w-6 h-6"})})}),t.jsx(Me,{children:t.jsx("p",{children:r?"Resume":"Pause"})})]}),c&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{onClick:async()=>{try{const C=await c?.();C&&"error"in C&&C.error&&w({title:"Error",description:C.error.message||"Failed to cancel session",variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-secondary",className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground",children:t.jsx(Pe,{className:"w-6 h-6"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Cancel"})})]})]}),t.jsx("div",{className:"flex-1",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsxs(D,{onClick:async()=>{try{const C=await i();C&&"error"in C&&C.error&&w({title:"Error",description:C.error.message||"Failed to stop session",variant:"destructive"})}catch{w({title:"Error",description:"Network error. Please try again.",variant:"destructive"})}},variant:"action-primary",size:"action-main",className:"w-full",children:[t.jsx(Zc,{className:"w-5 h-5 mr-2"}),"Finish"]})}),t.jsx(Me,{children:t.jsx("p",{children:"Complete"})})]})})]}),u&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(oe,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ta,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Speed"}),t.jsx(Ze,{content:"Normal walking: 3 mph (5 km/h) - Default. Brisk walking: 4+ mph (6+ km/h). Adjust during your walk if needed.",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsx("div",{className:"flex items-center justify-start",children:t.jsxs(Vt,{value:N.displaySpeed,onValueChange:j,children:[t.jsx(Ft,{className:"h-7 w-24 text-sm bg-ceramic-base border-ceramic-rim",children:t.jsx(Ht,{})}),t.jsx(Ot,{className:"z-50 bg-ceramic-plate border-ceramic-rim backdrop-blur-sm",children:y.map(C=>t.jsx(Ue,{value:C.displaySpeed,className:"text-xs hover:bg-ceramic-base focus:bg-ceramic-base",children:C.label},C.displaySpeed))})]})})]}),t.jsxs(oe,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Br,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Distance"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xl font-bold text-primary",children:[u.distance,t.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:m==="metric"?"km":"mi"})]}),t.jsx(Ze,{content:"Distance is estimated based on your walking speed and elapsed time.",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(oe,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Br,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Calories"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xl font-bold text-primary",children:[u.calories,t.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"cal"})]}),t.jsx(Ze,{content:"Calories are estimated based on your profile data (weight, age, etc.) and walking intensity.",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]})]}),t.jsxs(oe,{className:"p-3 relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(nn,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Fat"})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${s&&!r&&!v?"bg-accent animate-pulse":s&&!r?"bg-accent":"bg-muted"}`})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xl font-bold text-primary",children:[(u.calories/9).toFixed(1),t.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"g"})]}),t.jsx(Ze,{content:"Fat burned is estimated based on calories (1g fat = 9 calories).",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]})]})]}),t.jsx("div",{className:"flex justify-start mt-3",children:t.jsx(yj,{contentKey:"walking_timer_health",content:"Walking regularly helps improve cardiovascular health, builds stronger bones, and can boost your mood through the release of endorphins. Even short walks make a meaningful difference!",size:"sm"})})]})]}),!s&&t.jsx("div",{className:"mt-8",children:t.jsxs(D,{onClick:a,variant:"action-primary",size:"start-button",className:"w-full",children:[t.jsx(Ea,{className:"w-8 h-8 mr-3"}),"Start Walking"]})})]})})},bm=l.memo(bj);var jj="Label",jm=l.forwardRef((e,s)=>t.jsx(pe.label,{...e,ref:s,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(e.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));jm.displayName=jj;var Nm=jm;const Nj=sn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),fe=l.forwardRef(({className:e,...s},r)=>t.jsx(Nm,{ref:r,className:K(Nj(),e),...s}));fe.displayName=Nm.displayName;var Sm=["PageUp","PageDown"],_m=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Cm={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Nr="Slider",[Fo,Sj,_j]=en(Nr),[km,X2]=jt(Nr,[_j]),[Cj,Nn]=km(Nr),Em=l.forwardRef((e,s)=>{const{name:r,min:a=0,max:n=100,step:o=1,orientation:i="horizontal",disabled:c=!1,minStepsBetweenThumbs:d=0,defaultValue:f=[a],value:u,onValueChange:m=()=>{},onValueCommit:h=()=>{},inverted:p=!1,form:x,...g}=e,v=l.useRef(new Set),w=l.useRef(0),b=i==="horizontal"?kj:Ej,[j=[],N]=Lt({prop:u,defaultProp:f,onChange:A=>{[...v.current][w.current]?.focus(),m(A)}}),C=l.useRef(j);function _(A){const I=Aj(j,A);E(A,I)}function k(A){E(A,w.current)}function S(){const A=C.current[w.current];j[w.current]!==A&&h(j)}function E(A,I,{commit:z}={commit:!1}){const W=Oj(o),Y=Lj(Math.round((A-a)/o)*o+a,W),G=Xr(Y,[a,n]);N((te=[])=>{const $=Pj(te,G,I);if(Fj($,d*o)){w.current=$.indexOf(G);const q=String($)!==String(te);return q&&z&&h($),q?$:te}else return te})}return t.jsx(Cj,{scope:e.__scopeSlider,name:r,disabled:c,min:a,max:n,valueIndexToChangeRef:w,thumbs:v.current,values:j,orientation:i,form:x,children:t.jsx(Fo.Provider,{scope:e.__scopeSlider,children:t.jsx(Fo.Slot,{scope:e.__scopeSlider,children:t.jsx(b,{"aria-disabled":c,"data-disabled":c?"":void 0,...g,ref:s,onPointerDown:re(g.onPointerDown,()=>{c||(C.current=j)}),min:a,max:n,inverted:p,onSlideStart:c?void 0:_,onSlideMove:c?void 0:k,onSlideEnd:c?void 0:S,onHomeKeyDown:()=>!c&&E(a,0,{commit:!0}),onEndKeyDown:()=>!c&&E(n,j.length-1,{commit:!0}),onStepKeyDown:({event:A,direction:I})=>{if(!c){const Y=Sm.includes(A.key)||A.shiftKey&&_m.includes(A.key)?10:1,G=w.current,te=j[G],$=o*Y*I;E(te+$,G,{commit:!0})}}})})})})});Em.displayName=Nr;var[Tm,Mm]=km(Nr,{startEdge:"left",endEdge:"right",size:"width",direction:1}),kj=l.forwardRef((e,s)=>{const{min:r,max:a,dir:n,inverted:o,onSlideStart:i,onSlideMove:c,onSlideEnd:d,onStepKeyDown:f,...u}=e,[m,h]=l.useState(null),p=we(s,b=>h(b)),x=l.useRef(),g=zs(n),v=g==="ltr",w=v&&!o||!v&&o;function y(b){const j=x.current||m.getBoundingClientRect(),N=[0,j.width],_=qi(N,w?[r,a]:[a,r]);return x.current=j,_(b-j.left)}return t.jsx(Tm,{scope:e.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width",children:t.jsx(Pm,{dir:g,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const j=y(b.clientX);i?.(j)},onSlideMove:b=>{const j=y(b.clientX);c?.(j)},onSlideEnd:()=>{x.current=void 0,d?.()},onStepKeyDown:b=>{const N=Cm[w?"from-left":"from-right"].includes(b.key);f?.({event:b,direction:N?-1:1})}})})}),Ej=l.forwardRef((e,s)=>{const{min:r,max:a,inverted:n,onSlideStart:o,onSlideMove:i,onSlideEnd:c,onStepKeyDown:d,...f}=e,u=l.useRef(null),m=we(s,u),h=l.useRef(),p=!n;function x(g){const v=h.current||u.current.getBoundingClientRect(),w=[0,v.height],b=qi(w,p?[a,r]:[r,a]);return h.current=v,b(g-v.top)}return t.jsx(Tm,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:t.jsx(Pm,{"data-orientation":"vertical",...f,ref:m,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:g=>{const v=x(g.clientY);o?.(v)},onSlideMove:g=>{const v=x(g.clientY);i?.(v)},onSlideEnd:()=>{h.current=void 0,c?.()},onStepKeyDown:g=>{const w=Cm[p?"from-bottom":"from-top"].includes(g.key);d?.({event:g,direction:w?-1:1})}})})}),Pm=l.forwardRef((e,s)=>{const{__scopeSlider:r,onSlideStart:a,onSlideMove:n,onSlideEnd:o,onHomeKeyDown:i,onEndKeyDown:c,onStepKeyDown:d,...f}=e,u=Nn(Nr,r);return t.jsx(pe.span,{...f,ref:s,onKeyDown:re(e.onKeyDown,m=>{m.key==="Home"?(i(m),m.preventDefault()):m.key==="End"?(c(m),m.preventDefault()):Sm.concat(_m).includes(m.key)&&(d(m),m.preventDefault())}),onPointerDown:re(e.onPointerDown,m=>{const h=m.target;h.setPointerCapture(m.pointerId),m.preventDefault(),u.thumbs.has(h)?h.focus():a(m)}),onPointerMove:re(e.onPointerMove,m=>{m.target.hasPointerCapture(m.pointerId)&&n(m)}),onPointerUp:re(e.onPointerUp,m=>{const h=m.target;h.hasPointerCapture(m.pointerId)&&(h.releasePointerCapture(m.pointerId),o(m))})})}),Dm="SliderTrack",Am=l.forwardRef((e,s)=>{const{__scopeSlider:r,...a}=e,n=Nn(Dm,r);return t.jsx(pe.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...a,ref:s})});Am.displayName=Dm;var Oo="SliderRange",Rm=l.forwardRef((e,s)=>{const{__scopeSlider:r,...a}=e,n=Nn(Oo,r),o=Mm(Oo,r),i=l.useRef(null),c=we(s,i),d=n.values.length,f=n.values.map(h=>Fm(h,n.min,n.max)),u=d>1?Math.min(...f):0,m=100-Math.max(...f);return t.jsx(pe.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...a,ref:c,style:{...e.style,[o.startEdge]:u+"%",[o.endEdge]:m+"%"}})});Rm.displayName=Oo;var Lo="SliderThumb",Im=l.forwardRef((e,s)=>{const r=Sj(e.__scopeSlider),[a,n]=l.useState(null),o=we(s,c=>n(c)),i=l.useMemo(()=>a?r().findIndex(c=>c.ref.current===a):-1,[r,a]);return t.jsx(Tj,{...e,ref:o,index:i})}),Tj=l.forwardRef((e,s)=>{const{__scopeSlider:r,index:a,name:n,...o}=e,i=Nn(Lo,r),c=Mm(Lo,r),[d,f]=l.useState(null),u=we(s,y=>f(y)),m=d?i.form||!!d.closest("form"):!0,h=ra(d),p=i.values[a],x=p===void 0?0:Fm(p,i.min,i.max),g=Dj(a,i.values.length),v=h?.[c.size],w=v?Rj(v,x,c.direction):0;return l.useEffect(()=>{if(d)return i.thumbs.add(d),()=>{i.thumbs.delete(d)}},[d,i.thumbs]),t.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${x}% + ${w}px)`},children:[t.jsx(Fo.ItemSlot,{scope:e.__scopeSlider,children:t.jsx(pe.span,{role:"slider","aria-label":e["aria-label"]||g,"aria-valuemin":i.min,"aria-valuenow":p,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...o,ref:u,style:p===void 0?{display:"none"}:e.style,onFocus:re(e.onFocus,()=>{i.valueIndexToChangeRef.current=a})})}),m&&t.jsx(Mj,{name:n??(i.name?i.name+(i.values.length>1?"[]":""):void 0),form:i.form,value:p},a)]})});Im.displayName=Lo;var Mj=e=>{const{value:s,...r}=e,a=l.useRef(null),n=ia(s);return l.useEffect(()=>{const o=a.current,i=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(i,"value").set;if(n!==s&&d){const f=new Event("input",{bubbles:!0});d.call(o,s),o.dispatchEvent(f)}},[n,s]),t.jsx("input",{style:{display:"none"},...r,ref:a,defaultValue:s})};function Pj(e=[],s,r){const a=[...e];return a[r]=s,a.sort((n,o)=>n-o)}function Fm(e,s,r){const o=100/(r-s)*(e-s);return Xr(o,[0,100])}function Dj(e,s){return s>2?`Value ${e+1} of ${s}`:s===2?["Minimum","Maximum"][e]:void 0}function Aj(e,s){if(e.length===1)return 0;const r=e.map(n=>Math.abs(n-s)),a=Math.min(...r);return r.indexOf(a)}function Rj(e,s,r){const a=e/2,o=qi([0,50],[0,a]);return(a-o(s)*r)*r}function Ij(e){return e.slice(0,-1).map((s,r)=>e[r+1]-s)}function Fj(e,s){if(s>0){const r=Ij(e);return Math.min(...r)>=s}return!0}function qi(e,s){return r=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(r-e[0])}}function Oj(e){return(String(e).split(".")[1]||"").length}function Lj(e,s){const r=Math.pow(10,s);return Math.round(e*r)/r}var Om=Em,$j=Am,Uj=Rm,zj=Im;const Lm=l.forwardRef(({className:e,...s},r)=>t.jsxs(Om,{ref:r,className:K("relative flex w-full touch-none select-none items-center",e),...s,children:[t.jsx($j,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:t.jsx(Uj,{className:"absolute h-full bg-primary"})}),t.jsx(zj,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Lm.displayName=Om.displayName;const ge=l.forwardRef(({className:e,type:s,...r},a)=>t.jsx("input",{type:s,className:K("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));ge.displayName="Input";var Bi="Switch",[qj,J2]=jt(Bi),[Bj,Wj]=qj(Bi),$m=l.forwardRef((e,s)=>{const{__scopeSwitch:r,name:a,checked:n,defaultChecked:o,required:i,disabled:c,value:d="on",onCheckedChange:f,form:u,...m}=e,[h,p]=l.useState(null),x=we(s,b=>p(b)),g=l.useRef(!1),v=h?u||!!h.closest("form"):!0,[w=!1,y]=Lt({prop:n,defaultProp:o,onChange:f});return t.jsxs(Bj,{scope:r,checked:w,disabled:c,children:[t.jsx(pe.button,{type:"button",role:"switch","aria-checked":w,"aria-required":i,"data-state":qm(w),"data-disabled":c?"":void 0,disabled:c,value:d,...m,ref:x,onClick:re(e.onClick,b=>{y(j=>!j),v&&(g.current=b.isPropagationStopped(),g.current||b.stopPropagation())})}),v&&t.jsx(Gj,{control:h,bubbles:!g.current,name:a,value:d,checked:w,required:i,disabled:c,form:u,style:{transform:"translateX(-100%)"}})]})});$m.displayName=Bi;var Um="SwitchThumb",zm=l.forwardRef((e,s)=>{const{__scopeSwitch:r,...a}=e,n=Wj(Um,r);return t.jsx(pe.span,{"data-state":qm(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})});zm.displayName=Um;var Gj=e=>{const{control:s,checked:r,bubbles:a=!0,...n}=e,o=l.useRef(null),i=ia(r),c=ra(s);return l.useEffect(()=>{const d=o.current,f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"checked").set;if(i!==r&&m){const h=new Event("click",{bubbles:a});m.call(d,r),d.dispatchEvent(h)}},[i,r,a]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:o,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function qm(e){return e?"checked":"unchecked"}var Bm=$m,Vj=zm;const Sn=l.forwardRef(({className:e,...s},r)=>t.jsx(Bm,{className:K("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-muted data-[state=unchecked]:border-border",e),...s,ref:r,children:t.jsx(Vj,{className:K("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Sn.displayName=Bm.displayName;const Jr=Wc,Hj=Bc,Wm=l.forwardRef(({className:e,...s},r)=>t.jsx(si,{ref:r,className:K("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));Wm.displayName=si.displayName;const ir=l.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(Hj,{children:[t.jsx(Wm,{}),t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:t.jsx(ri,{ref:a,className:K("relative grid w-full max-w-md mx-auto gap-4 border border-ceramic-rim bg-ceramic-plate p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 sm:rounded-lg max-h-[90vh] overflow-y-auto",e),...r,children:s})})]}));ir.displayName=ri.displayName;const _n=({className:e,...s})=>t.jsx("div",{className:K("flex flex-col space-y-1.5 text-center sm:text-left border-b border-border -mx-6 px-6 pb-4 mb-4",e),...s});_n.displayName="DialogHeader";const Gm=({className:e,...s})=>t.jsx("div",{className:K("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});Gm.displayName="DialogFooter";const lr=l.forwardRef(({className:e,...s},r)=>t.jsx(ai,{ref:r,className:K("text-lg font-semibold leading-none tracking-tight",e),...s}));lr.displayName=ai.displayName;const Vm=l.forwardRef(({className:e,...s},r)=>t.jsx(ni,{ref:r,className:K("text-sm text-muted-foreground",e),...s}));Vm.displayName=ni.displayName;const it=({isOpen:e,onClose:s,title:r,size:a="md",variant:n="standard",showCloseButton:o=!0,closeOnOverlay:i=!0,children:c,footer:d,className:f,headerClassName:u,contentClassName:m})=>{const h=X.useCallback(()=>{s()},[s]);return X.useEffect(()=>{const p=x=>{x.key==="Escape"&&e&&h()};return e&&(document.addEventListener("keydown",p),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",p),document.body.style.overflow="unset"}},[e,h]),n==="fullscreen"?t.jsx(Jr,{open:e,onOpenChange:i?h:void 0,children:t.jsx(ir,{className:K("w-full max-w-full md:max-w-md h-full max-h-full p-0 overflow-hidden","bg-background","border border-border","rounded-lg shadow-xl","focus:outline-none focus:ring-2 focus:ring-primary",!o&&"[&>button]:hidden",f),onPointerDownOutside:i?void 0:p=>p.preventDefault(),onEscapeKeyDown:i?void 0:p=>p.preventDefault(),children:t.jsxs("div",{className:"h-full flex flex-col max-w-full overflow-hidden",children:[r&&t.jsxs("div",{className:K("universal-modal-header sticky top-0 z-10 bg-muted/50 border-b border-border px-4 py-3 flex items-center justify-between",u),children:[t.jsx(lr,{className:"text-lg font-semibold text-foreground flex-1 pr-4",children:r}),o&&t.jsx(D,{variant:"ghost",size:"sm",onClick:h,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200 p-0",title:`Close ${r}`,children:t.jsx(Pe,{className:"w-4 h-4"})})]}),t.jsx("div",{className:K("flex-1 overflow-y-auto overflow-x-hidden",r?"px-4 py-4":"p-0",m),children:c}),d&&t.jsx("div",{className:K("sticky bottom-0 z-10 bg-muted/50 border-t border-border px-4 py-3 shadow-lg grid grid-cols-2 gap-3"),children:d})]})})}):t.jsx(Jr,{open:e,onOpenChange:i?h:void 0,children:t.jsxs(ir,{className:K("bg-background","border border-border","rounded-lg shadow-xl","p-0 overflow-hidden","mx-4 my-8","max-h-[90vh]","w-[calc(100vw-2rem)] max-w-md","focus:outline-none focus:ring-2 focus:ring-primary",!o&&"[&>button]:hidden",f),onPointerDownOutside:i?void 0:p=>p.preventDefault(),onEscapeKeyDown:i?void 0:p=>p.preventDefault(),children:[r&&t.jsxs("div",{className:K("universal-modal-header px-6 py-3 border-b border-border flex items-center justify-between","bg-muted/50",u),children:[t.jsx(lr,{className:"text-lg font-semibold text-foreground flex-1 pr-4",children:r}),o&&t.jsx(D,{variant:"ghost",size:"sm",onClick:h,className:K("h-8 w-8 p-0 rounded-md","text-muted-foreground hover:text-foreground","hover:bg-muted"),"aria-label":"Close modal",children:t.jsx(Pe,{className:"h-5 w-5"})})]}),t.jsx("div",{className:K("overflow-y-auto",r?"px-6 py-4":"p-0","max-h-[calc(90vh-8rem)]",m),children:c}),d&&t.jsx("div",{className:K("px-6 py-4 border-t border-border","bg-muted/50","grid grid-cols-2 gap-3"),children:d})]})})},Qj=({currentDuration:e,onSelect:s,onClose:r})=>{const[a,n]=l.useState(()=>Math.floor(e/3600)||60),[o,i]=l.useState(!1),[c,d]=l.useState(new Date().toISOString().split("T")[0]),[f,u]=l.useState("12:00"),m=()=>{if(o){const g=new Date(`${c}T${f}`);s(a*3600,g,f)}else s(a*3600)},h=()=>o?new Date(`${c}T${f}`)<new Date:!0,p=g=>{n(g)},x=[{name:"24 Hour Fast",hours:24},{name:"48 Hour Fast",hours:48},{name:"60 Hour Fast",hours:60,recommended:!0},{name:"72 Hour Fast",hours:72}];return t.jsxs(it,{isOpen:!0,onClose:r,title:"Configure Fast",variant:"standard",size:"sm",showCloseButton:!0,contentClassName:"px-4 sm:px-6 py-3 sm:py-4 max-h-[85vh] sm:max-h-[90vh]",footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:r,className:"w-full h-10",size:"default",children:"Cancel"}),t.jsx(D,{onClick:m,disabled:!h(),className:"w-full h-10",size:"default",children:o?"Start Past Fasting":"Start Fasting"})]}),children:[t.jsxs("div",{className:"space-y-4 mb-6",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Quick Presets"}),t.jsx("div",{className:"grid gap-2",children:x.map(g=>t.jsxs(D,{variant:a===g.hours?"default":"outline",onClick:()=>n(g.hours),className:a===g.hours?"justify-start bg-primary text-primary-foreground hover:bg-primary/90 border-2 border-primary-foreground/20":"justify-start bg-ceramic-base border-ceramic-rim hover:bg-ceramic-rim",children:[t.jsx("span",{className:"font-medium",children:g.name}),a===g.hours&&t.jsx(dr,{className:"ml-2 w-4 h-4 text-primary-foreground"}),t.jsxs("span",{className:"ml-auto text-muted-foreground text-sm",children:[g.hours," hours"]})]},g.name))})]}),t.jsx("div",{className:"space-y-4 mb-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs(fe,{className:"text-warm-text font-medium",children:["Fast Duration: ",a,"h"]}),t.jsx(Lm,{value:[a],onValueChange:g=>p(g[0]),max:168,min:24,step:1,defaultValue:[60],className:"w-full"})]})}),t.jsxs("div",{className:"space-y-4 p-3 sm:p-4 rounded-lg bg-ceramic-base/30 border border-ceramic-rim/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(rn,{className:"w-4 h-4 text-primary"}),t.jsx(fe,{className:"text-warm-text font-medium text-sm sm:text-base",children:"Start fast in the past"})]}),t.jsx(Sn,{checked:o,onCheckedChange:i})]}),o&&t.jsxs("div",{className:"space-y-3 pt-2",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text text-xs sm:text-sm",children:"Date"}),t.jsx(ge,{type:"date",value:c,onChange:g=>d(g.target.value),className:"bg-ceramic-base border-ceramic-rim text-xs sm:text-sm h-8 sm:h-10"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text text-xs sm:text-sm",children:"Time"}),t.jsx(ge,{type:"time",value:f,onChange:g=>u(g.target.value),className:"bg-ceramic-base border-ceramic-rim text-xs sm:text-sm h-8 sm:h-10"})]})]}),!h()&&t.jsx("p",{className:"text-red-500 text-xs",children:"Please select a date and time in the past"})]})]})]})},Kj=({open:e,onOpenChange:s,onConfirm:r,currentDuration:a,actionType:n="finish"})=>{const o=()=>s(!1);return t.jsx(it,{isOpen:e,onClose:o,title:n==="cancel"?"Cancel Fast?":"Finish Fast?",size:"sm",showCloseButton:!1,footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",size:"action-main",onClick:o,className:"text-sm w-full",children:"Close"}),t.jsx(D,{variant:"action-primary",size:"action-main",onClick:r,className:"text-sm w-full",children:n==="cancel"?"Cancel Fast":"Finish Fast"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:n==="cancel"?t.jsxs(t.Fragment,{children:["Are you sure you want to cancel your fast? You've been fasting for ",t.jsx("span",{className:"font-medium text-foreground",children:a||"0:00:00"}),"."]}):t.jsxs(t.Fragment,{children:["Are you sure you want to finish your fast? You've been fasting for ",t.jsx("span",{className:"font-medium text-foreground",children:a||"0:00:00"}),"."]})}),t.jsx("div",{className:"text-xs text-muted-foreground font-medium bg-muted/30 rounded-lg p-3 border border-border",children:n==="cancel"?"This will remove your fast from history completely.":"This will save your fast progress to history."})]})})},Yj=sn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function vs({className:e,variant:s,...r}){return t.jsx("div",{className:K(Yj({variant:s}),e),...r})}function Wt({className:e,...s}){return t.jsx("div",{className:K("animate-pulse rounded-md bg-muted",e),...s})}const Hm=({isLoading:e,children:s,loadingText:r,className:a,...n})=>t.jsxs(D,{disabled:e,className:K("gap-2",a),...n,children:[e&&t.jsx(Yt,{className:"w-4 h-4 animate-spin"}),e?r||"Please wait...":s]}),Z2=({text:e="Loading",size:s=16,className:r})=>t.jsxs("div",{className:K("flex items-center gap-2 text-muted-foreground",r),children:[t.jsx(Yt,{className:"animate-spin",style:{width:s,height:s}}),t.jsxs("span",{className:"text-sm",children:[e,"..."]})]});var Qm="AlertDialog",[Xj,ek]=jt(Qm,[Gc]),os=Gc(),Km=e=>{const{__scopeAlertDialog:s,...r}=e,a=os(s);return t.jsx(Wc,{...a,...r,modal:!0})};Km.displayName=Qm;var Jj="AlertDialogTrigger",Ym=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=os(r);return t.jsx(Fp,{...n,...a,ref:s})});Ym.displayName=Jj;var Zj="AlertDialogPortal",Xm=e=>{const{__scopeAlertDialog:s,...r}=e,a=os(s);return t.jsx(Bc,{...a,...r})};Xm.displayName=Zj;var eN="AlertDialogOverlay",Jm=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=os(r);return t.jsx(si,{...n,...a,ref:s})});Jm.displayName=eN;var er="AlertDialogContent",[tN,sN]=Xj(er),Zm=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,children:a,...n}=e,o=os(r),i=l.useRef(null),c=we(s,i),d=l.useRef(null);return t.jsx(Op,{contentName:er,titleName:eh,docsSlug:"alert-dialog",children:t.jsx(tN,{scope:r,cancelRef:d,children:t.jsxs(ri,{role:"alertdialog",...o,...n,ref:c,onOpenAutoFocus:re(n.onOpenAutoFocus,f=>{f.preventDefault(),d.current?.focus({preventScroll:!0})}),onPointerDownOutside:f=>f.preventDefault(),onInteractOutside:f=>f.preventDefault(),children:[t.jsx(Oc,{children:a}),t.jsx(aN,{contentRef:i})]})})})});Zm.displayName=er;var eh="AlertDialogTitle",th=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=os(r);return t.jsx(ai,{...n,...a,ref:s})});th.displayName=eh;var sh="AlertDialogDescription",rh=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=os(r);return t.jsx(ni,{...n,...a,ref:s})});rh.displayName=sh;var rN="AlertDialogAction",ah=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,n=os(r);return t.jsx(Vc,{...n,...a,ref:s})});ah.displayName=rN;var nh="AlertDialogCancel",oh=l.forwardRef((e,s)=>{const{__scopeAlertDialog:r,...a}=e,{cancelRef:n}=sN(nh,r),o=os(r),i=we(s,n);return t.jsx(Vc,{...o,...a,ref:i})});oh.displayName=nh;var aN=({contentRef:e})=>{const s=`\`${er}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${er}\` by passing a \`${sh}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${er}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,e]),null},nN=Km,oN=Ym,iN=Xm,ih=Jm,lh=Zm,ch=ah,dh=oh,uh=th,mh=rh;const et=nN,ht=oN,lN=iN,hh=l.forwardRef(({className:e,...s},r)=>t.jsx(ih,{className:K("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:r}));hh.displayName=ih.displayName;const qe=l.forwardRef(({className:e,...s},r)=>t.jsxs(lN,{children:[t.jsx(hh,{}),t.jsx(lh,{ref:r,className:K("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));qe.displayName=lh.displayName;const Be=({className:e,...s})=>t.jsx("div",{className:K("flex flex-col space-y-2 text-center sm:text-left",e),...s});Be.displayName="AlertDialogHeader";const We=({className:e,...s})=>t.jsx("div",{className:K("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});We.displayName="AlertDialogFooter";const Ge=l.forwardRef(({className:e,...s},r)=>t.jsx(uh,{ref:r,className:K("text-lg font-semibold",e),...s}));Ge.displayName=uh.displayName;const Ve=l.forwardRef(({className:e,...s},r)=>t.jsx(mh,{ref:r,className:K("text-sm text-muted-foreground",e),...s}));Ve.displayName=mh.displayName;const He=l.forwardRef(({className:e,...s},r)=>t.jsx(ch,{ref:r,className:K(Mi(),e),...s}));He.displayName=ch.displayName;const Qe=l.forwardRef(({className:e,...s},r)=>t.jsx(dh,{ref:r,className:K(Mi({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));Qe.displayName=dh.displayName;const cN=({onClose:e})=>{const[s,r]=l.useState([]),[a,n]=l.useState(!0);l.useState(new Set);const[o,i]=l.useState(0),[c,d]=l.useState(!0),{toast:f}=he(),{user:u}=ve(),m=10,h=N=>{const C=Math.floor(N/3600),_=Math.floor(N%3600/60);return _>0?`${C}h ${_}m`:`${C}h`},p=N=>{const C=N.duration_seconds&&N.goal_duration_seconds&&N.duration_seconds>=N.goal_duration_seconds;switch(N.status){case"completed":return C?t.jsx(vs,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Completed"}):t.jsx("div",{className:"w-6 h-6 bg-destructive rounded-full flex items-center justify-center",children:t.jsx(Pe,{className:"w-3 h-3 text-destructive-foreground"})});case"incomplete":return t.jsx(vs,{variant:"default",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",children:"Incomplete"});case"cancelled":return t.jsx("div",{className:"w-6 h-6 bg-destructive rounded-full flex items-center justify-center",children:t.jsx(Pe,{className:"w-3 h-3 text-destructive-foreground"})});case"active":return t.jsx(vs,{className:"bg-green-500 text-white hover:bg-green-600 font-medium",children:"Active"});default:return null}},x=()=>{const N=s.filter(_=>_.status==="completed"),C=s.filter(_=>_.status!=="active").length;return C>0?Math.round(N.length/C*100):0},g=()=>{const N=s.filter(_=>_.status==="completed"&&_.duration_seconds);if(N.length===0)return 0;const C=N.reduce((_,k)=>_+(k.duration_seconds||0),0);return Math.round(C/N.length)},v=()=>{let N=0,C=0;const _=[...s].filter(k=>k.status==="completed").sort((k,S)=>new Date(k.start_time).getTime()-new Date(S.start_time).getTime());for(const k of _)k.status==="completed"?(N++,C=Math.max(C,N)):N=0;return C},w=async(N=0,C=!1)=>{if(u){n(!0);try{console.log("Loading fasting history for user:",u.id);const{data:_,error:k}=await T.from("fasting_sessions").select("*").eq("user_id",u.id).order("start_time",{ascending:!1}).range(N*m,(N+1)*m-1);if(k)throw console.error("Error loading fasting history:",k),k;console.log("Loaded fasting sessions:",_?.length||0);const S=(_||[]).map(E=>({...E,status:E.status}));r(C?E=>[...E,...S]:S),d((_?.length||0)===m),console.log("Updated sessions state, total sessions:",C?s.length+S.length:S.length)}catch(_){console.error("Error loading fasting history:",_),f({title:"Error",description:"Failed to load fasting history. Please try again.",variant:"destructive"})}finally{n(!1)}}},y=()=>{const N=o+1;i(N),w(N,!0)},b=async N=>{try{const{error:C}=await T.from("fasting_sessions").delete().eq("id",N);if(C)throw C;r(_=>_.filter(k=>k.id!==N)),f({title:"Session deleted",description:"Fasting session has been removed"})}catch(C){console.error("Error deleting session:",C),f({title:"Error",description:"Failed to delete fasting session",variant:"destructive"})}},j=async()=>{try{const{error:N}=await T.from("fasting_sessions").delete().eq("user_id",u?.id).neq("status","active");if(N)throw N;await w(),f({title:"History deleted",description:"All completed and cancelled fasting sessions have been deleted"})}catch(N){console.error("Error deleting all history:",N),f({title:"Error",description:"Failed to delete fasting history",variant:"destructive"})}};return l.useEffect(()=>{w()},[u]),a&&s.length===0?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(oe,{className:"w-full max-w-md mx-auto",onClick:N=>N.stopPropagation(),children:[t.jsx(dt,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(as,{className:"text-lg font-semibold",children:"Fasting History"}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]})}),t.jsx(Le,{children:t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((N,C)=>t.jsx(oe,{children:t.jsx(dt,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-20"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-16"})]})]}),t.jsx("div",{className:"flex gap-2 justify-end",children:t.jsx("div",{className:"w-16 h-6 bg-muted animate-pulse rounded"})})]})})},C))})})]})}):(s.filter(N=>N.status==="completed"),x(),g(),v(),t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(oe,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:N=>N.stopPropagation(),children:[t.jsx(dt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(as,{className:"text-lg font-semibold",children:"Fasting History"}),t.jsxs("div",{className:"flex gap-2",children:[s.filter(N=>N.status!=="active").length>0&&t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(Je,{className:"w-4 h-4"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete All Fasting History"}),t.jsx(Ve,{children:"Are you sure you want to delete ALL fasting history? This will permanently remove all completed and cancelled sessions (active sessions will remain). This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:j,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]})]})}),t.jsx(Le,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:s.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(Kt,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),t.jsx("div",{className:"text-muted-foreground",children:"No fasting sessions found"}),t.jsx("div",{className:"text-sm text-muted-foreground/80 mt-1",children:"Start your first fast to see history here"})]}):t.jsxs(t.Fragment,{children:[s.map(N=>t.jsxs(oe,{className:"relative bg-muted/20 border-0",children:[t.jsxs(dt,{className:"pb-4",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h3",{className:"font-medium text-sm",children:new Date(N.start_time).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})}),t.jsxs("div",{className:"flex gap-3 text-xs text-muted-foreground mt-2",children:[N.duration_seconds&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"w-3 h-3"}),h(N.duration_seconds)]}),N.goal_duration_seconds&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Gt,{className:"w-3 h-3"}),"Target: ",h(N.goal_duration_seconds)]})]})]})}),t.jsx("div",{className:"absolute bottom-3 right-3",children:p(N)})]}),N.status!=="active"&&t.jsx("div",{className:"absolute top-3 right-3",children:t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(Je,{className:"w-3 h-3"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Fasting Session"}),t.jsx(Ve,{children:"Are you sure you want to delete this fasting session? This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>b(N.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Session"})]})]})]})})]},N.id)),c&&t.jsx("div",{className:"text-center pt-4",children:t.jsx(Hm,{variant:"outline",onClick:y,isLoading:a,loadingText:"Loading more",children:"Load More"})})]})})]})}))},Ct=e=>["active-fasting-session",e],wa=e=>["fasting-history",e],Wi=()=>{const{user:e}=ve(),{toast:s}=he(),r=ft(),a=ut({queryKey:Ct(e?.id||null),queryFn:async()=>{if(!e)return null;const{data:u,error:m}=await T.from("fasting_sessions").select("*").eq("user_id",e.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();if(m&&m.code!=="PGRST116")throw m;return u||null},enabled:!!e?.id,staleTime:5*1e3,gcTime:30*1e3,refetchInterval:u=>u?5e3:!1,refetchOnWindowFocus:!0,retry:3,retryDelay:u=>Math.min(1e3*2**u,1e4)}),n=ut({queryKey:wa(e?.id||null),queryFn:async()=>{if(!e)return[];const{data:u,error:m}=await T.from("fasting_sessions").select("*").eq("user_id",e.id).in("status",["completed","cancelled"]).order("start_time",{ascending:!1}).limit(50);if(m)throw m;return u||[]},enabled:!!e?.id,staleTime:10*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,retry:3}),o=xt({mutationFn:async u=>{if(console.log("Starting fasting session mutation with data:",u),console.log("User:",e),!e)throw new Error("User not authenticated");console.log("Cancelling existing active sessions...");const m=await T.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",e.id).eq("status","active");console.log("Cancel existing sessions result:",m);const h={user_id:e.id,start_time:u.start_time?u.start_time.toISOString():new Date().toISOString(),goal_duration_seconds:u.goal_duration_seconds,status:"active"};console.log("Inserting new session with data:",h);const{data:p,error:x}=await T.from("fasting_sessions").insert(h).select().single();if(console.log("Insert result:",{data:p,error:x}),x)throw x;return p},onMutate:async u=>{await r.cancelQueries({queryKey:Ct(e?.id||null)});const m={id:`temp-${Date.now()}`,user_id:e?.id||"",start_time:u.start_time?u.start_time.toISOString():new Date().toISOString(),goal_duration_seconds:u.goal_duration_seconds,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return r.setQueryData(Ct(e?.id||null),m),{optimisticSession:m}},onError:(u,m,h)=>{console.error("Fasting session start error:",u),r.setQueryData(Ct(e?.id||null),null),s({title:"Error starting fasting session",description:u instanceof Error?u.message:"Please try again.",variant:"destructive"})},onSuccess:u=>{r.setQueryData(Ct(e?.id||null),u),s({title:" Fasting Started!",description:"Your fasting session has begun. Good luck!"})}}),i=xt({mutationFn:async u=>{if(console.log(" Starting endSessionMutation with sessionId:",u),console.log(" User:",e),!e)throw console.error(" Error: User not authenticated"),new Error("User not authenticated");console.log(" Fetching session from database...");const{data:m,error:h}=await T.from("fasting_sessions").select("id, user_id, start_time, goal_duration_seconds").eq("id",u).eq("user_id",e.id).maybeSingle();if(console.log(" Fetch result:",{session:m,fetchError:h}),h)throw console.error(" Fetch error:",h),h;if(!m)throw console.error(" Error: No active session found"),new Error("No active session found");const p=new Date,x=new Date(m.start_time),g=Math.floor((p.getTime()-x.getTime())/1e3);m.goal_duration_seconds;const v="completed";console.log(" Updating session with:",{end_time:p.toISOString(),duration_seconds:g,status:v});const{data:w,error:y}=await T.from("fasting_sessions").update({end_time:p.toISOString(),duration_seconds:g,status:v}).eq("id",u).eq("user_id",e.id).select().single();if(console.log(" Update result:",{data:w,error:y}),y)throw console.error(" Update error:",y),y;return w},onMutate:async u=>{await r.cancelQueries({queryKey:Ct(e?.id||null)});const m=r.getQueryData(Ct(e?.id||null));return r.setQueryData(Ct(e?.id||null),null),{previousSession:m}},onError:(u,m,h)=>{console.error("Error ending fasting session:",u),h?.previousSession&&r.setQueryData(Ct(e?.id||null),h.previousSession),s({title:"Error ending fasting session",description:u instanceof Error?u.message:"Please try again.",variant:"destructive"})},onSuccess:u=>{r.setQueryData(Ct(e?.id||null),null),r.setQueryData(wa(e?.id||null),(p=[])=>[u,...p]);const m=Math.floor((u.duration_seconds||0)/3600),h=Math.floor((u.duration_seconds||0)%3600/60);s({title:" Fasting Completed!",description:`Great job! You fasted for ${m}h ${h}m.`})}}),c=xt({mutationFn:async u=>{if(!e)throw new Error("User not authenticated");const{error:m}=await T.from("fasting_sessions").update({status:"cancelled"}).eq("id",u).eq("user_id",e.id);if(m)throw m},onSuccess:()=>{r.setQueryData(Ct(e?.id||null),null),r.invalidateQueries({queryKey:wa(e?.id||null)}),s({title:"Fasting Cancelled",description:"Your fasting session has been cancelled."})},onError:()=>{s({title:"Error cancelling session",description:"Please try again.",variant:"destructive"})}}),d=l.useCallback(async()=>{await r.refetchQueries({queryKey:Ct(e?.id||null)})},[r,e?.id]),f=l.useCallback(async()=>{await r.refetchQueries({queryKey:wa(e?.id||null)})},[r,e?.id]);return{currentSession:a.data||null,fastingHistory:n.data||[],loading:a.isLoading,historyLoading:n.isLoading,startFastingSession:o.mutateAsync,endFastingSession:i.mutateAsync,cancelFastingSession:c.mutateAsync,refreshActiveSession:d,refreshHistory:f,isStarting:o.isPending,isEnding:i.isPending,isCancelling:c.isPending}},Hs=e=>["profile",e],dN=()=>{const e=wr(d=>d.user),s=ft(),{toast:r}=he(),a=ut({queryKey:Hs(e?.id||null),queryFn:async()=>{if(!e)return null;const{data:d,error:f}=await T.from("profiles").select("*").eq("user_id",e.id).single();if(f&&f.code!=="PGRST116")throw f;return d||null},enabled:!!e?.id,staleTime:5*60*1e3,gcTime:10*60*1e3,retry:3,retryDelay:d=>Math.min(1e3*2**d,3e4)}),n=xt({mutationFn:async d=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await T.from("profiles").upsert({user_id:e.id,...d,updated_at:new Date().toISOString()}).select().single();if(u)throw u;return f},onMutate:async d=>{await s.cancelQueries({queryKey:Hs(e?.id||null)});const f=s.getQueryData(Hs(e?.id||null));return s.setQueryData(Hs(e?.id||null),u=>u?{...u,...d}:{user_id:e?.id||"",...d}),{previousProfile:f}},onError:(d,f,u)=>{u?.previousProfile&&s.setQueryData(Hs(e?.id||null),u.previousProfile),r({title:"Profile Update Failed",description:"There was an error updating your profile. Please try again.",variant:"destructive"})},onSuccess:()=>{r({title:"Profile Updated",description:"Your profile has been successfully updated."})},onSettled:()=>{s.invalidateQueries({queryKey:Hs(e?.id||null)})}}),o=()=>{const d=a.data;return d?.onboarding_completed||!!(d?.weight&&d?.height&&d?.age&&d?.sex)},i=()=>{const d=a.data;if(!d?.weight||!d?.height||!d?.age)return 0;const f=d.weight,u=d.height;let m;return d.sex==="female"?m=Math.round(10*f+6.25*u-5*d.age-161):m=Math.round(10*f+6.25*u-5*d.age+5),m},c=(d,f=3)=>{const u=a.data;if(!u?.weight||!o())return 0;const m=u.weight;let h=f*1.60934,p=3;h<4?p=2.5:h<5.6?p=3:h<6.4?p=3.5:h<7.2?p=4:p=4.5;const x=d/60;return Math.round(p*m*x)};return{profile:a.data,loading:a.isLoading,error:a.error,updateProfile:n.mutate,isUpdating:n.isPending,isProfileComplete:o,calculateBMR:i,calculateWalkingCalories:c,refetch:a.refetch}},uN=(e,s)=>{const r=e*.414;let a=1;return s<=2.5?a=.9:s<=3.5?a=1:s<=4.5?a=1.1:a=1.2,r*a},mN=({durationMinutes:e,speedMph:s,userHeight:r=70,units:a="imperial"})=>{const n=a==="metric"?r/2.54:r,i=e/60*s*63360,c=uN(n,s);return Math.round(i/c)},$o=(e,s)=>s.some(r=>e instanceof r);let mc,hc;function hN(){return mc||(mc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fN(){return hc||(hc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uo=new WeakMap,Yn=new WeakMap,Cn=new WeakMap;function pN(e){const s=new Promise((r,a)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{r(Is(e.result)),n()},i=()=>{a(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)});return Cn.set(s,e),s}function gN(e){if(Uo.has(e))return;const s=new Promise((r,a)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{r(),n()},i=()=>{a(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});Uo.set(e,s)}let zo={get(e,s,r){if(e instanceof IDBTransaction){if(s==="done")return Uo.get(e);if(s==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Is(e[s])},set(e,s,r){return e[s]=r,!0},has(e,s){return e instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in e}};function fh(e){zo=e(zo)}function xN(e){return fN().includes(e)?function(...s){return e.apply(qo(this),s),Is(this.request)}:function(...s){return Is(e.apply(qo(this),s))}}function vN(e){return typeof e=="function"?xN(e):(e instanceof IDBTransaction&&gN(e),$o(e,hN())?new Proxy(e,zo):e)}function Is(e){if(e instanceof IDBRequest)return pN(e);if(Yn.has(e))return Yn.get(e);const s=vN(e);return s!==e&&(Yn.set(e,s),Cn.set(s,e)),s}const qo=e=>Cn.get(e);function yN(e,s,{blocked:r,upgrade:a,blocking:n,terminated:o}={}){const i=indexedDB.open(e,s),c=Is(i);return a&&i.addEventListener("upgradeneeded",d=>{a(Is(i.result),d.oldVersion,d.newVersion,Is(i.transaction),d)}),r&&i.addEventListener("blocked",d=>r(d.oldVersion,d.newVersion,d)),c.then(d=>{o&&d.addEventListener("close",()=>o()),n&&d.addEventListener("versionchange",f=>n(f.oldVersion,f.newVersion,f))}).catch(()=>{}),c}const wN=["get","getKey","getAll","getAllKeys","count"],bN=["put","add","delete","clear"],Xn=new Map;function fc(e,s){if(!(e instanceof IDBDatabase&&!(s in e)&&typeof s=="string"))return;if(Xn.get(s))return Xn.get(s);const r=s.replace(/FromIndex$/,""),a=s!==r,n=bN.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||wN.includes(r)))return;const o=async function(i,...c){const d=this.transaction(i,n?"readwrite":"readonly");let f=d.store;return a&&(f=f.index(c.shift())),(await Promise.all([f[r](...c),n&&d.done]))[0]};return Xn.set(s,o),o}fh(e=>({...e,get:(s,r,a)=>fc(s,r)||e.get(s,r,a),has:(s,r)=>!!fc(s,r)||e.has(s,r)}));const jN=["continue","continuePrimaryKey","advance"],pc={},Bo=new WeakMap,ph=new WeakMap,NN={get(e,s){if(!jN.includes(s))return e[s];let r=pc[s];return r||(r=pc[s]=function(...a){Bo.set(this,ph.get(this)[s](...a))}),r}};async function*SN(...e){let s=this;if(s instanceof IDBCursor||(s=await s.openCursor(...e)),!s)return;s=s;const r=new Proxy(s,NN);for(ph.set(r,s),Cn.set(r,qo(s));s;)yield r,s=await(Bo.get(r)||s.continue()),Bo.delete(r)}function gc(e,s){return s===Symbol.asyncIterator&&$o(e,[IDBIndex,IDBObjectStore,IDBCursor])||s==="iterate"&&$o(e,[IDBIndex,IDBObjectStore])}fh(e=>({...e,get(s,r,a){return gc(s,r)?SN:e.get(s,r,a)},has(s,r){return gc(s,r)||e.has(s,r)}}));let Jn=null;const Bs=()=>(Jn||(Jn=yN("fastnow_outbox",1,{upgrade(e){e.objectStoreNames.contains("operations")||e.createObjectStore("operations",{keyPath:"id"}),e.objectStoreNames.contains("mappings")||e.createObjectStore("mappings",{keyPath:"localId"})}})),Jn),_N=()=>globalThis.crypto?.randomUUID?.()??`id_${Date.now()}_${Math.random().toString(16).slice(2)}`,Qs=async e=>{const s=await Bs(),r={id:_N(),createdAt:Date.now(),attempts:0,...e};return await s.add("operations",r),Ga("changed"),r.id},gh=async()=>(await(await Bs()).getAll("operations")).sort((r,a)=>r.createdAt-a.createdAt),CN=async e=>{await(await Bs()).put("operations",e)},kN=async e=>{await(await Bs()).delete("operations",e),Ga("changed")},EN=async()=>(await(await Bs()).getAllKeys("operations")).length,Zn=async(e,s)=>{const r=await Bs(),a={localId:e,serverId:s,createdAt:Date.now()};await r.put("mappings",a)},eo=async e=>e?e.startsWith("local-")?(await(await Bs()).get("mappings",e))?.serverId??e:e:void 0,Ga=e=>{typeof window<"u"&&(window.dispatchEvent(new CustomEvent(`outbox:${e}`)),e==="sync-complete"&&window.dispatchEvent(new CustomEvent("outbox:sync")))},Wo="fastnow_fasting_session",Go="fastnow_walking_session",ba=e=>{typeof localStorage>"u"||(e?localStorage.setItem(Wo,JSON.stringify(e)):localStorage.removeItem(Wo))},TN=()=>{if(typeof localStorage>"u")return null;try{const e=localStorage.getItem(Wo);return e?JSON.parse(e):null}catch{return null}},ja=e=>{typeof localStorage>"u"||(e?localStorage.setItem(Go,JSON.stringify(e)):localStorage.removeItem(Go))},xc=()=>{if(typeof localStorage>"u")return null;try{const e=localStorage.getItem(Go);return e?JSON.parse(e):null}catch{return null}},Sr=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(!1),[n,o]=l.useState(3),[i,c]=l.useState(!1),[d,f]=l.useState(0),{user:u}=ve(),{profile:m,calculateWalkingCalories:h}=dN(),p=l.useCallback(()=>{f(_=>_+1)},[]),x=l.useCallback(async()=>{if(u){a(!0);try{const{data:_,error:k}=await T.from("walking_sessions").select("*").eq("user_id",u.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();if(k){console.error("Error loading active walking session:",k);const E=xc();E&&E.user_id===u.id&&E.status==="active"&&(s(E),c(E.session_state==="paused"));return}const S=_||null;s(S),c(S?.session_state==="paused"),S&&ja({id:S.id,user_id:S.user_id,start_time:S.start_time,status:S.status,speed_mph:S.speed_mph,session_state:S.session_state,pause_start_time:S.pause_start_time,total_pause_duration:S.total_pause_duration})}catch(_){console.error("Error loading active walking session:",_);const k=xc();k&&k.user_id===u.id&&k.status==="active"&&(s(k),c(k.session_state==="paused"))}finally{a(!1)}}},[u]),g=l.useCallback(async(_=n)=>{if(!u)return{error:{message:"User not authenticated"},data:null};const k=async()=>{const S=`local-${Date.now()}-${Math.random().toString(16).slice(2)}`,E=new Date().toISOString(),A={id:S,user_id:u.id,start_time:E,status:"active",session_state:"active",total_pause_duration:0,speed_mph:_};return s(A),o(_),c(!1),await Qs({entity:"walking_session",action:"start",user_id:u.id,payload:{local_id:S,start_time:E,speed_mph:_,status:"active",session_state:"active",total_pause_duration:0}}),{data:A,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await k();const{data:S,error:E}=await T.from("walking_sessions").insert({user_id:u.id,start_time:new Date().toISOString(),status:"active",speed_mph:_,session_state:"active",total_pause_duration:0}).select().single();return console.log("Walking session started successfully:",S),s(S),o(_),c(!1),ja({id:S.id,user_id:S.user_id,start_time:S.start_time,status:S.status,speed_mph:S.speed_mph,session_state:S.session_state,pause_start_time:S.pause_start_time,total_pause_duration:S.total_pause_duration}),console.log("Triggering refresh after session start"),p(),setTimeout(()=>{x()},100),{data:S,error:null}}catch(S){return console.error("Error starting walking session:",S),S?.message?.includes("fetch")?await k():{error:S,data:null}}finally{a(!1)}},[u,n,x,p]),v=l.useCallback(async()=>{if(!u||!e)return{error:{message:"No active session"},data:null};const _=async()=>{const k=new Date().toISOString(),S={...e,session_state:"paused",pause_start_time:k};return s(S),c(!0),await Qs({entity:"walking_session",action:"pause",user_id:u.id,payload:{session_id:e.id,pause_start_time:k}}),{data:S,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await _();const{data:k,error:S}=await T.from("walking_sessions").update({session_state:"paused",pause_start_time:new Date().toISOString()}).eq("id",e.id).select().single();if(S)throw S;return s(k),c(!0),p(),{data:k,error:null}}catch(k){return console.error("Error pausing walking session:",k),k.message?.includes("fetch")?await _():{error:k,data:null}}finally{a(!1)}},[u,e,p]),w=l.useCallback(async()=>{if(!u||!e)return{error:{message:"No active session"},data:null};const _=async()=>{const k=e.pause_start_time?Math.floor((new Date().getTime()-new Date(e.pause_start_time).getTime())/1e3):0,S={...e,session_state:"active",pause_start_time:null,total_pause_duration:(e.total_pause_duration||0)+k};return s(S),c(!1),await Qs({entity:"walking_session",action:"resume",user_id:u.id,payload:{session_id:e.id,pause_duration_seconds:k}}),{data:S,error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await _();const k=e.pause_start_time?Math.floor((new Date().getTime()-new Date(e.pause_start_time).getTime())/1e3):0,{data:S,error:E}=await T.from("walking_sessions").update({session_state:"active",pause_start_time:null,total_pause_duration:(e.total_pause_duration||0)+k}).eq("id",e.id).select().single();if(E)throw E;return s(S),c(!1),p(),{data:S,error:null}}catch(k){return console.error("Error resuming walking session:",k),k.message?.includes("fetch")?await _():{error:k,data:null}}finally{a(!1)}},[u,e,p]),y=l.useCallback(async _=>{if(console.log("Ending walking session..."),!u||!e)return{error:{message:"No active session"},data:null};const k=()=>{const E=new Date,A=new Date(e.start_time);let I,z=!1;if(_)I=_,z=!0;else{let te=E.getTime()-A.getTime(),$=e.total_pause_duration||0;if(i&&e.pause_start_time){const q=Math.floor((E.getTime()-new Date(e.pause_start_time).getTime())/1e3);$+=q}I=te/(1e3*60)-$/60}const W=e.speed_mph||n||3;let G={end_time:(z?new Date(A.getTime()+I*60*1e3):E).toISOString(),status:"completed",session_state:"completed"};if(z)G={...G,calories_burned:null,distance:null,estimated_steps:null,is_edited:!0,edit_reason:"Manual duration correction"};else{const te=h(I,W),$=I/60*W,q=m?.height||175,Z=mN({durationMinutes:I,speedMph:W,userHeight:q,units:"metric"});G={...G,calories_burned:te,distance:Math.round($*100)/100,estimated_steps:Z,total_pause_duration:e.total_pause_duration||0}}return G},S=async()=>{const E=k();return s(null),c(!1),await Qs({entity:"walking_session",action:"end",user_id:u.id,payload:{session_id:e.id,updateData:E}}),p(),{data:{...e,...E},error:null}};a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await S();const E=k(),{data:A,error:I}=await T.from("walking_sessions").update(E).eq("id",e.id).select().single();if(I)throw I;return s(null),c(!1),ja(null),p(),setTimeout(()=>{x()},100),{data:A,error:null}}catch(E){return console.error("Error ending walking session:",E),E.message?.includes("fetch")?await S():{error:E,data:null}}finally{a(!1)}},[u,e,n,h,i,m,p,x]),b=l.useCallback(async()=>{if(console.log("Cancelling walking session..."),!u||!e)return{error:{message:"No active session"},data:null};const _=async()=>(s(null),c(!1),await Qs({entity:"walking_session",action:"cancel",user_id:u.id,payload:{session_id:e.id}}),p(),{data:!0,error:null});a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await _();const{error:k}=await T.from("walking_sessions").delete().eq("id",e.id);if(k)throw k;return s(null),c(!1),ja(null),p(),{data:!0,error:null}}catch(k){return console.error("Error cancelling walking session:",k),k.message?.includes("fetch")?await _():{error:k,data:null}}finally{a(!1)}},[u,e,p]);l.useEffect(()=>{let _=!0;return(async()=>{_&&await x()})(),()=>{_=!1}},[x]),l.useEffect(()=>{m?.default_walking_speed&&m.default_walking_speed!==n&&o(m.default_walking_speed)},[m?.default_walking_speed]);const j=l.useCallback(async _=>{if(!e||!u)return{error:null,data:null};const k=async()=>{const S={...e,speed_mph:_};return s(S),await Qs({entity:"walking_session",action:"update_speed",user_id:u.id,payload:{session_id:e.id,speed_mph:_}}),{data:S,error:null}};console.log("Updating session speed:",{currentSpeed:e.speed_mph,newSpeed:_}),a(!0);try{if(typeof navigator<"u"&&!navigator.onLine)return await k();const{data:S,error:E}=await T.from("walking_sessions").update({speed_mph:_}).eq("id",e.id).select().single();if(E)throw console.error("Database error updating session speed:",E),E;return console.log("Successfully updated session speed:",S),s(S),{data:S,error:null}}catch(S){return console.error("Error updating session speed:",S),S.message?.includes("fetch")?await k():{error:S,data:null}}finally{a(!1)}},[u,e]),N=l.useCallback(async _=>{if(u)try{await T.from("profiles").update({default_walking_speed:_}).eq("user_id",u.id)}catch(k){console.error("Error saving walking speed to profile:",k)}},[u]),C=l.useCallback(_=>{o(_),N(_)},[N]);return{currentSession:e,loading:r,selectedSpeed:n,setSelectedSpeed:C,isPaused:i,startWalkingSession:g,pauseWalkingSession:v,resumeWalkingSession:w,endWalkingSession:y,cancelWalkingSession:b,loadActiveSession:x,updateSessionSpeed:j,refreshTrigger:d,triggerRefresh:p}},to=e=>["walking-sessions",e],Ds=e=>["active-walking-session",e],xh=()=>{const e=wr(f=>f.user),s=ft(),{toast:r}=he(),a=ut({queryKey:to(e?.id||null),queryFn:async()=>{if(!e)return[];const{data:f,error:u}=await T.from("walking_sessions").select("*").eq("user_id",e.id).order("start_time",{ascending:!1}).limit(50);if(u)throw u;return f||[]},enabled:!!e?.id,staleTime:30*1e3,gcTime:5*60*1e3,retry:3}),n=ut({queryKey:Ds(e?.id||null),queryFn:async()=>{if(!e)return null;const{data:f,error:u}=await T.from("walking_sessions").select("*").eq("user_id",e.id).eq("session_state","active").maybeSingle();if(u&&u.code!=="PGRST116")throw u;return f||null},enabled:!!e?.id,staleTime:5*1e3,gcTime:30*1e3,refetchInterval:5e3,retry:3}),o=xt({mutationFn:async()=>{if(!e)throw new Error("User not authenticated");const{data:f,error:u}=await T.from("walking_sessions").insert({user_id:e.id,start_time:new Date().toISOString(),session_state:"active"}).select().single();if(u)throw u;return f},onSuccess:f=>{s.setQueryData(Ds(e?.id||null),f),s.invalidateQueries({queryKey:to(e?.id||null)}),r({title:"Walking Started",description:"Your walking session has begun. Good luck!"})},onError:f=>{r({title:"Failed to Start Walking",description:"There was an error starting your walking session.",variant:"destructive"})}}),i=xt({mutationFn:async f=>{if(!e)throw new Error("User not authenticated");const u=s.getQueryData(Ds(e.id));if(!u)throw new Error("No active session found");const{data:m,error:h}=await T.from("walking_sessions").update({end_time:new Date().toISOString(),session_state:"completed",distance:f.distance_km,calories_burned:f.calories_burned,speed_mph:f.average_speed_kmh,estimated_steps:f.steps}).eq("id",u.id).eq("user_id",e.id).select().single();if(h)throw h;return m},onSuccess:f=>{s.setQueryData(Ds(e?.id||null),null),s.invalidateQueries({queryKey:to(e?.id||null)}),r({title:"Walking Complete",description:`Great job! You burned ${f.calories_burned||0} calories.`})},onError:f=>{r({title:"Failed to End Walking",description:"There was an error ending your walking session.",variant:"destructive"})}}),c=xt({mutationFn:async f=>{if(!e)throw new Error("User not authenticated");const u=s.getQueryData(Ds(e.id));if(!u)throw new Error("No active session found");const{data:m,error:h}=await T.from("walking_sessions").update(f).eq("id",u.id).eq("user_id",e.id).select().single();if(h)throw h;return m},onMutate:async f=>{s.setQueryData(Ds(e?.id||null),u=>u?{...u,...f}:null)},onError:(f,u,m)=>{s.invalidateQueries({queryKey:Ds(e?.id||null)})}}),d=xt({mutationFn:async f=>await c.mutateAsync({})});return{sessions:a.data||[],activeSession:n.data,loading:a.isLoading,activeSessionLoading:n.isLoading,startSession:o.mutate,endSession:i.mutate,updateSession:c.mutate,togglePause:d.mutate,isStarting:o.isPending,isEnding:i.isPending,isUpdating:c.isPending,refetchSessions:a.refetch,refetchActiveSession:n.refetch}},vh=()=>{const e=qt(),[s,r]=l.useState("fasting"),[a,n]=l.useState(!1),[o,i]=l.useState({fasting:{isActive:!1,timeElapsed:0},walking:{isActive:!1,timeElapsed:0}}),{currentSession:c}=Wi(),{activeSession:d}=xh();return l.useEffect(()=>{const h=()=>{const x=!!c&&c.status==="active",g=!!d&&d.session_state==="active";let v=0,w=0;if(c&&x){const y=new Date(c.start_time);v=Math.floor((new Date().getTime()-y.getTime())/1e3)}if(d&&g){const y=new Date(d.start_time),b=new Date;let j=Math.floor((b.getTime()-y.getTime())/1e3);const N=d.total_pause_duration||0;let C=0;d.session_state==="paused"&&d.pause_start_time&&(C=Math.floor((b.getTime()-new Date(d.pause_start_time).getTime())/1e3)),w=Math.max(0,j-N-C)}i({fasting:{isActive:x,timeElapsed:v},walking:{isActive:g,timeElapsed:w}})};let p;return c&&c.status==="active"||d&&d.session_state==="active"?(h(),p=setInterval(h,1e3)):h(),()=>{p&&clearInterval(p)}},[c?.status,d?.session_state,c?.start_time,d?.start_time]),l.useEffect(()=>{(()=>{const p=!!c&&c.status==="active",x=!!d&&d.session_state==="active";let g=0,v=0;if(c&&p){const w=new Date(c.start_time);g=Math.floor((new Date().getTime()-w.getTime())/1e3)}if(d&&x){const w=new Date(d.start_time),y=new Date;let b=Math.floor((y.getTime()-w.getTime())/1e3);const j=d.total_pause_duration||0;let N=0;d.session_state==="paused"&&d.pause_start_time&&(N=Math.floor((y.getTime()-new Date(d.pause_start_time).getTime())/1e3)),v=Math.max(0,b-j-N)}i({fasting:{isActive:p,timeElapsed:g},walking:{isActive:x,timeElapsed:v}})})()},[d?.id,d?.session_state,c?.id,c?.status]),{currentMode:s,timerStatus:o,sheetOpen:a,setSheetOpen:n,switchMode:h=>{r(h),n(!1),e(h==="walking"?"/walking":"/")},getActiveTimerCount:()=>(o.fasting.isActive?1:0)+(o.walking.isActive?1:0),formatTime:h=>{const p=Math.floor(h/3600),x=Math.floor(h%3600/60),g=h%60;return`${p.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`}}};let vc=!1,Va=null;const MN=async()=>{if(!(typeof window>"u"||vc))try{const{data:e,error:s}=await T.from("shared_settings").select("setting_value").eq("setting_key","ga_tracking_id").maybeSingle();if(s||!e?.setting_value){console.log("No GA tracking ID configured");return}const r=e.setting_value;if(Va=r,typeof document<"u"){window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",r,{anonymize_ip:!0,allow_google_signals:!1,allow_ad_personalization_signals:!1});const a=document.createElement("script");a.async=!0,a.src=`https://www.googletagmanager.com/gtag/js?id=${r}`,a.onerror=()=>console.warn("Failed to load Google Analytics script");const n=document.getElementsByTagName("script")[0];n?n.parentNode?.insertBefore(a,n):document.head.appendChild(a)}vc=!0,console.log("Google Analytics initialized with ID:",r)}catch(e){console.warn("Analytics initialization failed (non-critical):",e)}},PN=e=>{if(typeof window<"u"&&window.gtag&&Va)try{window.gtag("config",Va,{page_path:e})}catch(s){console.warn("Failed to track page view:",s)}},ca=(e,s)=>{if(typeof window<"u"&&window.gtag&&Va)try{window.gtag("event",e,s)}catch(r){console.warn("Failed to track event:",r)}},yc=(e,s,r)=>{ca("fasting_action",{action:e,fast_type:s,duration_hours:r?Math.round(r/3600):void 0})},Ar=(e,s,r)=>{ca("walking_action",{action:e,speed_mph:s,duration_minutes:r?Math.round(r/60):void 0})},Vo=(e,s)=>{ca("food_tracking",{action:e,input_method:s})},Na=(e,s)=>{ca("motivator_action",{action:e,category:s})},DN=(e,s)=>{ca("ai_usage",{action:e,model_used:s})},yh=({quotes:e,className:s="",onSaveQuote:r,compact:a=!1})=>{const[n,o]=l.useState(null),[i,c]=l.useState(-1),d=()=>{if(e.length===0)return null;if(e.length===1)return e[0];let m;do m=Math.floor(Math.random()*e.length);while(m===i&&e.length>1);return c(m),e[m]};l.useEffect(()=>{if(e.length===0){o(null);return}const m=d();o(m);const h=setInterval(()=>{const p=d();o(p)},3e4);return()=>clearInterval(h)},[e]);const f=()=>{const m=d();o(m)},u=()=>{n&&r&&r(n)};return!n||e.length===0?null:t.jsxs("div",{className:`max-w-md mx-auto text-center ${a?"px-4 py-2":"px-6 py-4"} cursor-pointer transition-opacity duration-500 hover:opacity-80 ${s}`,onClick:f,children:[t.jsxs("blockquote",{className:"relative",children:[t.jsxs("p",{className:`${a?"text-xs":"text-sm"} italic text-muted-foreground/80 leading-relaxed mb-2`,children:['"',n.text,'"']}),n.author&&t.jsxs("cite",{className:`${a?"text-[10px]":"text-xs"} text-muted-foreground/60 not-italic`,children:[" ",n.author]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("div",{className:`${a?"text-[10px]":"text-xs"} text-muted-foreground/40`,children:"Tap for another quote"}),r&&t.jsxs(D,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),u()},className:`${a?"h-5 px-1 text-[10px]":"h-6 px-2 text-xs"} text-muted-foreground/60 hover:text-muted-foreground`,children:[t.jsx(tg,{className:`${a?"w-2 h-2 mr-0.5":"w-3 h-3 mr-1"}`}),"Save to Goals"]})]})]})},AN=({currentHour:e,className:s="",maxHour:r=72,onHourChange:a})=>{const n=f=>Math.min(Math.max(f,0),r),o=Math.max(e-1,0),i=Math.min(e+1,r),c=e>0,d=e<r;return t.jsxs("div",{className:`w-full animate-fade-in ${s}`,"aria-live":"polite",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("button",{type:"button",className:`transition-colors ${c?"text-muted-foreground hover:text-primary":"text-muted-foreground/50 cursor-not-allowed"}`,onClick:()=>c&&a?.(o),disabled:!c,"aria-label":`Go to hour ${o}`,children:["Hour ",o]}),t.jsxs("span",{className:"font-medium text-primary",children:["Hour ",n(e)]}),t.jsxs("button",{type:"button",className:`transition-colors ${d?"text-muted-foreground hover:text-primary":"text-muted-foreground/50 cursor-not-allowed"}`,onClick:()=>d&&a?.(i),disabled:!d,"aria-label":`Go to hour ${i}`,children:["Hour ",i]})]}),t.jsxs("div",{className:"relative mt-2 h-5",children:[t.jsx("div",{className:"absolute left-0 right-0 top-1/2 -translate-y-1/2 h-px bg-border"}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary shadow-sm","aria-label":`Current fasting hour: ${n(e)}`})]})]})},Tt=["fasting","hours"];function RN(){const{isAdmin:e}=Ps();return ut({queryKey:Tt,queryFn:async()=>{console.log(" FASTING HOURS QUERY: Fetching fresh data from database");const{data:s,error:r}=await T.from("fasting_hours").select("*").lte("hour",72).order("hour",{ascending:!0});if(r)throw r;const a=(s||[]).map(n=>({...n,content_rotation_data:n.content_rotation_data?n.content_rotation_data:void 0}));return console.log(" FASTING HOURS QUERY: Fetched",a.length,"hours"),a},staleTime:e?5*60*1e3:24*60*60*1e3,refetchOnWindowFocus:e})}function IN({fastingHour:e,autoRotate:s=!0,rotationInterval:r=1e4}){const[a,n]=l.useState({currentContent:"",currentType:"metabolic",currentIndex:0,totalVariants:0,isRotating:s}),o=l.useCallback(u=>{console.log("Building content variants for hour:",u.hour,u);const m=[];return u.stage&&m.push({type:"stage",content:u.stage}),u.metabolic_changes&&m.push({type:"metabolic",content:u.metabolic_changes}),u.physiological_effects&&m.push({type:"physiological",content:u.physiological_effects}),u.mental_emotional_state&&u.mental_emotional_state.length>0&&m.push({type:"mental",content:u.mental_emotional_state.join(". ")}),u.encouragement&&m.push({type:"encouragement",content:u.encouragement}),m.length===0&&u.body_state&&m.push({type:"physiological",content:u.body_state}),console.log("Built variants (excluding admin logs):",m),m},[]);l.useEffect(()=>{if(console.log("Content rotation effect triggered with fastingHour:",e),!e){console.log("No fasting hour provided");return}let u=[];e.content_rotation_data?.variants?.length&&(console.log("Using provided rotation data:",e.content_rotation_data.variants),u=e.content_rotation_data.variants.filter(m=>m.content&&m.content.trim()!==""&&!m.content.includes("coming soon")&&m.type!=="admin_personal_log").map(m=>({...m,content:m.content.replace(/\\n/g," ").replace(/\n/g," ").trim()}))),u.length===0&&(console.log("Building variants from hour data"),u=o(e)),console.log("Final variants for display:",u),u.length>0?n(m=>({...m,currentContent:u[0]?.content||"",currentType:u[0]?.type||"metabolic",currentIndex:0,totalVariants:u.length,isRotating:s})):(console.log("No variants found, using fallback"),n(m=>({...m,currentContent:e.body_state||"Information will be available soon.",currentType:"physiological",currentIndex:0,totalVariants:1})))},[e,o]),l.useEffect(()=>{if(!a.isRotating||a.totalVariants<=1)return;const u=setInterval(()=>{n(m=>{if(!e)return m;const h=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants.filter(g=>g.content&&!g.content.includes("coming soon")):o(e),p=(m.currentIndex+1)%h.length,x=h[p];return{...m,currentContent:x?.content||"",currentType:x?.type||"metabolic",currentIndex:p}})},r);return()=>clearInterval(u)},[a.isRotating,a.totalVariants,r,e,o]);const i=l.useCallback(()=>{if(!e)return;const u=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e);n(m=>{const h=(m.currentIndex+1)%u.length,p=u[h];return{...m,currentContent:p.content,currentType:p.type,currentIndex:h}})},[e,o]),c=l.useCallback(()=>{if(!e)return;const u=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e);n(m=>{const h=m.currentIndex===0?u.length-1:m.currentIndex-1,p=u[h];return{...m,currentContent:p.content,currentType:p.type,currentIndex:h}})},[e,o]),d=l.useCallback(u=>{if(!e)return;const m=e.content_rotation_data?.variants?.length?e.content_rotation_data.variants:o(e),h=Math.max(0,Math.min(u,m.length-1)),p=m[h];n(x=>({...x,currentContent:p.content,currentType:p.type,currentIndex:h}))},[e,o]),f=l.useCallback(()=>{n(u=>({...u,isRotating:!u.isRotating}))},[]);return{...a,goToNext:i,goToPrevious:c,goToIndex:d,toggleRotation:f}}const wh=({onTranscription:e,isDisabled:s=!1})=>t.jsx("div",{className:"flex justify-center",children:t.jsx(Yr,{onTranscription:e,isDisabled:s,size:"lg"})}),bh=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(!1),{user:n}=ve(),{toast:o}=he(),i=l.useCallback(async()=>{if(!n){s(null),a(!1);return}a(!0);try{const{data:u,error:m}=await T.from("fasting_sessions").select("*").eq("user_id",n.id).eq("status","active").order("start_time",{ascending:!1}).limit(1).maybeSingle();m&&console.error("Error loading fasting session:",m);const h=u||null;s(h),h&&ba({id:h.id,start_time:h.start_time,goal_duration_seconds:h.goal_duration_seconds,status:h.status,user_id:h.user_id})}catch(u){console.error("Error loading active session:",u);const m=TN();m&&m.user_id===n.id&&m.status==="active"?s(m):s(null)}finally{a(!1)}},[n]);l.useEffect(()=>{n?i():(s(null),a(!1))},[n,i]);const c=l.useCallback(async(u,m)=>{if(!n)return o({title:"Error",description:"You must be logged in to start a fasting session",variant:"destructive"}),null;a(!0);try{await T.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",n.id).eq("status","active");const h=m?m.toISOString():new Date().toISOString(),{data:p,error:x}=await T.from("fasting_sessions").insert([{user_id:n.id,start_time:h,goal_duration_seconds:u,status:"active"}]).select().single();if(x)throw x;const g=p;return s(g),ba({id:g.id,start_time:g.start_time,goal_duration_seconds:g.goal_duration_seconds,status:g.status,user_id:g.user_id}),g}catch(h){return console.error("Error starting fasting session:",h),o({title:"Error",description:"Failed to start fasting session",variant:"destructive"}),null}finally{a(!1)}},[n,o]),d=l.useCallback(async u=>{if(!n)return null;const m=u||e?.id;if(!m)return null;a(!0);try{const h=new Date().toISOString(),p=e?.start_time||new Date().toISOString(),x=Math.floor((new Date(h).getTime()-new Date(p).getTime())/1e3),g=e?.goal_duration_seconds||0,v=x>=g?"completed":"cancelled",{data:w,error:y}=await T.from("fasting_sessions").update({status:v,end_time:h,duration_seconds:x}).eq("id",m).eq("user_id",n.id).select().single();if(y)throw y;return s(null),ba(null),w}catch(h){return console.error("Error ending fasting session:",h),o({title:"Error",description:"Failed to end fasting session",variant:"destructive"}),null}finally{a(!1)}},[n,e,o]),f=l.useCallback(async u=>{if(!n)return null;const m=u||e?.id;if(!m)return null;a(!0);try{const{data:h,error:p}=await T.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("id",m).eq("user_id",n.id).select().single();if(p)throw p;return s(null),ba(null),h}catch(h){return console.error("Error cancelling fasting session:",h),o({title:"Error",description:"Failed to cancel fasting session",variant:"destructive"}),null}finally{a(!1)}},[n,e,o]);return{currentSession:e,loading:r,startFastingSession:c,endFastingSession:d,cancelFastingSession:f,loadActiveSession:i}},FN=({currentHour:e,existingLog:s="",onLogSaved:r})=>{const{isAdmin:a}=Ps(),{toast:n}=he(),{currentSession:o}=bh(),i=ft(),[c,d]=l.useState(s),[f,u]=l.useState(s),[m,h]=l.useState(!s),[p,x]=l.useState(!1),[g,v]=l.useState(!1);if(l.useEffect(()=>{console.log(" AdminPersonalLogInterface: existingLog changed:",{existingLog:s,currentHour:e}),d(s||""),u(s||""),h(!s),s!==c&&console.log(" FORCING STATE UPDATE:",{existingLog:s,currentLogText:c})},[s,e]),!a)return null;const w=async()=>{x(!0);try{console.log(" ADMIN LOG SAVE DEBUG:",{hourToUpdate:e,logText:c.trim(),logTextLength:c.trim().length,userId:o?.user_id});const{data:b,error:j}=await T.from("fasting_hours").update({admin_personal_log:c.trim()||null}).eq("hour",e).select("*");if(console.log(" SUPABASE UPDATE RESULT:",{data:b,error:j}),j)throw j;n({title:"Personal log saved",description:`Hour ${e} log updated successfully`}),h(!1),u(c.trim()),i.removeQueries({queryKey:Tt}),await i.invalidateQueries({queryKey:Tt}),await i.refetchQueries({queryKey:Tt}),console.log(" CACHE AGGRESSIVELY REFRESHED: For hour",e),r?.()}catch(b){console.error("Error saving personal log:",b),n({title:"Error saving log",description:"Please try again",variant:"destructive"})}finally{x(!1)}},y=b=>{d(j=>j?`${j} ${b}`:b),v(!1),m||h(!0)};return t.jsxs("div",{className:"mt-4 p-4 rounded-md border bg-card/50 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Admin Personal Log"}),t.jsxs("div",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-medium",children:["Hour ",e]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[!m&&c&&t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{u(c),h(!0)},className:"h-7 w-7 p-0",children:t.jsx(Wg,{className:"h-3 w-3"})}),t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>v(!g),className:"h-7 w-7 p-0",disabled:!m,children:t.jsx(js,{className:"h-3 w-3"})})]})]}),g&&m&&t.jsxs("div",{className:"mb-3 p-3 rounded border bg-muted/30",children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Voice Recording"}),t.jsx(wh,{onTranscription:y,isDisabled:p})]}),m?t.jsxs("div",{className:"space-y-3",children:[t.jsx(jr,{value:c,onChange:b=>d(b.target.value),placeholder:`Record your experience at hour ${e} of your fast...`,className:"min-h-[80px] text-sm resize-none",disabled:p}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>{d(f),h(!1),v(!1)},disabled:p,className:"h-7 px-3",children:[t.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Cancel"]}),t.jsxs(D,{size:"sm",onClick:w,disabled:p,className:"h-7 px-3",children:[t.jsx(Mt,{className:"h-3 w-3 mr-1"}),p?"Saving...":"Save"]})]})]}):t.jsx("div",{className:"space-y-2",children:c?t.jsx("div",{className:"text-sm text-foreground p-3 rounded border bg-muted/20",children:c}):t.jsxs("div",{className:"text-sm text-muted-foreground italic p-3 rounded border bg-muted/10",children:["No personal log for hour ",e," yet. Click the edit button or mic to add one."]})})]})},ON=()=>{const{isAdmin:e}=Ps(),s=ft(),{toast:r}=he();if(!e)return null;const a=async()=>{const n=s.getQueryData(Tt);console.log(" BEFORE REFRESH - Cache data:",n),r({title:"Cache Debug",description:"Check console for cache data. Forcing refresh..."}),s.removeQueries({queryKey:Tt}),await s.invalidateQueries({queryKey:Tt}),await s.refetchQueries({queryKey:Tt}),setTimeout(()=>{const o=s.getQueryData(Tt);console.log(" AFTER REFRESH - Cache data:",o),r({title:"Cache Refreshed",description:"Check console for updated cache data"})},2e3)};return t.jsx(D,{variant:"outline",size:"sm",onClick:a,className:"mt-2",children:"Debug & Force Refresh Cache"})},so=72,LN=({currentHour:e=1,className:s})=>{const{data:r,isLoading:a}=RN(),n=ft(),[o,i]=l.useState(Math.min(Math.max(e||1,0),so)),[c,d]=l.useState(!1),[f,u]=l.useState(!1);l.useEffect(()=>{c||i(Math.min(Math.max(e||1,0),so))},[e,c]);const m=v=>{const w=Math.min(Math.max(v,0),so);i(w),d(!0),u(!0),setTimeout(()=>u(!1),100)},p=l.useMemo(()=>{const v=new Map;return(r||[]).forEach(w=>v.set(w.hour,w)),v},[r]).get(o),x=IN({fastingHour:p||null,autoRotate:!0,rotationInterval:1e4}),g=v=>{switch(v){case"metabolic":return"Metabolic Changes";case"physiological":return"Physical Effects";case"mental":return"Mental State";case"stage":return"Stage";case"encouragement":return"Encouragement";default:return""}};return t.jsxs("div",{className:K("w-full",s),children:[t.jsx(AN,{currentHour:o,className:"mb-3",onHourChange:m}),t.jsx("div",{className:"mt-4 rounded-md border bg-card p-4",role:"region","aria-live":"polite",children:a?t.jsxs("div",{className:"space-y-3",children:[t.jsx(Wt,{className:"h-5 w-1/2"}),t.jsx(Wt,{className:"h-4 w-3/4"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Wt,{className:"h-5 w-20"}),t.jsx(Wt,{className:"h-5 w-24"})]}),t.jsx(Wt,{className:"h-4 w-full"}),t.jsx(Wt,{className:"h-4 w-5/6"})]}):t.jsxs("div",{className:"space-y-3",children:[x.totalVariants>1&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:x.goToPrevious,className:"h-6 w-6 p-0",children:t.jsx(cg,{className:"h-3 w-3"})}),t.jsx(D,{variant:"ghost",size:"sm",onClick:x.toggleRotation,className:"h-6 w-6 p-0",children:x.isRotating?t.jsx(rd,{className:"h-3 w-3"}):t.jsx(Ea,{className:"h-3 w-3"})}),t.jsx(D,{variant:"ghost",size:"sm",onClick:x.goToNext,className:"h-6 w-6 p-0",children:t.jsx(li,{className:"h-3 w-3"})})]}),t.jsxs("div",{className:"min-h-[80px] relative",children:[t.jsx("div",{className:"absolute bottom-2 right-2 bg-primary/10 text-primary border border-primary/20 rounded-full w-8 h-8 flex items-center justify-center text-xs font-bold z-10",children:o}),x.totalVariants>1?t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h4",{className:"text-xs font-medium text-muted-foreground",children:g(x.currentType)}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[x.currentIndex+1," of ",x.totalVariants]})]}),t.jsx("div",{className:"text-sm text-foreground animate-fade-in pr-10",style:{animation:f?"fade-in 0.3s ease-in-out":"fade-in 0.8s ease-in-out"},children:x.currentContent},`${o}-${x.currentIndex}-${x.currentType}`)]}):t.jsx("div",{className:"text-sm text-muted-foreground pr-10",children:p?.physiological_effects||p?.body_state||"We'll add details for this hour soon."})]})]})}),t.jsx(FN,{currentHour:o,existingLog:p?.admin_personal_log,onLogSaved:async()=>{n.removeQueries({queryKey:Tt}),await n.invalidateQueries({queryKey:Tt}),await n.refetchQueries({queryKey:Tt}),console.log(" TIMELINE REFRESH: Forced complete refresh after log save for hour",o)}},`admin-log-${o}-${p?.admin_personal_log}`),t.jsx(ON,{})]})},$N=({quotes:e,currentFastingHour:s=0,className:r="",onSaveQuote:a})=>t.jsxs("div",{className:r,children:[t.jsx(LN,{currentHour:s}),e&&e.length>0&&t.jsx(yh,{quotes:e,className:"mt-4",onSaveQuote:a,compact:!0})]}),wc=["quotes","timer"];async function UN(){const{data:e,error:s}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["fasting_timer_quotes","walking_timer_quotes"]);if(s)throw s;const r={fasting_timer_quotes:[],walking_timer_quotes:[]};return e?.forEach(a=>{try{const n=JSON.parse(a.setting_value||"[]");a.setting_key==="fasting_timer_quotes"?r.fasting_timer_quotes=n:a.setting_key==="walking_timer_quotes"&&(r.walking_timer_quotes=n)}catch(n){console.warn(`Failed to parse quotes for ${a.setting_key}:`,n)}}),r}const jh=()=>{const e=ft(),{data:s,isLoading:r,refetch:a}=ut({queryKey:wc,queryFn:UN,staleTime:24*60*60*1e3}),n=xt({mutationFn:async({type:i,newQuotes:c})=>{const{error:d}=await T.from("shared_settings").upsert({setting_key:i,setting_value:JSON.stringify(c)});if(d)throw d;return{type:i,newQuotes:c}},onSuccess:()=>{e.invalidateQueries({queryKey:wc})}});return{quotes:s||{fasting_timer_quotes:[],walking_timer_quotes:[]},loading:r,updateQuotes:async(i,c)=>{try{return await n.mutateAsync({type:i,newQuotes:c}),{success:!0}}catch(d){return console.error("Error updating quotes:",d),{success:!1,error:d}}},refetch:a}},Gi="fasting_celebrated_milestones",Ho=e=>{if(!e)return new Set;try{const s=localStorage.getItem(`${Gi}_${e}`);return s?new Set(JSON.parse(s)):new Set}catch{return new Set}},zN=(e,s)=>{try{const r=Ho(e);r.add(s),localStorage.setItem(`${Gi}_${e}`,JSON.stringify([...r]))}catch{}},qN=(e,s)=>e==="hourly"?"color-wave":s===16?"particle-burst":s===24||s>=20?"fireworks":"particle-burst",BN=e=>{const[s,r]=l.useState({lastMilestoneHour:0,isVisible:!1,currentEvent:null,animationType:"ring-pulse"}),{toast:a}=he(),n=l.useCallback(d=>{if(e&&!d.message.includes(" Testing")){if(Ho(e).has(d.hours)){console.log(`Milestone ${d.hours} already celebrated for session ${e}, skipping`);return}zN(e,d.hours)}console.log(` Triggering celebration for ${d.type} milestone:`,d);const f=qN(d.type,d.hours);r({lastMilestoneHour:d.hours,isVisible:!0,currentEvent:d,animationType:f}),a({title:" Milestone Reached!",description:d.message,duration:5e3}),setTimeout(()=>{r(u=>({...u,isVisible:!1}))},3e3)},[a,e]),o=l.useCallback((d,f)=>{const u=Math.floor(d/3600);if(!e)return;const m=Ho(e);if(u>0&&!m.has(u)){const h={type:"hourly",hours:u,message:`${u} hour${u===1?"":"s"} of fasting completed!`};n(h);return}if(f&&d>=f){const h=Math.floor(f/3600);if(!m.has(h)){const p={type:"completion",hours:h,message:` Goal completed! ${h} hour fast achieved!`};n(p)}}},[e,n]),i=l.useCallback(()=>{if(r({lastMilestoneHour:0,isVisible:!1,currentEvent:null,animationType:"ring-pulse"}),e)try{localStorage.removeItem(`${Gi}_${e}`)}catch{}},[e]),c=l.useCallback(()=>{r(d=>({...d,isVisible:!1}))},[]);return{celebration:s,checkForMilestones:o,resetMilestones:i,triggerCelebration:n,closeCelebration:c}},WN=()=>{const[e,s]=l.useState(0),[r,a]=l.useState(60*60*60),[n,o]=l.useState("longterm"),[i,c]=l.useState("up"),[d,f]=l.useState(!1),[u,m]=l.useState(!1),[h,p]=l.useState("finish"),[x,g]=l.useState(!1),[v,w]=l.useState(!1);l.useState(0);const{currentSession:y,startFastingSession:b,endFastingSession:j,cancelFastingSession:N,refreshActiveSession:C}=Wi(),{currentSession:_,startWalkingSession:k,endWalkingSession:S}=Sr(),{currentMode:E,timerStatus:A,switchMode:I,formatTime:z}=vh(),{toast:W}=he();ve();const{profile:Y}=Ie(),{quotes:G}=jh(),{saveQuoteAsGoal:te}=qs(),{celebration:$,checkForMilestones:q,resetMilestones:de,closeCelebration:Z,triggerCelebration:F}=BN(y?.id);Ps();const Q=!!y,ae=le=>{const be=Math.floor(le/3600),ke=Math.floor(le%3600/60),Te=le%60;return`${be.toString().padStart(2,"0")}:${ke.toString().padStart(2,"0")}:${Te.toString().padStart(2,"0")}`};l.useEffect(()=>{C()},[C]),l.useEffect(()=>{Rs.prefetchQuery({queryKey:["fasting","hours"],queryFn:async()=>{const{data:le,error:be}=await T.from("fasting_hours").select("*").lte("hour",72).order("hour",{ascending:!0});if(be)throw be;return le||[]},staleTime:24*60*60*1e3}),Rs.prefetchQuery({queryKey:["quotes","timer"],queryFn:async()=>{const{data:le,error:be}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["fasting_timer_quotes","walking_timer_quotes"]);if(be)throw be;return le||[]},staleTime:24*60*60*1e3})},[]),l.useEffect(()=>{y?.goal_duration_seconds&&a(y.goal_duration_seconds)},[y]),l.useEffect(()=>{let le,be;if(Q&&y){const ke=()=>{const Te=new Date(y.start_time),O=Math.floor((new Date().getTime()-Te.getTime())/1e3);s(O),q(O,y.goal_duration_seconds)};if(ke(),le=setInterval(ke,1e3),y.goal_duration_seconds){const Te=new Date(y.start_time),O=new Date(Te.getTime()+y.goal_duration_seconds*1e3).getTime()-Date.now();O>0&&(console.log(` Setting goal completion timeout for ${O}ms from now`),be=setTimeout(async()=>{console.log(" Goal achieved! Auto-completing fasting session...");try{await j(y.id),W({title:" Goal Achieved!",description:`Congratulations! You've completed your ${ae(y.goal_duration_seconds)} fast!`})}catch(ue){console.error("Error auto-completing fasting session:",ue)}},O))}}else s(0);return()=>{le&&clearInterval(le),be&&clearTimeout(be)}},[Q,y?.start_time,y?.id,y?.goal_duration_seconds,q,j,W,ae]);const R=async()=>{if(!y?.id){console.error("No active fasting session found"),W({title:"Error",description:"No active fasting session found.",variant:"destructive"});return}try{h==="cancel"?(await N(y.id),yc("stop",n,e)):(await j(y.id),yc("stop",n,e))}catch(le){console.error("Error stopping fasting session:",le),W({title:"Error",description:"Failed to stop fasting session. Please try again.",variant:"destructive"})}},B=async()=>{const le=await k();le.error?W({variant:"destructive",title:"Error",description:le.error.message}):W({title:"Walking started",description:"Your walking session has begun!"})},L=async()=>{if(!_)return;const le=await S();le.error?W({variant:"destructive",title:"Error",description:le.error.message}):W({title:"Walking completed",description:`Session completed! Calories burned: ${le.data?.calories_burned||0}`})},se=()=>{if(i==="up")return ae(e);{const le=Math.max(0,r-e);return ae(le)}},J=()=>Math.min(e/r*100,100),ne=()=>y?"Extended Fast":"Start Your Fast",H=async(le,be,ke)=>{o("longterm"),a(le),f(!1),be&&ke?await me(be,le):await b({goal_duration_seconds:le})&&W({title:"Fast started",description:`Your ${ae(le)} fast has begun!`})},me=async(le,be)=>{try{if(await b({goal_duration_seconds:be,start_time:le})){await C();const ct=new Date().getTime()-le.getTime(),O=Math.floor(ct/1e3);W({title:"Fast started retroactively",description:`Fast started ${ae(O)} ago`})}}catch{W({title:"Error",description:"Failed to start retroactive fast",variant:"destructive"})}};return t.jsxs("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:[t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(yn,{})}),E==="fasting"&&t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx($i,{onClick:()=>w(!0),title:"View fasting history"})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent mb-1",children:E==="fasting"?"Fasting Timer":"Walking Timer"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:E==="fasting"?ne():"Track your walking session"})]})]}),t.jsx("div",{className:"relative mb-12 mt-12",children:E==="fasting"?t.jsx(t.Fragment,{children:t.jsx(W0,{progress:J(),displayTime:se(),isActive:Q,showSlideshow:Y?.enable_fasting_slideshow??!1,countDirection:i,onToggleCountDirection:()=>c(i==="up"?"down":"up"),fastType:n,goalDuration:r/3600,celebrationAnimation:$.isVisible?{isActive:$.isVisible,type:$.animationType,onAnimationEnd:Z}:void 0})}):t.jsx(bm,{displayTime:z(A.walking.timeElapsed),isActive:A.walking.isActive,onStart:B,onStop:L,showSlideshow:Y?.enable_walking_slideshow??!1,selectedSpeed:3,onSpeedChange:()=>{}})}),E==="fasting"&&t.jsx("div",{className:"space-y-4",children:Q?t.jsx(gr,{children:t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{onClick:()=>{p("cancel"),m(!0)},variant:"action-primary",size:"action-main",children:t.jsx(Pe,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Cancel your fast without saving it to history"})})]}),t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsxs(D,{onClick:()=>{p("finish"),m(!0)},variant:"action-primary",size:"action-main",children:[t.jsx(Zc,{className:"w-5 h-5 mr-2"}),"Finish"]})}),t.jsx(Me,{children:t.jsx("p",{children:"Complete your fast and save it to history"})})]})]})}):t.jsx("div",{className:"space-y-3",children:t.jsxs(D,{onClick:()=>f(!0),variant:"action-primary",size:"start-button",className:"w-full",children:[t.jsx(Ea,{className:"w-8 h-8 mr-3"}),"Start Fasting"]})})}),Y?.enable_fasting_slideshow?t.jsx($N,{quotes:G.fasting_timer_quotes,currentFastingHour:Math.max(1,Math.ceil(e/3600)),className:"mt-8",onSaveQuote:te}):null]}),d&&t.jsx(Qj,{currentDuration:r,onSelect:H,onClose:()=>f(!1)}),t.jsx(Kj,{open:u,onOpenChange:m,onConfirm:()=>{m(!1),R()},currentDuration:ae(e),actionType:h}),v&&t.jsx(cN,{onClose:()=>w(!1)}),t.jsx(na,{isOpen:x,onClose:()=>g(!1),title:Xe.timer.title,subtitle:Xe.timer.subtitle,heroQuote:Xe.timer.heroQuote,backgroundImage:Xe.timer.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:Xe.timer.subtitle})}),Xe.timer.sections.map((le,be)=>{const ke=le.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(ke,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:le.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:le.description})]})]},be)})]})})]})};function GN(e,s=[]){let r=[];function a(o,i){const c=l.createContext(i),d=r.length;r=[...r,i];function f(m){const{scope:h,children:p,...x}=m,g=h?.[e][d]||c,v=l.useMemo(()=>x,Object.values(x));return t.jsx(g.Provider,{value:v,children:p})}function u(m,h){const p=h?.[e][d]||c,x=l.useContext(p);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${o}\``)}return f.displayName=o+"Provider",[f,u]}const n=()=>{const o=r.map(i=>l.createContext(i));return function(c){const d=c?.[e]||o;return l.useMemo(()=>({[`__scope${e}`]:{...c,[e]:d}}),[c,d])}};return n.scopeName=e,[a,VN(n,...s)]}function VN(...e){const s=e[0];if(e.length===1)return s;const r=()=>{const a=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(o){const i=a.reduce((c,{useScope:d,scopeName:f})=>{const m=d(o)[`__scope${f}`];return{...c,...m}},{});return l.useMemo(()=>({[`__scope${s.scopeName}`]:i}),[i])}};return r.scopeName=s.scopeName,r}var ro="rovingFocusGroup.onEntryFocus",HN={bubbles:!1,cancelable:!0},kn="RovingFocusGroup",[Qo,Nh,QN]=en(kn),[KN,_r]=GN(kn,[QN]),[YN,XN]=KN(kn),Sh=l.forwardRef((e,s)=>t.jsx(Qo.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(Qo.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(JN,{...e,ref:s})})}));Sh.displayName=kn;var JN=l.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:n=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:d,onEntryFocus:f,preventScrollOnEntryFocus:u=!1,...m}=e,h=l.useRef(null),p=we(s,h),x=zs(o),[g=null,v]=Lt({prop:i,defaultProp:c,onChange:d}),[w,y]=l.useState(!1),b=Et(f),j=Nh(r),N=l.useRef(!1),[C,_]=l.useState(0);return l.useEffect(()=>{const k=h.current;if(k)return k.addEventListener(ro,b),()=>k.removeEventListener(ro,b)},[b]),t.jsx(YN,{scope:r,orientation:a,dir:x,loop:n,currentTabStopId:g,onItemFocus:l.useCallback(k=>v(k),[v]),onItemShiftTab:l.useCallback(()=>y(!0),[]),onFocusableItemAdd:l.useCallback(()=>_(k=>k+1),[]),onFocusableItemRemove:l.useCallback(()=>_(k=>k-1),[]),children:t.jsx(pe.div,{tabIndex:w||C===0?-1:0,"data-orientation":a,...m,ref:p,style:{outline:"none",...e.style},onMouseDown:re(e.onMouseDown,()=>{N.current=!0}),onFocus:re(e.onFocus,k=>{const S=!N.current;if(k.target===k.currentTarget&&S&&!w){const E=new CustomEvent(ro,HN);if(k.currentTarget.dispatchEvent(E),!E.defaultPrevented){const A=j().filter(G=>G.focusable),I=A.find(G=>G.active),z=A.find(G=>G.id===g),Y=[I,z,...A].filter(Boolean).map(G=>G.ref.current);kh(Y,u)}}N.current=!1}),onBlur:re(e.onBlur,()=>y(!1))})})}),_h="RovingFocusGroupItem",Ch=l.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:n=!1,tabStopId:o,...i}=e,c=ts(),d=o||c,f=XN(_h,r),u=f.currentTabStopId===d,m=Nh(r),{onFocusableItemAdd:h,onFocusableItemRemove:p}=f;return l.useEffect(()=>{if(a)return h(),()=>p()},[a,h,p]),t.jsx(Qo.ItemSlot,{scope:r,id:d,focusable:a,active:n,children:t.jsx(pe.span,{tabIndex:u?0:-1,"data-orientation":f.orientation,...i,ref:s,onMouseDown:re(e.onMouseDown,x=>{a?f.onItemFocus(d):x.preventDefault()}),onFocus:re(e.onFocus,()=>f.onItemFocus(d)),onKeyDown:re(e.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){f.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const g=t1(x,f.orientation,f.dir);if(g!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let w=m().filter(y=>y.focusable).map(y=>y.ref.current);if(g==="last")w.reverse();else if(g==="prev"||g==="next"){g==="prev"&&w.reverse();const y=w.indexOf(x.currentTarget);w=f.loop?s1(w,y+1):w.slice(y+1)}setTimeout(()=>kh(w))}})})})});Ch.displayName=_h;var ZN={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function e1(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function t1(e,s,r){const a=e1(e.key,r);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ZN[a]}function kh(e,s=!1){const r=document.activeElement;for(const a of e)if(a===r||(a.focus({preventScroll:s}),document.activeElement!==r))return}function s1(e,s){return e.map((r,a)=>e[(s+a)%e.length])}var Vi=Sh,Hi=Ch,Qi="Tabs",[r1,tk]=jt(Qi,[_r]),Eh=_r(),[a1,Ki]=r1(Qi),Th=l.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,onValueChange:n,defaultValue:o,orientation:i="horizontal",dir:c,activationMode:d="automatic",...f}=e,u=zs(c),[m,h]=Lt({prop:a,onChange:n,defaultProp:o});return t.jsx(a1,{scope:r,baseId:ts(),value:m,onValueChange:h,orientation:i,dir:u,activationMode:d,children:t.jsx(pe.div,{dir:u,"data-orientation":i,...f,ref:s})})});Th.displayName=Qi;var Mh="TabsList",Ph=l.forwardRef((e,s)=>{const{__scopeTabs:r,loop:a=!0,...n}=e,o=Ki(Mh,r),i=Eh(r);return t.jsx(Vi,{asChild:!0,...i,orientation:o.orientation,dir:o.dir,loop:a,children:t.jsx(pe.div,{role:"tablist","aria-orientation":o.orientation,...n,ref:s})})});Ph.displayName=Mh;var Dh="TabsTrigger",Ah=l.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,disabled:n=!1,...o}=e,i=Ki(Dh,r),c=Eh(r),d=Fh(i.baseId,a),f=Oh(i.baseId,a),u=a===i.value;return t.jsx(Hi,{asChild:!0,...c,focusable:!n,active:u,children:t.jsx(pe.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":f,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:d,...o,ref:s,onMouseDown:re(e.onMouseDown,m=>{!n&&m.button===0&&m.ctrlKey===!1?i.onValueChange(a):m.preventDefault()}),onKeyDown:re(e.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&i.onValueChange(a)}),onFocus:re(e.onFocus,()=>{const m=i.activationMode!=="manual";!u&&!n&&m&&i.onValueChange(a)})})})});Ah.displayName=Dh;var Rh="TabsContent",Ih=l.forwardRef((e,s)=>{const{__scopeTabs:r,value:a,forceMount:n,children:o,...i}=e,c=Ki(Rh,r),d=Fh(c.baseId,a),f=Oh(c.baseId,a),u=a===c.value,m=l.useRef(u);return l.useEffect(()=>{const h=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(h)},[]),t.jsx(Nt,{present:n||u,children:({present:h})=>t.jsx(pe.div,{"data-state":u?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":d,hidden:!h,id:f,tabIndex:0,...i,ref:s,style:{...e.style,animationDuration:m.current?"0s":void 0},children:h&&o})})});Ih.displayName=Rh;function Fh(e,s){return`${e}-trigger-${s}`}function Oh(e,s){return`${e}-content-${s}`}var n1=Th,Lh=Ph,$h=Ah,Uh=Ih;const Ha=n1,En=l.forwardRef(({className:e,...s},r)=>t.jsx(Lh,{ref:r,className:K("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));En.displayName=Lh.displayName;const ys=l.forwardRef(({className:e,...s},r)=>t.jsx($h,{ref:r,className:K("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));ys.displayName=$h.displayName;const ws=l.forwardRef(({className:e,...s},r)=>t.jsx(Uh,{ref:r,className:K("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));ws.displayName=Uh.displayName;const Tn=()=>{const[e,s]=l.useState(!1),{toast:r}=he();return{addToDefaultGoals:async c=>{s(!0);try{const{data:d,error:f}=await T.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(f)throw f;const u=d?.setting_value?JSON.parse(d.setting_value):[];if(u.some(g=>g.title===c.title||g.id===c.id))return r({title:"Already exists",description:"This motivator is already in the default goals.",variant:"destructive"}),!1;const h={id:c.id,title:c.title,description:c.content||"",category:c.category||"personal",imageUrl:c.imageUrl},p=[...u,h],{error:x}=await T.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(p)},{onConflict:"setting_key"});if(x)throw x;return r({title:"Added to default goals",description:`"${c.title}" has been added to the default goal ideas.`}),!0}catch(d){return console.error("Error adding to default goals:",d),r({title:"Error",description:"Failed to add motivator to default goals.",variant:"destructive"}),!1}finally{s(!1)}},removeFromDefaultGoals:async c=>{s(!0);try{const{data:d,error:f}=await T.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(f)throw f;const m=(d?.setting_value?JSON.parse(d.setting_value):[]).filter(p=>p.id!==c),{error:h}=await T.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(m)},{onConflict:"setting_key"});if(h)throw h;return r({title:"Removed from default goals",description:"The goal idea has been removed from the default list."}),!0}catch(d){return console.error("Error removing from default goals:",d),r({title:"Error",description:"Failed to remove goal from default list.",variant:"destructive"}),!1}finally{s(!1)}},updateDefaultGoal:async(c,d)=>{s(!0);try{console.log(" Starting update for goal ID:",c,"with updates:",d);const{data:f,error:u}=await T.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(u)throw u;let m=[];f?.setting_value&&(m=JSON.parse(f.setting_value)),console.log(" Current goal ideas:",m);const h=m.findIndex(x=>x.id===c);if(h===-1)return console.error(" Goal not found with ID:",c),r({title:"Error",description:"Goal idea not found",variant:"destructive"}),!1;m[h]={...m[h],title:d.title||m[h].title,description:d.content||m[h].description,imageUrl:d.imageUrl!==void 0?d.imageUrl:m[h].imageUrl},console.log(" Updated goal:",m[h]);const{error:p}=await T.from("shared_settings").upsert({setting_key:"admin_goal_ideas",setting_value:JSON.stringify(m)},{onConflict:"setting_key"});if(p)throw console.error(" Database update error:",p),p;return console.log(" Successfully updated admin goal ideas in database"),r({title:" Goal Updated!",description:"Admin goal idea has been updated successfully"}),!0}catch(f){return console.error(" Error updating default goal:",f),r({title:"Error",description:"Failed to update goal idea",variant:"destructive"}),!1}finally{s(!1)}},checkIfInDefaultGoals:async c=>{try{const{data:d,error:f}=await T.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();return f||!d?.setting_value?!1:JSON.parse(d.setting_value).some(m=>m.id===c)}catch(d){return console.error("Error checking if in default goals:",d),!1}},loading:e}},zh=async(e,s=1024,r=1024,a=.8)=>new Promise((n,o)=>{const i=document.createElement("canvas"),c=i.getContext("2d"),d=new Image;d.onload=()=>{let{width:f,height:u}=d;f>u?f>s&&(u=u*s/f,f=s):u>r&&(f=f*r/u,u=r),i.width=f,i.height=u,c?.drawImage(d,0,0,f,u),i.toBlob(m=>{if(m){const h=i.toDataURL("image/jpeg",a);n({blob:m,dataUrl:h,size:m.size,width:f,height:u})}else o(new Error("Failed to compress image"))},"image/jpeg",a)},d.onerror=()=>o(new Error("Failed to load image")),d.src=URL.createObjectURL(e)}),o1=e=>e?1/0:100,i1=async(e,s)=>{const r=o1(s);if(s)return{canUpload:!0,currentCount:0,limit:r};const n=Xi(e).length;return{canUpload:n<r,currentCount:n,limit:r}},Yi="motivator_images",l1=(e,s,r)=>{const a=`${e}_${Date.now()}`,n={id:a,userId:e,dataUrl:s.dataUrl,originalName:r,size:s.size,uploadedAt:new Date().toISOString()},o=Xi();return o.push(n),localStorage.setItem(Yi,JSON.stringify(o)),a},Xi=e=>{try{const s=localStorage.getItem(Yi),r=s?JSON.parse(s):[];return e?r.filter(a=>a.userId===e):r}catch(s){return console.error("Error reading local images:",s),[]}},c1=(e=50)=>{try{const s=Xi(),r=s.reduce((n,o)=>n+o.size,0),a=e*1024*1024;if(r>a){s.sort((i,c)=>new Date(i.uploadedAt).getTime()-new Date(c.uploadedAt).getTime());let n=r;const o=[];for(let i=s.length-1;i>=0;i--)n<=a?o.unshift(s[i]):n-=s[i].size;localStorage.setItem(Yi,JSON.stringify(o))}}catch(s){console.error("Error cleaning up local storage:",s)}},qh=async(e,s,r,a,n="motivator-images")=>{try{const{canUpload:o,currentCount:i,limit:c}=await i1(s,r);if(!o)return{success:!1,imageId:"",url:"",error:`Storage limit reached (${i}/${c} images). Upgrade to Pro for unlimited storage.`};const d=await zh(e);if(r){const f=`${s}/${Date.now()}_${e.name}`;console.log(" Uploading to storage:",{bucketName:n,fileName:f,userId:s});const{data:u,error:m}=await a.storage.from(n).upload(f,d.blob);if(m)throw console.error(" Storage upload error:",m),m;console.log(" Storage upload success:",u);const{data:h}=a.storage.from(n).getPublicUrl(f);return{success:!0,imageId:f,url:h.publicUrl}}else{const f=l1(s,d,e.name);return c1(),{success:!0,imageId:f,url:d.dataUrl}}}catch(o){return console.error("Upload error:",o),{success:!1,imageId:"",url:"",error:o instanceof Error?o.message:"Upload failed"}}},Bh=({currentImageUrl:e,onImageUpload:s,onImageRemove:r,showUploadOptionsWhenImageExists:a=!1,regenerateButton:n,aiGenerationPrompt:o,motivatorId:i,onAiGenerate:c,isGenerating:d=!1,bucket:f="motivator-images"})=>{const[u,m]=l.useState(!1),[h,p]=l.useState(!1),[x,g]=l.useState(e||null),v=l.useRef(null),w=l.useRef(null),{toast:y}=he(),{user:b}=ve(),{hasPremiumFeatures:j}=Es(),N=zi(),C=W=>{W.preventDefault(),m(!0)},_=W=>{W.preventDefault(),m(!1)},k=W=>{W.preventDefault(),m(!1);const G=Array.from(W.dataTransfer.files).find(te=>te.type.startsWith("image/"));G&&I(G)},S=()=>{v.current?.click()},E=()=>{w.current?.click()},A=W=>{const Y=W.target.files?.[0];Y&&I(Y)},I=async W=>{if(!b){y({title:"Error",description:"Please sign in to upload images",variant:"destructive"});return}if(!W.type.startsWith("image/")){y({title:"Error",description:"Please select an image file",variant:"destructive"});return}if(W.size>5*1024*1024){y({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});return}p(!0);try{const Y=URL.createObjectURL(W);g(Y);const G=await qh(W,b.id,j,T,f);if(!G.success)throw new Error(G.error||"Upload failed");s(G.url),y({title:"Success",description:"Image uploaded successfully"})}catch(Y){console.error("Upload error:",Y),y({title:"Error",description:"Failed to upload image",variant:"destructive"}),g(e||null)}finally{p(!1)}},z=()=>{g(null),r()};return t.jsxs("div",{className:"space-y-4",children:[x?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"aspect-video max-h-[70vh] bg-ceramic-rim rounded-lg overflow-hidden flex items-center justify-center",children:t.jsx("img",{src:x,alt:"Preview",className:"w-full h-full object-contain"})}),t.jsx(D,{variant:"destructive",size:"sm",onClick:z,className:"absolute top-2 right-2 h-8 w-8 p-0",disabled:h,children:t.jsx(Pe,{className:"w-4 h-4"})}),n&&t.jsx("div",{className:"absolute top-2 right-12",children:n})]}),a&&t.jsxs("div",{className:"space-y-3",children:[N&&t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(D,{variant:"outline",onClick:S,disabled:h,className:"h-16 flex-col space-y-1 bg-ceramic-base border-ceramic-rim",children:[t.jsx(Wr,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",children:"Upload photo"})]}),t.jsxs(D,{variant:"outline",onClick:E,disabled:h,className:"h-16 flex-col space-y-1 bg-ceramic-base border-ceramic-rim",children:[t.jsx(tr,{className:"w-4 h-4"}),t.jsx("span",{className:"text-xs",children:"Use camera"})]})]}),!N&&t.jsxs(D,{variant:"outline",onClick:S,disabled:h,className:"w-full bg-ceramic-base border-ceramic-rim",children:[t.jsx(qr,{className:"w-4 h-4 mr-2"}),"Upload New Image"]})]})]}):t.jsxs("div",{className:"space-y-4",children:[!N&&t.jsx("div",{className:`
                border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors
                ${u?"border-primary bg-primary/5":"border-ceramic-rim"}
                ${h?"opacity-50 cursor-not-allowed":"hover:border-primary hover:bg-primary/5"}
              `,onDragOver:C,onDragLeave:_,onDrop:k,onClick:h?void 0:S,children:h?t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(Yt,{className:"w-8 h-8 text-primary animate-spin"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx(qr,{className:"w-8 h-8 text-muted-foreground"}),t.jsx("p",{className:"text-sm font-medium text-warm-text",children:"Upload photo"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Drag & drop or click to browse"})]})}),N&&t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(D,{variant:"outline",onClick:S,disabled:h,className:"h-24 flex-col space-y-2 bg-ceramic-base border-ceramic-rim",children:[t.jsx(Wr,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm",children:"Upload photo"})]}),t.jsxs(D,{variant:"outline",onClick:E,disabled:h,className:"h-24 flex-col space-y-2 bg-ceramic-base border-ceramic-rim",children:[t.jsx(tr,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm",children:"Use camera"})]})]}),!N&&t.jsxs(D,{variant:"outline",onClick:S,disabled:h,className:"w-full bg-ceramic-base border-ceramic-rim",children:[t.jsx(qr,{className:"w-4 h-4 mr-2"}),"Upload photo"]})]}),t.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:A,className:"hidden"}),t.jsx("input",{ref:w,type:"file",accept:"image/*",capture:"environment",onChange:A,className:"hidden"})]})},d1=()=>{const[e,s]=l.useState([]),[r,a]=l.useState(!0);he();const n=async()=>{try{const{data:o,error:i}=await T.from("shared_settings").select("setting_value").eq("setting_key","ai_admin_motivator_templates").single();if(i&&i.code!=="PGRST116")throw i;if(o?.setting_value){const c=JSON.parse(o.setting_value);s(Array.isArray(c)?c:[])}else s([])}catch(o){console.error("Error loading admin templates:",o),s([])}finally{a(!1)}};return l.useEffect(()=>{n()},[]),{templates:e,loading:r,refreshTemplates:n}},Qa=({motivator:e,onSave:s,onClose:r})=>{const[a,n]=l.useState(e?.title||""),[o,i]=l.useState(e?.content||""),[c,d]=l.useState(e?.imageUrl||""),[f,u]=l.useState(!1),[m,h]=l.useState(null),{toast:p}=he(),{templates:x,loading:g}=d1(),v=!!e?.id;l.useEffect(()=>{e&&(n(e.title||""),i(e.content||""),d(e.imageUrl||""))},[e]);const w=async()=>{if(!a.trim()){p({title:"Title required",description:"Please add a title for your motivator.",variant:"destructive"});return}const j={id:e?.id||m||"",title:a.trim(),content:o.trim(),imageUrl:c||void 0};if(m&&!e?.id)try{await T.from("motivators").update({title:j.title,content:j.content,image_url:j.imageUrl}).eq("id",m),j.id=m}catch(N){console.error("Error updating temporary motivator:",N)}console.log("MotivatorFormModal: Saving motivator data:",j),s(j)},y=j=>{j.length<50?n(j):i(j),u(!1)},b=j=>{n(j.title),i(j.description),j.imageUrl&&d(j.imageUrl)};return t.jsxs(it,{isOpen:!0,onClose:r,title:v?"Edit Motivator":"Create New Motivator",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:r,className:"w-full bg-ceramic-base border-ceramic-rim",children:"Cancel"}),t.jsxs(D,{onClick:w,disabled:!a.trim(),className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(Mt,{className:"w-4 h-4 mr-2"}),v?"Save":"Create"]})]}),children:[!v&&x.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(an,{className:"w-4 h-4 text-primary"}),t.jsx(fe,{className:"text-warm-text font-medium",children:"Get inspired by examples"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-40 overflow-y-auto",children:x.map(j=>t.jsx(oe,{className:"p-3 cursor-pointer hover:bg-ceramic-base border-ceramic-rim transition-colors",onClick:()=>b(j),children:t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"font-medium text-sm text-warm-text",children:j.title}),t.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:j.description}),t.jsx(vs,{variant:"secondary",className:"text-xs",children:j.category})]})},j.id))}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:" Click any example to use as a starting point (you can edit it afterwards)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(fe,{htmlFor:"title",className:"text-warm-text font-medium",children:"Title *"}),t.jsx(yt,{feature:"Voice Input",showUpgrade:!1,children:t.jsx("button",{onClick:()=>u(!0),className:"w-6 h-6 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200",children:t.jsx(js,{className:"w-3 h-3 mx-auto"})})})]}),t.jsx(ge,{id:"title",value:a,onChange:j=>n(j.target.value),className:"bg-ceramic-base border-ceramic-rim",placeholder:"What motivates you to fast?"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(fe,{htmlFor:"content",className:"text-warm-text font-medium",children:"Description (Optional)"}),t.jsx(yt,{feature:"Voice Input",showUpgrade:!1,children:t.jsx("button",{onClick:()=>u(!0),className:"w-6 h-6 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200",children:t.jsx(js,{className:"w-3 h-3 mx-auto"})})})]}),t.jsx(jr,{id:"content",value:o,onChange:j=>i(j.target.value),className:"bg-ceramic-base border-ceramic-rim min-h-[40px]",placeholder:"Optional: Add more details about this motivation..."})]}),t.jsx("div",{className:"space-y-2",children:t.jsx(Bh,{currentImageUrl:c,onImageUpload:d,onImageRemove:()=>d(""),showUploadOptionsWhenImageExists:!0})}),t.jsx("div",{className:"h-2"})]}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[60]",children:t.jsxs("div",{className:"bg-ceramic-plate rounded-2xl p-6 w-full max-w-sm",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("h4",{className:"font-semibold text-warm-text mb-2",children:"Voice Input"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Speak your motivator title or description"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(yt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(wh,{onTranscription:y})}),t.jsx(D,{variant:"outline",onClick:()=>u(!1),className:"w-full",children:"Cancel"})]})]})})]})},u1=()=>{const{user:e}=ve(),s=ft(),[r,a]=l.useState([]),[n,o]=l.useState([]),[i,c]=l.useState(!1),d=async(x,g)=>{if(!e)throw new Error("User not authenticated");c(!0);const v=[];try{if(g==="today"){const w=new Date().toISOString().split("T")[0],{data:y,error:b}=await T.from("food_entries").select("id, name, serving_size, calories, carbs").eq("user_id",e.id).eq("source_date",w).ilike("name",`%${x}%`);if(b)throw b;y?.forEach(j=>{v.push({id:j.id,name:j.name,type:"today",current_values:{serving_size:j.serving_size,calories:j.calories,carbs:j.carbs}})})}else if(g==="library"){const{data:w,error:y}=await T.from("user_foods").select("id, name, calories_per_100g, carbs_per_100g").eq("user_id",e.id).ilike("name",`%${x}%`);if(y)throw y;w?.forEach(b=>{v.push({id:b.id,name:b.name,type:"library",current_values:{calories_per_100g:b.calories_per_100g,carbs_per_100g:b.carbs_per_100g}})})}else if(g==="templates"){const{data:w,error:y}=await T.from("daily_food_templates").select("id, name, serving_size, calories, carbs").eq("user_id",e.id).ilike("name",`%${x}%`);if(y)throw y;w?.forEach(b=>{v.push({id:b.id,name:b.name,type:"template",current_values:{serving_size:b.serving_size,calories:b.calories,carbs:b.carbs}})})}return a(v),v}catch(w){return console.error("Error searching foods:",w),Ke({title:"Search Error",description:"Failed to search for foods. Please try again.",variant:"destructive"}),[]}finally{c(!1)}},f=async(x,g)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await T.from("food_entries").update(g).eq("id",x).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["food-entries"]}),Ke({title:"Food Entry Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing food entry:",v),Ke({title:"Update Error",description:"Failed to update food entry. Please try again.",variant:"destructive"}),v}},u=async(x,g)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await T.from("user_foods").update(g).eq("id",x).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["user-foods"]}),Ke({title:"Library Food Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing library food:",v),Ke({title:"Update Error",description:"Failed to update library food. Please try again.",variant:"destructive"}),v}},m=async(x,g)=>{if(!e)throw new Error("User not authenticated");try{const{data:v,error:w}=await T.from("daily_food_templates").update(g).eq("id",x).eq("user_id",e.id).select().single();if(w)throw w;return s.invalidateQueries({queryKey:["daily-food-templates"]}),Ke({title:"Template Updated",description:`Successfully updated ${v.name}`}),v}catch(v){throw console.error("Error editing template food:",v),Ke({title:"Update Error",description:"Failed to update template. Please try again.",variant:"destructive"}),v}};return{searchResults:r,editPreviews:n,isSearching:i,searchFoodsForEdit:d,editFoodEntry:f,editLibraryFood:u,editTemplateFood:m,createEditPreview:(x,g)=>({id:x.id,name:x.name,type:x.type,before:x.current_values,after:{...x.current_values,...g},confirmed:!1}),applyEditPreview:async x=>{const g=Object.keys(x.after).reduce((v,w)=>(x.after[w]!==x.before[w]&&(v[w]=x.after[w]),v),{});if(x.type==="today")return await f(x.id,g);if(x.type==="library")return await u(x.id,g);if(x.type==="template")return await m(x.id,g)},setEditPreviews:o}},m1=({preview:e,onConfirm:s,onCancel:r,onEdit:a})=>{const n=(c,d)=>c==="serving_size"?`${d}g`:c==="calories"||c==="calories_per_100g"?`${d} cal`:c==="carbs"||c==="carbs_per_100g"?`${d}g carbs`:`${d}`,i=(()=>{const c=[];return Object.keys(e.after).forEach(d=>{e.after[d]!==e.before[d]&&typeof e.after[d]=="number"&&c.push({key:d,before:e.before[d],after:e.after[d]})}),c})();return i.length===0?null:t.jsx(oe,{className:"p-4 border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-900",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"font-medium text-warm-text",children:["Edit Preview: ",e.name]}),t.jsx("div",{className:"text-xs text-muted-foreground bg-ceramic-base px-2 py-1 rounded",children:e.type==="today"?"Today's Entry":e.type==="library"?"Food Library":"Template"})]}),t.jsx("div",{className:"space-y-2",children:i.map(({key:c,before:d,after:f})=>t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{className:"capitalize text-warm-text",children:[c.replace("_"," ").replace("per 100g","/100g"),":"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-muted-foreground line-through",children:n(c,d)}),t.jsx("span",{className:"text-xs text-muted-foreground",children:""}),t.jsx("span",{className:"text-primary font-medium",children:n(c,f)})]})]},c))}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsxs(D,{size:"sm",onClick:s,className:"flex-1",children:[t.jsx(dr,{className:"w-3 h-3 mr-1"}),"Apply Changes"]}),t.jsx(D,{size:"sm",variant:"ghost",onClick:a,className:"px-3",children:t.jsx(mt,{className:"w-3 h-3"})}),t.jsx(D,{size:"sm",variant:"ghost",onClick:r,className:"px-3",children:t.jsx(Pe,{className:"w-3 h-3"})})]})]})})};var Ji="Checkbox",[h1,sk]=jt(Ji),[f1,p1]=h1(Ji),Wh=l.forwardRef((e,s)=>{const{__scopeCheckbox:r,name:a,checked:n,defaultChecked:o,required:i,disabled:c,value:d="on",onCheckedChange:f,form:u,...m}=e,[h,p]=l.useState(null),x=we(s,j=>p(j)),g=l.useRef(!1),v=h?u||!!h.closest("form"):!0,[w=!1,y]=Lt({prop:n,defaultProp:o,onChange:f}),b=l.useRef(w);return l.useEffect(()=>{const j=h?.form;if(j){const N=()=>y(b.current);return j.addEventListener("reset",N),()=>j.removeEventListener("reset",N)}},[h,y]),t.jsxs(f1,{scope:r,state:w,disabled:c,children:[t.jsx(pe.button,{type:"button",role:"checkbox","aria-checked":bs(w)?"mixed":w,"aria-required":i,"data-state":Hh(w),"data-disabled":c?"":void 0,disabled:c,value:d,...m,ref:x,onKeyDown:re(e.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:re(e.onClick,j=>{y(N=>bs(N)?!0:!N),v&&(g.current=j.isPropagationStopped(),g.current||j.stopPropagation())})}),v&&t.jsx(g1,{control:h,bubbles:!g.current,name:a,value:d,checked:w,required:i,disabled:c,form:u,style:{transform:"translateX(-100%)"},defaultChecked:bs(o)?!1:o})]})});Wh.displayName=Ji;var Gh="CheckboxIndicator",Vh=l.forwardRef((e,s)=>{const{__scopeCheckbox:r,forceMount:a,...n}=e,o=p1(Gh,r);return t.jsx(Nt,{present:a||bs(o.state)||o.state===!0,children:t.jsx(pe.span,{"data-state":Hh(o.state),"data-disabled":o.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...e.style}})})});Vh.displayName=Gh;var g1=e=>{const{control:s,checked:r,bubbles:a=!0,defaultChecked:n,...o}=e,i=l.useRef(null),c=ia(r),d=ra(s);l.useEffect(()=>{const u=i.current,m=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(m,"checked").set;if(c!==r&&p){const x=new Event("click",{bubbles:a});u.indeterminate=bs(r),p.call(u,bs(r)?!1:r),u.dispatchEvent(x)}},[c,r,a]);const f=l.useRef(bs(r)?!1:r);return t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??f.current,...o,tabIndex:-1,ref:i,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function bs(e){return e==="indeterminate"}function Hh(e){return bs(e)?"indeterminate":e?"checked":"unchecked"}var Qh=Wh,x1=Vh;const Kh=l.forwardRef(({className:e,...s},r)=>t.jsx(Qh,{ref:r,className:K("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:t.jsx(x1,{className:K("flex items-center justify-center text-current"),children:t.jsx(dr,{className:"h-4 w-4"})})}));Kh.displayName=Qh.displayName;const $e=(e,s)=>["food-entries",e,s],Ks=(e,s)=>["daily-totals",e,s],Mn=()=>{const{user:e}=ve(),{toast:s}=he(),r=ft(),a=new Date().toISOString().split("T")[0],n=ut({queryKey:$e(e?.id||null,a),queryFn:async()=>{if(console.log(" foodEntriesQuery queryFn - user:",e?.id),!e)return console.log(" No user authenticated, returning empty array"),[];const m=new Date;m.setHours(0,0,0,0);const h=new Date(m);h.setDate(h.getDate()+1),console.log(" Fetching food entries from",m.toISOString(),"to",h.toISOString(),"for user:",e.id);const{data:p,error:x}=await T.from("food_entries").select("*").eq("user_id",e.id).gte("created_at",m.toISOString()).lt("created_at",h.toISOString()).order("consumed",{ascending:!0}).order("created_at",{ascending:!1});if(console.log(" Food entries query result:",{data:p,error:x,userCalling:e.id,count:p?.length}),x)throw x;return p||[]},enabled:!!e?.id,staleTime:5*60*1e3,gcTime:30*60*1e3,refetchOnWindowFocus:!1,retry:3,retryDelay:m=>Math.min(1e3*2**m,3e4)}),o=ut({queryKey:Ks(e?.id||null,a),queryFn:()=>{const h=(n.data||[]).filter(p=>p.consumed);return{calories:h.reduce((p,x)=>p+x.calories,0),carbs:h.reduce((p,x)=>p+x.carbs,0)}},enabled:!!n.data,staleTime:5*60*1e3,gcTime:30*60*1e3}),i=xt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const{data:h,error:p}=await T.from("food_entries").insert({user_id:e.id,name:m.name,calories:m.calories,carbs:m.carbs,serving_size:m.serving_size,consumed:m.consumed??!0,image_url:m.image_url}).select().single();if(p)throw p;return h},onMutate:async m=>{await r.cancelQueries({queryKey:$e(e?.id||null,a)});const h=r.getQueryData($e(e?.id||null,a)),p={id:`temp-${Date.now()}`,user_id:e?.id||"",name:m.name,calories:m.calories,carbs:m.carbs,serving_size:m.serving_size,consumed:m.consumed??!0,image_url:m.image_url,created_at:new Date().toISOString()};return r.setQueryData($e(e?.id||null,a),(x=[])=>[p,...x]),{previousEntries:h}},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData($e(e?.id||null,a),p.previousEntries),s({title:"Error adding food entry",description:"Please try again.",variant:"destructive"})},onSuccess:m=>{r.setQueryData($e(e?.id||null,a),(h=[])=>{const p=h.filter(x=>!x.id.startsWith("temp-"));return[m,...p]}),r.invalidateQueries({queryKey:Ks(e?.id||null,a)})}}),c=xt({mutationFn:async({id:m,updates:h})=>{if(console.log(" Starting updateFoodEntryMutation with:",{id:m,updates:h}),!e)throw console.error(" Error: User not authenticated"),new Error("User not authenticated");console.log(" Current user ID:",e.id),console.log(" Checking if food entry exists...");const{data:p,error:x}=await T.from("food_entries").select("id, user_id, name").eq("id",m).maybeSingle();if(console.log(" Existing entry check:",{existingEntry:p,checkError:x}),x)throw console.error(" Error checking existing entry:",x),new Error(`Failed to check existing entry: ${x.message}`);if(!p)throw console.error(" Food entry not found in database"),new Error("Food entry not found");if(p.user_id!==e.id)throw console.error(" User ID mismatch:",{entryUserId:p.user_id,currentUserId:e.id}),new Error("Permission denied - entry belongs to different user");console.log(" Food entry found and belongs to user, proceeding with update...");const{data:g,error:v}=await T.from("food_entries").update(h).eq("id",m).eq("user_id",e.id).select().maybeSingle();if(console.log(" Update result:",{data:g,error:v}),v)throw console.error(" Database error:",v),v;if(!g)throw console.error(" No data returned from update"),new Error("Update failed - no data returned");return g},onMutate:async({id:m,updates:h})=>{await r.cancelQueries({queryKey:$e(e?.id||null,a)});const p=r.getQueryData($e(e?.id||null,a));return r.setQueryData($e(e?.id||null,a),(x=[])=>x.map(g=>g.id===m?{...g,...h}:g)),{previousEntries:p}},onSuccess:m=>{console.log(" Update successful:",m),r.invalidateQueries({queryKey:$e(e?.id||null,a)}),r.invalidateQueries({queryKey:Ks(e?.id||null,a)})},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData($e(e?.id||null,a),p.previousEntries),console.error(" Update mutation error:",m),s({title:"Error updating food entry",description:`Database error: ${m.message||"Please try again."}`,variant:"destructive"})}}),d=xt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const{error:h}=await T.from("food_entries").delete().eq("id",m).eq("user_id",e.id);if(h)throw h},onMutate:async m=>{await r.cancelQueries({queryKey:$e(e?.id||null,a)});const h=r.getQueryData($e(e?.id||null,a));return r.setQueryData($e(e?.id||null,a),(p=[])=>p.filter(x=>x.id!==m)),{previousEntries:h}},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData($e(e?.id||null,a),p.previousEntries),s({title:"Error deleting food entry",description:"Please try again.",variant:"destructive"})},onSuccess:()=>{r.invalidateQueries({queryKey:Ks(e?.id||null,a)})}}),f=xt({mutationFn:async m=>{if(!e)throw new Error("User not authenticated");const h=n.data?.find(g=>g.id===m);if(!h)throw new Error("Entry not found");const{data:p,error:x}=await T.from("food_entries").update({consumed:!h.consumed}).eq("id",m).eq("user_id",e.id).select().single();if(x)throw x;return p},onMutate:async m=>{await r.cancelQueries({queryKey:$e(e?.id||null,a)});const h=r.getQueryData($e(e?.id||null,a));return r.setQueryData($e(e?.id||null,a),(p=[])=>p.map(x=>x.id===m?{...x,consumed:!x.consumed}:x)),{previousEntries:h}},onSuccess:m=>{const h=m.consumed?"Food marked as eaten":"Food returned to active list";s({title:h,description:"Food status updated successfully."}),r.invalidateQueries({queryKey:Ks(e?.id||null,a)})},onError:(m,h,p)=>{p?.previousEntries&&r.setQueryData($e(e?.id||null,a),p.previousEntries),s({title:"Error updating food entry",description:"Please try again.",variant:"destructive"})}}),u=l.useCallback(async()=>{await r.refetchQueries({queryKey:$e(e?.id||null,a)}),await r.refetchQueries({queryKey:Ks(e?.id||null,a)})},[r,e?.id,a]);return{todayEntries:n.data||[],todayTotals:o.data||{calories:0,carbs:0},loading:n.isLoading,addFoodEntry:i.mutateAsync,updateFoodEntry:c.mutateAsync,deleteFoodEntry:d.mutateAsync,toggleConsumption:f.mutateAsync,refreshFoodEntries:u,isAddingEntry:i.isPending,isUpdatingEntry:c.isPending,isDeletingEntry:d.isPending,isTogglingConsumption:f.isPending}},Yh=()=>{const[e,s]=l.useState([]),[r,a]=l.useState(0),[n,o]=l.useState(!1),{user:i}=ve(),c=l.useCallback(async()=>{if(i){o(!0);try{const f=new Date().toISOString().split("T")[0],{data:u,error:m}=await T.from("manual_calorie_burns").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});if(m)throw m;const h=(u||[]).filter(x=>x.created_at.split("T")[0]===f);s(h);const p=h.reduce((x,g)=>x+g.calories_burned,0);a(p)}catch(f){console.error("Error loading manual calorie burns:",f),s([]),a(0)}finally{o(!1)}}},[i]);l.useEffect(()=>{c()},[c]);const d=l.useCallback(async f=>{if(i)try{const{error:u}=await T.from("manual_calorie_burns").delete().eq("id",f).eq("user_id",i.id);if(u)throw u;await c()}catch(u){throw console.error("Error deleting manual calorie burn:",u),u}},[i,c]);return{manualBurns:e,todayTotal:r,loading:n,refreshManualBurns:c,deleteManualBurn:d}},v1=(e,s)=>["daily-deficit-stable",e,s],y1=(e,s)=>["bmr-tdee-stable",e,s],Pn=()=>{const{user:e}=ve(),{profile:s}=Ie(),{todayTotals:r}=Mn(),{sessions:a}=xh(),n=new Date().toISOString().split("T")[0],o=s?`${s.weight}-${s.height}-${s.age}-${s.activity_level}`:"no-profile",{todayTotal:i,loading:c}=Yh(),d=ut({queryKey:y1(e?.id||null,o),queryFn:()=>{if(!s?.weight||!s?.height||!s?.age)return{bmr:0,tdee:0};const h=s.weight,p=s.height,x=10*h+6.25*p-5*s.age+5,g={sedentary:1.2,"lightly-active":1.375,lightly_active:1.375,"moderately-active":1.55,moderately_active:1.55,"very-active":1.725,very_active:1.725,"extremely-active":1.9,extremely_active:1.9},v=s.activity_level||"sedentary",w=g[v]||1.2,y=x*w;return{bmr:Math.round(x),tdee:Math.round(y)}},enabled:!!s?.weight&&!!s?.height&&!!s?.age,staleTime:5*60*1e3,gcTime:30*60*1e3}),f=ut({queryKey:["walking-calories",e?.id,n],queryFn:()=>!a||!s?.weight?0:a.filter(x=>x.start_time.split("T")[0]===n).reduce((x,g)=>{if(g.calories_burned&&g.end_time)return x+g.calories_burned;if(g.session_state==="active"&&g.start_time&&g.speed_mph){const v=new Date,w=new Date(g.start_time),y=Math.max(0,(v.getTime()-w.getTime())/(1e3*60)),j={2:2.8,2.5:2.8,3:3.2,3.5:3.5,4:3.8,4.5:4.3,5:4.8}[g.speed_mph]||3.2,N=y/60,C=Math.round(j*s.weight*N);return x+C}return x},0),enabled:!!a&&!!s?.weight,staleTime:5*60*1e3,gcTime:30*60*1e3}),u=ut({queryKey:v1(e?.id||null,n),queryFn:()=>{const h=d.data||{bmr:0,tdee:0},p=r?.calories||0,x=f.data||0,g=i||0,v=h.tdee+x+g,w=v-p;return{todayDeficit:Math.round(w),totalCaloriesBurned:Math.round(v),bmr:h.bmr,tdee:h.tdee,caloriesConsumed:p,walkingCalories:x,manualCalories:g,activityLevel:s?.activity_level||"sedentary"}},enabled:!!d.data&&r!==void 0&&f.data!==void 0&&i!==void 0&&!c,staleTime:2*60*1e3,gcTime:15*60*1e3}),m=l.useCallback(async()=>{await f.refetch(),await u.refetch()},[f.refetch,u.refetch]);return{deficitData:u.data||{todayDeficit:0,totalCaloriesBurned:0,bmr:0,tdee:0,caloriesConsumed:0,walkingCalories:0,manualCalories:0,activityLevel:"sedentary"},loading:u.isLoading||d.isLoading,refreshDeficit:m}},Zi=()=>{const{deficitData:e}=Pn(),{profile:s}=Ie();return l.useMemo(()=>{const a=s?.weight||null,n=s?.goal_weight||null,o=e.todayDeficit,i=Math.round(Math.max(0,o)/7.7*10)/10,c=Math.round(Math.max(0,o*30)/7.7*10)/10;if(!a||!n||a<=n)return{weeksToGoal:null,dailyDeficitNeeded:null,currentDeficit:o,goalWeight:n,currentWeight:a,weightToLose:null,fatInGrams:i,thirtyDayProjection:c};const d=a-n;let f;s?.units==="metric"?f=d*1e3:f=d*453.592;const u=f*7.7;let m=null,h=null;if(o>0){const x=u/o;m=Math.round(x/7*10)/10}s?.units;const p=(s?.units==="metric"?500:453.592)*7.7;return h=Math.round(p/7),{weeksToGoal:m,dailyDeficitNeeded:h,currentDeficit:o,goalWeight:n,currentWeight:a,weightToLose:d,fatInGrams:i,thirtyDayProjection:c}},[e.todayDeficit,s?.weight,s?.goal_weight,s?.units])},Xh=({isOpen:e,onClose:s,onResult:r,context:a="",title:n="AI Assistant",systemPrompt:o="You are a helpful AI assistant.",conversationType:i="general",proactiveMessage:c="",quickReplies:d=[],onFoodAdd:f})=>{l.useState("");const[u,m]=l.useState([]),[h,p]=l.useState(!1),[x,g]=l.useState(null),[v,w]=l.useState(null),[y,b]=l.useState(null),[j,N]=l.useState(null),[C,_]=l.useState(null),[k,S]=l.useState(!1),[E,A]=l.useState({title:"",content:""}),[I,z]=l.useState({}),[W,Y]=l.useState({}),[G,te]=l.useState(new Set),$=l.useRef(null),q=l.useRef(null),de=l.useRef(null),Z=l.useRef(null);ve();const{searchResults:F,searchFoodsForEdit:Q,createEditPreview:ae,applyEditPreview:R}=u1(),[B,L]=l.useState([]),{currentSession:se,startFastingSession:J,endFastingSession:ne,cancelFastingSession:H}=bh(),{currentSession:me,startWalkingSession:le,endWalkingSession:be}=Sr(),{profile:ke,updateProfile:Te}=Ie(),{isAdmin:ct}=Ps(),{deficitData:O}=Pn();Zi(),l.useEffect(()=>{$.current?.scrollIntoView({behavior:"smooth"})},[u]),l.useEffect(()=>{x?.foods&&x.foods.length>0&&setTimeout(()=>{de.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[x?.foods]),l.useEffect(()=>{if(e){const M=[];if(a){const P={role:"assistant",content:a,timestamp:new Date};M.push(P)}if(c){const P={role:"assistant",content:c,timestamp:new Date};M.push(P)}m(M),g(null),w(null),b(null),te(new Set)}else e||(Z.current&&Z.current.cancelRecording(),setTimeout(()=>{m([]),N(null),_(null),S(!1),A({title:"",content:""}),z({}),Y({}),g(null),w(null),b(null),te(new Set)},100))},[e,a,i,c]);const ue=async(M,P=!1)=>{console.log(" sendToAI called:",{message:M,fromVoice:P,isProcessing:h}),p(!0);try{const U=u.map(Ce=>({role:Ce.role,content:Ce.content}));let V=o;n==="Food Assistant"?V=`${o}

You are a comprehensive food tracking assistant. Your goals are to:

FOR ADDING FOODS:
1. IMMEDIATELY process food information and call add_multiple_foods
2. Be concise but helpful - when users ask about your reasoning or assumptions, provide brief explanations
3. CRITICAL QUANTITY HANDLING: When users specify a COUNT of items (e.g., "two cucumbers", "three bananas", "four apples"), create SEPARATE entries for each item. DO NOT aggregate quantities.
4. EXAMPLES OF CORRECT BEHAVIOR:
   - "two cucumbers"  2 separate cucumber entries (e.g., 150g each)
   - "three bananas each 120g"  3 separate banana entries at 120g each
   - "400g chicken"  1 chicken entry at 400g
   - "two Greek yogurts"  2 separate Greek yogurt entries
   - "200g of rice"  1 rice entry at 200g
5. Only aggregate when NO specific count is mentioned and user gives total weight
6. When making assumptions (like estimating portion sizes), briefly explain your reasoning when asked
7. Destination: default to today. If the user explicitly says template or library, pass destination accordingly

FOR EDITING/DELETING FOODS:
1. When users want to edit/change/delete/remove foods, FIRST call search_foods_for_edit to find the item
2. Context hints:
   - "today's food", "my lunch", "the chicken I ate"  context: "today"
   - "in my library", "my saved foods"  context: "library"
   - "my template"  context: "templates"
3. For deletion phrases like "I didn't eat that", "remove it", "delete the banana":
   - search_foods_for_edit first (context defaults to today)
   - then call delete_food_entry (or delete_library_food for library items)
4. For updates, after finding foods, call edit_food_entry or edit_library_food

FORMATS:
- For adding: list each as "Name (Xg) - Y cal, Zg carbs" and include Total line
- For editing/deleting: call the tool first, then a short confirmation

CRITICAL: Always use function calls for food operations.`:n==="Motivator Assistant"&&(V=`${o}

You are a motivational goal creation assistant. Your task is to:

**FOR SINGLE MOTIVATORS:**
1. If user mentions ONE goal/motivation, use create_motivator function
2. Extract the key motivation from what they said
3. Create a short, punchy title (3-8 words max)
4. Write compelling content that includes their specific trigger/motivation

**FOR MULTIPLE MOTIVATORS:**
1. If user mentions MULTIPLE goals/motivations, use create_multiple_motivators function
2. Parse each distinct goal into a separate motivator
3. Examples of multiple goals:
   - "I want to lose weight, feel confident, and impress my friends" = 3 motivators
   - "Create motivators for my health and fitness goals" = multiple health/fitness motivators
   - "I need goals for weight loss, exercise, and confidence" = 3 motivators

**FOR EDITING/DELETING MOTIVATORS:**
1. When users want to edit/change/modify their goals, use edit_motivator function
2. When users want to delete/remove their goals, use delete_motivator function
3. Listen for phrases like "edit my goal", "change that motivator", "delete my weight loss goal", "remove that", etc.

**CRITICAL RULES:**
- ALWAYS call the appropriate function immediately - no questions or discussions
- For multiple goals, ALWAYS use create_multiple_motivators, not individual create_motivator calls
- Create the motivators directly based on what they told you
- Each motivator should be distinct and focused on one specific goal
- Support editing and deleting motivators through voice commands`);const{data:ee,error:st}=await T.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:V},...U,{role:"user",content:M}]}});if(st)throw st;if(console.log(" AI Response received:",{data:ee,completion:ee?.completion,functionCall:ee?.functionCall}),ee.functionCall){if(ee.functionCall.name==="add_multiple_foods"){const Ce=ee.functionCall.arguments?.foods||[];g({foods:Ce,destination:ee.functionCall.arguments?.destination||"today",added:!1}),te(new Set(Ce.map((Fe,Tr)=>Tr)));return}else if(ee.functionCall.name==="create_multiple_motivators"){b(ee.functionCall.arguments);return}else if(ee.functionCall.name==="create_motivator"){w(ee.functionCall);const Ce=ee.functionCall.arguments,Fe={role:"assistant",content:`${Ce.title}

${Ce.content}`,timestamp:new Date};m(Tr=>[...Tr,Fe]);return}else if(ee.functionCall.name==="search_foods_for_edit"){const{search_term:Ce,context:Fe}=ee.functionCall.arguments;await pa(Ce,Fe);return}else if(ee.functionCall.name==="edit_food_entry"){const{entry_id:Ce,updates:Fe}=ee.functionCall.arguments;await kr(Ce,Fe,"today");return}else if(ee.functionCall.name==="edit_library_food"){const{food_id:Ce,updates:Fe}=ee.functionCall.arguments;await kr(Ce,Fe,"library");return}else if(ee.functionCall.name==="delete_food_entry"||ee.functionCall.name==="delete_library_food"){await r?.(ee.functionCall);return}else if(ee.functionCall.name==="start_fasting_session"){await Ln(ee.functionCall.arguments);return}else if(ee.functionCall.name==="stop_fasting_session"){await xe(ee.functionCall.arguments);return}else if(ee.functionCall.name==="start_walking_session"){await _e(ee.functionCall.arguments);return}else if(ee.functionCall.name==="stop_walking_session"){await Se();return}else if(ee.functionCall.name==="get_current_session_status"){await St();return}else if(ee.functionCall.name==="get_current_fast_duration"){await _t();return}else if(ee.functionCall.name==="get_current_walk_duration"){await Vs();return}else if(ee.functionCall.name==="get_today_deficit"){await $n();return}else if(ee.functionCall.name==="add_admin_personal_log"){await _p(ee.functionCall.arguments);return}else if(ee.functionCall.name==="get_admin_personal_log"){await Cp(ee.functionCall.arguments);return}else if(ee.functionCall.name==="update_weight"){await kp(ee.functionCall.arguments);return}else if(ee.functionCall.name==="update_goal_weight"){await Ep(ee.functionCall.arguments);return}else if(ee.functionCall.name==="update_daily_goals"){await Tp(ee.functionCall.arguments);return}else if(ee.functionCall.name==="get_weight_loss_projection"){await Mp();return}}if(ee.completion&&ee.completion.trim()&&!Pp(ee.completion)){const Ce={role:"assistant",content:ee.completion,timestamp:new Date};m(Fe=>[...Fe,Ce])}}catch(U){console.error("Error sending message to AI:",U),Ke({title:"Error",description:U?.message||"Failed to send message. Please try again.",variant:"destructive"})}finally{p(!1)}},ce=async M=>{if(console.log(" Voice transcription received:",M),!M.trim())return;const P={role:"user",content:M,timestamp:new Date};console.log(" Adding user voice message to chat"),m(U=>[...U,P]),await ue(M,!0)},je=M=>{if(x?.foods&&x.foods[M]){const P=x.foods[M];z(U=>({...U,[M]:{name:P.name||"",portion:P.serving_size?.toString()||"",calories:P.calories?.toString()||"",carbs:P.carbs?.toString()||""}})),N(M)}},tt=M=>{const P=I[M];if(P&&x?.foods){const U=[...x.foods];U[M]={...U[M],name:P.name,serving_size:parseInt(P.portion)||0,calories:parseInt(P.calories)||0,carbs:parseInt(P.carbs)||0},g(V=>({...V,foods:U})),N(null),z(V=>{const ee={...V};return delete ee[M],ee})}},is=M=>{N(null),z(P=>{const U={...P};return delete U[M],U})},In=M=>{if(x?.foods){const P=x.foods.filter((U,V)=>V!==M);g(U=>({...U,foods:P})),te(U=>{const V=new Set;return Array.from(U).forEach(ee=>{ee<M?V.add(ee):ee>M&&V.add(ee-1)}),V}),j===M&&(N(null),z(U=>{const V={...U};return delete V[M],V}))}},ma=async()=>{if(!(!x?.foods||h)){p(!0);try{const M=x.destination||"today",P=x.foods.filter((U,V)=>G.has(V));if(P.length===0){Ke({title:"No foods selected",description:"Please select at least one food to add.",variant:"destructive"}),p(!1);return}f?await f(P,M):r&&await r({name:"add_multiple_foods",arguments:{foods:P,destination:M}}),g(U=>({...U,added:!0})),Ke({title:"Foods added successfully",description:`Added ${P.length} foods to your ${M}`}),setTimeout(()=>{s()},2e3)}catch(M){console.error("Error adding foods:",M),Ke({title:"Error",description:"Failed to add foods. Please try again.",variant:"destructive"})}finally{p(!1)}}},Cr=async()=>{if(v&&r){console.log(" Creating motivator with data:",v),console.log(" Motivator arguments:",v.arguments);try{console.log(" Calling onResult with:",v),await r(v);const M={role:"assistant",content:"Motivator created successfully! You can now view it in your motivators list.",timestamp:new Date};m(P=>[...P,M]),w(null),Ke({title:"Motivator created!",description:"Your new motivator has been added to your collection"}),setTimeout(()=>{s()},2e3)}catch(M){console.error("Error creating motivator:",M),Ke({title:"Error",description:"Failed to create motivator. Please try again.",variant:"destructive"})}}},ls=M=>{if(y?.motivators&&y.motivators[M]){const P=y.motivators[M];Y(U=>({...U,[M]:{title:P.title||"",content:P.content||"",category:P.category||""}})),_(M)}},ha=M=>{const P=W[M];if(P&&y?.motivators){const U=[...y.motivators];U[M]={...U[M],title:P.title,content:P.content,category:P.category||U[M].category},b(V=>({...V,motivators:U})),_(null),Y(V=>{const ee={...V};return delete ee[M],ee})}},cs=M=>{_(null),Y(P=>{const U={...P};return delete U[M],U})},fa=M=>{if(y?.motivators){const P=y.motivators.filter((U,V)=>V!==M);b(U=>({...U,motivators:P})),C===M&&(_(null),Y(U=>{const V={...U};return delete V[M],V}))}},Fn=async()=>{if(y?.motivators&&r){p(!0);try{await r({name:"create_multiple_motivators",arguments:{motivators:y.motivators}});const M={role:"assistant",content:` Created ${y.motivators.length} motivators successfully!`,timestamp:new Date};m(P=>[...P,M]),b(P=>({...P,added:!0})),setTimeout(()=>{s()},2e3)}catch(M){console.error("Error adding motivators:",M),Ke({title:"Error",description:"Failed to create motivators. Please try again.",variant:"destructive"})}finally{p(!1)}}},pa=async(M,P)=>{try{const U=await Q(M,P);if(U.length===0){const st={role:"assistant",content:`I couldn't find any ${P==="today"?"today's entries":P} matching "${M}". Try a different search term or check the specific location.`,timestamp:new Date};m(Ce=>[...Ce,st]);return}const V=U.map(st=>` ${st.name} (${st.type==="today"?"Today":st.type==="library"?"Library":"Template"})`).join(`
`),ee={role:"assistant",content:`Found ${U.length} food(s) matching "${M}":

${V}

Tell me what you'd like to change. For example: "Change the chicken to 150g" or "Update the banana calories to 120".`,timestamp:new Date};m(st=>[...st,ee])}catch(U){console.error("Error searching foods:",U),Ke({title:"Search Error",description:"Failed to search for foods. Please try again.",variant:"destructive"})}},kr=async(M,P,U)=>{try{const V=F.find(Fe=>Fe.id===M);if(!V)throw new Error("Food item not found for editing");const ee=ae(V,P);L(Fe=>[...Fe,ee]);const st=Object.keys(P).map(Fe=>{const Tr=V.current_values[Fe],Dp=P[Fe];return`${Fe.replace("_"," ")}: ${Tr}  ${Dp}`}).join(", "),Ce={role:"assistant",content:`Ready to update ${V.name}: ${st}. Please confirm the changes below.`,timestamp:new Date};m(Fe=>[...Fe,Ce])}catch(V){console.error("Error creating edit preview:",V),Ke({title:"Edit Error",description:"Failed to prepare food edit. Please try again.",variant:"destructive"})}},On=async M=>{try{await R(M),L(U=>U.filter(V=>V.id!==M.id));const P={role:"assistant",content:` Successfully updated ${M.name}!`,timestamp:new Date};m(U=>[...U,P])}catch(P){console.error("Error applying edit:",P)}},Er=M=>{L(U=>U.filter(V=>V.id!==M.id));const P={role:"assistant",content:`Cancelled editing ${M.name}.`,timestamp:new Date};m(U=>[...U,P])},Bt=M=>{const P={role:"assistant",content:`Opening manual editor for ${M.name}. Tell me what specific changes you'd like to make.`,timestamp:new Date};m(U=>[...U,P])},Ln=async M=>{try{const P=M.goal_hours||16;await J(P*3600);const U={role:"assistant",content:` Started fasting! Your goal is ${P} hours. I'll be here to support you throughout your journey.`,timestamp:new Date};m(V=>[...V,U])}catch(P){const U={role:"assistant",content:` Failed to start fasting session. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},xe=async M=>{try{M.action==="complete"?await ne():await H();const P={role:"assistant",content:M.action==="complete"?" Congratulations on completing your fast! Well done!":"Fast cancelled. No worries - you can start again whenever you're ready.",timestamp:new Date};m(U=>[...U,P])}catch(P){const U={role:"assistant",content:` Failed to ${M.action} fasting session. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},_e=async M=>{try{const P=M.speed_mph||ke?.default_walking_speed||3;await le(P);const U={role:"assistant",content:` Started walking at ${P} mph! Enjoy your walk - I'll track your progress.`,timestamp:new Date};m(V=>[...V,U])}catch(P){const U={role:"assistant",content:` Failed to start walking session. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},Se=async()=>{try{await be();const M={role:"assistant",content:" Great walk! Session completed and calories have been logged.",timestamp:new Date};m(P=>[...P,M])}catch(M){const P={role:"assistant",content:` Failed to end walking session. ${M.message}`,timestamp:new Date};m(U=>[...U,P])}},St=async()=>{let M="";if(se){const U=Math.floor((Date.now()-new Date(se.start_time).getTime())/36e5);M+=` Currently fasting for ${U} hours. `}if(me){const U=Math.floor((Date.now()-new Date(me.start_time).getTime())/6e4);M+=` Currently walking for ${U} minutes. `}M||(M="No active sessions right now. Ready to start when you are!");const P={role:"assistant",content:M,timestamp:new Date};m(U=>[...U,P])},_t=async()=>{if(!se){const ee={role:"assistant",content:"You're not currently fasting. Ready to start when you are!",timestamp:new Date};m(st=>[...st,ee]);return}const M=Math.floor((Date.now()-new Date(se.start_time).getTime())/(1e3*60*60)),P=Math.floor(M),U=Math.floor((M-P)*60),V={role:"assistant",content:` You've been fasting for ${P} hours and ${U} minutes. Keep going strong!`,timestamp:new Date};m(ee=>[...ee,V])},Vs=async()=>{if(!me){const U={role:"assistant",content:"You're not currently walking. Ready for a walk?",timestamp:new Date};m(V=>[...V,U]);return}const P={role:"assistant",content:` You've been walking for ${Math.floor((Date.now()-new Date(me.start_time).getTime())/(1e3*60))} minutes. Great job!`,timestamp:new Date};m(U=>[...U,P])},$n=async()=>{const M=O?.todayDeficit||0,P=O?.caloriesConsumed||0,U=O?.totalCaloriesBurned||0,V={role:"assistant",content:` Today's progress: ${Math.abs(M)} calorie ${M>=0?"deficit":"surplus"}. You've consumed ${P} calories and burned ${U} calories.`,timestamp:new Date};m(ee=>[...ee,V])},_p=async M=>{if(!ct){const P={role:"assistant",content:" Admin access required for personal logs.",timestamp:new Date};m(U=>[...U,P]);return}try{const{error:P}=await T.from("fasting_hours").update({admin_personal_log:M.log_entry}).eq("hour",M.hour);if(P)throw P;const U={role:"assistant",content:` Added personal log for hour ${M.hour}.`,timestamp:new Date};m(V=>[...V,U])}catch(P){const U={role:"assistant",content:` Failed to add personal log. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},Cp=async M=>{if(!ct){const P={role:"assistant",content:" Admin access required for personal logs.",timestamp:new Date};m(U=>[...U,P]);return}try{let P=T.from("fasting_hours").select("hour, admin_personal_log").not("admin_personal_log","is",null);M.hour&&(P=P.eq("hour",M.hour));const{data:U,error:V}=await P.order("hour");if(V)throw V;if(!U||U.length===0){const Ce={role:"assistant",content:M.hour?`No personal log found for hour ${M.hour}.`:"No personal logs found.",timestamp:new Date};m(Fe=>[...Fe,Ce]);return}const st={role:"assistant",content:U.map(Ce=>`Hour ${Ce.hour}: ${Ce.admin_personal_log}`).join(`

`),timestamp:new Date};m(Ce=>[...Ce,st])}catch(P){const U={role:"assistant",content:` Failed to get personal logs. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},kp=async M=>{try{await Te({weight:M.weight_kg});const P={role:"assistant",content:` Updated your weight to ${M.weight_kg} kg.`,timestamp:new Date};m(U=>[...U,P])}catch(P){const U={role:"assistant",content:` Failed to update weight. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},Ep=async M=>{try{await Te({goal_weight:M.goal_weight_kg});const P={role:"assistant",content:` Updated your goal weight to ${M.goal_weight_kg} kg.`,timestamp:new Date};m(U=>[...U,P])}catch(P){const U={role:"assistant",content:` Failed to update goal weight. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},Tp=async M=>{try{const P={};M.daily_calorie_goal&&(P.daily_calorie_goal=M.daily_calorie_goal),M.daily_carb_goal&&(P.daily_carb_goal=M.daily_carb_goal),await Te(P);const U=[];M.daily_calorie_goal&&U.push(`calories to ${M.daily_calorie_goal}`),M.daily_carb_goal&&U.push(`carbs to ${M.daily_carb_goal}g`);const V={role:"assistant",content:` Updated your daily goals: ${U.join(", ")}.`,timestamp:new Date};m(ee=>[...ee,V])}catch(P){const U={role:"assistant",content:` Failed to update daily goals. ${P.message}`,timestamp:new Date};m(V=>[...V,U])}},Mp=async()=>{if(!ke?.weight||!ke?.goal_weight){const M={role:"assistant",content:"Please set your current weight and goal weight first to get projections.",timestamp:new Date};m(P=>[...P,M]);return}try{const M=ke.weight-ke.goal_weight,P=M*1e3*.85,U=O?.todayDeficit||500,V=Math.ceil(P/U),ee={role:"assistant",content:` Weight loss projection: You need to lose ${M.toFixed(1)} kg (${P.toFixed(0)}g of fat). At your current deficit rate of ${U} calories/day, you'll reach your goal in approximately ${V} days.`,timestamp:new Date};m(st=>[...st,ee])}catch(M){const P={role:"assistant",content:` Failed to calculate projection. ${M.message}`,timestamp:new Date};m(U=>[...U,P])}},Pp=M=>{const U=["calories","carbs","grams","add this","add it","food log"].some(ee=>M.toLowerCase().includes(ee));M.includes("?");const V=/\d+\s*(calories|cal|grams?|g\b)/i.test(M);return U&&!M.toLowerCase().includes("what food")&&(V||M.toLowerCase().includes("add"))};return t.jsxs(it,{isOpen:e,onClose:s,title:n,variant:"standard",size:"sm",showCloseButton:!0,children:[t.jsxs("div",{className:"space-y-4 min-h-[300px] max-h-[400px] overflow-y-auto mb-4",children:[u.map((M,P)=>t.jsx("div",{className:`flex ${M.role==="user"?"justify-end":"justify-start"}`,children:t.jsx(oe,{className:`max-w-[85%] p-3 ${M.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:t.jsx("div",{className:"flex items-start gap-2",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:M.content}),M.role==="assistant"&&M.content.includes("Need to make adjustments?")&&t.jsx("div",{className:"flex justify-center mt-3",children:t.jsx(yt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(Yr,{onTranscription:ce,isDisabled:h,size:"sm"})})}),i==="general"&&n==="Motivator Assistant"&&M.role==="assistant"&&v&&t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsx(D,{size:"sm",onClick:Cr,className:"text-xs bg-primary text-primary-foreground",children:"Create This Motivator"}),t.jsx(D,{size:"sm",variant:"outline",onClick:()=>{S(!0),setTimeout(()=>{q.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},className:"text-xs",children:"Edit Language"})]}),t.jsx("p",{className:"text-xs opacity-70 mt-2",children:M.timestamp.toLocaleTimeString()})]})})})},P)),k&&v&&t.jsx("div",{ref:q,className:"mt-4 p-4 border-2 border-primary/50 rounded-lg bg-primary/5",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium text-sm",children:"Edit Your Motivator"}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"motivator-title",className:"text-sm font-medium",children:"Goal Title"}),t.jsx(ge,{id:"motivator-title",value:E.title||v.arguments.title,onChange:M=>A(P=>({...P,title:M.target.value})),className:"mt-1",placeholder:"Enter motivating title"})]}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"motivator-content",className:"text-sm font-medium",children:"Goal Description"}),t.jsx("textarea",{id:"motivator-content",value:E.content||v.arguments.content,onChange:M=>A(P=>({...P,content:M.target.value})),className:"mt-1 w-full p-2 border border-input rounded-md resize-none h-20 text-sm",placeholder:"Describe your motivating goal"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(D,{size:"sm",onClick:()=>{const M=E.title||v.arguments.title,P=E.content||v.arguments.content,U={...v.arguments,title:M,content:P};w(V=>({...V,arguments:U})),m(V=>V.map(ee=>ee.role==="assistant"&&ee.content.includes(v.arguments.title)&&ee.content.includes(v.arguments.content)?{...ee,content:`${M}

${P}`}:ee)),S(!1),A({title:"",content:""}),Ke({title:"Changes saved",description:"Your motivator has been updated"})},className:"flex-1",children:"Save"}),t.jsx(D,{size:"sm",variant:"outline",onClick:()=>{S(!1),A({title:"",content:""})},className:"flex-1",children:"Cancel"})]})]})}),B.length>0&&t.jsx("div",{className:"space-y-2",children:B.map((M,P)=>t.jsx(m1,{preview:M,onConfirm:()=>On(M),onCancel:()=>Er(M),onEdit:()=>Bt(M)},`${M.id}-${P}`))}),y?.motivators&&y.motivators.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(oe,{className:"p-3 bg-muted/50",children:t.jsxs("div",{className:"text-sm font-medium",children:[y.motivators.length," Motivators Ready",y.added&&t.jsx("span",{className:"ml-2 text-green-600 text-xs",children:" Created successfully"})]})}),y.motivators.map((M,P)=>t.jsx(oe,{className:"p-3 bg-background border",children:C===P?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Title"}),t.jsx(ge,{value:W[P]?.title||"",onChange:U=>Y(V=>({...V,[P]:{...V[P],title:U.target.value}})),placeholder:"Motivator title",className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Content"}),t.jsx("textarea",{value:W[P]?.content||"",onChange:U=>Y(V=>({...V,[P]:{...V[P],content:U.target.value}})),placeholder:"Motivational content",className:"w-full p-2 border border-input rounded-md resize-none h-16 text-sm"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(D,{size:"sm",onClick:()=>ha(P),className:"h-8 px-3 text-sm flex-1",children:"Save"}),t.jsx(D,{size:"sm",variant:"outline",onClick:()=>cs(P),className:"h-8 px-3 text-sm flex-1",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-medium",children:M.title}),t.jsx("div",{className:"text-xs text-muted-foreground mt-1 leading-relaxed",children:M.content}),M.category&&t.jsxs("div",{className:"text-xs text-primary mt-1 font-medium",children:["#",M.category]})]}),!y.added&&t.jsxs("div",{className:"flex gap-1 ml-3",children:[t.jsx(D,{size:"sm",variant:"outline",onClick:()=>ls(P),className:"h-8 px-3 text-sm",children:"Edit"}),t.jsx(D,{size:"sm",variant:"outline",onClick:()=>fa(P),className:"h-8 px-3 text-sm text-destructive",children:"Remove"})]})]})},P)),!y.added&&t.jsx("div",{className:"flex gap-2 mt-3",children:t.jsx(D,{size:"sm",onClick:Fn,className:"flex-1",disabled:h,children:h?"Creating...":`Create All ${y.motivators.length} Motivators`})})]}),x?.foods&&x.foods.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx(oe,{ref:de,className:"p-3 bg-muted/50",children:t.jsxs("div",{className:"text-sm font-medium",children:["Selected: ",Array.from(G).reduce((M,P)=>{const U=x.foods[P];return M+(U?.calories||0)},0)," calories, ",Math.round(Array.from(G).reduce((M,P)=>{const U=x.foods[P];return M+(U?.carbs||0)},0)),"g carbs",x.added&&t.jsx("span",{className:"ml-2 text-green-600 text-xs",children:" Added to log"})]})}),x.foods.map((M,P)=>t.jsx(oe,{className:"p-3 bg-background border",children:j===P?t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{value:I[P]?.name||"",onChange:U=>z(V=>({...V,[P]:{...V[P],name:U.target.value}})),placeholder:"Food name",className:"h-8 text-sm"}),t.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Weight (g)"}),t.jsx(ge,{type:"number",value:I[P]?.portion||"",onChange:U=>z(V=>({...V,[P]:{...V[P],portion:U.target.value}})),className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Calories"}),t.jsx(ge,{type:"number",value:I[P]?.calories||"",onChange:U=>z(V=>({...V,[P]:{...V[P],calories:U.target.value}})),className:"h-8 text-sm"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Carbs (g)"}),t.jsx(ge,{type:"number",value:I[P]?.carbs||"",onChange:U=>z(V=>({...V,[P]:{...V[P],carbs:U.target.value}})),className:"h-8 text-sm"})]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(D,{size:"sm",onClick:()=>tt(P),className:"h-8 px-3 text-sm flex-1",children:"Save"}),t.jsx(D,{size:"sm",variant:"outline",onClick:()=>is(P),className:"h-8 px-3 text-sm flex-1",children:"Cancel"})]})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[!x.added&&t.jsx(Kh,{checked:G.has(P),onCheckedChange:U=>{const V=new Set(G);U?V.add(P):V.delete(P),te(V)},className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-medium truncate",children:M.name}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[M.serving_size,"g  ",M.calories," cal  ",Math.round(M.carbs),"g carbs"]})]}),!x.added&&t.jsxs("div",{className:"flex gap-1 shrink-0",children:[t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>je(P),className:"h-7 w-7 p-0",children:t.jsx(mt,{className:"h-3 w-3"})}),t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>In(P),className:"h-7 w-7 p-0 text-destructive hover:text-destructive",children:t.jsx(Pe,{className:"h-3 w-3"})})]})]})},P)),!x.added&&t.jsxs("div",{className:"sticky bottom-0 bg-background/90 backdrop-blur supports-[backdrop-filter]:bg-background/70 border-t pt-3 pb-2 px-1 mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Add to"}),t.jsx("div",{className:"flex gap-1",children:["today","template","library"].map(M=>t.jsx(D,{size:"sm",variant:(x.destination||"today")===M?"default":"outline",className:"h-7 px-2 text-xs",onClick:()=>g(P=>({...P,destination:M})),children:M.charAt(0).toUpperCase()+M.slice(1)},M))})]}),t.jsx(D,{size:"sm",onClick:ma,className:"w-full bg-green-600 hover:bg-green-700 text-white",disabled:h||G.size===0,children:h?"Adding...":`Add ${G.size} Selected Food${G.size!==1?"s":""}`})]})]}),h&&t.jsx("div",{className:"flex justify-start",children:t.jsx(oe,{className:"max-w-[85%] p-3 bg-muted",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),t.jsx("p",{className:"text-sm",children:"AI is thinking..."})]})})}),t.jsx("div",{ref:$})]}),j===null&&t.jsx("div",{className:"border-t border-border pt-4 mt-4 space-y-3",children:t.jsx("div",{className:"w-full flex justify-center",children:t.jsx(yt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(Yr,{ref:Z,onTranscription:ce,isDisabled:h,size:"lg",autoStart:!0})})})})]})};class w1 extends l.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),console.error("Production error:",{error:s.message,stack:s.stack,componentStack:r.componentStack}),this.setState({errorInfo:r}),this.props.onError?.(s,r)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleGoHome=()=>{window.location.href="/"};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const{level:s="component"}=this.props;return this.state,s==="page"?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsxs(oe,{className:"w-full max-w-md p-6 text-center space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto",children:t.jsx(Qt,{className:"w-8 h-8 text-destructive"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Something went wrong"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"We encountered an unexpected error. Please try refreshing the page."})]}),!1,t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(D,{onClick:this.handleRetry,variant:"outline",className:"flex-1",children:[t.jsx(hs,{className:"w-4 h-4 mr-2"}),"Try Again"]}),t.jsxs(D,{onClick:this.handleGoHome,className:"flex-1",children:[t.jsx(mo,{className:"w-4 h-4 mr-2"}),"Go Home"]})]})]})}):s==="critical"?t.jsx(oe,{className:"p-4 border-destructive/20 bg-destructive/5",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Qt,{className:"w-5 h-5 text-destructive flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-medium text-destructive",children:"Critical Error"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"This component failed to load. Please refresh the page."})]}),t.jsx(D,{size:"sm",onClick:this.handleRetry,variant:"outline",children:t.jsx(hs,{className:"w-4 h-4"})})]})}):t.jsx("div",{className:"bg-muted/50 border border-border rounded-lg p-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center space-x-2 text-muted-foreground",children:[t.jsx(Qt,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Component unavailable"}),t.jsx(D,{size:"sm",variant:"ghost",onClick:this.handleRetry,className:"h-6 px-2",children:t.jsx(hs,{className:"w-3 h-3"})})]})})}return this.props.children}}const $r=({children:e,onError:s})=>t.jsx(w1,{level:"component",onError:s,children:e}),el=e=>{const[s,r]=l.useState([]),[a,n]=l.useState(0),[o,i]=l.useState(!0);he();const c=async(f=!1)=>{console.log(" Loading admin goal ideas with gender filter:",e,"Force clear:",f),console.log(" Clearing ALL cache before loading goal ideas"),Rs.invalidateQueries({queryKey:["admin"]}),Rs.removeQueries({queryKey:["admin"]}),localStorage.removeItem("goalIdeasCache"),localStorage.removeItem("adminGoalIdeas"),sessionStorage.removeItem("goalIdeasCache"),sessionStorage.removeItem("adminGoalIdeas");try{const u=Date.now(),{data:m,error:h}=await T.from("shared_settings").select("setting_value").eq("setting_key","admin_goal_ideas").maybeSingle();if(h){console.error("Admin Goal Ideas Database error:",h),r([]),i(!1);return}if(m?.setting_value)try{const p=JSON.parse(m.setting_value);let x=Array.isArray(p)?p:[];e&&(console.log(" Filtering ideas by gender:",e),console.log(" All ideas before filtering:",x.map(g=>({id:g.id,title:g.title,gender:g.gender}))),x=x.filter(g=>g.gender===e),console.log(" Filtered ideas:",x.map(g=>({id:g.id,title:g.title,gender:g.gender})))),console.log(" Admin Goal Ideas loaded successfully:",x.length,"ideas for gender:",e),r(x.map(g=>({...g,_timestamp:u})))}catch(p){console.error("Error parsing admin goal ideas:",p),r([])}else console.log("No admin goal ideas data found in database"),r([])}catch(u){console.error("Error loading admin goal ideas:",u),r([])}finally{i(!1)}};return l.useEffect(()=>{console.log(" useAdminGoalIdeas useEffect triggered - refreshTrigger:",a,"genderFilter:",e),c(!0)},[a,e]),{goalIdeas:s,loading:o,refreshGoalIdeas:()=>c(!0),forceRefresh:()=>{console.log(" Force refreshing admin goal ideas..."),localStorage.clear(),sessionStorage.clear(),Rs.clear(),n(f=>f+1)}}},b1=({onSelectGoal:e,onClose:s})=>{const[r,a]=l.useState(""),[n,o]=l.useState(null),{profile:i}=Ie(),{isAdmin:c}=Ps(),d=i?.sex||"male",{goalIdeas:f,loading:u}=el(d),m=f.filter(h=>h.title.toLowerCase().includes(r.toLowerCase())||h.description.toLowerCase().includes(r.toLowerCase()));return u?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("div",{className:"w-4 h-4 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[...Array(4)].map((h,p)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},p))})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Goal Ideas"}),t.jsx(D,{variant:"ghost",size:"sm",onClick:s,className:"w-10 h-10 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]}),t.jsxs("div",{className:"relative",children:[t.jsx(rx,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),t.jsx(ge,{placeholder:"Search goal ideas...",value:r,onChange:h=>a(h.target.value),className:"pl-9"})]}),t.jsx("div",{className:"max-h-80 overflow-y-auto space-y-3",children:m.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(an,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No goal ideas found"})]}):m.map(h=>{const p=n===h.id;return t.jsxs(oe,{className:"border-ceramic-rim transition-colors",children:[t.jsx("div",{className:"p-3 cursor-pointer hover:bg-ceramic-base",onClick:()=>o(p?null:h.id),children:t.jsxs("div",{className:"flex gap-3",children:[h.imageUrl&&t.jsx("div",{className:"w-8 h-8 flex-shrink-0",children:t.jsx(oa,{src:h.imageUrl,alt:h.title,className:"w-full h-full object-cover rounded"})}),t.jsxs("div",{className:"flex-1 space-y-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("h4",{className:"font-medium text-warm-text text-sm leading-tight",children:h.title}),c&&h.gender&&t.jsx("span",{className:"text-xs",title:`${h.gender} goal`,children:h.gender==="male"?"":""})]}),t.jsx(vs,{variant:"secondary",className:"text-xs bg-muted text-muted-foreground flex-shrink-0",children:h.category})]}),t.jsx("p",{className:`text-xs text-muted-foreground leading-relaxed ${p?"":"line-clamp-3"}`,children:h.description})]}),t.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:p?t.jsx(bt,{className:"w-4 h-4 text-muted-foreground"}):t.jsx(li,{className:"w-4 h-4 text-muted-foreground"})})]})}),p&&t.jsx("div",{className:"px-3 pb-3",children:t.jsxs(D,{size:"sm",onClick:x=>{x.stopPropagation(),e(h)},className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Add This Goal"]})})]},h.id)})})]})},j1=({isOpen:e,onClose:s,onSelectGoal:r,onEditGoal:a})=>{const[n,o]=l.useState(null),[i,c]=l.useState(!1),{goalIdeas:d,loading:f,refreshGoalIdeas:u}=el(),{removeFromDefaultGoals:m,loading:h}=Tn(),{user:p}=ve();l.useEffect(()=>{(async()=>{if(p)try{const{data:v,error:w}=await T.rpc("has_role",{_user_id:p.id,_role:"admin"});if(w)throw w;c(v||!1)}catch(v){console.error("Error checking admin role:",v),c(!1)}})()},[p]),l.useEffect(()=>{e&&u()},[e,u]);const x=async g=>{await m(g)&&u()};return f?t.jsx(it,{isOpen:e,onClose:s,title:"Motivator Ideas",variant:"standard",size:"md",showCloseButton:!0,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx("div",{className:"w-4 h-4 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-32"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[...Array(4)].map((g,v)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},v))})]})}):t.jsx(it,{isOpen:e,onClose:s,title:"Motivator Ideas",variant:"standard",size:"md",showCloseButton:!0,children:t.jsx("div",{className:"space-y-4 py-2",children:t.jsx("div",{className:"max-h-96 overflow-y-auto space-y-3",children:d.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(an,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No motivator ideas found"})]}):d.map(g=>{const v=n===g.id,w=g.description&&g.description.length>50;return t.jsx(oe,{className:"overflow-hidden relative",children:t.jsxs(Le,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0",children:t.jsx(oa,{src:g.imageUrl,alt:g.title,className:"w-full h-full object-cover"})}),t.jsx("div",{className:"flex-1 p-4 pr-2 cursor-pointer hover:bg-muted/5",onClick:y=>{w&&(y.stopPropagation(),o(v?null:g.id))},children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h3",{className:"font-semibold text-warm-text line-clamp-1",children:g.title})}),g.description&&t.jsx("div",{className:"text-sm text-muted-foreground",children:v?t.jsx("p",{className:"whitespace-pre-wrap",children:g.description}):t.jsx("p",{className:"line-clamp-2",children:g.description})})]}),t.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",onClick:y=>{y.stopPropagation(),r(g),s()},className:"p-1 h-6 w-6 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground",children:t.jsx(ze,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add this motivator to your goals"})})]}),i&&a&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),a(g)},className:"p-1 h-6 w-6 rounded-md hover:bg-ceramic-base text-muted-foreground hover:text-warm-text",children:t.jsx(mt,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this idea (Admin)"})})]}),i&&t.jsxs(et,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(ht,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation()},disabled:h,className:"p-1 h-6 w-6 rounded-md hover:bg-destructive/10 hover:text-destructive",children:t.jsx(Je,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Remove from default goals (Admin)"})})]}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Remove Default Goal"}),t.jsxs(Ve,{children:['Are you sure you want to remove "',g.title,'" from the default goal ideas? This action cannot be undone.']})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>x(g.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})]})]})]})})]}),w&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>o(v?null:g.id),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10",children:t.jsx(bt,{className:`w-3 h-3 transition-transform duration-200 ${v?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:v?"Show less":"Show full description"})})]})})]})},g.id)})})})})},Jh=l.memo(({motivator:e,onEdit:s,onDelete:r})=>{const[a,n]=l.useState(!1),[o,i]=l.useState(e.imageUrl||""),[c,d]=l.useState(!1),[f,u]=l.useState(!1),{addToDefaultGoals:m,checkIfInDefaultGoals:h,loading:p}=Tn(),{user:x}=ve(),g=e.content&&e.content.length>50;l.useEffect(()=>{(async()=>{if(x)try{const{data:b,error:j}=await T.rpc("has_role",{_user_id:x.id,_role:"admin"});if(j)throw j;d(b||!1)}catch(b){console.error("Error checking admin role:",b),d(!1)}})()},[x]),l.useEffect(()=>{(async()=>{if(!c)return;const b=await h(e.id);u(b)})()},[c,e.id,h]),l.useEffect(()=>{i(e.imageUrl||"")},[e.imageUrl]);const v=async()=>{await m(e)&&u(!0)},w=e.category==="saved_quote";return t.jsx(oe,{className:`overflow-hidden relative ${w?"bg-gray-900 border-gray-700":""}`,children:t.jsxs(Le,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0 relative",children:t.jsx(oa,{src:o,alt:e.title,className:"w-full h-full object-cover",onAddImageClick:s,showAddImagePrompt:!o})}),t.jsx("div",{className:"flex-1 p-4 pr-2 cursor-pointer hover:bg-muted/5",onClick:y=>{g&&(y.stopPropagation(),n(!a))},children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"flex items-center",children:t.jsx("h3",{className:`font-semibold ${w?"text-white":"text-warm-text"} ${a?"":"line-clamp-2"}`,children:e.title})}),e.content&&t.jsx("div",{className:`text-sm ${w?"text-gray-200":"text-muted-foreground"}`,children:a?t.jsx("p",{className:"whitespace-pre-wrap",children:e.content}):t.jsx("p",{className:"line-clamp-2",children:e.content})})]}),t.jsxs("div",{className:"flex flex-col gap-1 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),s()},className:"p-1 h-6 w-6 hover:bg-muted hover:text-foreground",children:t.jsx(mt,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this motivator"})})]}),c&&!f&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation(),v()},disabled:p,className:"p-1 h-6 w-6 hover:bg-yellow-500/10 hover:text-yellow-600",children:t.jsx(Sl,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add to default goals (Admin)"})})]}),c&&f&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx("div",{className:"p-1 h-6 w-6 flex items-center justify-center",children:t.jsx(Sl,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"})})}),t.jsx(Me,{children:t.jsx("p",{children:"In default goals"})})]}),t.jsxs(et,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(ht,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:y=>{y.stopPropagation()},className:"p-1 h-6 w-6 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(Je,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Delete this motivator"})})]}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Motivator"}),t.jsxs(Ve,{children:['Are you sure you want to delete "',e.title,'"? This action cannot be undone.']})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:r,children:"Delete"})]})]})]})]})]})})]}),g&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>n(!a),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10",children:t.jsx(bt,{className:`w-3 h-3 transition-transform duration-200 ${a?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:a?"Show less":"Show full description"})})]})})]})})});Jh.displayName="ExpandableMotivatorCard";const Zh=l.memo(({motivator:e,onDelete:s})=>t.jsx(oe,{className:"overflow-hidden relative bg-gray-900 border-gray-700",children:t.jsx(Le,{className:"p-6",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsx("div",{className:"flex-1 pr-4",children:e.content&&t.jsx("p",{className:"text-lg text-white leading-relaxed whitespace-pre-wrap",children:e.content})}),t.jsx("div",{className:"flex-shrink-0",children:t.jsxs(et,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(ht,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",className:"p-2 h-8 w-8 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(Je,{className:"w-4 h-4"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Delete this quote"})})]}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Quote"}),t.jsx(Ve,{children:"Are you sure you want to delete this saved quote? This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:s,children:"Delete"})]})]})]})})]})})}));Zh.displayName="SimpleMotivatorCard";const N1=()=>t.jsx(oe,{className:"overflow-hidden",children:t.jsxs("div",{className:"flex",children:[t.jsx(Wt,{className:"w-24 h-24 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 p-4 space-y-2",children:[t.jsx(Wt,{className:"h-4 w-[180px]"}),t.jsx(Wt,{className:"h-3 w-[120px]"}),t.jsx(Wt,{className:"h-3 w-[160px]"})]})]})}),S1=()=>{const e=qt(),{toast:s}=he(),{motivators:r,loading:a,createMotivator:n,createMultipleMotivators:o,updateMotivator:i,deleteMotivator:c,refreshMotivators:d}=qs(),{addToDefaultGoals:f,removeFromDefaultGoals:u,updateDefaultGoal:m,checkIfInDefaultGoals:h}=Tn(),[p,x]=l.useState("goals"),[g,v]=l.useState(!1),[w,y]=l.useState(null),[b,j]=l.useState(!1),[N,C]=l.useState(!1),[_,k]=l.useState(!1),[S,E]=l.useState(!1),[A,I]=l.useState("");l.useState(null);const z=r.filter(F=>F.category!=="saved_quote"),W=r.filter(F=>F.category==="saved_quote"),Y=async F=>{try{await n({title:F.title,content:F.content,category:"personal",imageUrl:F.imageUrl}),Na("create","personal"),v(!1),s({title:" Motivator Created!",description:"Your new motivator has been saved successfully."}),d()}catch{s({title:"Error",description:"Failed to create motivator",variant:"destructive"})}},G=F=>{y(F)},te=async F=>{try{w&&typeof w.id=="string"&&!w.id.match(/^\d+$/)?await m(w.id,{title:F.title,content:F.content,imageUrl:F.imageUrl})&&(Na("edit","admin_goal"),y(null),s({title:" Admin Goal Updated!",description:"The goal idea has been updated successfully."}),k(!0)):(await i(F.id,{title:F.title,content:F.content,imageUrl:F.imageUrl}),Na("edit","personal"),y(null),s({title:" Motivator Updated!",description:"Your changes have been saved."}),d())}catch{s({title:"Error",description:"Failed to update motivator",variant:"destructive"})}},$=async F=>{try{await c(F)&&Na("delete","personal")}catch{s({title:"Error",description:"Failed to delete motivator",variant:"destructive"})}},q=async F=>{if(console.log(" Result name:",F.name),console.log(" Result arguments:",F.arguments),F.name==="edit_motivator"){const{motivator_id:Q,updates:ae}=F.arguments;try{await i(Q,ae),s({title:" Motivator Updated!",description:"Your motivator has been updated via voice command."})}catch(R){console.error(" Error updating motivator via voice:",R),s({title:"Error",description:"Failed to update motivator. Please try again.",variant:"destructive"})}return}if(F.name==="delete_motivator"){const{motivator_id:Q}=F.arguments;try{await $(Q),s({title:" Motivator Deleted!",description:"Your motivator has been deleted via voice command."})}catch(ae){console.error(" Error deleting motivator via voice:",ae),s({title:"Error",description:"Failed to delete motivator. Please try again.",variant:"destructive"})}return}if(F.name==="create_multiple_motivators"){console.log(" Found create_multiple_motivators result");try{const Q=F.arguments.motivators.map(R=>({title:R.title,content:R.content,category:R.category||"general"})),ae=await o(Q);console.log(" Successfully created bulk motivators:",ae),s({title:" Motivators Created!",description:`Created ${Q.length} motivator${Q.length>1?"s":""} successfully!`})}catch(Q){console.error(" Error creating bulk motivators:",Q),s({title:"Error",description:"Failed to create motivators. Please try again.",variant:"destructive"})}}else if(F.name==="create_motivator"||F.arguments&&F.arguments.title){let Q;if(F.name==="create_motivator"){const{arguments:ae}=F;console.log(" Processing create_motivator function call:",ae),Q={title:ae.title,content:ae.content,imageUrl:ae.imageUrl||null}}else console.log(" Processing direct arguments:",F.arguments),Q={title:F.arguments.title,content:F.arguments.content,imageUrl:F.arguments.imageUrl||null};console.log(" Final suggestion data:",Q);try{console.log(" Calling handleCreateMotivator with:",Q),await Y(Q),console.log(" Successfully created motivator!"),s({title:" Motivator Created!",description:"Your AI-generated motivator has been saved."})}catch(ae){console.error(" Error creating motivator:",ae),s({title:"Error",description:"Failed to create AI motivator. Please try again.",variant:"destructive"})}}else console.log(" Result does not match expected format for motivator creation")},de=F=>{const Q={id:F.id,title:F.title,content:F.description||"",imageUrl:F.imageUrl};y(Q),k(!1)},Z=async F=>{try{await Y({title:F.title,content:F.description,imageUrl:F.imageUrl||null}),C(!1)}catch(Q){console.error("Error creating motivator from goal idea:",Q)}};return t.jsx(gr,{children:t.jsx("div",{className:"relative min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4",children:t.jsx("div",{className:"max-w-md mx-auto pt-10 pb-20",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(yn,{})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent mb-1",children:p==="goals"?"My Goals":"Saved Quotes"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:p==="goals"?"Your personal motivators":"Quotes saved from timers"})]})]}),t.jsxs("div",{className:"mb-6 grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(yt,{feature:"Voice Input",grayOutForFree:!0,className:"w-full",children:t.jsx(D,{onClick:()=>{I("Help me create a powerful motivator for my fasting journey. I want to record what drives me and why it's important."),j(!0),DN("chat","motivator_voice")},variant:"ai",size:"action-tall",className:"w-full flex items-center justify-center","aria-label":"Create motivator with voice",children:t.jsx(js,{className:"w-5 h-5"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Create a motivator by talking about what drives you"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Voice add"})]}),t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{onClick:()=>v(!0),variant:"action-primary",size:"action-tall",className:"w-full flex items-center justify-center","aria-label":"Create motivator manually",children:t.jsx(ze,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Create a motivator by typing title, description, and adding images"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Manual add"})]}),t.jsxs("div",{className:"col-span-1 flex flex-col items-center gap-1",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{onClick:()=>e("/motivator-ideas"),variant:"action-secondary",size:"action-tall",className:"w-full flex items-center justify-center","aria-label":"Browse motivator ideas",children:t.jsx(Jc,{className:"w-5 h-5"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Browse professionally designed motivators and add them to your collection"})})]}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Library"})]})]}),t.jsx("div",{className:"mb-6",children:t.jsx(Ha,{value:p,onValueChange:x,className:"w-full",children:t.jsxs(En,{className:"grid w-full grid-cols-2",children:[t.jsxs(ys,{value:"goals",children:["Goals (",z.length,")"]}),t.jsxs(ys,{value:"quotes",children:["Quotes (",W.length,")"]})]})})}),N&&t.jsx("div",{className:"mb-6 bg-card border border-border rounded-lg p-4",children:t.jsx($r,{children:t.jsx(b1,{onSelectGoal:Z,onClose:()=>C(!1)})})}),a?t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((F,Q)=>t.jsx(N1,{},Q))}):t.jsxs(Ha,{value:p,onValueChange:x,className:"w-full",children:[t.jsx(ws,{value:"goals",children:z.length===0?t.jsx(oe,{className:"p-6 text-center",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto",children:t.jsx(Gt,{className:"w-8 h-8 text-muted-foreground"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No goals yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first goal to stay inspired during your fasting journey"}),t.jsxs(D,{onClick:()=>v(!0),variant:"action-secondary",size:"action-secondary",children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Create Goal"]})]})]})}):t.jsxs("div",{className:"space-y-4",children:[z.map(F=>t.jsx(Jh,{motivator:F,onEdit:()=>G(F),onDelete:()=>$(F.id)},F.id)),z.length<3&&[...Array(3-z.length)].map((F,Q)=>t.jsx(oe,{className:"overflow-hidden border-dashed border-2 border-muted-foreground/20 hover:border-primary/30 cursor-pointer transition-all duration-200 hover:bg-muted/10 bg-muted/5",onClick:()=>v(!0),children:t.jsx(Le,{className:"p-6",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:t.jsx(ze,{className:"w-6 h-6 text-primary/60"})}),t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-muted-foreground/70 mb-1",children:["Create Goal #",z.length+Q+1]}),t.jsx("p",{className:"text-xs text-muted-foreground/50",children:"Tap to add another motivating goal"})]})]})})},`placeholder-${Q}`))]})}),t.jsx(ws,{value:"quotes",children:W.length===0?t.jsx(oe,{className:"p-6 text-center",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto",children:t.jsx(Xs,{className:"w-8 h-8 text-muted-foreground"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No saved quotes yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Quotes you save from timer screens will appear here"})]})]})}):t.jsx("div",{className:"space-y-4",children:W.map(F=>t.jsx(Zh,{motivator:F,onDelete:()=>$(F.id)},F.id))})})]}),g&&t.jsx($r,{children:t.jsx(Qa,{onSave:Y,onClose:()=>v(!1)})}),w&&t.jsx($r,{children:t.jsx(Qa,{motivator:w,onSave:te,onClose:()=>y(null)})}),b&&t.jsx($r,{children:t.jsx(Xh,{isOpen:b,context:A,onResult:q,onClose:()=>j(!1),title:"Motivator Assistant",systemPrompt:"You are a motivational coach who helps users create personalized motivational messages and goals. Focus on understanding their specific motivations and creating compelling, actionable content that will inspire them on their journey."})}),t.jsx(j1,{isOpen:_,onClose:()=>k(!1),onSelectGoal:Z,onEditGoal:de}),t.jsx(na,{isOpen:S,onClose:()=>E(!1),title:Xe.motivators.title,subtitle:Xe.motivators.subtitle,heroQuote:Xe.motivators.heroQuote,backgroundImage:Xe.motivators.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:Xe.motivators.subtitle})}),Xe.motivators.sections.map((F,Q)=>{const ae=F.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(ae,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:F.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:F.description})]})]},Q)})]})})]})})})})},_1=l.memo(S1);function C1({title:e,description:s,canonicalPath:r}){l.useEffect(()=>{if(document.title=e,s){let a=document.querySelector('meta[name="description"]');a||(a=document.createElement("meta"),a.setAttribute("name","description"),document.head.appendChild(a)),a.setAttribute("content",s)}if(r){const a=`${window.location.origin}${r}`;let n=document.querySelector('link[rel="canonical"]');n||(n=document.createElement("link"),n.setAttribute("rel","canonical"),document.head.appendChild(n)),n.setAttribute("href",a)}},[e,s,r])}var tl="Radio",[k1,ef]=jt(tl),[E1,T1]=k1(tl),tf=l.forwardRef((e,s)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:o,disabled:i,value:c="on",onCheck:d,form:f,...u}=e,[m,h]=l.useState(null),p=we(s,v=>h(v)),x=l.useRef(!1),g=m?f||!!m.closest("form"):!0;return t.jsxs(E1,{scope:r,checked:n,disabled:i,children:[t.jsx(pe.button,{type:"button",role:"radio","aria-checked":n,"data-state":af(n),"data-disabled":i?"":void 0,disabled:i,value:c,...u,ref:p,onClick:re(e.onClick,v=>{n||d?.(),g&&(x.current=v.isPropagationStopped(),x.current||v.stopPropagation())})}),g&&t.jsx(M1,{control:m,bubbles:!x.current,name:a,value:c,checked:n,required:o,disabled:i,form:f,style:{transform:"translateX(-100%)"}})]})});tf.displayName=tl;var sf="RadioIndicator",rf=l.forwardRef((e,s)=>{const{__scopeRadio:r,forceMount:a,...n}=e,o=T1(sf,r);return t.jsx(Nt,{present:a||o.checked,children:t.jsx(pe.span,{"data-state":af(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:s})})});rf.displayName=sf;var M1=e=>{const{control:s,checked:r,bubbles:a=!0,...n}=e,o=l.useRef(null),i=ia(r),c=ra(s);return l.useEffect(()=>{const d=o.current,f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"checked").set;if(i!==r&&m){const h=new Event("click",{bubbles:a});m.call(d,r),d.dispatchEvent(h)}},[i,r,a]),t.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:o,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function af(e){return e?"checked":"unchecked"}var P1=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],sl="RadioGroup",[D1,rk]=jt(sl,[_r,ef]),nf=_r(),of=ef(),[A1,R1]=D1(sl),lf=l.forwardRef((e,s)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:o,required:i=!1,disabled:c=!1,orientation:d,dir:f,loop:u=!0,onValueChange:m,...h}=e,p=nf(r),x=zs(f),[g,v]=Lt({prop:o,defaultProp:n,onChange:m});return t.jsx(A1,{scope:r,name:a,required:i,disabled:c,value:g,onValueChange:v,children:t.jsx(Vi,{asChild:!0,...p,orientation:d,dir:x,loop:u,children:t.jsx(pe.div,{role:"radiogroup","aria-required":i,"aria-orientation":d,"data-disabled":c?"":void 0,dir:x,...h,ref:s})})})});lf.displayName=sl;var cf="RadioGroupItem",df=l.forwardRef((e,s)=>{const{__scopeRadioGroup:r,disabled:a,...n}=e,o=R1(cf,r),i=o.disabled||a,c=nf(r),d=of(r),f=l.useRef(null),u=we(s,f),m=o.value===n.value,h=l.useRef(!1);return l.useEffect(()=>{const p=g=>{P1.includes(g.key)&&(h.current=!0)},x=()=>h.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",x),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",x)}},[]),t.jsx(Hi,{asChild:!0,...c,focusable:!i,active:m,children:t.jsx(tf,{disabled:i,required:o.required,checked:m,...d,...n,name:o.name,ref:u,onCheck:()=>o.onValueChange(n.value),onKeyDown:re(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:re(n.onFocus,()=>{h.current&&f.current?.click()})})})});df.displayName=cf;var I1="RadioGroupIndicator",uf=l.forwardRef((e,s)=>{const{__scopeRadioGroup:r,...a}=e,n=of(r);return t.jsx(rf,{...n,...a,ref:s})});uf.displayName=I1;var mf=lf,hf=df,F1=uf;const ff=l.forwardRef(({className:e,...s},r)=>t.jsx(mf,{className:K("grid gap-2",e),...s,ref:r}));ff.displayName=mf.displayName;const Ko=l.forwardRef(({className:e,...s},r)=>t.jsx(hf,{ref:r,className:K("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:t.jsx(F1,{className:"flex items-center justify-center",children:t.jsx(ed,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ko.displayName=hf.displayName;const O1=({onImageUpload:e,onImageRemove:s,currentImageUrl:r})=>{const[a,n]=l.useState(!1),{toast:o}=he(),{user:i}=ve(),c=async f=>{if(f){if(!i){o({title:"Error",description:"Please sign in to upload images",variant:"destructive"});return}if(!f.type.startsWith("image/")){o({title:"Error",description:"Please select an image file",variant:"destructive"});return}if(f.size>5*1024*1024){o({title:"Error",description:"Image size must be less than 5MB",variant:"destructive"});return}n(!0);try{const u=f.name.split(".").pop(),m=`${i.id}/${Date.now()}-admin-goal.${u}`;console.log(" Uploading admin goal image to:",m),console.log(" File size:",f.size,"bytes"),console.log(" File type:",f.type);const{data:h,error:p}=await T.storage.from("motivator-images").upload(m,f,{cacheControl:"3600",upsert:!0});if(p)throw console.error(" Storage upload error:",p),new Error(`Upload failed: ${p.message}`);if(!h)throw console.error(" No data returned from upload"),new Error("Upload failed: No data returned");console.log(" File uploaded successfully:",h);const{data:x}=T.storage.from("motivator-images").getPublicUrl(m);if(!x?.publicUrl)throw console.error(" Failed to get public URL"),new Error("Failed to get public URL");const g=x.publicUrl;console.log(" Public URL generated:",g),e(g),o({title:"Success",description:"Image uploaded successfully"})}catch(u){console.error(" Upload error details:",{message:u.message,stack:u.stack,error:u}),o({title:"Upload Failed",description:u.message||"Failed to upload image. Please try again.",variant:"destructive"})}finally{n(!1)}}},d=()=>{s(),o({title:"Image removed",description:"The image has been removed"})};return t.jsxs("div",{className:"space-y-3",children:[r&&t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:r,alt:"Goal idea",className:"w-full h-32 object-cover rounded-lg border border-ceramic-rim"}),t.jsx(D,{type:"button",size:"sm",variant:"destructive",onClick:d,className:"absolute top-2 right-2 h-6 w-6 p-0",disabled:a,children:t.jsx(Pe,{className:"w-3 h-3"})})]}),!r&&t.jsxs("div",{className:"border-2 border-dashed border-ceramic-rim rounded-lg p-6 text-center bg-ceramic-plate",children:[t.jsx(Wr,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Upload an image for this goal idea"}),t.jsx("label",{htmlFor:"admin-image-upload",className:"cursor-pointer",children:t.jsx(D,{type:"button",variant:"outline",size:"sm",disabled:a,className:"bg-ceramic-base border-ceramic-rim",asChild:!0,children:t.jsx("span",{children:a?t.jsxs(t.Fragment,{children:[t.jsx(Yt,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(qr,{className:"w-4 h-4 mr-2"}),"Choose Image"]})})})}),t.jsx("input",{id:"admin-image-upload",type:"file",accept:"image/*",onChange:f=>{const u=f.target.files?.[0];u&&c(u)},className:"hidden",disabled:a})]}),r&&t.jsxs("div",{className:"flex justify-center",children:[t.jsx("label",{htmlFor:"admin-image-replace",className:"cursor-pointer",children:t.jsx(D,{type:"button",variant:"outline",size:"sm",disabled:a,className:"bg-ceramic-base border-ceramic-rim",asChild:!0,children:t.jsx("span",{children:a?t.jsxs(t.Fragment,{children:[t.jsx(Yt,{className:"w-4 h-4 mr-2 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(qr,{className:"w-4 h-4 mr-2"}),"Replace Image"]})})})}),t.jsx("input",{id:"admin-image-replace",type:"file",accept:"image/*",onChange:f=>{const u=f.target.files?.[0];u&&c(u)},className:"hidden",disabled:a})]})]})},L1=({goal:e,onSave:s,onClose:r})=>{const[a,n]=l.useState(""),[o,i]=l.useState(""),[c,d]=l.useState(""),[f,u]=l.useState("male"),[m,h]=l.useState(!1),{toast:p}=he();l.useEffect(()=>{e&&(console.log(" Loading goal data into form:",e),n(e.title||""),i(e.description||""),d(e.imageUrl||""),u(e.gender||"male"))},[e]);const x=async()=>{if(!a.trim()){p({title:"Title required",description:"Please add a title for this idea.",variant:"destructive"});return}if(e){h(!0);try{const g={...e,title:a.trim(),description:o.trim(),imageUrl:c||void 0,gender:f};console.log(" Saving goal data:",g),await s(g),r()}catch(g){console.error(" Error saving goal:",g),p({title:"Error",description:"Failed to save changes",variant:"destructive"})}finally{h(!1)}}};return e?t.jsx(it,{isOpen:!0,onClose:r,title:"Edit Motivator Idea",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:r,disabled:m,className:"w-full bg-ceramic-base border-ceramic-rim",children:"Cancel"}),t.jsx(D,{onClick:x,disabled:!a.trim()||m,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",children:m?t.jsxs(t.Fragment,{children:[t.jsx(Mt,{className:"w-4 h-4 mr-2 animate-pulse"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"goal-title",className:"text-warm-text font-medium",children:"Title *"}),t.jsx(ge,{id:"goal-title",value:a,onChange:g=>n(g.target.value),className:"bg-ceramic-base border-ceramic-rim",placeholder:"Enter the motivator title...",disabled:m})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"goal-description",className:"text-warm-text font-medium",children:"Description"}),t.jsx(jr,{id:"goal-description",value:o,onChange:g=>i(g.target.value),className:"bg-ceramic-base border-ceramic-rim min-h-[80px]",placeholder:"Enter the motivator description...",disabled:m})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Gender"}),t.jsxs(ff,{value:f,onValueChange:g=>u(g),children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ko,{value:"male",id:"male"}),t.jsx(fe,{htmlFor:"male",className:"text-warm-text",children:"Male "})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ko,{value:"female",id:"female"}),t.jsx(fe,{htmlFor:"female",className:"text-warm-text",children:"Female "})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{className:"text-warm-text font-medium",children:"Image"}),t.jsx(O1,{currentImageUrl:c,onImageUpload:d,onImageRemove:()=>d("")})]})]})}):null};function $1(){C1({title:"Motivator Ideas Library",description:"Browse motivator ideas and add them to your goals.",canonicalPath:"/motivator-ideas"});const e=qt(),{toast:s}=he(),{profile:r}=Ie(),{isAdmin:a}=Ps(),n=r?.sex||"male";console.log("MotivatorIdeas - User gender for filtering:",n,"Profile sex:",r?.sex);const{goalIdeas:o,loading:i,refreshGoalIdeas:c,forceRefresh:d}=el(n),{removeFromDefaultGoals:f,updateDefaultGoal:u,loading:m}=Tn(),{createMotivator:h}=qs(),[p,x]=l.useState(null),[g,v]=l.useState(null),[w,y]=l.useState(null);l.useEffect(()=>{console.log(" Force refreshing goal ideas on page load..."),d()},[]),l.useEffect(()=>{r?.sex&&(w!==null&&w!==r.sex&&(console.log("MotivatorIdeas: Profile sex changed from",w,"to",r.sex,"- refreshing goals"),d()),y(r.sex))},[r?.sex,w,d]);const b=async _=>{try{await h({title:_.title,content:_.description||"",category:"personal",imageUrl:_.imageUrl||void 0}),s({title:" Added to My Goals",description:"The motivator was added successfully."})}catch{s({title:"Error",description:"Failed to add motivator.",variant:"destructive"})}},j=_=>{v(_)},N=async _=>{try{if(console.log("Saving edit with data:",_),await u(_.id,{title:_.title,content:_.description,imageUrl:_.imageUrl}))console.log(" Update successful, force refreshing ideas..."),v(null),s({title:" Idea Updated",description:"Changes saved successfully."}),d();else throw new Error("Update failed")}catch(k){console.error("Update error:",k),s({title:"Error",description:"Failed to update idea.",variant:"destructive"})}},C=async _=>{await f(_)&&(s({title:"Removed",description:"Idea removed from defaults."}),d())};return t.jsxs("div",{className:"pt-20 pb-20",children:[" ",t.jsxs("header",{className:"flex items-center gap-3 mb-4",children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>e("/motivators"),"aria-label":"Back to My Goals",children:t.jsx(oi,{className:"w-4 h-4"})}),t.jsxs("h1",{className:"text-xl font-bold text-warm-text",children:["Goal Ideas (",r?.sex||"Loading...",")"]})]}),t.jsx("main",{children:i?t.jsx("div",{className:"space-y-4",children:[...Array(4)].map((_,k)=>t.jsx("div",{className:"p-3 border border-ceramic-rim rounded-lg",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-full"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-1/2"}),t.jsx("div",{className:"h-5 bg-muted animate-pulse rounded w-16"})]})},k))}):o.length===0?t.jsxs("section",{className:"text-center py-10",children:[t.jsx(an,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No motivator ideas found"})]}):t.jsx("section",{className:"space-y-3","aria-label":"Motivator ideas list",children:o.map(_=>{const k=p===_.id,S=_.description&&_.description.length>50;return t.jsx(oe,{className:"overflow-hidden relative",children:t.jsxs(Le,{className:"p-0",children:[t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-32 h-32 flex-shrink-0",children:t.jsx(oa,{src:_.imageUrl,alt:_.title,className:"w-full h-full object-cover"})}),t.jsx("div",{className:"flex-1 p-4 pr-2",children:t.jsxs("div",{className:"flex items-start justify-between h-full",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"font-semibold text-warm-text line-clamp-1",children:_.title}),a&&_.gender&&t.jsx("span",{className:"text-sm",title:`${_.gender} goal`,children:_.gender==="male"?"":""})]}),_.description&&t.jsx("div",{className:"text-sm text-muted-foreground",children:k?t.jsx("p",{className:"whitespace-pre-wrap",children:_.description}):t.jsx("p",{className:"line-clamp-2",children:_.description})})]}),t.jsxs("div",{className:"flex flex-col gap-2 ml-2",children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",onClick:()=>b(_),className:"p-1 h-6 w-6 rounded-md bg-primary hover:bg-primary/90 text-primary-foreground","aria-label":"Add to my goals",children:t.jsx(ze,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Add this motivator to your goals"})})]}),a&&t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>j(_),className:"p-1 h-6 w-6 rounded-md hover:bg-ceramic-base text-muted-foreground hover:text-warm-text","aria-label":"Edit idea",children:t.jsx(mt,{className:"w-3 h-3"})})}),t.jsx(Me,{children:t.jsx("p",{children:"Edit this idea (Admin)"})})]}),a&&t.jsxs(et,{children:[t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(ht,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",disabled:m,className:"p-1 h-6 w-6 rounded-md hover:bg-destructive/10 hover:text-destructive","aria-label":"Delete idea",children:t.jsx(Je,{className:"w-3 h-3"})})})}),t.jsx(Me,{children:t.jsx("p",{children:"Remove from default goals (Admin)"})})]}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Remove Default Goal"}),t.jsxs(Ve,{children:['Are you sure you want to remove "',_.title,'" from the default goal ideas? This action cannot be undone.']})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>C(_.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove"})]})]})]})]})]})})]}),S&&t.jsx("div",{className:"absolute bottom-2 right-2",children:t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>x(k?null:_.id),className:"h-6 w-6 p-0 rounded-full hover:bg-muted/10","aria-label":k?"Show less":"Show full description",children:t.jsx(bt,{className:`w-3 h-3 transition-transform duration-200 ${k?"rotate-180":""}`})})}),t.jsx(Me,{children:t.jsx("p",{children:k?"Show less":"Show full description"})})]})})]})},_.id)})})}),g&&t.jsx(L1,{goal:g,onSave:N,onClose:()=>v(null)})]},`motivator-ideas-${r?.sex||"unknown"}-${Date.now()}`)}const U1=({onComplete:e,onSkip:s})=>{const{profile:r,updateProfile:a,loading:n}=Ie(),{toast:o}=he(),[i,c]=l.useState({weight:r?.weight?r.weight.toString():"",height:r?.height?r.height.toString():"",age:r?.age?r.age.toString():"",sex:r?.sex||"",activityLevel:r?.activity_level||""});X.useEffect(()=>{r&&c({weight:r.weight?r.weight.toString():"",height:r.height?r.height.toString():"",age:r.age?r.age.toString():"",sex:r.sex||"",activityLevel:r.activity_level||""})},[r]);const[d,f]=l.useState(null),[u,m]=l.useState(""),h=async()=>{try{const y={weight:parseFloat(i.weight),height:parseInt(i.height),age:parseInt(i.age),activity_level:i.activityLevel,sex:i.sex};console.log("About to save profile data:",y);const b=await a(y);if(console.log("Profile update result:",b),b?.error)throw console.error("Profile update failed:",b.error),new Error(b.error.message||"Failed to update profile");if(!b?.data)throw console.error("No data returned from profile update"),new Error("No data returned from profile update");console.log("Profile successfully saved:",b.data),o({title:"Profile Updated",description:"Your profile has been successfully updated!"}),setTimeout(()=>{e()},500)}catch(y){console.error("Error updating profile:",y),o({title:"Error",description:`Failed to update profile: ${y instanceof Error?y.message:"Please try again."}`,variant:"destructive"})}},p=()=>i.weight&&i.height&&i.age&&i.sex&&i.activityLevel,x=y=>{f(y),y==="weight"?m(i.weight):y==="height"?m(i.height):y==="age"?m(i.age):y==="sex"?m(i.sex):y==="activityLevel"&&m(i.activityLevel)},g=()=>{d==="weight"?c(y=>({...y,weight:u})):d==="height"?c(y=>({...y,height:u})):d==="age"?c(y=>({...y,age:u})):d==="sex"?c(y=>({...y,sex:u})):d==="activityLevel"&&c(y=>({...y,activityLevel:u})),f(null)},v=y=>{const b=i[y];if(!b)return"Not set";switch(y){case"weight":return`${b} kg`;case"height":return`${b} cm`;case"age":return`${b} years`;case"sex":return b.charAt(0).toUpperCase()+b.slice(1);case"activityLevel":return b?b.replace(/-/g," ").replace(/\b\w/g,j=>j.toUpperCase()):"Not set";default:return b}},w=()=>{if(!d)return null;switch(d){case"weight":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Weight (kg)"}),t.jsx(ge,{type:"number",value:u,onChange:y=>m(y.target.value),placeholder:"Enter weight in kg",min:"30",max:"300",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Or select from list"}),t.jsxs(Vt,{value:u,onValueChange:m,children:[t.jsx(Ft,{children:t.jsx(Ht,{placeholder:"Select weight"})}),t.jsx(Ot,{className:"bg-background border z-50 max-h-60",children:Array.from({length:271},(y,b)=>t.jsxs(Ue,{value:(30+b).toString(),children:[30+b," kg"]},30+b))})]})]})]});case"height":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Height (cm)"}),t.jsx(ge,{type:"number",value:u,onChange:y=>m(y.target.value),placeholder:"Enter height in cm",min:"100",max:"250",step:"1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Or select from list"}),t.jsxs(Vt,{value:u,onValueChange:m,children:[t.jsx(Ft,{children:t.jsx(Ht,{placeholder:"Select height"})}),t.jsx(Ot,{className:"bg-background border z-50 max-h-60",children:Array.from({length:151},(y,b)=>t.jsxs(Ue,{value:(100+b).toString(),children:[100+b," cm"]},100+b))})]})]})]});case"age":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Age"}),t.jsx(ge,{type:"number",value:u,onChange:y=>m(y.target.value),placeholder:"Enter age",min:"13",max:"120"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Or select from list"}),t.jsxs(Vt,{value:u,onValueChange:m,children:[t.jsx(Ft,{children:t.jsx(Ht,{placeholder:"Select age"})}),t.jsx(Ot,{className:"bg-background border z-50 max-h-60",children:Array.from({length:108},(y,b)=>t.jsx(Ue,{value:(13+b).toString(),children:13+b},13+b))})]})]})]});case"sex":return t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Biological Sex"}),t.jsxs(Vt,{value:u,onValueChange:m,children:[t.jsx(Ft,{children:t.jsx(Ht,{placeholder:"Select sex"})}),t.jsxs(Ot,{className:"bg-background border z-50",children:[t.jsx(Ue,{value:"male",children:"Male"}),t.jsx(Ue,{value:"female",children:"Female"})]})]})]})});case"activityLevel":return t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Activity Level"}),t.jsxs(Vt,{value:u,onValueChange:m,children:[t.jsx(Ft,{children:t.jsx(Ht,{placeholder:"Select activity level"})}),t.jsxs(Ot,{className:"bg-background border z-50",children:[t.jsx(Ue,{value:"sedentary",children:"Sedentary"}),t.jsx(Ue,{value:"lightly-active",children:"Lightly Active"}),t.jsx(Ue,{value:"moderately-active",children:"Moderately Active"}),t.jsx(Ue,{value:"very-active",children:"Very Active"}),t.jsx(Ue,{value:"extra-active",children:"Extra Active"})]})]})]})});default:return null}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("button",{onClick:()=>x("weight"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Weight"}),t.jsx("div",{className:"font-medium",children:v("weight")})]}),t.jsxs("button",{onClick:()=>x("height"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Height"}),t.jsx("div",{className:"font-medium",children:v("height")})]}),t.jsxs("button",{onClick:()=>x("age"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Age"}),t.jsx("div",{className:"font-medium",children:v("age")})]}),t.jsxs("button",{onClick:()=>x("sex"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Sex"}),t.jsx("div",{className:"font-medium",children:v("sex")})]}),t.jsxs("button",{onClick:()=>x("activityLevel"),className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors text-left col-span-2",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"Activity Level"}),t.jsx("div",{className:"font-medium",children:v("activityLevel")})]})]}),t.jsxs("div",{className:"flex justify-between items-center pt-6",children:[t.jsx(D,{variant:"ghost",onClick:s,className:"text-muted-foreground hover:text-foreground",disabled:n,children:"Skip for now"}),t.jsx(D,{onClick:h,disabled:!p()||n,children:n?"Completing...":"Complete Profile"})]}),t.jsx(Jr,{open:!!d,onOpenChange:()=>f(null),children:t.jsxs(ir,{className:"sm:max-w-md",children:[t.jsx(_n,{children:t.jsx(lr,{children:d&&d.charAt(0).toUpperCase()+d.slice(1)})}),w(),t.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[t.jsx(D,{variant:"outline",onClick:()=>f(null),children:"Cancel"}),t.jsx(D,{onClick:g,disabled:!u,children:"Save"})]})]})})]})},pf=({isOpen:e,onClose:s})=>{const r=Xe.profile;return t.jsx(na,{isOpen:e,onClose:s,title:r.title,subtitle:r.subtitle,children:t.jsx("div",{className:"mt-6 bg-muted/20 rounded-xl border border-border/50 p-6",children:t.jsx(U1,{onComplete:s,onSkip:s})})})},z1=()=>{const[e,s]=l.useState(!1),{toast:r}=he(),a=async()=>{s(!0);try{if(localStorage.clear(),sessionStorage.clear(),"indexedDB"in window){const n=await indexedDB.databases();await Promise.all(n.map(o=>{if(o.name)return new Promise((i,c)=>{const d=indexedDB.deleteDatabase(o.name);d.onsuccess=()=>i(),d.onerror=()=>c(d.error)})}))}if("caches"in window){const n=await caches.keys();await Promise.all(n.map(o=>caches.delete(o)))}if("serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();await Promise.all(n.map(o=>(o.waiting&&o.waiting.postMessage({type:"SKIP_WAITING"}),o.unregister())));try{await navigator.serviceWorker.register("/sw.js")}catch(o){console.log("Service worker registration after clear:",o)}}r({title:"Cache Cleared",description:"All cached data has been cleared. The page will reload to get the latest version."}),setTimeout(()=>{window.location.href=window.location.origin},1e3)}catch(n){console.error("Error clearing cache:",n),r({title:"Error",description:"Failed to clear cache completely. Please try refreshing the page manually.",variant:"destructive"})}finally{s(!1)}};return t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"outline",className:"w-full bg-ceramic-base border-ceramic-rim justify-start",children:"Clear Cache"})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Clear App Cache?"}),t.jsx(Ve,{children:"This will clear all cached data and reload the app to ensure you have the latest version. You may need to sign in again."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:a,disabled:e,children:e?t.jsx(t.Fragment,{children:"Clearing..."}):t.jsx(t.Fragment,{children:"Clear Cache"})})]})]})]})},q1=({onClose:e})=>{const[s,r]=l.useState([]),[a,n]=l.useState(""),[o,i]=l.useState(!1),[c,d]=l.useState(!1),f=l.useRef(null),{toast:u}=he(),{createMotivator:m,updateMotivator:h,refreshMotivators:p}=qs();l.useEffect(()=>{r([{role:"assistant",content:`Welcome! I'm here to help you create powerful motivators for your fasting journey. Let me share some real examples that work incredibly well:

**Fitting into clothes** - This is one of the most powerful motivators. Think about:
 That pair of pants you bought but never wore
 Clothes you used to fit into years ago
 A tuxedo or special outfit for an upcoming event (wedding, reunion, etc.)

The magic happens when you combine this with:
 A specific deadline (like a wedding date)
 Financial investment (you bought something expensive)
 Social validation (others will see you)
 Progress tracking (trying them on regularly)

**Impressing someone specific** - This might not be the most noble goal, but it works:
 Someone who used to like you but doesn't anymore
 People who insulted you or doubted you
 Someone you want to attract or re-attract

For each motivator, record a voice message telling me:
1. What specifically motivates you
2. Why it's important to you
3. Any deadlines or events involved
4. The emotional impact you want

I'll create each motivator in your database with a placeholder image. Then you should replace it with real photos - like actually wearing those tight clothes or a photo of the person you want to impress.

What's your first powerful motivator? Record it and tell me everything!`,timestamp:new Date}])},[]),l.useEffect(()=>{f.current?.scrollIntoView({behavior:"smooth"})},[s]);const x=async y=>{if(!y.trim())return;const b={role:"user",content:y,timestamp:new Date,audioEnabled:!0};r(j=>[...j,b]),await v(y,!0)},g=async y=>{const b=a.trim();if(!b||o)return;const j={role:"user",content:b,timestamp:new Date};r(N=>[...N,j]),n(""),await v(b)},v=async(y,b=!1)=>{i(!0);try{const j=s.map(A=>({role:A.role,content:A.content})),N=`You are a motivational coach specialized in creating powerful fasting motivators. Your goal is to help users create specific, emotionally resonant motivators.

IMPORTANT: Each voice message from the user should be processed individually to create separate motivators. If they mention multiple motivators in one message, split them into separate ones.

When a user describes a motivator, immediately create it by responding with a JSON object:
{
  "action": "create_motivator",
  "title": "Brief, powerful title (max 50 chars)",
  "content": "Detailed description based on their story (max 200 chars)",
  "category": "personal" | "health" | "achievement" | "mindset"
}

MOTIVATOR CREATION GUIDELINES:
- Use their exact words and emotional language
- Include specific details they mentioned (dates, people, clothes, etc.)
- Make it personal and emotionally charged
- Focus on the outcome they want
- Include any deadlines or social elements
- Reference specific items (clothes, photos, events)

RESPONSE STYLE:
- After creating each motivator, tell them: "I've created your motivator! I'm also generating a motivational image for it automatically - you can replace it later with your own photos if you prefer."
- Ask if they have more motivators to add
- Keep responses encouraging and action-oriented
- Don't ask too many clarifying questions - create the motivator from what they give you

ALWAYS create the motivator immediately when they describe one. Don't ask for permission.`,{data:C,error:_}=await T.functions.invoke("chat-completion",{body:{message:y,conversationHistory:[{role:"system",content:N},...j]}});if(_)throw _;let k=!1,S=C.completion;try{const A=C.completion.match(/\{[\s\S]*?"action":\s*"create_motivator"[\s\S]*?\}/);if(A){const I=JSON.parse(A[0]);if(I.action==="create_motivator"){const z=await m({title:I.title,content:I.content,category:I.category||"personal"});k=!0,S=C.completion.replace(A[0],"").trim(),u({title:" Motivator Created!",description:`"${I.title}" has been added to your motivators.`})}}}catch(A){console.error("Error parsing motivator JSON:",A)}const E={role:"assistant",content:S||C.completion,timestamp:new Date,audioEnabled:c&&b};r(A=>[...A,E]),c&&b&&S&&await w(S),k&&p()}catch(j){console.error("Error sending message:",j),u({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{i(!1)}},w=async y=>{try{const{data:b,error:j}=await T.functions.invoke("text-to-speech",{body:{text:y,voice:"alloy"}});if(j)throw j;b.audioUrl&&new Audio(b.audioUrl).play()}catch(b){console.error("Error playing text as audio:",b)}};return t.jsxs(it,{isOpen:!0,onClose:e,title:"AI Motivator Coach",variant:"standard",size:"md",showCloseButton:!0,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 justify-end",children:[t.jsx(Sn,{id:"modal-audio-mode",checked:c,onCheckedChange:d,className:"scale-75"}),t.jsx(fe,{htmlFor:"modal-audio-mode",className:"text-sm",children:c?t.jsx(Cl,{className:"h-3 w-3"}):t.jsx(Cx,{className:"h-3 w-3"})})]}),t.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto mb-4",children:[s.map((y,b)=>t.jsx("div",{className:`flex ${y.role==="user"?"justify-end":"justify-start"}`,children:t.jsx(oe,{className:`max-w-[85%] p-3 ${y.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:y.content}),t.jsx("p",{className:"text-xs opacity-70 mt-1",children:y.timestamp.toLocaleTimeString()})]}),y.audioEnabled&&y.role==="assistant"&&t.jsx(Cl,{className:"h-4 w-4 opacity-70"})]})})},b)),o&&t.jsx("div",{className:"flex justify-start",children:t.jsx(oe,{className:"max-w-[85%] p-3 bg-muted",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}),t.jsx("p",{className:"text-sm",children:"AI is thinking..."})]})})}),t.jsx("div",{ref:f})]}),t.jsxs("div",{className:"border-t border-border pt-4 mt-4 space-y-3",children:[t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsx(ge,{value:a,onChange:y=>n(y.target.value),placeholder:"Tell me what motivates you...",onKeyPress:y=>y.key==="Enter"&&!y.shiftKey&&g(),disabled:o,className:"flex-1"}),t.jsx(D,{onClick:()=>g(),disabled:!a.trim()||o,size:"default",className:"flex-shrink-0",children:t.jsx(ad,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(yt,{feature:"Voice Input",grayOutForFree:!0,children:t.jsx(Yr,{onTranscription:x,isDisabled:o,size:"lg"})})})]})]})},B1=({onClose:e})=>{const{toast:s}=he(),{motivators:r,loading:a,createMotivator:n,updateMotivator:o,deleteMotivator:i,refreshMotivators:c}=qs(),[d,f]=l.useState(!1),[u,m]=l.useState(null),h=async v=>{try{await n({title:v.title,content:v.content,category:"personal",imageUrl:v.imageUrl}),f(!1),c()}catch{s({title:"Error",description:"Failed to create motivator",variant:"destructive"})}},p=v=>{m(v)},x=async v=>{try{if(console.log("Updating motivator with ID:",v.id,"Type:",typeof v.id),!v.id||typeof v.id!="string")throw new Error("Invalid motivator ID");await o(v.id,{title:v.title,content:v.content,imageUrl:v.imageUrl}),m(null),c()}catch(w){console.error("Error updating motivator:",w),s({title:"Error updating motivator",description:w.message||"Failed to update motivator",variant:"destructive"})}},g=async v=>{try{await i(v),c()}catch{s({title:"Error",description:"Failed to delete motivator",variant:"destructive"})}};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-ceramic-plate rounded-3xl w-full max-w-md max-h-[85vh] border border-ceramic-rim shadow-2xl mt-4 flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-ceramic-rim",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"My Motivators"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Your personal motivators"})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[t.jsxs(D,{onClick:()=>f(!0),className:"w-full mb-6 bg-primary hover:bg-primary/90 text-primary-foreground",children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Create New Motivator"]}),a?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading your motivators..."})}):r.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(Xs,{className:"w-8 h-8 text-muted-foreground"})}),t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:"No motivators yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first motivator to stay inspired during your fasting journey"})]}):t.jsx("div",{className:"space-y-4",children:r.map(v=>t.jsx(oe,{className:"overflow-hidden",children:t.jsx(Le,{className:"p-0",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-20 h-20 bg-muted flex items-center justify-center flex-shrink-0",children:v.imageUrl?t.jsx("img",{src:v.imageUrl,alt:v.title,className:"w-full h-full object-cover"}):t.jsx(Wr,{className:"w-8 h-8 text-muted-foreground"})}),t.jsx("div",{className:"flex-1 p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text line-clamp-1",children:v.title}),v.content&&t.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:v.content}),v.category&&t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(vs,{variant:"secondary",className:"text-xs",children:v.category})})]}),t.jsxs("div",{className:"flex gap-1 ml-2",children:[t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>p(v),className:"p-1 h-6 w-6 hover:bg-muted hover:text-foreground",children:t.jsx(mt,{className:"w-3 h-3"})}),t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",className:"p-1 h-6 w-6 hover:bg-destructive/10 hover:text-destructive",children:t.jsx(Je,{className:"w-3 h-3"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Motivator"}),t.jsxs(Ve,{children:['Are you sure you want to delete "',v.title,'"? This action cannot be undone.']})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>g(v.id),children:"Delete"})]})]})]})]})]})})]})})},v.id))})]}),d&&t.jsx(Qa,{onSave:h,onClose:()=>f(!1)}),u&&t.jsx(Qa,{motivator:u,onSave:x,onClose:()=>m(null)})]})})},gf=l.createContext(void 0),W1=()=>{const e=l.useContext(gf);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},G1=({children:e})=>{const[s,r]=l.useState(()=>{const c=localStorage.getItem("theme")||"dark";return c==="system"?"dark":c}),[a,n]=l.useState("light");l.useEffect(()=>{let i=s;s==="system"&&(i="dark",r("dark"),localStorage.setItem("theme","dark")),n(i),document.documentElement.classList.toggle("dark",i==="dark")},[s]);const o=i=>{r(i),localStorage.setItem("theme",i)};return t.jsx(gf.Provider,{value:{theme:s,setTheme:o,actualTheme:a},children:e})},V1=()=>{const{theme:e,setTheme:s}=W1(),r=[{value:"light",icon:mx,label:"Light"},{value:"dark",icon:$g,label:"Dark"},{value:"system",icon:Og,label:"Auto"}];return t.jsx("div",{className:"flex bg-muted rounded-lg p-1 gap-1",children:r.map(({value:a,icon:n,label:o})=>t.jsxs(D,{variant:e===a?"default":"ghost",size:"sm",onClick:()=>s(a),className:`
            flex-1 h-8 px-2 transition-all duration-200
            ${e===a?"bg-background shadow-sm text-foreground":"hover:bg-muted-foreground/10 text-muted-foreground"}
          `,children:[t.jsx(n,{className:"w-3.5 h-3.5 mr-1.5"}),t.jsx("span",{className:"text-xs font-medium",children:o})]},a))})},H1=()=>{const e=ft(),s=l.useCallback(async()=>{console.log(" Clearing ALL subscription-related cache");try{await e.invalidateQueries({queryKey:["unified-subscription"]}),await e.invalidateQueries({queryKey:["subscription"]}),await e.invalidateQueries({queryKey:["optimized-subscription"]}),e.removeQueries({queryKey:["unified-subscription"]}),e.removeQueries({queryKey:["subscription"]}),e.removeQueries({queryKey:["optimized-subscription"]}),e.invalidateQueries({queryKey:["profile"]}),await e.refetchQueries({queryKey:["unified-subscription"],type:"active"}),await new Promise(c=>setTimeout(c,100)),console.log(" All subscription cache cleared and refetched"),window.location.reload()}catch(c){console.error(" Error clearing subscription cache:",c)}},[e]),r=l.useCallback(()=>{console.log(" Force refreshing subscription data"),e.invalidateQueries({queryKey:["unified-subscription"]}),e.refetchQueries({queryKey:["unified-subscription"]})},[e]),a=l.useCallback((c={})=>{console.log(" Clearing subscription cache"),e.invalidateQueries({queryKey:["unified-subscription"]}),e.invalidateQueries({queryKey:["subscription"]}),e.removeQueries({queryKey:["unified-subscription"]}),e.removeQueries({queryKey:["subscription"]}),c.showToast&&console.log(" Subscription cache cleared")},[e]),n=l.useCallback((c={})=>{console.log(" Clearing walking cache"),e.invalidateQueries({queryKey:["walking"]}),e.removeQueries({queryKey:["walking"]}),c.showToast&&console.log(" Walking cache cleared")},[e]),o=l.useCallback(async(c={})=>{console.log(" Clearing goals cache"),e.invalidateQueries({queryKey:["goals"]}),e.invalidateQueries({queryKey:["motivators"]}),e.removeQueries({queryKey:["goals"]}),e.removeQueries({queryKey:["motivators"]}),c.showToast&&console.log(" Goals cache cleared")},[e]),i=l.useCallback(async(c={})=>{console.log(" Clearing profile cache"),e.invalidateQueries({queryKey:["profile"]}),e.removeQueries({queryKey:["profile"]}),c.showToast&&console.log(" Profile cache cleared")},[e]);return{clearAllSubscriptionCache:s,forceRefreshSubscription:r,clearSubscriptionCache:a,clearWalkingCache:n,clearGoalsCache:o,clearProfileCache:i}},Q1=()=>{l.useState(!0);const[e,s]=l.useState(!1),[r,a]=l.useState("gpt-4o-mini-realtime"),[n,o]=l.useState("whisper-1"),[i,c]=l.useState("tts-1"),[d,f]=l.useState("alloy"),[u,m]=l.useState(""),[h,p]=l.useState(""),[x,g]=l.useState(""),[v,w]=l.useState(""),[y,b]=l.useState(""),[j,N]=l.useState(""),[C,_]=l.useState("sedentary"),{toast:k}=he(),{user:S,signOut:E}=ve(),A=qt(),I=Es(),z=I.platform==="web",W=I.platform==="ios"?"App Store":I.platform==="android"?"Google Play":"Stripe",[Y,G]=l.useState(!1),[te,$]=l.useState(!1),[q,de]=l.useState(!1),{profile:Z,updateProfile:F,loading:Q}=Ie();nr();const{clearGoalsCache:ae,clearProfileCache:R}=H1();l.useEffect(()=>{const J=async()=>{if(S)try{const{data:H,error:me}=await T.from("user_roles").select("role").eq("user_id",S.id).eq("role","admin").maybeSingle();me?(console.log("Admin check error (expected if no role):",me),s(!1)):s(!!H)}catch(H){console.error("Error checking admin role:",H),s(!1)}},ne=async()=>{if(S)try{const{data:H,error:me}=await T.from("profiles").select("speech_model, transcription_model, tts_model, tts_voice, weight, height, age, sex, daily_calorie_goal, daily_carb_goal, activity_level, enable_fasting_slideshow, enable_walking_slideshow").eq("user_id",S.id).maybeSingle();if(me){console.error("Error loading profile settings:",me);return}if(H){a(H.speech_model||"gpt-4o-mini-realtime"),o(H.transcription_model||"whisper-1"),c(H.tts_model||"tts-1"),f(H.tts_voice||"alloy"),m(H.weight?.toString()||""),p(H.height?.toString()||""),g(H.age?.toString()||""),w(H.sex||""),b(H.daily_calorie_goal?.toString()||""),N(H.daily_carb_goal?.toString()||""),_(H.activity_level||"sedentary");const le=!H.weight||!H.height||!H.age||!H.activity_level&&!H["activity-level"];console.log("Profile incompleteness check:",{weight:H.weight,height:H.height,age:H.age,activity_level:H.activity_level,isIncomplete:le}),le&&de(!0)}else de(!0)}catch(H){console.error("Error fetching user settings:",H)}};J(),ne()},[S]);const B=async()=>{try{if(u&&(parseFloat(u)<30||parseFloat(u)>300)){k({title:"Invalid Weight",description:"Weight must be between 30-300 kg",variant:"destructive"});return}if(h&&(parseInt(h)<100||parseInt(h)>250)){k({title:"Invalid Height",description:"Height must be between 100-250 cm",variant:"destructive"});return}if(S){const J={speech_model:r,transcription_model:n,tts_model:i,tts_voice:d,weight:u?parseFloat(u):null,height:h?parseInt(h):null,age:x?parseInt(x):null,sex:v||null,daily_calorie_goal:y?parseInt(y):null,daily_carb_goal:j?parseInt(j):null,activity_level:C};console.log("Settings: User ID:",S?.id),console.log("Settings: Saving profile data:",J);const ne=await F(J);if(ne?.error){console.error("Settings save error:",ne.error),k({title:"Database Error",description:`Failed to save: ${ne.error.message}`,variant:"destructive"});return}ne?.data&&J.sex&&J.sex!==Z?.sex&&(console.log(" Sex changed - clearing goal and profile caches"),await ae({showToast:!1}),await R({showToast:!1}),k({title:"Profile Updated",description:"Sex updated successfully. Goal recommendations have been refreshed."}));const me=ne?.error;try{await T.rpc("update_user_tier",{_user_id:S.id}),I?.invalidate?.()}catch(le){console.warn("Tier update RPC failed:",le)}console.log("Settings saved successfully"),k({title:" Settings Saved!",description:"Your settings have been updated successfully."})}}catch(J){console.error("Settings save error:",J),k({title:"Error",description:J?.message||"Failed to save settings. Please try again.",variant:"destructive"})}},L=async()=>{if(S)try{const J=[T.from("chat_conversations").delete().eq("user_id",S.id),T.from("motivators").delete().eq("user_id",S.id),T.from("food_entries").delete().eq("user_id",S.id),T.from("user_foods").delete().eq("user_id",S.id),T.from("fasting_sessions").delete().eq("user_id",S.id),T.from("walking_sessions").delete().eq("user_id",S.id),T.from("manual_calorie_burns").delete().eq("user_id",S.id),T.from("daily_activity_overrides").delete().eq("user_id",S.id),T.from("daily_food_templates").delete().eq("user_id",S.id),T.from("default_food_favorites").delete().eq("user_id",S.id)];await Promise.all(J),await T.from("profiles").update({weight:null,height:null,age:null,daily_calorie_goal:null,daily_carb_goal:null,goal_weight:null,onboarding_completed:!1}).eq("user_id",S.id),k({title:"Account Reset Complete",description:"All your data has been cleared. You can start fresh!"}),A("/")}catch(J){console.error("Error resetting account:",J),k({title:"Error",description:"Failed to reset account. Please try again.",variant:"destructive"})}},se=async()=>{if(S)try{const{data:J,error:ne}=await T.functions.invoke("delete-account",{headers:{Authorization:`Bearer ${(await T.auth.getSession()).data.session?.access_token}`}});if(ne)throw ne;J.scheduled?k({title:"Account Deletion Scheduled",description:J.message}):(k({title:"Account Deleted",description:J.message}),await E(),A("/auth"))}catch(J){console.error("Error deleting account:",J),k({title:"Error",description:"Failed to delete account. Please try again.",variant:"destructive"})}};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted/20 p-4",children:t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"mb-2 mt-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent mb-1",children:"Settings"}),e&&t.jsx(D,{size:"sm",variant:"outline",onClick:()=>A("/admin"),children:"Admin Dashboard"})]}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Customize your fasting experience"})]})}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(_l,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Profile"})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>de(!0),className:"w-8 h-8 p-0 rounded-full bg-ceramic-plate/80 backdrop-blur-sm border border-ceramic-rim hover:bg-ceramic-plate hover:scale-110 transition-all duration-200",title:"Setup Profile Walkthrough",children:t.jsx(ii,{className:"w-4 h-4 text-warm-text"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-sm font-medium text-warm-text",children:"Physical Attributes"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"weight",className:"text-warm-text",children:"Weight (kg)"}),t.jsx(ge,{id:"weight",type:"number",placeholder:"70",value:u,onChange:J=>m(J.target.value),className:"bg-ceramic-base border-ceramic-rim",min:"30",max:"300",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"height",className:"text-warm-text",children:"Height (cm)"}),t.jsx(ge,{id:"height",type:"number",placeholder:"175",value:h,onChange:J=>p(J.target.value),className:"bg-ceramic-base border-ceramic-rim",min:"100",max:"250",step:"1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"age",className:"text-warm-text",children:"Age"}),t.jsx(ge,{id:"age",type:"number",placeholder:"30",value:x,onChange:J=>g(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"sex",className:"text-warm-text",children:"Biological Sex"}),t.jsxs(Vt,{value:v,onValueChange:w,children:[t.jsx(Ft,{className:"bg-ceramic-base border-ceramic-rim",children:t.jsx(Ht,{placeholder:"Select sex"})}),t.jsxs(Ot,{children:[t.jsx(Ue,{value:"male",children:"Male"}),t.jsx(Ue,{value:"female",children:"Female"})]})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium text-warm-text",children:"Daily Goals"}),t.jsx(Ze,{content:"Set your daily calorie and carb targets. These help track your progress and calculate deficits. Leave blank if you don't want to track these goals.",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"daily-calorie-goal",className:"text-warm-text",children:"Calorie Goal"}),t.jsx(ge,{id:"daily-calorie-goal",type:"number",placeholder:"2000",value:y,onChange:J=>b(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"daily-carb-goal",className:"text-warm-text",children:"Carb Goal (g)"}),t.jsx(ge,{id:"daily-carb-goal",type:"number",placeholder:"200",value:j,onChange:J=>N(J.target.value),className:"bg-ceramic-base border-ceramic-rim"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(fe,{htmlFor:"activity-level",className:"text-warm-text",children:"Activity Level"}),t.jsx(Ze,{content:"Affects calorie burn calculations. Most people should choose 'Sedentary' (office work) or 'Lightly Active' (some walking). This is your default setting.",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs(Vt,{value:C,onValueChange:_,children:[t.jsx(Ft,{className:"bg-ceramic-base border-ceramic-rim w-full",children:t.jsx(Ht,{placeholder:"Select"})}),t.jsxs(Ot,{children:[t.jsx(Ue,{value:"sedentary",children:"Low (Little/no exercise)"}),t.jsx(Ue,{value:"moderately_active",children:"Medium (Moderate exercise 3-5 days/week)"}),t.jsx(Ue,{value:"very_active",children:"High (Hard exercise 6-7 days/week)"})]})]})]})]})]})}),t.jsx(D,{onClick:B,variant:"action-primary",size:"action-main",className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70",children:"Save Settings"}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(_l,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Account"})]}),t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Email"}),t.jsx("span",{className:"text-warm-text font-medium",children:S?.email})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Login Method"}),t.jsx("span",{className:"text-warm-text font-medium",children:S?.app_metadata?.provider==="google"?"Google":"Email"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Account Type"}),t.jsx("span",{className:"text-warm-text font-medium",children:I.inTrial?"Trial User":I.hasPremiumFeatures?"Premium User":"Free User"})]}),(I.inTrial||I.hasPremiumFeatures)&&t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:I.inTrial?"Trial expires":"Renewal due"}),t.jsx("span",{className:"text-warm-text font-medium",children:I.inTrial?I.trialEndsAt?new Date(I.trialEndsAt).toLocaleDateString():"Unknown":I.subscription_end_date?new Date(I.subscription_end_date).toLocaleDateString():"Unknown"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-muted-foreground",children:"Member since"}),t.jsx("span",{className:"text-warm-text font-medium",children:S?.created_at?new Date(S.created_at).toLocaleDateString():"Unknown"})]})]}),t.jsxs("div",{className:"pt-3 border-t border-ceramic-rim space-y-3",children:[I.subscription_tier!=="paid_user"&&t.jsxs(D,{onClick:async()=>{try{await I.createSubscription(),k({title:z?"Redirecting to checkout":`Use ${W} to upgrade`,description:z?"Opening payment page...":`Purchases are managed via ${W}.`})}catch{k({title:"Error",description:"Failed to start subscription. Please try again.",variant:"destructive"})}},className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70",children:[t.jsx(co,{className:"w-4 h-4 mr-2"}),z?"Upgrade to Premium":`Upgrade via ${W}`]}),t.jsx(D,{onClick:()=>{E(),A("/auth")},variant:"outline",className:"w-full bg-ceramic-base border-ceramic-rim justify-start hover:bg-red-50 hover:border-red-200 hover:text-red-600",children:"Sign Out"})]})]})}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(zg,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Appearance"})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(V1,{})})]})}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim border-destructive/20",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Qt,{className:"w-5 h-5 text-destructive"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Account Management"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(z1,{}),t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"outline",className:"w-full border-orange-500/30 text-orange-600 hover:bg-orange-500/10 justify-start",children:"Reset Account Data"})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Reset Account Data?"}),t.jsx(Ve,{children:"This will permanently delete all your data (food entries, fasting sessions, walking history, motivators, etc.) but keep your account active. You can start fresh with a clean slate."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:L,className:"bg-orange-500 hover:bg-orange-600",children:"Reset All Data"})]})]})]}),t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"outline",className:"w-full border-destructive/30 text-destructive hover:bg-destructive/10 justify-start",children:"Delete Account"})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Account Permanently?"}),t.jsx(Ve,{children:"This will permanently delete your account and all associated data. This action cannot be undone. If you have an active subscription, it will be canceled."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:se,className:"bg-destructive hover:bg-destructive/80",children:"Delete Forever"})]})]})]})]})]})}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(at,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"About"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Version"}),t.jsx("span",{className:"text-warm-text font-medium",children:"1.0.0"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-muted-foreground",children:"Build"}),t.jsx("span",{className:"text-warm-text font-medium",children:"Beta"})]})]})]})}),t.jsx(oe,{className:"p-6 bg-ceramic-plate border-ceramic-rim",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Nl,{className:"w-5 h-5 text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Legal"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("a",{href:"https://fastnow.app/privacy",target:"_blank",rel:"noopener noreferrer",className:"block w-full text-left text-sm text-primary hover:underline",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Nl,{className:"w-4 h-4 mr-2"}),"Privacy Policy"]})}),t.jsx("a",{href:"https://fastnow.app/terms",target:"_blank",rel:"noopener noreferrer",className:"block w-full text-left text-sm text-primary hover:underline",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(at,{className:"w-4 h-4 mr-2"}),"Terms of Service"]})})]})]})})]}),Y&&t.jsx(B1,{onClose:()=>G(!1)}),te&&t.jsx(q1,{onClose:()=>$(!1)}),t.jsx(pf,{isOpen:q,onClose:()=>de(!1)})]})})};var rl="Collapsible",[K1,ak]=jt(rl),[Y1,al]=K1(rl),xf=l.forwardRef((e,s)=>{const{__scopeCollapsible:r,open:a,defaultOpen:n,disabled:o,onOpenChange:i,...c}=e,[d=!1,f]=Lt({prop:a,defaultProp:n,onChange:i});return t.jsx(Y1,{scope:r,disabled:o,contentId:ts(),open:d,onOpenToggle:l.useCallback(()=>f(u=>!u),[f]),children:t.jsx(pe.div,{"data-state":ol(d),"data-disabled":o?"":void 0,...c,ref:s})})});xf.displayName=rl;var vf="CollapsibleTrigger",yf=l.forwardRef((e,s)=>{const{__scopeCollapsible:r,...a}=e,n=al(vf,r);return t.jsx(pe.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":ol(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...a,ref:s,onClick:re(e.onClick,n.onOpenToggle)})});yf.displayName=vf;var nl="CollapsibleContent",wf=l.forwardRef((e,s)=>{const{forceMount:r,...a}=e,n=al(nl,e.__scopeCollapsible);return t.jsx(Nt,{present:r||n.open,children:({present:o})=>t.jsx(X1,{...a,ref:s,present:o})})});wf.displayName=nl;var X1=l.forwardRef((e,s)=>{const{__scopeCollapsible:r,present:a,children:n,...o}=e,i=al(nl,r),[c,d]=l.useState(a),f=l.useRef(null),u=we(s,f),m=l.useRef(0),h=m.current,p=l.useRef(0),x=p.current,g=i.open||c,v=l.useRef(g),w=l.useRef();return l.useEffect(()=>{const y=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(y)},[]),wt(()=>{const y=f.current;if(y){w.current=w.current||{transitionDuration:y.style.transitionDuration,animationName:y.style.animationName},y.style.transitionDuration="0s",y.style.animationName="none";const b=y.getBoundingClientRect();m.current=b.height,p.current=b.width,v.current||(y.style.transitionDuration=w.current.transitionDuration,y.style.animationName=w.current.animationName),d(a)}},[i.open,a]),t.jsx(pe.div,{"data-state":ol(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!g,...o,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":x?`${x}px`:void 0,...e.style},children:g&&n})});function ol(e){return e?"open":"closed"}var J1=xf;const Z1=J1,eS=yf,tS=wf,Ka=({fullScreen:e=!0,text:s="Loading",subText:r="Preparing your experience"})=>{const a=t.jsxs("div",{className:"text-center space-y-4",children:[t.jsxs("div",{className:"relative w-16 h-16 mx-auto",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-primary/20 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary rounded-full animate-spin"}),t.jsx("div",{className:"absolute inset-2 border-2 border-primary/30 rounded-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-lg font-medium text-foreground",children:s}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),t.jsxs("div",{className:"flex justify-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]});return e?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a}):t.jsx("div",{className:"flex items-center justify-center p-8",children:a})},sS=()=>{const[e,s]=l.useState(""),[r,a]=l.useState(""),[n,o]=l.useState(!1),[i,c]=l.useState(!1),[d,f]=l.useState(!1),{signIn:u,signUp:m,signInWithGoogle:h,user:p,loading:x}=ve(),g=qt();if(l.useEffect(()=>{p&&!x&&g("/")},[p,x,g]),x)return t.jsx(Ka,{});const v=async b=>{b.preventDefault(),o(!0),await u(e,r),o(!1)},w=async b=>{b.preventDefault(),o(!0),await m(e,r),o(!1)},y=async()=>{o(!0),await h(),o(!1)};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background/80 to-accent/10 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-primary to-primary-glow bg-clip-text text-transparent",children:"FastNow"}),t.jsx("p",{className:"text-muted-foreground",children:"Your no-BS weight loss program"})]}),t.jsx(oe,{className:"border-border/50 backdrop-blur-sm bg-card/80 shadow-elegant",children:t.jsxs(Le,{className:"space-y-6 pt-6",children:[t.jsxs(D,{size:"lg",className:"w-full h-12 text-base bg-gradient-to-r from-primary to-primary-glow hover:from-primary/90 hover:to-primary-glow/90 shadow-lg",onClick:y,disabled:n,children:[n?t.jsx(Yt,{className:"mr-3 h-5 w-5 animate-spin"}):t.jsxs("svg",{className:"mr-3 h-5 w-5",viewBox:"0 0 24 24",children:[t.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),t.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),t.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),t.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),t.jsxs(Z1,{open:i,onOpenChange:c,children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 flex items-center",children:t.jsx("div",{className:"w-full border-t border-border"})}),t.jsx("div",{className:"relative flex justify-center",children:t.jsx(eS,{asChild:!0,children:t.jsxs(D,{variant:"ghost",size:"sm",className:"bg-card px-4 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[t.jsx(sd,{className:"mr-2 h-4 w-4"}),"Use email instead",t.jsx(bt,{className:`ml-2 h-4 w-4 transition-transform ${i?"rotate-180":""}`})]})})})]}),t.jsxs(tS,{className:"space-y-4 animate-in slide-in-from-top-2 duration-300",children:[t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsx(D,{variant:d?"outline":"default",size:"sm",className:"flex-1",onClick:()=>f(!1),children:"Sign In"}),t.jsx(D,{variant:d?"default":"outline",size:"sm",className:"flex-1",onClick:()=>f(!0),children:"Sign Up"})]}),t.jsxs("form",{onSubmit:d?w:v,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"email",children:"Email"}),t.jsx(ge,{id:"email",type:"email",placeholder:"Enter your email",value:e,onChange:b=>s(b.target.value),required:!0,disabled:n})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"password",children:"Password"}),t.jsx(ge,{id:"password",type:"password",placeholder:d?"Create a password":"Enter your password",value:r,onChange:b=>a(b.target.value),required:!0,disabled:n})]}),t.jsx(D,{type:"submit",className:"w-full",disabled:n,children:n?t.jsxs(t.Fragment,{children:[t.jsx(Yt,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Creating Account...":"Signing In..."]}):d?"Create Account":"Sign In"}),!d&&t.jsx("div",{className:"text-center",children:t.jsx(aa,{to:"/reset-password",className:"text-sm text-muted-foreground hover:text-primary transition-colors",children:"Forgot your password?"})})]})]})]}),t.jsxs("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:["By continuing, you agree to our"," ",t.jsx("a",{href:"https://fastnow.app/terms",target:"_blank",rel:"noopener noreferrer",className:"underline text-foreground hover:text-primary",children:"Terms of Service"})," ","and"," ",t.jsx("a",{href:"https://fastnow.app/privacy",target:"_blank",rel:"noopener noreferrer",className:"underline text-foreground hover:text-primary",children:"Privacy Policy"}),"."," ","Your data is secured and never shared with third parties."]})]})})]})})},rS=()=>{const[e,s]=l.useState(""),[r,a]=l.useState(!1),[n,o]=l.useState(!1),{resetPassword:i}=ve(),c=qt(),d=async f=>{f.preventDefault(),a(!0);const{error:u}=await i(e);u||o(!0),a(!1)};return n?t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(oe,{className:"w-full max-w-md",children:[t.jsxs(dt,{className:"text-center space-y-4",children:[t.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(sd,{className:"h-6 w-6 text-primary"})}),t.jsx(as,{children:"Check Your Email"}),t.jsxs(Ua,{children:["We've sent a password reset link to ",e]})]}),t.jsx(Le,{className:"space-y-4",children:t.jsx(D,{onClick:()=>c("/auth"),className:"w-full",variant:"outline",children:"Back to Sign In"})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(oe,{className:"w-full max-w-md",children:[t.jsxs(dt,{className:"space-y-4",children:[t.jsxs(aa,{to:"/auth",className:"flex items-center text-sm text-muted-foreground hover:text-foreground transition-colors",children:[t.jsx(oi,{className:"h-4 w-4 mr-2"}),"Back to Sign In"]}),t.jsxs("div",{className:"text-center",children:[t.jsx(as,{children:"Reset Password"}),t.jsx(Ua,{children:"Enter your email address and we'll send you a link to reset your password"})]})]}),t.jsx(Le,{children:t.jsxs("form",{onSubmit:d,className:"space-y-4",children:[t.jsx("div",{className:"space-y-2",children:t.jsx(ge,{type:"email",placeholder:"Enter your email",value:e,onChange:f=>s(f.target.value),required:!0,disabled:r})}),t.jsx(D,{type:"submit",className:"w-full",disabled:r||!e,children:r?"Sending...":"Send Reset Link"})]})})]})})},aS=()=>{const[e,s]=l.useState(""),[r,a]=l.useState(""),[n,o]=l.useState(!1),{updatePassword:i,session:c}=ve(),d=qt();l.useEffect(()=>{c||d("/auth")},[c,d]);const f=async p=>{if(p.preventDefault(),e!==r||e.length<6)return;o(!0);const{error:x}=await i(e);x||d("/"),o(!1)},u=e===r,m=e.length>=6,h=u&&m&&e&&r;return t.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:t.jsxs(oe,{className:"w-full max-w-md",children:[t.jsxs(dt,{className:"text-center space-y-4",children:[t.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:t.jsx(ur,{className:"h-6 w-6 text-primary"})}),t.jsx(as,{children:"Update Password"}),t.jsx(Ua,{children:"Enter your new password below"})]}),t.jsx(Le,{children:t.jsxs("form",{onSubmit:f,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{type:"password",placeholder:"New password",value:e,onChange:p=>s(p.target.value),required:!0,disabled:n,minLength:6}),e&&!m&&t.jsx("p",{className:"text-sm text-destructive",children:"Password must be at least 6 characters"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(ge,{type:"password",placeholder:"Confirm new password",value:r,onChange:p=>a(p.target.value),required:!0,disabled:n,minLength:6}),r&&!u&&t.jsx("p",{className:"text-sm text-destructive",children:"Passwords do not match"})]}),t.jsx(D,{type:"submit",className:"w-full",disabled:n||!h,children:n?"Updating...":"Update Password"})]})})]})})},nS=()=>{const e=zt();return l.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),t.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),t.jsx(aa,{to:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},oS=({isOpen:e,onClose:s,onComplete:r,requiredFor:a="this feature"})=>{const{profile:n,updateProfile:o,loading:i}=Ie(),{toast:c}=he(),[d,f]=l.useState({weight:n?.weight||"",height:n?.height||"",age:n?.age||""}),u=(h,p)=>{f(x=>({...x,[h]:p}))},m=async h=>{if(h.preventDefault(),!d.weight||!d.height||!d.age){c({title:"Missing Information",description:"Please fill in all fields to continue.",variant:"destructive"});return}const{error:p}=await o({weight:Number(d.weight),height:Number(d.height),age:Number(d.age)});p?c({title:"Error",description:"Failed to save profile information.",variant:"destructive"}):(c({title:"Profile Updated",description:"Your profile information has been saved."}),r())};return t.jsx(Jr,{open:e,onOpenChange:s,children:t.jsxs(ir,{className:"sm:max-w-[425px]",children:[t.jsxs(_n,{children:[t.jsx(lr,{children:"Complete Your Profile"}),t.jsxs(Vm,{children:["We need some basic information to enable ",a,". This helps us provide accurate calculations."]})]}),t.jsxs("form",{onSubmit:m,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"weight",children:"Weight (lbs)"}),t.jsx(ge,{id:"weight",type:"number",value:d.weight,onChange:h=>u("weight",h.target.value),placeholder:"Enter your weight",min:"50",max:"500"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"height",children:"Height (inches)"}),t.jsx(ge,{id:"height",type:"number",value:d.height,onChange:h=>u("height",h.target.value),placeholder:"Enter your height",min:"36",max:"96"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"age",children:"Age (years)"}),t.jsx(ge,{id:"age",type:"number",value:d.age,onChange:h=>u("age",h.target.value),placeholder:"Enter your age",min:"13",max:"120"})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsx(D,{type:"button",variant:"outline",onClick:s,className:"flex-1",children:"Skip for Now"}),t.jsx(D,{type:"submit",disabled:i,className:"flex-1",children:i?"Saving...":"Save & Continue"})]})]})]})})};function At(e){const s=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&s==="[object Date]"?new e.constructor(+e):typeof e=="number"||s==="[object Number]"||typeof e=="string"||s==="[object String]"?new Date(e):new Date(NaN)}function Us(e,s){return e instanceof Date?new e.constructor(s):new Date(s)}const bf=6048e5,iS=864e5,jf=6e4,Nf=36e5;let lS={};function Dn(){return lS}function Zr(e,s){const r=Dn(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,n=At(e),o=n.getDay(),i=(o<a?7:0)+o-a;return n.setDate(n.getDate()-i),n.setHours(0,0,0,0),n}function Ya(e){return Zr(e,{weekStartsOn:1})}function Sf(e){const s=At(e),r=s.getFullYear(),a=Us(e,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const n=Ya(a),o=Us(e,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const i=Ya(o);return s.getTime()>=n.getTime()?r+1:s.getTime()>=i.getTime()?r:r-1}function Yo(e){const s=At(e);return s.setHours(0,0,0,0),s}function bc(e){const s=At(e),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+e-+r}function cS(e,s){const r=Yo(e),a=Yo(s),n=+r-bc(r),o=+a-bc(a);return Math.round((n-o)/iS)}function dS(e){const s=Sf(e),r=Us(e,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),Ya(r)}function uS(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function mS(e){if(!uS(e)&&typeof e!="number")return!1;const s=At(e);return!isNaN(Number(s))}function hS(e){const s=At(e);return s.setHours(23,59,59,999),s}function fS(e){const s=At(e),r=Us(e,0);return r.setFullYear(s.getFullYear(),0,1),r.setHours(0,0,0,0),r}const pS={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},gS=(e,s,r)=>{let a;const n=pS[e];return typeof n=="string"?a=n:s===1?a=n.one:a=n.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+a:a+" ago":a};function ao(e){return(s={})=>{const r=s.width?String(s.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const xS={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},vS={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},yS={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},wS={date:ao({formats:xS,defaultWidth:"full"}),time:ao({formats:vS,defaultWidth:"full"}),dateTime:ao({formats:yS,defaultWidth:"full"})},bS={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},jS=(e,s,r,a)=>bS[e];function Rr(e){return(s,r)=>{const a=r?.context?String(r.context):"standalone";let n;if(a==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,c=r?.width?String(r.width):i;n=e.formattingValues[c]||e.formattingValues[i]}else{const i=e.defaultWidth,c=r?.width?String(r.width):e.defaultWidth;n=e.values[c]||e.values[i]}const o=e.argumentCallback?e.argumentCallback(s):s;return n[o]}}const NS={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},SS={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_S={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},CS={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},kS={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ES={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},TS=(e,s)=>{const r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},MS={ordinalNumber:TS,era:Rr({values:NS,defaultWidth:"wide"}),quarter:Rr({values:SS,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Rr({values:_S,defaultWidth:"wide"}),day:Rr({values:CS,defaultWidth:"wide"}),dayPeriod:Rr({values:kS,defaultWidth:"wide",formattingValues:ES,defaultFormattingWidth:"wide"})};function Ir(e){return(s,r={})=>{const a=r.width,n=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],o=s.match(n);if(!o)return null;const i=o[0],c=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],d=Array.isArray(c)?DS(c,m=>m.test(i)):PS(c,m=>m.test(i));let f;f=e.valueCallback?e.valueCallback(d):d,f=r.valueCallback?r.valueCallback(f):f;const u=s.slice(i.length);return{value:f,rest:u}}}function PS(e,s){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&s(e[r]))return r}function DS(e,s){for(let r=0;r<e.length;r++)if(s(e[r]))return r}function AS(e){return(s,r={})=>{const a=s.match(e.matchPattern);if(!a)return null;const n=a[0],o=s.match(e.parsePattern);if(!o)return null;let i=e.valueCallback?e.valueCallback(o[0]):o[0];i=r.valueCallback?r.valueCallback(i):i;const c=s.slice(n.length);return{value:i,rest:c}}}const RS=/^(\d+)(th|st|nd|rd)?/i,IS=/\d+/i,FS={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},OS={any:[/^b/i,/^(a|c)/i]},LS={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},$S={any:[/1/i,/2/i,/3/i,/4/i]},US={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},zS={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},qS={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},BS={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},WS={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},GS={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},VS={ordinalNumber:AS({matchPattern:RS,parsePattern:IS,valueCallback:e=>parseInt(e,10)}),era:Ir({matchPatterns:FS,defaultMatchWidth:"wide",parsePatterns:OS,defaultParseWidth:"any"}),quarter:Ir({matchPatterns:LS,defaultMatchWidth:"wide",parsePatterns:$S,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ir({matchPatterns:US,defaultMatchWidth:"wide",parsePatterns:zS,defaultParseWidth:"any"}),day:Ir({matchPatterns:qS,defaultMatchWidth:"wide",parsePatterns:BS,defaultParseWidth:"any"}),dayPeriod:Ir({matchPatterns:WS,defaultMatchWidth:"any",parsePatterns:GS,defaultParseWidth:"any"})},HS={code:"en-US",formatDistance:gS,formatLong:wS,formatRelative:jS,localize:MS,match:VS,options:{weekStartsOn:0,firstWeekContainsDate:1}};function QS(e){const s=At(e);return cS(s,fS(s))+1}function KS(e){const s=At(e),r=+Ya(s)-+dS(s);return Math.round(r/bf)+1}function _f(e,s){const r=At(e),a=r.getFullYear(),n=Dn(),o=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=Us(e,0);i.setFullYear(a+1,0,o),i.setHours(0,0,0,0);const c=Zr(i,s),d=Us(e,0);d.setFullYear(a,0,o),d.setHours(0,0,0,0);const f=Zr(d,s);return r.getTime()>=c.getTime()?a+1:r.getTime()>=f.getTime()?a:a-1}function YS(e,s){const r=Dn(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,n=_f(e,s),o=Us(e,0);return o.setFullYear(n,0,a),o.setHours(0,0,0,0),Zr(o,s)}function XS(e,s){const r=At(e),a=+Zr(r,s)-+YS(r,s);return Math.round(a/bf)+1}function Ne(e,s){const r=e<0?"-":"",a=Math.abs(e).toString().padStart(s,"0");return r+a}const ms={y(e,s){const r=e.getFullYear(),a=r>0?r:1-r;return Ne(s==="yy"?a%100:a,s.length)},M(e,s){const r=e.getMonth();return s==="M"?String(r+1):Ne(r+1,2)},d(e,s){return Ne(e.getDate(),s.length)},a(e,s){const r=e.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,s){return Ne(e.getHours()%12||12,s.length)},H(e,s){return Ne(e.getHours(),s.length)},m(e,s){return Ne(e.getMinutes(),s.length)},s(e,s){return Ne(e.getSeconds(),s.length)},S(e,s){const r=s.length,a=e.getMilliseconds(),n=Math.trunc(a*Math.pow(10,r-3));return Ne(n,s.length)}},Ys={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},jc={G:function(e,s,r){const a=e.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(e,s,r){if(s==="yo"){const a=e.getFullYear(),n=a>0?a:1-a;return r.ordinalNumber(n,{unit:"year"})}return ms.y(e,s)},Y:function(e,s,r,a){const n=_f(e,a),o=n>0?n:1-n;if(s==="YY"){const i=o%100;return Ne(i,2)}return s==="Yo"?r.ordinalNumber(o,{unit:"year"}):Ne(o,s.length)},R:function(e,s){const r=Sf(e);return Ne(r,s.length)},u:function(e,s){const r=e.getFullYear();return Ne(r,s.length)},Q:function(e,s,r){const a=Math.ceil((e.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return Ne(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,s,r){const a=Math.ceil((e.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return Ne(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,s,r){const a=e.getMonth();switch(s){case"M":case"MM":return ms.M(e,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(e,s,r){const a=e.getMonth();switch(s){case"L":return String(a+1);case"LL":return Ne(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(e,s,r,a){const n=XS(e,a);return s==="wo"?r.ordinalNumber(n,{unit:"week"}):Ne(n,s.length)},I:function(e,s,r){const a=KS(e);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):Ne(a,s.length)},d:function(e,s,r){return s==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):ms.d(e,s)},D:function(e,s,r){const a=QS(e);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):Ne(a,s.length)},E:function(e,s,r){const a=e.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(e,s,r,a){const n=e.getDay(),o=(n-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(o);case"ee":return Ne(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,s,r,a){const n=e.getDay(),o=(n-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(o);case"cc":return Ne(o,s.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,s,r){const a=e.getDay(),n=a===0?7:a;switch(s){case"i":return String(n);case"ii":return Ne(n,s.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(e,s,r){const n=e.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,s,r){const a=e.getHours();let n;switch(a===12?n=Ys.noon:a===0?n=Ys.midnight:n=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,s,r){const a=e.getHours();let n;switch(a>=17?n=Ys.evening:a>=12?n=Ys.afternoon:a>=4?n=Ys.morning:n=Ys.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,s,r){if(s==="ho"){let a=e.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return ms.h(e,s)},H:function(e,s,r){return s==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):ms.H(e,s)},K:function(e,s,r){const a=e.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):Ne(a,s.length)},k:function(e,s,r){let a=e.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):Ne(a,s.length)},m:function(e,s,r){return s==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):ms.m(e,s)},s:function(e,s,r){return s==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):ms.s(e,s)},S:function(e,s){return ms.S(e,s)},X:function(e,s,r){const a=e.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return Sc(a);case"XXXX":case"XX":return As(a);case"XXXXX":case"XXX":default:return As(a,":")}},x:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"x":return Sc(a);case"xxxx":case"xx":return As(a);case"xxxxx":case"xxx":default:return As(a,":")}},O:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Nc(a,":");case"OOOO":default:return"GMT"+As(a,":")}},z:function(e,s,r){const a=e.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Nc(a,":");case"zzzz":default:return"GMT"+As(a,":")}},t:function(e,s,r){const a=Math.trunc(e.getTime()/1e3);return Ne(a,s.length)},T:function(e,s,r){const a=e.getTime();return Ne(a,s.length)}};function Nc(e,s=""){const r=e>0?"-":"+",a=Math.abs(e),n=Math.trunc(a/60),o=a%60;return o===0?r+String(n):r+String(n)+s+Ne(o,2)}function Sc(e,s){return e%60===0?(e>0?"-":"+")+Ne(Math.abs(e)/60,2):As(e,s)}function As(e,s=""){const r=e>0?"-":"+",a=Math.abs(e),n=Ne(Math.trunc(a/60),2),o=Ne(a%60,2);return r+n+s+o}const _c=(e,s)=>{switch(e){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},Cf=(e,s)=>{switch(e){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},JS=(e,s)=>{const r=e.match(/(P+)(p+)?/)||[],a=r[1],n=r[2];if(!n)return _c(e,s);let o;switch(a){case"P":o=s.dateTime({width:"short"});break;case"PP":o=s.dateTime({width:"medium"});break;case"PPP":o=s.dateTime({width:"long"});break;case"PPPP":default:o=s.dateTime({width:"full"});break}return o.replace("{{date}}",_c(a,s)).replace("{{time}}",Cf(n,s))},ZS={p:Cf,P:JS},e_=/^D+$/,t_=/^Y+$/,s_=["D","DD","YY","YYYY"];function r_(e){return e_.test(e)}function a_(e){return t_.test(e)}function n_(e,s,r){const a=o_(e,s,r);if(console.warn(a),s_.includes(e))throw new RangeError(a)}function o_(e,s,r){const a=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const i_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,l_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,c_=/^'([^]*?)'?$/,d_=/''/g,u_=/[a-zA-Z]/;function no(e,s,r){const a=Dn(),n=a.locale??HS,o=a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,i=a.weekStartsOn??a.locale?.options?.weekStartsOn??0,c=At(e);if(!mS(c))throw new RangeError("Invalid time value");let d=s.match(l_).map(u=>{const m=u[0];if(m==="p"||m==="P"){const h=ZS[m];return h(u,n.formatLong)}return u}).join("").match(i_).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const m=u[0];if(m==="'")return{isToken:!1,value:m_(u)};if(jc[m])return{isToken:!0,value:u};if(m.match(u_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:u}});n.localize.preprocessor&&(d=n.localize.preprocessor(c,d));const f={firstWeekContainsDate:o,weekStartsOn:i,locale:n};return d.map(u=>{if(!u.isToken)return u.value;const m=u.value;(a_(m)||r_(m))&&n_(m,s,String(e));const h=jc[m[0]];return h(c,m,n.localize,f)}).join("")}function m_(e){const s=e.match(c_);return s?s[1].replace(d_,"'"):e}function oo(e,s){const a=g_(e);let n;if(a.date){const d=x_(a.date,2);n=v_(d.restDateString,d.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const o=n.getTime();let i=0,c;if(a.time&&(i=y_(a.time),isNaN(i)))return new Date(NaN);if(a.timezone){if(c=w_(a.timezone),isNaN(c))return new Date(NaN)}else{const d=new Date(o+i),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(o+i+c)}const Sa={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},h_=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,f_=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,p_=/^([+-])(\d{2})(?::?(\d{2}))?$/;function g_(e){const s={},r=e.split(Sa.dateTimeDelimiter);let a;if(r.length>2)return s;if(/:/.test(r[0])?a=r[0]:(s.date=r[0],a=r[1],Sa.timeZoneDelimiter.test(s.date)&&(s.date=e.split(Sa.timeZoneDelimiter)[0],a=e.substr(s.date.length,e.length))),a){const n=Sa.timezone.exec(a);n?(s.time=a.replace(n[1],""),s.timezone=n[1]):s.time=a}return s}function x_(e,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};const n=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?n:o*100,restDateString:e.slice((a[1]||a[2]).length)}}function v_(e,s){if(s===null)return new Date(NaN);const r=e.match(h_);if(!r)return new Date(NaN);const a=!!r[4],n=Fr(r[1]),o=Fr(r[2])-1,i=Fr(r[3]),c=Fr(r[4]),d=Fr(r[5])-1;if(a)return __(s,c,d)?b_(s,c,d):new Date(NaN);{const f=new Date(0);return!N_(s,o,i)||!S_(s,n)?new Date(NaN):(f.setUTCFullYear(s,o,Math.max(n,i)),f)}}function Fr(e){return e?parseInt(e):1}function y_(e){const s=e.match(f_);if(!s)return NaN;const r=io(s[1]),a=io(s[2]),n=io(s[3]);return C_(r,a,n)?r*Nf+a*jf+n*1e3:NaN}function io(e){return e&&parseFloat(e.replace(",","."))||0}function w_(e){if(e==="Z")return 0;const s=e.match(p_);if(!s)return 0;const r=s[1]==="+"?-1:1,a=parseInt(s[2]),n=s[3]&&parseInt(s[3])||0;return k_(a,n)?r*(a*Nf+n*jf):NaN}function b_(e,s,r){const a=new Date(0);a.setUTCFullYear(e,0,4);const n=a.getUTCDay()||7,o=(s-1)*7+r+1-n;return a.setUTCDate(a.getUTCDate()+o),a}const j_=[31,null,31,30,31,30,31,31,30,31,30,31];function kf(e){return e%400===0||e%4===0&&e%100!==0}function N_(e,s,r){return s>=0&&s<=11&&r>=1&&r<=(j_[s]||(kf(e)?29:28))}function S_(e,s){return s>=1&&s<=(kf(e)?366:365)}function __(e,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function C_(e,s,r){return e===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&e>=0&&e<25}function k_(e,s){return s>=0&&s<=59}const Ef=({session:e,isOpen:s,onClose:r,onSessionEdited:a})=>{const{toast:n}=he(),o=ft(),i=wr(j=>j.user),c=j=>{const N=oo(j);return new Date(N.getTime()-N.getTimezoneOffset()*6e4).toISOString().slice(0,16)},[d,f]=l.useState(e.start_time?c(e.start_time):""),[u,m]=l.useState(e.end_time?c(e.end_time):""),[h,p]=l.useState(""),[x,g]=l.useState(!1),v=()=>{if(!d||!u)return 0;const j=new Date(d),N=new Date(u);return Math.round((N.getTime()-j.getTime())/(1e3*60))},w=async()=>{if(!i||!d||!u){n({title:"Invalid Input",description:"Please fill in both start and end times.",variant:"destructive"});return}const j=new Date(d),N=new Date(u);if(N<=j){n({title:"Invalid Time Range",description:"End time must be after start time.",variant:"destructive"});return}const C=v();if(C<=0||C>1440){n({title:"Invalid Duration",description:"Duration must be between 1 minute and 24 hours.",variant:"destructive"});return}g(!0);try{const _=e.is_edited?e.duration_minutes:Math.round((oo(e.end_time).getTime()-oo(e.start_time).getTime())/6e4),{error:k}=await T.from("walking_sessions").update({start_time:j.toISOString(),end_time:N.toISOString(),is_edited:!0,original_duration_minutes:e.is_edited?e.duration_minutes:_,edit_reason:h||null,calories_burned:null,distance:null,estimated_steps:null,updated_at:new Date().toISOString()}).eq("id",e.id).eq("user_id",i.id);if(k)throw k;o.invalidateQueries({queryKey:["walking-sessions"]}),o.invalidateQueries({queryKey:["daily-deficit"]}),o.invalidateQueries({queryKey:["walking-calories"]}),n({title:"Session Updated",description:"Walking session time has been updated. Calculated data has been removed."}),a(),r()}catch(_){console.error("Error updating session:",_),n({title:"Update Failed",description:"Failed to update walking session.",variant:"destructive"})}finally{g(!1)}},y=v(),b=y>0?`${Math.floor(y/60)}h ${y%60}m`:"0m";return t.jsx(Jr,{open:s,onOpenChange:r,children:t.jsxs(ir,{className:"sm:max-w-md",children:[t.jsx(_n,{children:t.jsxs(lr,{className:"flex items-center gap-2",children:[t.jsx(Kt,{className:"w-5 h-5"}),"Edit Walking Time"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Qt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Editing will remove calculated data"}),t.jsx("p",{children:"Calories, distance, and steps will be nulled out and excluded from deficit calculations."})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"start-time",children:"Start Time"}),t.jsx(ge,{id:"start-time",type:"datetime-local",value:d,onChange:j=>f(j.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"end-time",children:"End Time"}),t.jsx(ge,{id:"end-time",type:"datetime-local",value:u,onChange:j=>m(j.target.value)})]})]}),y>0&&t.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.jsx("strong",{children:"New Duration:"})," ",b]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"edit-reason",children:"Edit Reason (Optional)"}),t.jsx(jr,{id:"edit-reason",placeholder:"e.g., Forgot to stop timer",value:h,onChange:j=>p(j.target.value),rows:2})]})]}),t.jsxs(Gm,{children:[t.jsx(D,{variant:"outline",onClick:r,children:"Cancel"}),t.jsx(D,{onClick:w,disabled:x||!d||!u,children:x?"Saving...":"Save"})]})]})})},E_=({onClose:e})=>{const[s,r]=l.useState([]),[a,n]=l.useState(!0),[o,i]=l.useState(!1),[c,d]=l.useState(null),[f,u]=l.useState(!1),[m,h]=l.useState(new Set),[p,x]=l.useState(null),{user:g}=ve(),{toast:v}=he(),{refreshTrigger:w}=Sr();l.useEffect(()=>{(async()=>{if(g){n(!0);try{const E=o?50:5,{data:A,error:I}=await T.from("walking_sessions").select("id, start_time, end_time, calories_burned, distance, speed_mph, estimated_steps, status, is_edited, original_duration_minutes, edit_reason").eq("user_id",g.id).eq("status","completed").is("deleted_at",null).order("created_at",{ascending:!1}).limit(E);if(I)throw I;if(r(A||[]),o)u(!1);else{const{count:z}=await T.from("walking_sessions").select("*",{count:"exact",head:!0}).eq("user_id",g.id).eq("status","completed").is("deleted_at",null);u((z||0)>5)}}catch(E){console.error("Error fetching walking sessions:",E)}finally{n(!1)}}})()},[g,o,w]);const y=async S=>{if(g){d(S);try{const{error:E}=await T.from("walking_sessions").delete().eq("id",S).eq("user_id",g.id);if(E)throw E;r(A=>A.filter(I=>I.id!==S)),v({title:"Session deleted",description:"Walking session has been permanently deleted."})}catch(E){console.error("Error deleting session:",E),v({title:"Error",description:"Failed to delete walking session. Please try again.",variant:"destructive"})}finally{d(null)}}},b=async()=>{try{const{error:S}=await T.from("walking_sessions").delete().eq("user_id",g?.id).eq("status","completed");if(S)throw S;r([]),u(!1),v({title:"History deleted",description:"All completed walking sessions have been deleted"})}catch(S){console.error("Error deleting all history:",S),v({title:"Error",description:"Failed to delete walking history",variant:"destructive"})}},j=(S,E)=>{const A=new Date(S),z=new Date(E).getTime()-A.getTime();return Math.floor(z/(1e3*60))},N=S=>{const E=Math.floor(S/60),A=S%60;return E>0?`${E}h ${A}m`:`${A}m`},C=s.reduce((S,E)=>{const A=no(new Date(E.start_time),"yyyy-MM-dd");return S[A]||(S[A]=[]),S[A].push(E),S},{});X.useEffect(()=>{const S=Object.keys(C);h(new Set(S))},[s.length]);const _=S=>{h(E=>{const A=new Set(E);return A.has(S)?A.delete(S):A.add(S),A})},k=s.filter(S=>S.status==="completed");return k.length,k.reduce((S,E)=>S+(E.distance||0),0),k.reduce((S,E)=>S+(E.calories_burned||0),0),k.reduce((S,E)=>S+j(E.start_time,E.end_time),0),t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(oe,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:S=>S.stopPropagation(),children:[t.jsx(dt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(as,{className:"text-lg font-semibold",children:"Walking History"}),t.jsxs("div",{className:"flex gap-2",children:[s.length>0&&t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(Je,{className:"w-4 h-4"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete All Walking History"}),t.jsx(Ve,{children:"Are you sure you want to delete ALL walking history? This will permanently remove all completed sessions. This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]})]})}),t.jsxs(Le,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:[a?t.jsx("div",{className:"space-y-3",children:[...Array(3)].map((S,E)=>t.jsxs(oe,{className:"p-4 animate-pulse",children:[t.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]},E))}):s.length===0?t.jsxs(oe,{className:"p-6 text-center",children:[t.jsx(jl,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),t.jsx("p",{className:"text-muted-foreground",children:"No walking sessions yet"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Start your first walk to see your progress here!"})]}):t.jsx("div",{className:"space-y-4",children:Object.entries(C).sort(([S],[E])=>new Date(E).getTime()-new Date(S).getTime()).map(([S,E])=>{const A=m.has(S),I=no(new Date(S),"MMM d, yyyy");return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-muted/20 rounded-lg cursor-pointer hover:bg-muted/30 transition-colors border-0",onClick:()=>_(S),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(rn,{className:"w-4 h-4 text-muted-foreground"}),t.jsx("span",{className:"font-medium text-sm",children:I}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",E.length," session",E.length>1?"s":"",")"]})]}),t.jsx(bt,{className:`w-4 h-4 text-muted-foreground transition-transform ${A?"":"rotate-180"}`})]}),!A&&t.jsx("div",{className:"space-y-2 ml-4",children:E.map(z=>{const W=j(z.start_time,z.end_time),Y=new Date(z.start_time);return t.jsxs(oe,{className:"relative bg-muted/20 border-0",children:[t.jsx(dt,{className:"pb-4",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h3",{className:"font-medium text-sm",children:no(Y,"h:mm a")})}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mt-2",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Kt,{className:"w-3 h-3"}),N(W),z.is_edited&&t.jsx("span",{className:"text-xs text-muted-foreground/70 ml-1",children:"(Edited)"})]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(jl,{className:"w-3 h-3 text-green-500"}),z.is_edited?"N/A":`${z.distance?.toFixed(2)||0} mi`]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Ta,{className:"w-3 h-3 text-orange-500"}),z.is_edited?"N/A":`${z.calories_burned||0} cal`]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(nn,{className:"w-3 h-3 text-purple-500"}),z.is_edited?"N/A":`${z.estimated_steps?.toLocaleString()||"N/A"} steps`]})]})]})})}),t.jsxs("div",{className:"absolute top-3 right-3 flex gap-1",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>x(z),children:t.jsx(mt,{className:"w-3 h-3"})}),t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10 hover:text-destructive",disabled:c===z.id,children:t.jsx(Je,{className:"w-3 h-3"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Walking Session"}),t.jsxs(Ve,{children:["Are you sure you want to delete this walking session from ",I,"? This action cannot be undone."]})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>y(z.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]}),z.is_edited&&z.edit_reason&&t.jsxs("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:[t.jsx("span",{className:"font-medium",children:"Edit reason:"})," ",z.edit_reason]})]},z.id)})})]},S)})}),(f||o)&&s.length>0&&t.jsx("div",{className:"flex justify-center",children:t.jsx(D,{variant:"outline",onClick:()=>i(!o),className:"w-full",disabled:a,children:o?t.jsxs(t.Fragment,{children:[t.jsx(ci,{className:"w-4 h-4 mr-2"}),"Show Less"]}):t.jsxs(t.Fragment,{children:[t.jsx(bt,{className:"w-4 h-4 mr-2"}),"Load More (",f?"more available":"no more",")"]})})})]}),p&&t.jsx(Ef,{session:p,isOpen:!!p,onClose:()=>x(null),onSessionEdited:()=>{n(!0),(async()=>{if(g)try{const E=o?50:5,{data:A,error:I}=await T.from("walking_sessions").select("id, start_time, end_time, calories_burned, distance, speed_mph, estimated_steps, status, is_edited, original_duration_minutes, edit_reason").eq("user_id",g.id).eq("status","completed").is("deleted_at",null).order("created_at",{ascending:!1}).limit(E);if(I)throw I;r(A||[])}catch(E){console.error("Error refreshing sessions:",E)}finally{n(!1)}})()}})]})})},Cc=({open:e,onOpenChange:s,onConfirm:r,onManualDurationConfirm:a,currentDuration:n,durationMinutes:o=0,calories:i,distance:c,units:d="imperial",actionType:f="finish"})=>{const[u,m]=l.useState(!1),[h,p]=l.useState(""),x=()=>{s(!1),m(!1),p("")},g=()=>{const y=parseInt(h);y>0&&a&&(a(y),x())},v=o>=120,w=f==="finish"&&v&&!u;return t.jsx(it,{isOpen:e,onClose:x,title:u?"Correct Walking Duration":f==="cancel"?"Cancel Walking Session?":"Finish Walking Session?",size:"sm",showCloseButton:!0,footer:u?t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:()=>m(!1),className:"w-full h-10",size:"default",children:"Back"}),t.jsx(D,{variant:"action-primary",onClick:g,disabled:!h||parseInt(h)<=0,className:"w-full h-10",size:"default",children:"Save"})]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:x,className:"w-full h-10",size:"default",children:"Close"}),w&&t.jsx(D,{variant:"outline",onClick:()=>m(!0),className:"w-full h-10",size:"default",children:"Edit"}),t.jsx(D,{variant:"action-primary",onClick:r,className:"w-full h-10",size:"default",children:f==="cancel"?"Cancel Session":"Finish Session"})]}),children:t.jsx("div",{className:"space-y-4",children:u?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Qt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Manual duration correction"}),t.jsx("p",{children:"Enter how long you actually walked. Calculated data (calories, distance, steps) will be removed."})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"manual-duration",children:"Walking Duration (minutes)"}),t.jsx(ge,{id:"manual-duration",type:"number",placeholder:"e.g., 30",value:h,onChange:y=>p(y.target.value),min:"1",max:"1440"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm leading-relaxed text-muted-foreground",children:["You've been walking for ",t.jsx("span",{className:"font-medium text-foreground",children:n||"0:00:00"}),"."]}),w&&t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(Qt,{className:"w-4 h-4 text-amber-600 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-amber-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"Long session detected"}),t.jsx("p",{children:"Did you forget to stop the timer? You can edit the duration if needed."})]})]}),i&&c&&t.jsxs("div",{className:"space-y-2 text-xs bg-muted/50 rounded-lg p-3 border border-border",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Calories:"}),t.jsx("span",{className:"font-medium",children:i})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Distance:"}),t.jsxs("span",{className:"font-medium",children:[c," ",d==="metric"?"km":"miles"]})]})]}),t.jsx("div",{className:"text-xs text-muted-foreground font-medium bg-muted/30 rounded-lg p-3 border border-border",children:f==="cancel"?"This will remove your session from history completely.":"This will save your walking progress to history."})]})})})},Tf=l.createContext(void 0),T_=({children:e})=>{const[s,r]=l.useState({calories:0,distance:0,pace:"",startTime:"",fatBurned:0}),{currentSession:a,selectedSpeed:n}=Sr();l.useEffect(()=>{if(!a||a.status!=="active"){r({calories:0,distance:0,pace:"",startTime:"",fatBurned:0});return}const i=()=>{const d=new Date,f=new Date(a.start_time),u=(d.getTime()-f.getTime())/(1e3*60),m=a.total_pause_duration?a.total_pause_duration/60:0,h=u-m;if(h<=0)return;const p=Math.max(3,n*1.2),x=Math.round(h*p),g=h/60*n,v=n>0?60/n:0,w=Math.floor(v),y=Math.round((v-w)*60),b=`${w}:${y.toString().padStart(2,"0")}/mi`,j=f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),N=Math.round(x*.2);r({calories:x,distance:parseFloat(g.toFixed(2)),pace:b,startTime:j,fatBurned:N})};i();const c=setInterval(i,3e4);return()=>{clearInterval(c)}},[a,n]);const o=l.useMemo(()=>({walkingStats:s}),[s]);return t.jsx(Tf.Provider,{value:o,children:e})},M_=()=>{const e=l.useContext(Tf);return e===void 0?{walkingStats:{calories:0,distance:0,pace:"",startTime:"",fatBurned:0}}:e},P_=()=>{const[e,s]=l.useState(!1),[r,a]=l.useState(0),n=l.useRef(!0),o=l.useCallback(async()=>{const u=await EN();n.current&&a(u)},[]);l.useEffect(()=>{n.current=!0,o();const u=()=>o();return window.addEventListener("outbox:changed",u),()=>{n.current=!1,window.removeEventListener("outbox:changed",u)}},[o]);const i=l.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,x=async g=>await eo(g);if(m==="start"){const{local_id:g,start_time:v,speed_mph:w,total_pause_duration:y,session_state:b,status:j}=h,{data:N,error:C}=await T.from("walking_sessions").insert({user_id:p,start_time:v,status:j??"active",session_state:b??"active",total_pause_duration:y??0,speed_mph:w}).select().single();if(C)throw C;g&&N?.id&&await Zn(g,N.id);return}if(m==="pause"){const g=await x(h.session_id),v=h.pause_start_time??new Date().toISOString(),{error:w}=await T.from("walking_sessions").update({session_state:"paused",pause_start_time:v}).eq("id",g);if(w)throw w;return}if(m==="resume"){const g=await x(h.session_id),v=h.pause_duration_seconds??0,{data:w,error:y}=await T.from("walking_sessions").select("total_pause_duration").eq("id",g).single();if(y)throw y;const b=(w?.total_pause_duration??0)+v,{error:j}=await T.from("walking_sessions").update({session_state:"active",pause_start_time:null,total_pause_duration:b}).eq("id",g);if(j)throw j;return}if(m==="update_speed"){const g=await x(h.session_id),{error:v}=await T.from("walking_sessions").update({speed_mph:h.speed_mph}).eq("id",g);if(v)throw v;return}if(m==="end"){const g=await x(h.session_id),v=h.updateData,{error:w}=await T.from("walking_sessions").update(v).eq("id",g);if(w)throw w;return}if(m==="cancel"){const g=await x(h.session_id),{error:v}=await T.from("walking_sessions").delete().eq("id",g);if(v)throw v;return}},[]),c=l.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,x=async g=>await eo(g);if(m==="start"){await T.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("user_id",p).eq("status","active");const{local_id:g,start_time:v,goal_duration_seconds:w}=h,{data:y,error:b}=await T.from("fasting_sessions").insert({user_id:p,start_time:v,goal_duration_seconds:w,status:"active"}).select().single();if(b)throw b;g&&y?.id&&await Zn(g,y.id);return}if(m==="end"){const g=await x(h.session_id),{end_time:v,duration_seconds:w,status:y}=h,{error:b}=await T.from("fasting_sessions").update({end_time:v,duration_seconds:w,status:y}).eq("id",g);if(b)throw b;return}if(m==="cancel"){const g=await x(h.session_id),{error:v}=await T.from("fasting_sessions").update({status:"cancelled",end_time:new Date().toISOString()}).eq("id",g);if(v)throw v;return}},[]),d=l.useCallback(async u=>{const{action:m,payload:h,user_id:p}=u,x=async g=>await eo(g);if(m==="create"){const{local_id:g,name:v,calories:w,carbs:y,serving_size:b,consumed:j,image_url:N}=h,{data:C,error:_}=await T.from("food_entries").insert({user_id:p,name:v,calories:w,carbs:y,serving_size:b,consumed:j??!0,image_url:N}).select().single();if(_)throw _;g&&C?.id&&await Zn(g,C.id);return}if(m==="update"){const g=await x(h.entry_id),{updates:v}=h,{error:w}=await T.from("food_entries").update(v).eq("id",g).eq("user_id",p);if(w)throw w;return}if(m==="delete"){const g=await x(h.entry_id),{error:v}=await T.from("food_entries").delete().eq("id",g).eq("user_id",p);if(v)throw v;return}if(m==="toggle_consumed"){const g=await x(h.entry_id),{consumed:v}=h,{error:w}=await T.from("food_entries").update({consumed:v}).eq("id",g).eq("user_id",p);if(w)throw w;return}},[]),f=l.useCallback(async()=>{if(!e&&!(typeof navigator<"u"&&!navigator.onLine)){s(!0),Ga("sync-start");try{const u=await gh();for(const m of u)try{m.entity==="walking_session"?await i(m):m.entity==="fasting_session"?await c(m):m.entity==="food_entry"&&await d(m),await kN(m.id)}catch(h){m.attempts=(m.attempts??0)+1,m.lastError=h?.message??String(h),await CN(m);break}}finally{s(!1),Ga("sync-complete"),o()}}},[e,i,c,d,o]);return l.useEffect(()=>{const u=()=>f(),m=()=>{document.hidden||f()};return window.addEventListener("online",u),document.addEventListener("visibilitychange",m),f(),()=>{window.removeEventListener("online",u),document.removeEventListener("visibilitychange",m)}},[f]),{isSyncing:e,pending:r,triggerSync:f}},D_=({className:e})=>{const{isSyncing:s,pending:r,triggerSync:a}=P_(),[n,o]=l.useState(!1),[i,c]=l.useState([]);if(l.useEffect(()=>{o(s||r>0),r>0&&gh().then(c)},[s,r]),!n||r===0)return null;const d=u=>{switch(u){case"walking_session":return t.jsx(px,{className:"w-3 h-3"});case"fasting_session":return t.jsx(Kt,{className:"w-3 h-3"});case"food_entry":return t.jsx(ps,{className:"w-3 h-3"});default:return t.jsx(wl,{className:"w-3 h-3"})}},f=i.reduce((u,m)=>(u[m.entity]=(u[m.entity]||0)+1,u),{});return t.jsxs("div",{className:K("flex items-center gap-2",e),children:[t.jsxs("div",{className:K("text-xs text-muted-foreground flex items-center gap-1"),title:s?"Syncing changes...":`${r} change(s) pending sync`,children:[t.jsx(wl,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:s?"Syncing":`${r} pending`})]}),Object.keys(f).length>1&&t.jsx("div",{className:"flex items-center gap-1",children:Object.entries(f).map(([u,m])=>t.jsxs("div",{className:"flex items-center gap-0.5 text-xs text-muted-foreground",children:[d(u),t.jsx("span",{children:m})]},u))}),t.jsxs(D,{size:"sm",variant:"outline",onClick:a,disabled:s,children:[t.jsx(hs,{className:"w-3.5 h-3.5 mr-1"}),"Sync"]})]})},A_=()=>{const[e,s]=l.useState(!1),[r,a]=l.useState(!1),[n,o]=l.useState(!1),[i,c]=l.useState(!1),[d,f]=l.useState(!1),[u,m]=l.useState(0),{toast:h}=he(),{currentSession:p,loading:x,selectedSpeed:g,setSelectedSpeed:v,isPaused:w,startWalkingSession:y,pauseWalkingSession:b,resumeWalkingSession:j,endWalkingSession:N,cancelWalkingSession:C,updateSessionSpeed:_}=Sr(),{profile:k}=Ie(),{walkingStats:S}=M_(),{quotes:E}=jh(),{saveQuoteAsGoal:A}=qs(),I=!!p;l.useEffect(()=>{let F;if(p&&!w){const Q=()=>{const ae=Date.now(),R=new Date(p.start_time).getTime(),B=p.total_pause_duration||0,L=Math.floor((ae-R-B)/1e3);m(Math.max(0,L))};Q(),F=setInterval(Q,1e3)}else p||m(0);return()=>{F&&clearInterval(F)}},[p,w]);const z=async()=>{try{await y(g),h({title:"Walking session started",description:"Good luck on your walk!"}),Ar("start",g)}catch(F){console.error("Failed to start walking session:",F),h({title:"Error",description:"Failed to start walking session. Please try again.",variant:"destructive"})}},W=async()=>{const F=await b();F.error?h({variant:"destructive",title:"Error",description:F.error.message}):Ar("pause",g,u)},Y=async()=>{const F=await j();F.error?h({variant:"destructive",title:"Error",description:F.error.message}):Ar("resume",g)},G=async()=>{console.log("Stop walking confirmed - ending session immediately"),a(!1),h({title:"Stopping session...",description:"Saving your walking session data."});const F=await N();F.error?h({variant:"destructive",title:"Error",description:F.error.message}):(Ar("stop",g,u),h({title:"Walking completed!",description:`Great job! You walked for ${Z(u)} and burned ${F.data?.calories_burned||0} calories.`}))},te=async F=>{console.log("Manual duration confirmed:",F),a(!1),h({title:"Correcting session...",description:"Saving with manual duration."});const Q=await N(F);Q.error?h({variant:"destructive",title:"Error",description:Q.error.message}):(Ar("stop",g,F*60),h({title:"Walking completed!",description:`Session corrected to ${F} minutes. Calculated data removed for accuracy.`}))},$=()=>{o(!0)},q=async()=>{o(!1);const F=await C();F.error?h({variant:"destructive",title:"Error",description:F.error.message}):h({title:"Session cancelled",description:"Walking session was cancelled and removed from history."})},de=()=>{s(!1),z()},Z=F=>{const Q=Math.floor(F/3600),ae=Math.floor(F%3600/60),R=F%60;return`${Q.toString().padStart(2,"0")}:${ae.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`};return t.jsx("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(yn,{})}),t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx($i,{onClick:()=>f(!0),title:"View walking history"})}),t.jsxs("div",{className:"pl-12 pr-12",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent mb-1",children:"Walking Timer"}),t.jsx("p",{className:"text-sm text-muted-foreground text-left",children:"Track your walking session"})]}),p&&t.jsx("div",{className:"mt-2 flex justify-end",children:t.jsx(D_,{})})]}),t.jsx("div",{className:"relative mb-6",children:t.jsx(bm,{displayTime:Z(u),isActive:!!p,isPaused:w,onStart:z,onPause:W,onResume:Y,onStop:async()=>{a(!0)},onCancel:async()=>{$()},showSlideshow:k?.enable_walking_slideshow??!1,units:k?.units||"imperial",selectedSpeed:g,onSpeedChange:async F=>{if(v(F),I)try{if((await _(F)).error)h({variant:"destructive",title:"Speed Update Failed",description:"Unable to update walking speed. Please try again."});else{const ae=k?.units||"imperial",R=ae==="metric"?(F*1.60934).toFixed(1):F.toFixed(1);h({title:"Speed Updated",description:`Speed updated to ${R} ${ae==="metric"?"km/h":"mph"}`})}}catch{h({variant:"destructive",title:"Network Error",description:"Failed to update speed. Check your connection."})}else h({title:"Speed Set",description:"Speed set for next session"})},realTimeStats:p?{speed:p.speed_mph||g,distance:S.distance,calories:S.calories,startTime:p.start_time}:void 0})}),t.jsx(yh,{quotes:E.walking_timer_quotes,className:"mt-8",onSaveQuote:A,compact:!0}),t.jsx(oS,{isOpen:e,onComplete:de,onClose:()=>s(!1),requiredFor:"accurate calorie calculation during walking"}),t.jsx(Cc,{open:r,onOpenChange:a,onConfirm:G,onManualDurationConfirm:te,currentDuration:Z(u),durationMinutes:Math.floor(u/60),calories:S.calories,distance:S.distance,units:k?.units||"imperial"}),t.jsx(Cc,{open:n,onOpenChange:o,onConfirm:q,currentDuration:Z(u),calories:S.calories,distance:S.distance,units:k?.units||"imperial",actionType:"cancel"}),d&&t.jsx(E_,{onClose:()=>f(!1)}),t.jsx(na,{isOpen:i,onClose:()=>c(!1),title:Xe.walking.title,subtitle:Xe.walking.subtitle,heroQuote:Xe.walking.heroQuote,backgroundImage:Xe.walking.backgroundImage,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-center",children:t.jsx("p",{className:"text-lg text-warm-text/80 mb-6",children:Xe.walking.subtitle})}),Xe.walking.sections.map((F,Q)=>{const ae=F.icon;return t.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-ceramic-base/50",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-ceramic-plate rounded-full flex items-center justify-center",children:t.jsx(ae,{className:"w-6 h-6 text-warm-text"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-warm-text mb-2",children:F.title}),t.jsx("p",{className:"text-warm-text/70 text-sm leading-relaxed",children:F.description})]})]},Q)})]})})]})})};var Xo=["Enter"," "],R_=["ArrowDown","PageUp","Home"],Mf=["ArrowUp","PageDown","End"],I_=[...R_,...Mf],F_={ltr:[...Xo,"ArrowRight"],rtl:[...Xo,"ArrowLeft"]},O_={ltr:["ArrowLeft"],rtl:["ArrowRight"]},da="Menu",[ea,L_,$_]=en(da),[Ws,Pf]=jt(da,[$_,pr,_r]),An=pr(),Df=_r(),[U_,Gs]=Ws(da),[z_,ua]=Ws(da),Af=e=>{const{__scopeMenu:s,open:r=!1,children:a,dir:n,onOpenChange:o,modal:i=!0}=e,c=An(s),[d,f]=l.useState(null),u=l.useRef(!1),m=Et(o),h=zs(n);return l.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),t.jsx(yi,{...c,children:t.jsx(U_,{scope:s,open:r,onOpenChange:m,content:d,onContentChange:f,children:t.jsx(z_,{scope:s,onClose:l.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:u,dir:h,modal:i,children:a})})})};Af.displayName=da;var q_="MenuAnchor",il=l.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e,n=An(r);return t.jsx(wi,{...n,...a,ref:s})});il.displayName=q_;var ll="MenuPortal",[B_,Rf]=Ws(ll,{forceMount:void 0}),If=e=>{const{__scopeMenu:s,forceMount:r,children:a,container:n}=e,o=Gs(ll,s);return t.jsx(B_,{scope:s,forceMount:r,children:t.jsx(Nt,{present:r||o.open,children:t.jsx(qc,{asChild:!0,container:n,children:a})})})};If.displayName=ll;var Pt="MenuContent",[W_,cl]=Ws(Pt),Ff=l.forwardRef((e,s)=>{const r=Rf(Pt,e.__scopeMenu),{forceMount:a=r.forceMount,...n}=e,o=Gs(Pt,e.__scopeMenu),i=ua(Pt,e.__scopeMenu);return t.jsx(ea.Provider,{scope:e.__scopeMenu,children:t.jsx(Nt,{present:a||o.open,children:t.jsx(ea.Slot,{scope:e.__scopeMenu,children:i.modal?t.jsx(G_,{...n,ref:s}):t.jsx(V_,{...n,ref:s})})})})}),G_=l.forwardRef((e,s)=>{const r=Gs(Pt,e.__scopeMenu),a=l.useRef(null),n=we(s,a);return l.useEffect(()=>{const o=a.current;if(o)return Lc(o)},[]),t.jsx(dl,{...e,ref:n,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:re(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),V_=l.forwardRef((e,s)=>{const r=Gs(Pt,e.__scopeMenu);return t.jsx(dl,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),dl=l.forwardRef((e,s)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:c,onEntryFocus:d,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,disableOutsideScroll:x,...g}=e,v=Gs(Pt,r),w=ua(Pt,r),y=An(r),b=Df(r),j=L_(r),[N,C]=l.useState(null),_=l.useRef(null),k=we(s,_,v.onContentChange),S=l.useRef(0),E=l.useRef(""),A=l.useRef(0),I=l.useRef(null),z=l.useRef("right"),W=l.useRef(0),Y=x?Uc:l.Fragment,G=x?{as:ti,allowPinchZoom:!0}:void 0,te=q=>{const de=E.current+q,Z=j().filter(L=>!L.disabled),F=document.activeElement,Q=Z.find(L=>L.ref.current===F)?.textValue,ae=Z.map(L=>L.textValue),R=aC(ae,de,Q),B=Z.find(L=>L.textValue===R)?.ref.current;(function L(se){E.current=se,window.clearTimeout(S.current),se!==""&&(S.current=window.setTimeout(()=>L(""),1e3))})(de),B&&setTimeout(()=>B.focus())};l.useEffect(()=>()=>window.clearTimeout(S.current),[]),$c();const $=l.useCallback(q=>z.current===I.current?.side&&oC(q,I.current?.area),[]);return t.jsx(W_,{scope:r,searchRef:E,onItemEnter:l.useCallback(q=>{$(q)&&q.preventDefault()},[$]),onItemLeave:l.useCallback(q=>{$(q)||(_.current?.focus(),C(null))},[$]),onTriggerLeave:l.useCallback(q=>{$(q)&&q.preventDefault()},[$]),pointerGraceTimerRef:A,onPointerGraceIntentChange:l.useCallback(q=>{I.current=q},[]),children:t.jsx(Y,{...G,children:t.jsx(zc,{asChild:!0,trapped:n,onMountAutoFocus:re(o,q=>{q.preventDefault(),_.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:t.jsx(ei,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:f,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:h,onDismiss:p,children:t.jsx(Vi,{asChild:!0,...b,dir:w.dir,orientation:"vertical",loop:a,currentTabStopId:N,onCurrentTabStopIdChange:C,onEntryFocus:re(d,q=>{w.isUsingKeyboardRef.current||q.preventDefault()}),preventScrollOnEntryFocus:!0,children:t.jsx(bi,{role:"menu","aria-orientation":"vertical","data-state":Jf(v.open),"data-radix-menu-content":"",dir:w.dir,...y,...g,ref:k,style:{outline:"none",...g.style},onKeyDown:re(g.onKeyDown,q=>{const Z=q.target.closest("[data-radix-menu-content]")===q.currentTarget,F=q.ctrlKey||q.altKey||q.metaKey,Q=q.key.length===1;Z&&(q.key==="Tab"&&q.preventDefault(),!F&&Q&&te(q.key));const ae=_.current;if(q.target!==ae||!I_.includes(q.key))return;q.preventDefault();const B=j().filter(L=>!L.disabled).map(L=>L.ref.current);Mf.includes(q.key)&&B.reverse(),sC(B)}),onBlur:re(e.onBlur,q=>{q.currentTarget.contains(q.target)||(window.clearTimeout(S.current),E.current="")}),onPointerMove:re(e.onPointerMove,ta(q=>{const de=q.target,Z=W.current!==q.clientX;if(q.currentTarget.contains(de)&&Z){const F=q.clientX>W.current?"right":"left";z.current=F,W.current=q.clientX}}))})})})})})})});Ff.displayName=Pt;var H_="MenuGroup",ul=l.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(pe.div,{role:"group",...a,ref:s})});ul.displayName=H_;var Q_="MenuLabel",Of=l.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(pe.div,{...a,ref:s})});Of.displayName=Q_;var Xa="MenuItem",kc="menu.itemSelect",Rn=l.forwardRef((e,s)=>{const{disabled:r=!1,onSelect:a,...n}=e,o=l.useRef(null),i=ua(Xa,e.__scopeMenu),c=cl(Xa,e.__scopeMenu),d=we(s,o),f=l.useRef(!1),u=()=>{const m=o.current;if(!r&&m){const h=new CustomEvent(kc,{bubbles:!0,cancelable:!0});m.addEventListener(kc,p=>a?.(p),{once:!0}),Lp(m,h),h.defaultPrevented?f.current=!1:i.onClose()}};return t.jsx(Lf,{...n,ref:d,disabled:r,onClick:re(e.onClick,u),onPointerDown:m=>{e.onPointerDown?.(m),f.current=!0},onPointerUp:re(e.onPointerUp,m=>{f.current||m.currentTarget?.click()}),onKeyDown:re(e.onKeyDown,m=>{const h=c.searchRef.current!=="";r||h&&m.key===" "||Xo.includes(m.key)&&(m.currentTarget.click(),m.preventDefault())})})});Rn.displayName=Xa;var Lf=l.forwardRef((e,s)=>{const{__scopeMenu:r,disabled:a=!1,textValue:n,...o}=e,i=cl(Xa,r),c=Df(r),d=l.useRef(null),f=we(s,d),[u,m]=l.useState(!1),[h,p]=l.useState("");return l.useEffect(()=>{const x=d.current;x&&p((x.textContent??"").trim())},[o.children]),t.jsx(ea.ItemSlot,{scope:r,disabled:a,textValue:n??h,children:t.jsx(Hi,{asChild:!0,...c,focusable:!a,children:t.jsx(pe.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...o,ref:f,onPointerMove:re(e.onPointerMove,ta(x=>{a?i.onItemLeave(x):(i.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:re(e.onPointerLeave,ta(x=>i.onItemLeave(x))),onFocus:re(e.onFocus,()=>m(!0)),onBlur:re(e.onBlur,()=>m(!1))})})})}),K_="MenuCheckboxItem",$f=l.forwardRef((e,s)=>{const{checked:r=!1,onCheckedChange:a,...n}=e;return t.jsx(Wf,{scope:e.__scopeMenu,checked:r,children:t.jsx(Rn,{role:"menuitemcheckbox","aria-checked":Ja(r)?"mixed":r,...n,ref:s,"data-state":hl(r),onSelect:re(n.onSelect,()=>a?.(Ja(r)?!0:!r),{checkForDefaultPrevented:!1})})})});$f.displayName=K_;var Uf="MenuRadioGroup",[Y_,X_]=Ws(Uf,{value:void 0,onValueChange:()=>{}}),zf=l.forwardRef((e,s)=>{const{value:r,onValueChange:a,...n}=e,o=Et(a);return t.jsx(Y_,{scope:e.__scopeMenu,value:r,onValueChange:o,children:t.jsx(ul,{...n,ref:s})})});zf.displayName=Uf;var qf="MenuRadioItem",Bf=l.forwardRef((e,s)=>{const{value:r,...a}=e,n=X_(qf,e.__scopeMenu),o=r===n.value;return t.jsx(Wf,{scope:e.__scopeMenu,checked:o,children:t.jsx(Rn,{role:"menuitemradio","aria-checked":o,...a,ref:s,"data-state":hl(o),onSelect:re(a.onSelect,()=>n.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Bf.displayName=qf;var ml="MenuItemIndicator",[Wf,J_]=Ws(ml,{checked:!1}),Gf=l.forwardRef((e,s)=>{const{__scopeMenu:r,forceMount:a,...n}=e,o=J_(ml,r);return t.jsx(Nt,{present:a||Ja(o.checked)||o.checked===!0,children:t.jsx(pe.span,{...n,ref:s,"data-state":hl(o.checked)})})});Gf.displayName=ml;var Z_="MenuSeparator",Vf=l.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e;return t.jsx(pe.div,{role:"separator","aria-orientation":"horizontal",...a,ref:s})});Vf.displayName=Z_;var eC="MenuArrow",Hf=l.forwardRef((e,s)=>{const{__scopeMenu:r,...a}=e,n=An(r);return t.jsx(ji,{...n,...a,ref:s})});Hf.displayName=eC;var tC="MenuSub",[nk,Qf]=Ws(tC),Ur="MenuSubTrigger",Kf=l.forwardRef((e,s)=>{const r=Gs(Ur,e.__scopeMenu),a=ua(Ur,e.__scopeMenu),n=Qf(Ur,e.__scopeMenu),o=cl(Ur,e.__scopeMenu),i=l.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:d}=o,f={__scopeMenu:e.__scopeMenu},u=l.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return l.useEffect(()=>u,[u]),l.useEffect(()=>{const m=c.current;return()=>{window.clearTimeout(m),d(null)}},[c,d]),t.jsx(il,{asChild:!0,...f,children:t.jsx(Lf,{id:n.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":n.contentId,"data-state":Jf(r.open),...e,ref:Hc(s,n.onTriggerChange),onClick:m=>{e.onClick?.(m),!(e.disabled||m.defaultPrevented)&&(m.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:re(e.onPointerMove,ta(m=>{o.onItemEnter(m),!m.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),u()},100))})),onPointerLeave:re(e.onPointerLeave,ta(m=>{u();const h=r.content?.getBoundingClientRect();if(h){const p=r.content?.dataset.side,x=p==="right",g=x?-5:5,v=h[x?"left":"right"],w=h[x?"right":"left"];o.onPointerGraceIntentChange({area:[{x:m.clientX+g,y:m.clientY},{x:v,y:h.top},{x:w,y:h.top},{x:w,y:h.bottom},{x:v,y:h.bottom}],side:p}),window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(m),m.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:re(e.onKeyDown,m=>{const h=o.searchRef.current!=="";e.disabled||h&&m.key===" "||F_[a.dir].includes(m.key)&&(r.onOpenChange(!0),r.content?.focus(),m.preventDefault())})})})});Kf.displayName=Ur;var Yf="MenuSubContent",Xf=l.forwardRef((e,s)=>{const r=Rf(Pt,e.__scopeMenu),{forceMount:a=r.forceMount,...n}=e,o=Gs(Pt,e.__scopeMenu),i=ua(Pt,e.__scopeMenu),c=Qf(Yf,e.__scopeMenu),d=l.useRef(null),f=we(s,d);return t.jsx(ea.Provider,{scope:e.__scopeMenu,children:t.jsx(Nt,{present:a||o.open,children:t.jsx(ea.Slot,{scope:e.__scopeMenu,children:t.jsx(dl,{id:c.contentId,"aria-labelledby":c.triggerId,...n,ref:f,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{i.isUsingKeyboardRef.current&&d.current?.focus(),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:re(e.onFocusOutside,u=>{u.target!==c.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:re(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:re(e.onKeyDown,u=>{const m=u.currentTarget.contains(u.target),h=O_[i.dir].includes(u.key);m&&h&&(o.onOpenChange(!1),c.trigger?.focus(),u.preventDefault())})})})})})});Xf.displayName=Yf;function Jf(e){return e?"open":"closed"}function Ja(e){return e==="indeterminate"}function hl(e){return Ja(e)?"indeterminate":e?"checked":"unchecked"}function sC(e){const s=document.activeElement;for(const r of e)if(r===s||(r.focus(),document.activeElement!==s))return}function rC(e,s){return e.map((r,a)=>e[(s+a)%e.length])}function aC(e,s,r){const n=s.length>1&&Array.from(s).every(f=>f===s[0])?s[0]:s,o=r?e.indexOf(r):-1;let i=rC(e,Math.max(o,0));n.length===1&&(i=i.filter(f=>f!==r));const d=i.find(f=>f.toLowerCase().startsWith(n.toLowerCase()));return d!==r?d:void 0}function nC(e,s){const{x:r,y:a}=e;let n=!1;for(let o=0,i=s.length-1;o<s.length;i=o++){const c=s[o].x,d=s[o].y,f=s[i].x,u=s[i].y;d>a!=u>a&&r<(f-c)*(a-d)/(u-d)+c&&(n=!n)}return n}function oC(e,s){if(!s)return!1;const r={x:e.clientX,y:e.clientY};return nC(r,s)}function ta(e){return s=>s.pointerType==="mouse"?e(s):void 0}var iC=Af,lC=il,cC=If,dC=Ff,uC=ul,mC=Of,hC=Rn,fC=$f,pC=zf,gC=Bf,xC=Gf,vC=Vf,yC=Hf,wC=Kf,bC=Xf,fl="DropdownMenu",[jC,ok]=jt(fl,[Pf]),lt=Pf(),[NC,Zf]=jC(fl),ep=e=>{const{__scopeDropdownMenu:s,children:r,dir:a,open:n,defaultOpen:o,onOpenChange:i,modal:c=!0}=e,d=lt(s),f=l.useRef(null),[u=!1,m]=Lt({prop:n,defaultProp:o,onChange:i});return t.jsx(NC,{scope:s,triggerId:ts(),triggerRef:f,contentId:ts(),open:u,onOpenChange:m,onOpenToggle:l.useCallback(()=>m(h=>!h),[m]),modal:c,children:t.jsx(iC,{...d,open:u,onOpenChange:m,dir:a,modal:c,children:r})})};ep.displayName=fl;var tp="DropdownMenuTrigger",sp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...n}=e,o=Zf(tp,r),i=lt(r);return t.jsx(lC,{asChild:!0,...i,children:t.jsx(pe.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...n,ref:Hc(s,o.triggerRef),onPointerDown:re(e.onPointerDown,c=>{!a&&c.button===0&&c.ctrlKey===!1&&(o.onOpenToggle(),o.open||c.preventDefault())}),onKeyDown:re(e.onKeyDown,c=>{a||(["Enter"," "].includes(c.key)&&o.onOpenToggle(),c.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(c.key)&&c.preventDefault())})})})});sp.displayName=tp;var SC="DropdownMenuPortal",rp=e=>{const{__scopeDropdownMenu:s,...r}=e,a=lt(s);return t.jsx(cC,{...a,...r})};rp.displayName=SC;var ap="DropdownMenuContent",np=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=Zf(ap,r),o=lt(r),i=l.useRef(!1);return t.jsx(dC,{id:n.contentId,"aria-labelledby":n.triggerId,...o,...a,ref:s,onCloseAutoFocus:re(e.onCloseAutoFocus,c=>{i.current||n.triggerRef.current?.focus(),i.current=!1,c.preventDefault()}),onInteractOutside:re(e.onInteractOutside,c=>{const d=c.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,u=d.button===2||f;(!n.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});np.displayName=ap;var _C="DropdownMenuGroup",CC=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(uC,{...n,...a,ref:s})});CC.displayName=_C;var kC="DropdownMenuLabel",op=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(mC,{...n,...a,ref:s})});op.displayName=kC;var EC="DropdownMenuItem",ip=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(hC,{...n,...a,ref:s})});ip.displayName=EC;var TC="DropdownMenuCheckboxItem",lp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(fC,{...n,...a,ref:s})});lp.displayName=TC;var MC="DropdownMenuRadioGroup",PC=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(pC,{...n,...a,ref:s})});PC.displayName=MC;var DC="DropdownMenuRadioItem",cp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(gC,{...n,...a,ref:s})});cp.displayName=DC;var AC="DropdownMenuItemIndicator",dp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(xC,{...n,...a,ref:s})});dp.displayName=AC;var RC="DropdownMenuSeparator",up=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(vC,{...n,...a,ref:s})});up.displayName=RC;var IC="DropdownMenuArrow",FC=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(yC,{...n,...a,ref:s})});FC.displayName=IC;var OC="DropdownMenuSubTrigger",mp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(wC,{...n,...a,ref:s})});mp.displayName=OC;var LC="DropdownMenuSubContent",hp=l.forwardRef((e,s)=>{const{__scopeDropdownMenu:r,...a}=e,n=lt(r);return t.jsx(bC,{...n,...a,ref:s,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hp.displayName=LC;var $C=ep,UC=sp,zC=rp,fp=np,pp=op,gp=ip,xp=lp,vp=cp,yp=dp,wp=up,bp=mp,jp=hp;const Jo=$C,Zo=UC,qC=l.forwardRef(({className:e,inset:s,children:r,...a},n)=>t.jsxs(bp,{ref:n,className:K("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-muted hover:bg-muted data-[state=open]:bg-accent",s&&"pl-8",e),...a,children:[r,t.jsx(li,{className:"ml-auto h-4 w-4"})]}));qC.displayName=bp.displayName;const BC=l.forwardRef(({className:e,...s},r)=>t.jsx(jp,{ref:r,className:K("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));BC.displayName=jp.displayName;const Za=l.forwardRef(({className:e,sideOffset:s=4,...r},a)=>t.jsx(zC,{children:t.jsx(fp,{ref:a,sideOffset:s,className:K("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Za.displayName=fp.displayName;const Oe=l.forwardRef(({className:e,inset:s,...r},a)=>t.jsx(gp,{ref:a,className:K("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...r}));Oe.displayName=gp.displayName;const WC=l.forwardRef(({className:e,children:s,checked:r,...a},n)=>t.jsxs(xp,{ref:n,className:K("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...a,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(yp,{children:t.jsx(dr,{className:"h-4 w-4"})})}),s]}));WC.displayName=xp.displayName;const GC=l.forwardRef(({className:e,children:s,...r},a)=>t.jsxs(vp,{ref:a,className:K("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-muted hover:bg-muted focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[t.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(yp,{children:t.jsx(ed,{className:"h-2 w-2 fill-current"})})}),s]}));GC.displayName=vp.displayName;const VC=l.forwardRef(({className:e,inset:s,...r},a)=>t.jsx(pp,{ref:a,className:K("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...r}));VC.displayName=pp.displayName;const HC=l.forwardRef(({className:e,...s},r)=>t.jsx(wp,{ref:r,className:K("-mx-1 my-1 h-px bg-muted",e),...s}));HC.displayName=wp.displayName;const QC=({food:e,onUpdate:s,isOpen:r,onClose:a,mode:n="default"})=>{const[o,i]=l.useState(!1),[c,d]=l.useState(e.name),[f,u]=l.useState(e.calories_per_100g.toString()),[m,h]=l.useState(e.carbs_per_100g.toString()),[p,x]=l.useState(e.image_url||""),g=l.useRef(e.id);l.useEffect(()=>{e.id!==g.current&&(d(e.name),u(e.calories_per_100g.toString()),h(e.carbs_per_100g.toString()),x(e.image_url||""),g.current=e.id)},[e.id]);const{toast:v}=he(),{profile:w}=Ie(),y=j=>{x(j)},b=async()=>{if(!c.trim()){v({title:"Error",description:"Food name is required",variant:"destructive"});return}const j=parseFloat(f),N=parseFloat(m);if(isNaN(j)||j<0){v({title:"Error",description:"Please enter a valid calories value",variant:"destructive"});return}if(isNaN(N)||N<0){v({title:"Error",description:"Please enter a valid carbs value",variant:"destructive"});return}try{const C={name:c.trim(),calories_per_100g:j,carbs_per_100g:N,image_url:p||null};await s(e.id,C),a?a():i(!1),v({title:"Food updated successfully",description:`${c} has been saved`})}catch(C){console.error("Failed to update food:",C),v({title:"Error",description:"Failed to update food",variant:"destructive"})}};return t.jsxs(t.Fragment,{children:[r===void 0&&t.jsx(D,{variant:"ghost",size:"sm",className:"p-1 h-6 w-6 hover:bg-primary/10",title:"Edit default food",onClick:j=>{j.stopPropagation(),i(!0)},children:t.jsx(mt,{className:"w-3 h-3 text-muted-foreground"})}),t.jsx(it,{isOpen:r!==void 0?r:o,onClose:()=>{a?a():i(!1)},title:`Edit ${e.name}`,variant:"standard",size:"sm",footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:()=>{a?a():i(!1)},className:"w-full",children:"Cancel"}),t.jsx(D,{onClick:b,className:"w-full",children:"Save"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"name",children:"Food Name"}),t.jsx(ge,{id:"name",value:c,onChange:j=>d(j.target.value),placeholder:"Enter food name"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"calories",children:["Calories (per 100",w?.units==="imperial"?"oz":"g",")"]}),t.jsx(ge,{id:"calories",type:"number",value:f,onChange:j=>u(j.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(fe,{htmlFor:"carbs",children:["Carbs (per 100",w?.units==="imperial"?"oz":"g",")"]}),t.jsx(ge,{id:"carbs",type:"number",value:m,onChange:j=>h(j.target.value),placeholder:"0",min:"0",step:"0.1"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{children:"Food Image"}),t.jsx(Bh,{currentImageUrl:p,onImageUpload:y,onImageRemove:()=>x(""),bucket:"food-images"})]})]})})]})},KC=()=>{const[e,s]=l.useState([]),[r,a]=l.useState(!0),{user:n}=ve();l.useEffect(()=>{n&&o()},[n]);const o=async()=>{if(n)try{a(!0);const{data:i,error:c}=await T.from("food_entries").select(`
          name,
          calories,
          carbs,
          image_url,
          created_at
        `).eq("user_id",n.id).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1});if(c)throw c;const d=new Map;i?.forEach(u=>{const m=u.name.toLowerCase();(!d.has(m)||new Date(u.created_at)>new Date(d.get(m).last_used))&&d.set(m,{id:`recent-${m}`,name:u.name,calories_per_100g:u.calories||0,carbs_per_100g:u.carbs||0,image_url:u.image_url,last_used:u.created_at,usage_count:1})});const f=Array.from(d.values()).sort((u,m)=>new Date(m.last_used).getTime()-new Date(u.last_used).getTime()).slice(0,20);s(f)}catch(i){console.error("Error loading recent foods:",i)}finally{a(!1)}};return{recentFoods:e,loading:r,refreshRecentFoods:o}},YC=({onSelectFood:e,onBack:s})=>{const[r,a]=l.useState([]),[n,o]=l.useState([]),[i,c]=l.useState(new Set),[d,f]=l.useState(""),[u,m]=l.useState(!0),[h,p]=l.useState(!1),[x,g]=l.useState("recent"),[v,w]=l.useState(!1),[y,b]=l.useState(new Set),{user:j}=ve(),{toast:N}=he(),{recentFoods:C,loading:_,refreshRecentFoods:k}=KC();l.useEffect(()=>{j&&(async()=>{m(!0);try{await Promise.all([E(),A(),I(),S()])}finally{m(!1)}})()},[j]);const S=async()=>{if(j)try{const{data:R,error:B}=await T.rpc("has_role",{_user_id:j.id,_role:"admin"});if(B)throw B;p(R||!1)}catch(R){console.error("Error checking admin role:",R),p(!1)}},E=async()=>{if(j)try{const{data:R,error:B}=await T.from("user_foods").select("*").eq("user_id",j.id).order("is_favorite",{ascending:!1}).order("name");if(B)throw B;a(R||[])}catch(R){console.error("Error loading user foods:",R),N({title:"Error",description:"Failed to load your food library",variant:"destructive"})}},A=async()=>{try{const{data:R,error:B}=await T.from("default_foods").select("*").order("name");if(B)throw B;o(R||[])}catch(R){console.error("Error loading default foods:",R),N({title:"Warning",description:"Failed to load suggested foods",variant:"destructive"})}},I=async()=>{if(j)try{const{data:R,error:B}=await T.from("default_food_favorites").select("default_food_id").eq("user_id",j.id);if(B)throw B;const L=new Set(R?.map(se=>se.default_food_id)||[]);c(L)}catch(R){console.error("Error loading default food favorites:",R)}},z=(R,B=!1)=>{const L="variations"in R?R:{...R,is_favorite:!1,variations:[]};b(se=>new Set([...se,R.id])),setTimeout(()=>{b(se=>{const J=new Set(se);return J.delete(R.id),J})},600),e(L,B)},W=async R=>{if(j){console.log(" FoodLibrary - handleAddToTemplate called with:",R),b(B=>new Set([...B,R.id])),setTimeout(()=>{b(B=>{const L=new Set(B);return L.delete(R.id),L})},600);try{const{data:B,error:L}=await T.from("daily_food_templates").insert({user_id:j.id,name:R.name,calories:R.calories_per_100g,carbs:R.carbs_per_100g,serving_size:100,image_url:R.image_url}).select().single();if(L)throw console.error(" FoodLibrary - handleAddToTemplate error:",L),L;console.log(" FoodLibrary - handleAddToTemplate success:",B),N({title:"Added to templates",description:`${R.name} has been added to your daily templates`})}catch(B){console.error(" FoodLibrary - handleAddToTemplate failed:",B),N({variant:"destructive",title:"Error",description:"Failed to add food to templates"})}}},Y=async R=>{if(j){b(B=>new Set([...B,R.id])),setTimeout(()=>{b(B=>{const L=new Set(B);return L.delete(R.id),L})},600);try{const{data:B,error:L}=await T.from("user_foods").insert({user_id:j.id,name:R.name,calories_per_100g:R.calories_per_100g,carbs_per_100g:R.carbs_per_100g,image_url:R.image_url,is_favorite:!1,variations:[]}).select().single();if(L)throw L;a(se=>[...se,B]),N({title:"Food imported",description:`${R.name} has been added to your personal library`})}catch(B){console.error("Error importing food:",B),N({title:"Error",description:"Failed to import food to your library",variant:"destructive"})}}},G=async(R,B)=>{console.log(" FoodLibrary - updateFood called with:",{foodId:R,updates:B});try{const{data:L,error:se}=await T.from("user_foods").update(B).eq("id",R).eq("user_id",j?.id).select().single();if(se)throw console.error(" FoodLibrary - updateFood error:",se),se;console.log(" FoodLibrary - updateFood success:",L),a(J=>J.map(ne=>ne.id===R?{...ne,...B}:ne)),console.log(" FoodLibrary - food updated in local state")}catch(L){throw console.error(" FoodLibrary - updateFood failed:",L),L}},te=async R=>{console.log(" FoodLibrary - deleteFood called with:",{foodId:R});try{const{data:B,error:L}=await T.from("user_foods").delete().eq("id",R).eq("user_id",j?.id).select();if(L)throw console.error(" FoodLibrary - deleteFood error:",L),L;if(!B||B.length===0){console.warn(" FoodLibrary - No rows were deleted"),N({variant:"destructive",title:"Error",description:"Food not found or already deleted"});return}console.log(" FoodLibrary - deleteFood success:",B),a(se=>se.filter(J=>J.id!==R)),N({title:"Food removed",description:"Food has been removed from your library"})}catch(B){console.error(" FoodLibrary - deleteFood failed:",B),N({title:"Error",description:"Failed to remove food",variant:"destructive"})}},$=async()=>{if(j)try{const{error:R}=await T.from("user_foods").delete().eq("user_id",j.id);if(R)throw R;a([]),w(!1),N({title:"All foods removed",description:"All foods have been removed from your library"})}catch(R){console.error("Error deleting all foods:",R),N({title:"Error",description:"Failed to remove all foods",variant:"destructive"})}},q=async(R,B)=>{try{const{error:L}=await T.from("default_foods").update(B).eq("id",R);if(L)throw L;o(se=>se.map(J=>J.id===R?{...J,...B}:J))}catch(L){throw console.error("Error updating default food:",L),L}},de=async R=>{try{const{error:B}=await T.from("food_entries").delete().eq("user_id",j?.id).eq("name",R);if(B)throw B;k(),N({title:"Food removed",description:`All entries of "${R}" have been removed from your history`})}catch(B){console.error("Error deleting recent food:",B),N({title:"Error",description:"Failed to remove food from history",variant:"destructive"})}},Z=async R=>{try{const{error:B}=await T.from("default_foods").delete().eq("id",R);if(B)throw B;o(n.filter(L=>L.id!==R)),N({title:"Default food removed",description:"Default food has been removed from the system"})}catch(B){console.error("Error deleting default food:",B),N({title:"Error",description:"Failed to remove default food",variant:"destructive"})}},F=r.filter(R=>R.name.toLowerCase().includes(d.toLowerCase())).sort((R,B)=>R.is_favorite&&!B.is_favorite?-1:!R.is_favorite&&B.is_favorite?1:R.name.localeCompare(B.name)),Q=n.filter(R=>R.name.toLowerCase().includes(d.toLowerCase())).map(R=>({...R,is_favorite:i.has(R.id)})).sort((R,B)=>R.is_favorite&&!B.is_favorite?-1:!R.is_favorite&&B.is_favorite?1:R.name.localeCompare(B.name));F.filter(R=>R.is_favorite).slice(0,5);const ae=({food:R,isUserFood:B=!0})=>{const L=y.has(R.id),[se,J]=l.useState(!1),ne=H=>{const me=H.target;if(me.closest("button")||me.closest('[role="menuitem"]')||me.closest("[data-radix-dropdown-menu-content]")||me.closest("[data-radix-popper-content-wrapper]")||me.closest(".dropdown-menu")||se){H.stopPropagation();return}B||x==="recent"||x==="suggested"?z(R,!1):Y(R)};return t.jsxs("div",{className:`p-3 mx-2 rounded-lg transition-all duration-200 cursor-pointer bg-muted/20 border-0 hover:bg-muted/30 ${L?"animate-success-flash":""}`,onClick:ne,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-shrink-0",onClick:H=>H.stopPropagation(),children:t.jsxs(Jo,{children:[t.jsx(Zo,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"min-w-[44px] min-h-[44px] p-2 hover:bg-secondary/80 rounded-md flex items-center justify-center",title:"More options","aria-label":"More options",onClick:H=>H.stopPropagation(),children:t.jsx(uo,{className:"w-4 h-4 text-primary"})})}),t.jsx(Za,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:B?t.jsxs(t.Fragment,{children:[t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),z(R,!1)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ze,{className:"w-4 h-4 mr-3"}),"Add to Today"]}),t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),W(R)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(Mt,{className:"w-4 h-4 mr-3"}),"Add to Templates"]}),(B||h)&&!R.id.startsWith("recent-")&&t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),J(!0)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(mt,{className:"w-4 h-4 mr-3"}),"Edit Food"]}),t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),te(R.id)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(Je,{className:"w-4 h-4 mr-3"}),"Delete Food"]})]}):t.jsxs(t.Fragment,{children:[t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),z(R,!1)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(ze,{className:"w-4 h-4 mr-3"}),"Add to Today"]}),t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),W(R)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(Mt,{className:"w-4 h-4 mr-3"}),"Add to Templates"]}),t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),Y(R)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(bl,{className:"w-4 h-4 mr-3"}),"Add to Library"]}),R.id.startsWith("recent-")?t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),de(R.name)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(Je,{className:"w-4 h-4 mr-3"}),"Remove from History"]}):h&&t.jsxs(t.Fragment,{children:[t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),J(!0)},className:"cursor-pointer py-2.5 px-3 flex items-center hover:bg-muted/80 transition-colors",children:[t.jsx(mt,{className:"w-4 h-4 mr-3"}),"Edit Food"]}),t.jsxs(Oe,{onClick:H=>{H.stopPropagation(),Z(R.id)},className:"text-destructive focus:text-destructive cursor-pointer py-2.5 px-3 flex items-center hover:bg-destructive/10 transition-colors",children:[t.jsx(Je,{className:"w-4 h-4 mr-3"}),"Delete Food"]})]})]})})]})}),R.image_url?t.jsx("img",{src:R.image_url,alt:R.name,className:"w-10 h-10 rounded-lg object-cover flex-shrink-0",loading:"lazy",onError:H=>{const me=H.target;me.style.display="none";const le=me.nextElementSibling;le&&(le.style.display="flex")}}):null,t.jsx("div",{className:`w-10 h-10 rounded-lg bg-muted flex items-center justify-center flex-shrink-0 ${R.image_url?"hidden":"flex"}`,children:t.jsx(ps,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"mb-0.5",children:t.jsx("h3",{className:"text-sm font-semibold text-foreground truncate",children:R.name})}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs("span",{className:"font-medium",children:[Math.round(R.calories_per_100g)," cal"]}),t.jsx("span",{className:"text-muted-foreground/60",children:""}),t.jsxs("span",{className:"font-medium",children:[Math.round(R.carbs_per_100g),"g carbs"]})]})]}),t.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",onClick:H=>H.stopPropagation(),children:t.jsx(D,{variant:"default",size:"sm",onClick:H=>{H.stopPropagation(),B||x==="recent"||x==="suggested"?z(R,!1):Y(R)},className:`min-w-[44px] min-h-[44px] p-2 flex-shrink-0 rounded-md flex items-center justify-center hover:bg-primary/90 transition-colors ${L?"animate-button-success":""}`,title:B||x==="recent"||x==="suggested"?"Add to today's plan":"Import to your library","aria-label":B||x==="recent"||x==="suggested"?"Add to today's plan":"Import to your library",children:B||x==="recent"||x==="suggested"?t.jsx(ze,{className:"w-4 h-4"}):t.jsx(bl,{className:"w-4 h-4"})})})]}),se&&t.jsx(QC,{food:R,onUpdate:B?G:q,isOpen:se,onClose:()=>J(!1),mode:B?"user":"default"})]})};return t.jsxs("div",{className:"h-full flex flex-col max-w-7xl mx-auto",children:[t.jsx("div",{className:"px-6 py-6 border-b border-border",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Food Library"}),t.jsxs(D,{variant:"ghost",size:"sm",onClick:s,className:"hover:bg-muted transition-colors",children:[t.jsx(oi,{className:"w-4 h-4 mr-2"}),"Back"]})]})}),t.jsx("div",{className:"flex-1 px-2 py-4 overflow-hidden",children:t.jsxs(Ha,{value:x,onValueChange:R=>g(R),className:"h-full flex flex-col",children:[t.jsx("div",{className:"mb-4",children:t.jsxs(En,{className:"grid w-full grid-cols-3",children:[t.jsx(ys,{value:"recent",children:"Recent"}),t.jsxs(ys,{value:"my-foods",className:"flex items-center gap-2",children:["My Food",F.length>0&&t.jsx(Je,{className:"w-3 h-3 text-destructive cursor-pointer hover:text-destructive/80",onClick:R=>{R.stopPropagation(),w(!0)}})]}),t.jsx(ys,{value:"suggested",children:"Default"})]})}),t.jsx(ws,{value:"my-foods",className:"flex-1 overflow-y-auto mt-0",children:t.jsx("div",{className:"space-y-2 mt-1",children:u?t.jsx("div",{className:"space-y-1",children:[...Array(8)].map((R,B)=>t.jsx("div",{className:"p-2 rounded-lg bg-muted/20 border-0 animate-pulse mb-1",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted"}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"})]})]})},B))}):F.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:""}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:d?"No foods found":"Your library is empty"}),t.jsx("p",{className:"text-muted-foreground",children:d?"Try a different search term":"Log foods to automatically add them to your library"})]}):t.jsx("div",{className:"space-y-1 overflow-x-hidden",children:F.map(R=>t.jsx(ae,{food:R,isUserFood:!0},R.id))})})}),t.jsx(ws,{value:"suggested",className:"flex-1 overflow-y-auto mt-0",children:t.jsx("div",{className:"space-y-2 mt-1",children:u?t.jsx("div",{className:"space-y-1",children:[...Array(8)].map((R,B)=>t.jsx("div",{className:"p-2 rounded-lg bg-muted/20 border-0 animate-pulse mb-1",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted"}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"})]})]})},B))}):Q.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:""}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:d?"No suggested foods found":"No suggested foods available"}),t.jsx("p",{className:"text-muted-foreground",children:d?"Try a different search term":"Check back later for curated food suggestions"})]}):t.jsx("div",{className:"space-y-1 overflow-x-hidden",children:Q.map(R=>t.jsx(ae,{food:R,isUserFood:!1},`default-${R.id}`))})})}),t.jsx(ws,{value:"recent",className:"flex-1 overflow-y-auto mt-0",children:t.jsx("div",{className:"space-y-2 mt-1",children:_?t.jsx("div",{className:"space-y-1",children:[...Array(8)].map((R,B)=>t.jsx("div",{className:"p-2 rounded-lg bg-muted/20 border-0 animate-pulse mb-1",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted"}),t.jsxs("div",{className:"flex-1 space-y-1",children:[t.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-2 bg-muted rounded w-1/2"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"}),t.jsx("div",{className:"w-5 h-5 bg-muted rounded"})]})]})},B))}):C.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:""}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"No recent foods"}),t.jsx("p",{className:"text-muted-foreground",children:"Foods you've logged recently will appear here for quick access"})]}):t.jsx("div",{className:"space-y-1 overflow-x-hidden",children:C.map(R=>t.jsx(ae,{food:R,isUserFood:!1},`recent-${R.id}`))})})})]})}),t.jsx(et,{open:v,onOpenChange:w,children:t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete All Foods?"}),t.jsxs(Ve,{children:["This will permanently delete all ",F.length," foods from your personal library. This action cannot be undone."]})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:$,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All"})]})]})})]})},lo=e=>e?.trim().toLowerCase().replace(/\s+/g," ")||"",XC=()=>{const{user:e}=ve(),[s,r]=l.useState(!1),[a,n]=l.useState(new Set),o=l.useCallback(async()=>{if(!e?.id){n(new Set);return}r(!0);try{const{data:f,error:u}=await T.from("user_foods").select("name").eq("user_id",e.id);if(u){console.error("Error fetching user library:",u),n(new Set);return}const m=new Set;if(f&&f.length>0)for(const h of f)m.add(lo(h.name));n(m)}catch(f){console.error("Exception fetching library:",f),n(new Set)}finally{r(!1)}},[e?.id]);l.useEffect(()=>{o()},[o]),l.useEffect(()=>{e?.id||n(new Set)},[e?.id]);const i=l.useCallback(f=>!f||a.size===0?!1:a.has(lo(f)),[a]),c=l.useCallback(f=>{if(!f)return;const u=lo(f);n(m=>{if(m.has(u))return m;const h=new Set(m);return h.add(u),h})},[]),d=l.useCallback(async()=>{await o()},[o]);return l.useMemo(()=>({isInLibrary:i,refresh:d,addLocal:c,loading:s}),[i,d,c,s])},JC=()=>{const[e,s]=l.useState(!1),{user:r}=ve();return{copyDayToToday:async n=>{if(!r)return ga.error("User not authenticated"),{success:!1};s(!0);try{const o=new Date(n),i=Yo(o),c=hS(o),{data:d,error:f}=await T.from("food_entries").select("*").eq("user_id",r.id).gte("created_at",i.toISOString()).lte("created_at",c.toISOString()).order("created_at",{ascending:!0});if(f)throw f;if(!d||d.length===0)return ga.info("No food entries found for this day"),{success:!1};const u=d.map(x=>({name:x.name,calories:x.calories,carbs:x.carbs,serving_size:x.serving_size,consumed:!1,image_url:x.image_url,user_id:r.id})),{data:m,error:h}=await T.from("food_entries").insert(u).select();if(h)throw h;const p=new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"});return ga.success(`Copied ${m?.length||0} food items from ${p} to today's plan`),{success:!0,count:m?.length||0}}catch(o){return console.error("Error copying day's foods:",o),ga.error("Failed to copy food items"),{success:!1}}finally{s(!1)}},loading:e}},ZC=({onClose:e})=>{const[s,r]=l.useState([]),[a,n]=l.useState(!0),[o,i]=l.useState(new Set),[c,d]=l.useState(0),[f,u]=l.useState(!0),{toast:m}=he(),{user:h}=ve(),{copyDayToToday:p,loading:x}=JC(),g=7,v=async(N=0,C=!1)=>{if(h){n(!0);try{const _=new Date;_.setHours(0,0,0,0);const k=new Date(_.getTime()-1),{data:S,error:E}=await T.from("food_entries").select("*").eq("user_id",h.id).eq("consumed",!0).lt("created_at",k.toISOString()).order("created_at",{ascending:!1}).range(N*50,(N+1)*50-1);if(E)throw E;const A=new Map;S?.forEach(z=>{const W=new Date(z.created_at).toDateString();A.has(W)||A.set(W,{date:W,totalCalories:0,totalCarbs:0,entryCount:0,entries:[]});const Y=A.get(W);Y.totalCalories+=z.calories||0,Y.totalCarbs+=z.carbs||0,Y.entryCount+=1,Y.entries.push({id:z.id,name:z.name,calories:z.calories||0,carbs:z.carbs||0,serving_size:z.serving_size||100,created_at:z.created_at})});const I=Array.from(A.values()).sort((z,W)=>new Date(W.date).getTime()-new Date(z.date).getTime()).slice(0,g);r(C?z=>[...z,...I]:I),u(S?.length===50)}catch(_){console.error("Error loading food history:",_),m({title:"Error",description:"Failed to load food history",variant:"destructive"})}finally{n(!1)}}},w=()=>{const N=c+1;d(N),v(N,!0)},y=N=>{i(C=>{const _=new Set(C);return _.has(N)?_.delete(N):_.add(N),_})},b=async N=>{try{const C=s.find(S=>S.date===N);if(!C)return;const _=C.entries.map(S=>S.id),{error:k}=await T.from("food_entries").delete().in("id",_);if(k)throw k;r(S=>S.filter(E=>E.date!==N)),m({title:"Day deleted",description:"All food entries for this day have been removed"})}catch(C){console.error("Error deleting day:",C),m({title:"Error",description:"Failed to delete food entries",variant:"destructive"})}},j=async()=>{if(h)try{const{error:N}=await T.from("food_entries").delete().eq("user_id",h.id);if(N)throw N;r([]),m({title:"History deleted",description:"All food history has been permanently removed"})}catch(N){console.error("Error deleting all history:",N),m({title:"Error",description:"Failed to delete food history",variant:"destructive"})}};return l.useEffect(()=>{v()},[h]),a&&s.length===0?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(oe,{className:"w-full max-w-md mx-auto",onClick:N=>N.stopPropagation(),children:[t.jsx(dt,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(as,{className:"text-lg font-semibold",children:"Food History"}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]})}),t.jsx(Le,{children:t.jsx("div",{className:"space-y-4",children:[...Array(3)].map((N,C)=>t.jsx(oe,{children:t.jsx(dt,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-24"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-16"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-20"}),t.jsx("div",{className:"h-3 bg-muted animate-pulse rounded w-12"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"w-6 h-6 bg-muted animate-pulse rounded"}),t.jsx("div",{className:"w-6 h-6 bg-muted animate-pulse rounded"})]})]})})},C))})})]})}):t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs(oe,{className:"w-full max-w-md mx-auto max-h-[85vh] flex flex-col",onClick:N=>N.stopPropagation(),children:[t.jsx(dt,{className:"border-b border-border py-4 px-0 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-center px-6",children:[t.jsx(as,{className:"text-lg font-semibold",children:"Food History"}),t.jsxs("div",{className:"flex gap-2",children:[s.length>0&&t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(Je,{className:"w-4 h-4"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete All Food History"}),t.jsx(Ve,{children:"Are you sure you want to delete ALL food history? This will permanently remove all food entries from all days. This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:j,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All History"})]})]})]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:e,className:"w-8 h-8 rounded-full hover:bg-muted/50 dark:hover:bg-muted/30 hover:scale-110 transition-all duration-200",children:t.jsx(Pe,{className:"w-8 h-8"})})]})]})}),t.jsx(Le,{className:"flex-1 overflow-y-auto space-y-4 pt-6",children:s.length===0?t.jsx("div",{className:"text-center py-8",children:t.jsx("div",{className:"text-muted-foreground",children:"No food entries found"})}):t.jsxs(t.Fragment,{children:[s.map(N=>t.jsxs(oe,{className:"relative",children:[t.jsx(dt,{className:"py-3 cursor-pointer hover:bg-muted/20 transition-colors",onClick:()=>y(N.date),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-medium text-sm",children:new Date(N.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(bt,{className:`w-5 h-5 text-muted-foreground transition-transform ${o.has(N.date)?"rotate-180":""}`})})]})}),o.has(N.date)&&t.jsxs(Le,{className:"pt-0",children:[t.jsx("div",{className:"space-y-1",children:N.entries.map(C=>t.jsx("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded text-xs",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-medium",children:C.name}),t.jsxs("div",{className:"text-muted-foreground",children:[C.calories," cal  ",C.carbs,"g carbs  ",C.serving_size,"g"]})]})},C.id))}),t.jsxs("div",{className:"mt-3 pt-2 border-t border-border flex items-center gap-2",children:[t.jsx(D,{variant:"outline",size:"sm",onClick:async C=>{C.stopPropagation(),(await p(N.date))?.success&&e()},disabled:x,className:"h-7 px-2 text-xs",children:"Copy to Today"}),t.jsxs(et,{children:[t.jsx(ht,{asChild:!0,children:t.jsx(D,{variant:"ghost",size:"sm",onClick:C=>C.stopPropagation(),className:"h-7 w-7 p-0 text-destructive hover:bg-destructive/10",children:t.jsx(Je,{className:"w-3 h-3"})})}),t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Delete Entire Day"}),t.jsxs(Ve,{children:["Are you sure you want to delete all food entries for ",new Date(N.date).toLocaleDateString(),"? This action cannot be undone."]})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:()=>b(N.date),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Day"})]})]})]})]})]})]},N.date)),f&&t.jsx("div",{className:"text-center pt-4",children:t.jsx(Hm,{variant:"outline",onClick:w,isLoading:a,loadingText:"Loading more",children:"Load More"})})]})})]})})},e2=({entry:e,onUpdate:s,isOpen:r,onClose:a})=>{const[n,o]=l.useState(!1),[i,c]=l.useState(e.name),[d,f]=l.useState(e.calories.toString()),[u,m]=l.useState(e.carbs.toString()),[h,p]=l.useState(e.serving_size.toString()),[x,g]=l.useState(!1),{toast:v}=he(),w=async()=>{if(!i.trim()){v({title:"Error",description:"Food name is required",variant:"destructive"});return}const b=parseFloat(d),j=parseFloat(u),N=parseFloat(h);if(isNaN(b)||b<0){v({title:"Error",description:"Please enter a valid calories value",variant:"destructive"});return}if(isNaN(j)||j<0){v({title:"Error",description:"Please enter a valid carbs value",variant:"destructive"});return}if(isNaN(N)||N<=0){v({title:"Error",description:"Please enter a valid serving size",variant:"destructive"});return}g(!0);try{const C={...e,name:i.trim(),calories:b,carbs:j,serving_size:N};await s(C),a?a():o(!1)}catch(C){console.error("Failed to update food entry:",C),v({title:"Error",description:"Failed to update food entry",variant:"destructive"})}finally{g(!1)}},y=()=>{c(e.name),f(e.calories.toString()),m(e.carbs.toString()),p(e.serving_size.toString())};return t.jsx(it,{isOpen:r!==void 0?r:n,onClose:()=>{a?a():o(!1),y()},title:`Edit ${e.name}`,variant:"standard",size:"sm",footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:()=>{a?a():o(!1)},className:"w-full",children:"Cancel"}),t.jsxs(D,{onClick:w,disabled:x,className:"w-full",children:[t.jsx(Mt,{className:"w-4 h-4 mr-2"}),x?"Saving...":"Save"]})]}),children:t.jsxs("div",{className:"space-y-4",children:[e.image_url&&t.jsx("div",{className:"w-full h-32 mb-4",children:t.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover rounded-lg"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"name",children:"Food Name"}),t.jsx(ge,{id:"name",value:i,onChange:b=>c(b.target.value),placeholder:"Enter food name"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"calories",children:"Calories"}),t.jsx(ge,{id:"calories",type:"number",value:d,onChange:b=>f(b.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"carbs",children:"Carbs (g)"}),t.jsx(ge,{id:"carbs",type:"number",value:u,onChange:b=>m(b.target.value),placeholder:"0",min:"0",step:"0.1"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(fe,{htmlFor:"serving",children:"Serving (g)"}),t.jsx(ge,{id:"serving",type:"number",value:h,onChange:b=>p(b.target.value),placeholder:"0",min:"0.1",step:"0.1"})]})]})]})})},t2=({onImageUpload:e})=>{const[s,r]=l.useState(!1),a=l.useRef(null),{toast:n}=he(),{user:o}=ve(),{hasPremiumFeatures:i}=Es(),c=()=>{a.current?.click()},d=u=>{const m=u.target.files?.[0];m&&f(m)},f=async u=>{if(!o){n({title:"Error",description:"Please sign in to upload images",variant:"destructive"});return}if(!u.type.startsWith("image/")){n({title:"Error",description:"Please select an image file",variant:"destructive"});return}r(!0);try{const m=await zh(u,1920,1920,.8);if(m.blob.size>5*1024*1024){n({title:"Error",description:"Compressed image is still too large. Please try a different photo.",variant:"destructive"}),r(!1);return}const h=new File([m.blob],u.name,{type:m.blob.type,lastModified:Date.now()}),p=await qh(h,o.id,i,T);if(!p.success)throw new Error(p.error||"Upload failed");e(p.url),n({title:"Success",description:"Photo uploaded successfully"})}catch(m){console.error("Upload error:",m),n({title:"Error",description:"Failed to upload photo. Please try again.",variant:"destructive"})}finally{r(!1)}};return t.jsxs("div",{className:"w-full",children:[t.jsx(D,{variant:"outline",onClick:c,disabled:s,className:"w-full h-20 flex-col space-y-2 bg-ceramic-base border-ceramic-rim",children:s?t.jsxs(t.Fragment,{children:[t.jsx(Yt,{className:"w-6 h-6 animate-spin"}),t.jsx("span",{className:"text-sm",children:"Uploading..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(tr,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm",children:"Take Photo"})]})}),t.jsx("input",{ref:a,type:"file",accept:"image/*",capture:"environment",onChange:d,className:"hidden"})]})},s2=[{value:"grams",label:"grams"},{value:"milliliters",label:"milliliters"}],Ec=()=>s2,Tc=()=>"grams",r2=e=>{switch(e){case"grams":return"Grams";case"milliliters":case"ml":return"Milliliters";default:return e.charAt(0).toUpperCase()+e.slice(1)}},a2=({isOpen:e,onClose:s,onSave:r})=>{const{toast:a}=he();ve();const{profile:n}=Ie(),{subscribed:o,hasPremiumFeatures:i}=Ri(),c=o||i,[d,f]=l.useState(null),[u,m]=l.useState(!1),[h,p]=l.useState(null),[x,g]=l.useState(null),[v,w]=l.useState(""),[y,b]=l.useState(""),[j,N]=l.useState(""),[C,_]=l.useState(""),[k,S]=l.useState(""),[E,A]=l.useState(1),[I,z]=l.useState(!1),[W,Y]=l.useState(!1),[G,te]=l.useState(!1);l.useEffect(()=>{if(n&&!j){const L=Tc();N(L)}},[n,j]);const $=async L=>{f(L),p(null),g(null),c&&await q(L)},q=async L=>{if(!c){a({title:"Premium Feature",description:"AI photo analysis requires a premium subscription",variant:"destructive"});return}try{m(!0),g(null);const{data:se,error:J}=await T.functions.invoke("analyze-food-image",{body:{imageUrl:L}});if(J)throw J;const ne=se;if(p(ne),ne.name&&!v&&w(ne.name),ne.estimated_serving_size&&!y&&b(ne.estimated_serving_size.toString()),ne.estimated_serving_size&&!C&&!k){const H=ne.calories_per_100g||0,me=Math.round(H*ne.estimated_serving_size/100);_(me.toString());const le=ne.carbs_per_100g||0,be=Math.round(le*ne.estimated_serving_size/100);S(be.toString())}a({title:"Analysis complete",description:"Food detected! Review and adjust if needed."})}catch(se){console.error("Analyze error",se),g("Failed to analyze image"),a({title:"Analysis failed",description:"Please try another photo or enter details manually.",variant:"destructive"})}finally{m(!1)}},de=async L=>{if(!v||!y||!j){a({title:"Missing information",description:"Please enter food name, amount, and unit first",variant:"destructive"});return}const se=L==="calories"?Y:te;se(!0);try{const{data:J,error:ne}=await T.functions.invoke("chat-completion",{body:{messages:[{role:"system",content:"You are a nutrition expert. Return ONLY a number with no units."},{role:"user",content:`Provide ${L} for ${y} ${j} of ${v}. Number only.`}]}});if(ne)throw new Error(ne.message||"Unknown error from AI service");if(!J)throw new Error("No response from AI service");const me=(J.completion||J.response||"").match(/(\d+(?:\.\d+)?)/);me?(L==="calories"?_(me[1]):S(me[1]),a({title:`${L.charAt(0).toUpperCase()+L.slice(1)} estimated`,description:"AI estimate applied successfully"})):a({title:"Could not parse AI response",description:"Please enter manually.",variant:"destructive"})}catch(J){a({title:"AI estimation failed",description:`${J instanceof Error?J.message:"Unknown error"}`,variant:"destructive"})}finally{se(!1)}},Z=L=>{const se=L.toLowerCase();return se.includes("milk")||se.includes("water")||se.includes("juice")||se.includes("drink")||se.includes("soda")||se.includes("coffee")?"milliliters":"grams"},F=L=>{if(w(L),L&&!j){const se=Z(L);Ec().some(ne=>ne.value===se)&&N(se)}},Q=async()=>{if(!v.trim()){a({title:"Food name required",variant:"destructive"});return}if(!C||!k||!y){a({title:"Required fields missing",description:"Please fill in amount, calories, and carbs",variant:"destructive"});return}z(!0);try{const L={name:v.trim(),serving_size:parseFloat(y)*E,calories:parseFloat(C)*E,carbs:parseFloat(k)*E,consumed:!1,image_url:d};await r(L),Vo("add",d?"image":"manual"),ae(),s()}catch{a({title:"Failed to save food",description:"Please try again.",variant:"destructive"})}finally{z(!1)}},ae=()=>{f(null),p(null),g(null),w(""),b(""),N(Tc()),_(""),S(""),A(1)},R=()=>{ae(),s()},B=()=>{f(null),p(null),g(null)};return t.jsxs(it,{isOpen:e,onClose:R,title:"Add Food",variant:"standard",size:"md",showCloseButton:!0,children:[d?t.jsxs("div",{className:"w-full h-48 mb-4 relative",children:[t.jsx("img",{src:d,alt:v||"Food",className:"w-full h-full object-cover rounded-lg"}),t.jsx(D,{variant:"outline",size:"sm",onClick:B,className:"absolute top-2 right-2",children:t.jsx(Xg,{className:"w-4 h-4"})})]}):t.jsxs("div",{className:"space-y-4 mb-4",children:[t.jsxs("div",{className:"text-center py-2",children:[t.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-muted rounded-full flex items-center justify-center",children:t.jsx(tr,{className:"w-5 h-5 text-muted-foreground"})}),t.jsx("p",{className:"text-sm text-muted-foreground",children:c?"Add photo for AI analysis (optional)":"Add photo (optional)"})]}),t.jsx(t2,{onImageUpload:$})]}),u&&t.jsxs("div",{className:"flex items-center justify-center p-4 bg-muted/50 rounded-lg mb-4",children:[t.jsx(Yt,{className:"w-5 h-5 mr-3 animate-spin"}),t.jsx("span",{className:"text-sm",children:"Analyzing nutritional information..."})]}),x&&t.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg mb-4",children:t.jsx("p",{className:"text-sm text-destructive",children:x})}),h&&t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Xs,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"AI Analysis"}),h.confidence&&t.jsxs(vs,{variant:"default",className:"text-xs bg-primary/20 text-primary-foreground",children:[Math.round(h.confidence*100),"% confidence"]})]}),h.description&&t.jsx("p",{className:"text-xs text-muted-foreground",children:h.description})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs(fe,{htmlFor:"food-name",className:"text-sm font-medium mb-1 block",children:["Food Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(ge,{id:"food-name",value:v,onChange:L=>F(L.target.value),placeholder:"e.g., Grilled Chicken Breast",className:"h-9",required:!0})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs(fe,{className:"text-xs font-medium mb-1 block",children:["Amount ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"flex",children:[t.jsx(ge,{id:"serving-amount",type:"number",value:y,onChange:L=>b(L.target.value),placeholder:"100",className:"text-sm h-9 rounded-r-none border-r-0 focus-within:z-10",min:"0.1",step:"0.1",required:!0}),t.jsxs(Vt,{value:j,onValueChange:N,children:[t.jsx(Ft,{className:"text-sm h-9 rounded-l-none w-24 border-l-0 focus-within:z-10",children:t.jsx(Ht,{})}),t.jsx(Ot,{children:Ec().map(L=>t.jsx(Ue,{value:L.value,children:r2(L.value)},L.value))})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsxs(fe,{htmlFor:"calories",className:"text-xs font-medium",children:["Calories ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(yt,{feature:"AI Estimation",grayOutForFree:!0,children:t.jsx("button",{type:"button","aria-label":"AI estimate calories for serving",onClick:()=>de("calories"),disabled:W||!v.trim()||!y.trim(),className:"w-5 h-5 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:W?t.jsx("div",{className:"w-2.5 h-2.5 animate-spin rounded-full border border-ai-foreground border-t-transparent mx-auto"}):t.jsx(Xs,{className:"w-2.5 h-2.5 mx-auto"})})})]}),t.jsx(ge,{id:"calories",type:"number",value:C,onChange:L=>_(L.target.value),placeholder:"0",className:`text-sm h-9 ${parseFloat(C)===0&&C!==""?"border-destructive text-destructive":""}`,required:!0}),parseFloat(C)===0&&C!==""&&t.jsx("p",{className:"text-xs text-destructive mt-1",children:"Unlikely to be zero calories"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsxs(fe,{htmlFor:"carbs",className:"text-xs font-medium",children:["Carbs ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(yt,{feature:"AI Estimation",grayOutForFree:!0,children:t.jsx("button",{type:"button","aria-label":"AI estimate carbs for serving",onClick:()=>de("carbs"),disabled:G||!v.trim()||!y.trim(),className:"w-5 h-5 rounded-full bg-ai hover:bg-ai/90 text-ai-foreground transition-all duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:G?t.jsx("div",{className:"w-2.5 h-2.5 animate-spin rounded-full border border-ai-foreground border-t-transparent mx-auto"}):t.jsx(Xs,{className:"w-2.5 h-2.5 mx-auto"})})})]}),t.jsx(ge,{id:"carbs",type:"number",value:k,onChange:L=>S(L.target.value),placeholder:"0",className:"text-sm h-9",required:!0})]})]})]}),d&&c&&t.jsx("div",{className:"flex justify-center",children:t.jsxs(D,{variant:"outline",onClick:()=>q(d),disabled:u,size:"sm",children:[t.jsx(Xs,{className:"w-4 h-4 mr-2"}),"Re-analyze Photo"]})})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsxs("div",{className:"flex items-center border rounded-md",children:[t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>A(Math.max(1,E-1)),disabled:E<=1,className:"h-8 w-8 p-0 rounded-r-none border-r",children:t.jsx(Ig,{className:"w-4 h-4"})}),t.jsx("div",{className:"px-3 py-1 min-w-[3rem] text-center text-sm font-medium",children:E}),t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>A(E+1),className:"h-8 w-8 p-0 rounded-l-none border-l",children:t.jsx(ze,{className:"w-4 h-4"})})]}),t.jsx(D,{onClick:Q,disabled:I||!v||!C||!k||!y,className:"flex-1",children:I?t.jsxs(t.Fragment,{children:[t.jsx(Yt,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add to Food Plan"})]})]})},n2=()=>{const{profile:e}=Ie(),s=l.useCallback((a,n=3)=>{if(!e?.weight||!a)return 0;const i={2:2.8,3:3.2,4:4.3,5:5.5}[Math.round(n)]||3.2,c=e.weight,d=i*c/60;return Math.ceil(a/d)},[e?.weight,e?.units]),r=l.useCallback(a=>{if(a<60)return`${a} min`;{const n=Math.floor(a/60),o=a%60;return o>0?`${n}h ${o}m`:`${n}h`}},[]);return{calculateWalkingMinutesForFood:s,formatWalkingTime:r}},o2=()=>{const[e,s]=l.useState([]),{user:r}=ve(),{executeWithRetry:a}=xu(),{loading:n,startLoading:o,stopLoading:i}=Ru("daily-template"),c=l.useCallback(async()=>{if(console.log(" loadTemplate called, user:",r?.id),!r){console.log(" No user, stopping loading"),i();return}o();try{console.log(" Fetching daily food templates for user:",r.id);const h=await a(async()=>await T.from("daily_food_templates").select("*").eq("user_id",r.id).order("sort_order",{ascending:!0}).order("created_at",{ascending:!1})),{data:p,error:x}=h;if(console.log(" Template fetch result:",{data:p,error:x,count:p?.length}),x)throw x;s(p||[]),console.log(" Template foods set:",p?.length||0,"items")}catch(h){console.error(" Error loading daily food template:",h)}finally{i()}},[r,a,o,i]),d=l.useCallback(async(h,p=!1)=>{if(!r)return{error:{message:"User not authenticated"}};o();try{if(p)console.log(" Appending to existing template for user:",r.id);else{console.log(" Saving template - clearing existing for user:",r.id);const{error:w}=await T.from("daily_food_templates").delete().eq("user_id",r.id);if(w)throw console.error(" Error clearing existing template:",w),w}const x=p?e.length:0,g=h.map((w,y)=>({...w,user_id:r.id,sort_order:x+y}));console.log(" Inserting template data:",g);const{error:v}=await T.from("daily_food_templates").insert(g);if(v)throw console.error(" Error inserting template data:",v),v;return console.log(" Template saved successfully, reloading..."),await new Promise(w=>setTimeout(w,500)),await c(),{error:null}}catch(x){return console.error(" Error saving daily template:",x),{error:x}}finally{i()}},[r,c,o,i,e.length]),f=l.useCallback(async()=>{if(!r)return{error:{message:"User not authenticated"}};o();try{const{error:h}=await T.from("daily_food_templates").delete().eq("user_id",r.id);if(h)throw h;return s([]),{error:null}}catch(h){return console.error("Error clearing daily template:",h),{error:h}}finally{i()}},[r,o,i]),u=l.useCallback(async()=>{if(!r||e.length===0)return{error:{message:"No template available"}};o();try{const h=new Date().toISOString().split("T")[0],p=e.map(g=>({name:g.name,calories:g.calories,carbs:g.carbs,serving_size:g.serving_size,image_url:g.image_url,user_id:r.id,consumed:!1,source_date:h})),{error:x}=await T.from("food_entries").insert(p);if(x)throw x;return{error:null}}catch(h){return console.error("Error applying daily template:",h),{error:h}}finally{i()}},[r,e,o,i]);l.useEffect(()=>{c()},[c]);const m=l.useCallback(async h=>await d(h,!0),[d]);return{templateFoods:e,loading:n,saveAsTemplate:d,addToTemplate:m,clearTemplate:f,applyTemplate:u,loadTemplate:c}},i2=({entries:e})=>{const{profile:s}=Ie(),r=e.filter(f=>!f.consumed).reduce((f,u)=>f+u.calories,0),a=e.filter(f=>f.consumed).reduce((f,u)=>f+u.calories,0),n=e.filter(f=>!f.consumed).reduce((f,u)=>f+u.carbs,0),o=e.filter(f=>f.consumed).reduce((f,u)=>f+u.carbs,0),i=s?.daily_calorie_goal||2e3,c=s?.daily_carb_goal||150,d=(f,u)=>{const m=f/u*100;return m>100?"text-red-600 dark:text-red-400":m>80?"text-amber-600 dark:text-amber-400":"text-green-600 dark:text-green-400"};return t.jsx("div",{className:"bg-muted/20 rounded-lg p-2 mb-4",children:t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(oe,{className:"p-3",children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Calories"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Planned:"}),t.jsxs("span",{className:"text-xs font-semibold",children:[Math.round(r)," / ",i]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Eaten:"}),t.jsxs("span",{className:`text-xs font-bold ${d(a,i)}`,children:[Math.round(a)," / ",i]})]})]})}),t.jsx(oe,{className:"p-3",children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("div",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Carbs (g)"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Planned:"}),t.jsxs("span",{className:"text-xs font-semibold",children:[Math.round(n)," / ",c]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Eaten:"}),t.jsxs("span",{className:`text-xs font-bold ${d(o,c)}`,children:[Math.round(o)," / ",c]})]})]})})]})})},l2=()=>{l.useState(""),l.useState(""),l.useState(""),l.useState("100"),l.useState(""),l.useState(!1),l.useState(!0);const[e,s]=l.useState(null),[r,a]=l.useState(!1),[n,o]=l.useState(!1),[i,c]=l.useState(!1),[d,f]=l.useState(!1),[u,m]=l.useState(!1),[h,p]=l.useState("today"),[x,g]=l.useState(!1),[v,w]=l.useState(!1),[y,b]=l.useState(!1),[j,N]=l.useState(!1);l.useState("Daily Plan");const[C,_]=l.useState([]),{user:k}=ve(),{toast:S}=he(),{profile:E,updateProfile:A}=Ie();Ri();const{todayEntries:I,addFoodEntry:z,deleteFoodEntry:W,updateFoodEntry:Y,toggleConsumption:G,refreshFoodEntries:te}=Mn();n2();const{templateFoods:$,loading:q,saveAsTemplate:de,addToTemplate:Z,clearTemplate:F,applyTemplate:Q,loadTemplate:ae}=o2(),{isInLibrary:R,addLocal:B}=XC(),L=async O=>{console.log(" handleAiChatResult called with:",O);let ue=[];if(O.foodEntries&&Array.isArray(O.foodEntries)?(ue=O.foodEntries,console.log(" Using old format (foodEntries):",ue)):O.arguments?.foods&&Array.isArray(O.arguments.foods)?(ue=O.arguments.foods,console.log(" Using new format (arguments.foods):",ue)):O.name==="add_multiple_foods"&&O.arguments?.foods&&(ue=O.arguments.foods,console.log(" Using function call format:",ue)),ue.length>0){console.log(" Adding foods sequentially to prevent duplicates:",ue);let ce=0;const je=[];for(const tt of ue)try{console.log(" Processing food:",tt.name),await z({name:tt.name,calories:tt.calories,carbs:tt.carbs,serving_size:tt.serving_size,consumed:!1,image_url:tt.image_url}),console.log(" Successfully added food:",tt.name),ce++}catch(is){console.error(" Error adding food:",tt.name,is),je.push(tt.name)}ce>0&&S({title:"Foods Added",description:ce===ue.length?`Added ${ce} food${ce>1?"s":""} to your plan`:`Added ${ce} of ${ue.length} foods to your plan`}),je.length>0&&S({variant:"destructive",title:"Some Foods Failed",description:`Failed to add: ${je.join(", ")}`}),Vo("add","voice")}else console.warn(" No foods found in result:",O);f(!1)},se=()=>{m(!0)},J=async O=>{const ue=await z({name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size,consumed:!1,image_url:O.image_url});!ue||"error"in ue?S({variant:"destructive",title:"Error",description:"Failed to save food entry"}):(S({title:"Food Added",description:`${O.name} has been added to your plan`}),Vo("add",O.image_url?"image":"manual")),m(!1)},ne=async(O,ue)=>{await G(O)},H=async O=>{await W(O),S({title:"Food Deleted",description:"Food entry has been removed from your plan"})},me=async O=>{try{const{data:ue,error:ce}=await T.from("user_foods").insert([{user_id:k?.id,name:O.name,calories_per_100g:Math.round(O.calories/O.serving_size*100),carbs_per_100g:Math.round(O.carbs/O.serving_size*100)}]);if(ce)throw ce;return{success:!0}}catch(ue){return console.error("Error saving to library:",ue),{error:ue}}},le=async()=>{try{const{error:O}=await T.from("food_entries").delete().eq("user_id",k?.id).gte("created_at",new Date().toISOString().split("T")[0]);if(O)throw O;await te(),S({title:"All Foods Cleared",description:"All food entries for today have been removed"})}catch(O){console.error("Error clearing foods:",O),S({variant:"destructive",title:"Error",description:"Failed to clear food entries"})}w(!1)},be=async()=>{try{const O=I.map(ue=>({name:ue.name,calories:ue.calories,carbs:ue.carbs,serving_size:ue.serving_size,image_url:ue.image_url}));_(O),g(!1),N(!0)}catch(O){console.error("Error preparing template save:",O),S({variant:"destructive",title:"Error",description:"Failed to prepare template save"})}},ke=async()=>{try{console.log(" Saving template with foods:",C);const{error:O}=await de(C);O?(console.error(" Error saving template:",O),S({title:"Error",description:"Failed to save template",variant:"destructive"})):(console.log(" Successfully saved template"),S({title:"Template Saved",description:"Your daily food plan has been saved as a template"}),h==="template"&&(console.log(" On template tab, forcing immediate refresh..."),await ae()),E?.enable_daily_reset||await A({enable_daily_reset:!0}))}catch(O){console.error(" Exception saving template:",O),S({title:"Error",description:"Failed to save template",variant:"destructive"})}N(!1),_([])},Te=async()=>{try{console.log(" Applying template...");const{error:O}=await Q();O?(console.error(" Error applying template:",O),S({title:"Error",description:"Failed to apply template",variant:"destructive"})):(console.log(" Successfully applied template"),await te(),S({title:"Template Applied",description:"Your daily template has been applied to today's plan"}))}catch(O){console.error(" Exception applying template:",O),S({title:"Error",description:"Failed to apply template",variant:"destructive"})}},ct=async()=>{try{console.log(" Clearing template...");const{error:O}=await F();O?(console.error(" Error clearing template:",O),S({title:"Error",description:"Failed to clear template",variant:"destructive"})):(console.log(" Successfully cleared template"),S({title:"Template Cleared",description:"Your daily template has been cleared"}))}catch(O){console.error(" Exception clearing template:",O),S({title:"Error",description:"Failed to clear template",variant:"destructive"})}b(!1)};return t.jsxs("div",{className:"relative min-h-[calc(100vh-80px)] bg-background p-4 overflow-x-hidden",children:[t.jsxs("div",{className:"max-w-md mx-auto pt-10 pb-24",children:[t.jsxs("div",{className:"mb-4 mt-4 relative",children:[t.jsx("div",{className:"absolute left-0 top-0",children:t.jsx(yn,{})}),t.jsx("div",{className:"absolute right-0 top-0",children:t.jsx($i,{onClick:()=>o(!0),title:"View food history"})}),t.jsxs("div",{className:"px-4",children:[t.jsxs("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent mb-1 flex items-center",children:[t.jsx(ii,{className:"w-6 h-6 mr-2"}),"Food Tracking"]}),t.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Lock your food intake"})]})]}),t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsx(yt,{feature:"ai_food_voice",className:"col-span-1",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(D,{variant:"ai",size:"action-tall",className:"w-full flex flex-col items-center justify-center gap-1",onClick:()=>f(!0),children:t.jsx(js,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"Voice add"})]})}),t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(D,{variant:"ai",size:"start-button",className:"w-full flex flex-col items-center justify-center gap-2",onClick:se,children:t.jsx(ze,{className:"w-8 h-8"})}),t.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"Add food"})]}),t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx(D,{variant:"action-primary",size:"action-tall",className:"w-full flex flex-col items-center justify-center gap-1",onClick:()=>a(!0),children:t.jsx(Jc,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-xs text-muted-foreground text-center",children:"Library"})]})]})}),t.jsx("div",{className:"mb-6",children:t.jsx($r,{children:t.jsx(i2,{entries:I})})}),t.jsx("div",{className:"space-y-6",children:t.jsxs(Ha,{value:h,onValueChange:async O=>{p(O),O==="template"&&(console.log(" Switching to template tab, forcing refresh..."),await ae())},className:"w-full",children:[t.jsxs(En,{className:"grid w-full grid-cols-2 p-1",children:[t.jsxs(ys,{value:"today",className:"text-sm font-medium flex items-center justify-between px-3",children:[t.jsx("span",{children:"Today's Plan"}),I.length>0&&h==="today"&&t.jsxs("div",{className:"flex items-center gap-4 ml-2",children:[t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-primary/10 text-primary",onClick:O=>{O.stopPropagation(),g(!0)},"aria-label":"Save as template",title:"Save current plan as template",children:t.jsx(Mt,{className:"h-3 w-3"})}),t.jsx(D,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-destructive/10 text-destructive",onClick:O=>{O.stopPropagation(),w(!0)},"aria-label":"Clear all foods",title:"Clear all foods",children:t.jsx(Je,{className:"h-3 w-3"})})]})]}),t.jsx(ys,{value:"template",className:"text-sm font-medium",children:"Daily Template"})]}),t.jsx(ws,{value:"today",className:"mt-4",children:I.length===0?t.jsxs("div",{className:"text-center py-6",children:[t.jsx(ps,{className:"w-12 h-12 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"No foods added yet"}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Add foods using the buttons above"})]}):t.jsx("div",{className:"space-y-1",children:I.map(O=>t.jsx("div",{className:`rounded-lg p-2 mb-1 transition-all duration-200 bg-muted/20 border-0 ${O.consumed?"opacity-60":""}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Jo,{children:[t.jsx(Zo,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-secondary/80 rounded flex-shrink-0","aria-label":"More options",children:t.jsx(uo,{className:"w-5 h-5 text-primary"})})}),t.jsxs(Za,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:[t.jsxs(Oe,{onClick:()=>s(O),className:"py-2.5 px-3",children:[t.jsx(mt,{className:"w-4 h-4 mr-2"}),"Edit Entry"]}),t.jsxs(Oe,{className:"py-2.5 px-3",onClick:async()=>{const ue=await z({name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size,consumed:!1,image_url:O.image_url});!ue||"error"in ue?S({variant:"destructive",title:"Error",description:"Failed to duplicate entry"}):S({title:"Entry duplicated",description:`${O.name} has been duplicated`})},children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Duplicate Entry"]}),t.jsxs(Oe,{onClick:async()=>{if(R(O.name)){S({title:"Already in Library",description:`${O.name} is already in your library`});return}await me({name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size}),B(O.name),S({title:"Saved to Library",description:`${O.name} added to your library`})},className:`py-2.5 px-3 ${R(O.name)?"text-muted-foreground cursor-default":""}`,children:[t.jsx(Mt,{className:"w-4 h-4 mr-2"}),R(O.name)?"Already in Library":"Add to Library"]}),t.jsxs(Oe,{className:"py-2.5 px-3",onClick:async()=>{try{const ue=[{name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size,image_url:O.image_url}],{error:ce}=await Z(ue);S(ce?{title:"Error",description:"Failed to add to template",variant:"destructive"}:{title:"Added to Template",description:`${O.name} added to your daily template`})}catch{S({title:"Error",description:"Failed to add to template",variant:"destructive"})}},children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Add to Template"]}),t.jsxs(Oe,{onClick:()=>H(O.id),className:"py-2.5 px-3 text-destructive focus:text-destructive",children:[t.jsx(Je,{className:"w-4 h-4 mr-2"}),"Delete Entry"]})]})]}),t.jsx("div",{className:"w-10 h-10 bg-muted rounded-lg flex items-center justify-center flex-shrink-0",children:O.image_url?t.jsx("img",{src:O.image_url,alt:O.name,className:"w-10 h-10 object-cover rounded-lg"}):t.jsx(ps,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 relative",children:[t.jsxs("div",{className:"mb-0 flex items-center gap-2 min-w-0",children:[t.jsx("h3",{className:`text-sm font-semibold truncate max-w-[180px] ${O.consumed?"text-muted-foreground line-through":"text-foreground"}`,children:O.name}),R(O.name)&&t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full shrink-0",title:"Saved to library"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs("span",{className:`font-medium ${Math.round(O.serving_size)===0?"text-destructive":""}`,children:[Math.round(O.serving_size),"g"]}),t.jsx("span",{className:"text-muted-foreground/60",children:""}),t.jsx(Ze,{content:"Calories",children:t.jsx("span",{className:`font-medium cursor-pointer ${Math.round(O.calories)===0?"text-destructive":""}`,children:Math.round(O.calories)})}),t.jsx("span",{className:"text-muted-foreground/60",children:""}),t.jsx(Ze,{content:"Carbs",children:t.jsxs("span",{className:"font-medium cursor-pointer",children:[Math.round(O.carbs),"g"]})})]})]}),t.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:t.jsx(D,{size:"sm",variant:"default",onClick:()=>ne(O.id,!O.consumed),className:"h-5 w-5 p-1 bg-primary hover:bg-primary/90 rounded",title:O.consumed?"Mark as not eaten":"Mark as eaten","aria-label":O.consumed?"Mark as not eaten":"Mark as eaten",children:t.jsx(dr,{className:"w-3 h-3 text-primary-foreground"})})})]})},O.id))})}),t.jsx(ws,{value:"template",className:"mt-4",children:t.jsx("div",{className:"space-y-4 pb-20",children:$.length>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground border-b border-border/50 pb-2",children:[t.jsx("div",{className:"flex items-center space-x-3",children:t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx(Sn,{id:"activate-daily",checked:E?.enable_daily_reset||!1,onCheckedChange:O=>{A({enable_daily_reset:O}).then(ue=>{ue.error?S({variant:"destructive",title:"Error",description:"Failed to update daily reset setting"}):S({title:O?"Daily Reset Activated":"Daily Reset Deactivated",description:O?"Your template will automatically apply each day at midnight":"Automatic daily reset has been disabled"})})},className:"scale-75"}),t.jsx(fe,{htmlFor:"activate-daily",className:"text-xs font-normal",children:"Auto-apply daily"}),t.jsx(Ze,{content:"When enabled, this template will automatically replace your current food plan every day at midnight",children:t.jsx(at,{className:"w-3 h-3 text-muted-foreground/70 ml-1"})})]})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>b(!0),className:"h-6 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",children:[t.jsx(Je,{className:"w-3 h-3 mr-1"}),"Clear"]}),t.jsx(Ze,{content:"Apply template to today's plan",children:t.jsx(D,{variant:"ghost",size:"sm",onClick:Te,className:"h-6 px-2 text-xs text-primary hover:text-primary hover:bg-primary/10",children:t.jsx(ze,{className:"w-3 h-3 mr-1"})})}),t.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"Apply today"})]})]}),t.jsx("div",{className:"space-y-1",children:$.map(O=>{const ue=O.id;return t.jsx("div",{className:"rounded-lg p-2 mb-1 transition-all duration-200 bg-muted/20 border-0",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(Jo,{children:[t.jsx(Zo,{asChild:!0,children:t.jsx(D,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-secondary/80 rounded flex-shrink-0","aria-label":"More options",children:t.jsx(uo,{className:"w-5 h-5 text-primary"})})}),t.jsxs(Za,{align:"start",side:"bottom",sideOffset:8,avoidCollisions:!0,collisionPadding:16,className:"w-52 z-50 bg-background border border-border shadow-lg",children:[t.jsxs(Oe,{className:"py-2.5 px-3",onClick:()=>{const ce={id:O.id,name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size,image_url:O.image_url,consumed:!1,user_id:k?.id||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),source_date:new Date().toISOString().split("T")[0]};s(ce)},children:[t.jsx(mt,{className:"w-4 h-4 mr-2"}),"Edit Entry"]}),t.jsxs(Oe,{className:"py-2.5 px-3",onClick:async()=>{const ce=$.find(je=>je.id===ue);if(!ce){S({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const je=[{name:ce.name,calories:ce.calories,carbs:ce.carbs,serving_size:ce.serving_size,image_url:ce.image_url}],{error:tt}=await Z(je);S(tt?{title:"Error",description:"Failed to duplicate template item",variant:"destructive"}:{title:"Template item duplicated",description:`${ce.name} has been duplicated in template`})}catch{S({title:"Error",description:"Failed to duplicate template item",variant:"destructive"})}},children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Duplicate Entry"]}),t.jsxs(Oe,{onClick:async()=>{const ce=$.find(je=>je.id===ue);if(!ce){S({variant:"destructive",title:"Error",description:"Food item not found"});return}if(R(ce.name)){S({title:"Already in Library",description:`${ce.name} is already in your library`});return}await me({name:ce.name,calories:ce.calories,carbs:ce.carbs,serving_size:ce.serving_size}),B(ce.name),S({title:"Saved to Library",description:`${ce.name} added to your library`})},className:`py-2.5 px-3 ${R(O.name)?"text-muted-foreground cursor-default":""}`,children:[t.jsx(Mt,{className:"w-4 h-4 mr-2"}),R(O.name)?"Already in Library":"Add to Library"]}),t.jsxs(Oe,{onClick:async()=>{const ce=$.find(je=>je.id===ue);if(!ce){S({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const je=await z({name:ce.name,calories:ce.calories,carbs:ce.carbs,serving_size:ce.serving_size,image_url:ce.image_url,consumed:!1});!je||"error"in je?S({variant:"destructive",title:"Error",description:"Failed to add to today's plan"}):S({title:"Added to Today's Plan",description:`${ce.name} added to today's food plan`})}catch(je){S({variant:"destructive",title:"Error",description:`Failed to add to today's plan: ${je.message||"Unknown error"}`})}},children:[t.jsx(ze,{className:"w-4 h-4 mr-2"}),"Add to Today"]}),t.jsxs(Oe,{onClick:async()=>{const ce=$.find(je=>je.id===ue);if(!ce){S({variant:"destructive",title:"Error",description:"Food item not found"});return}try{const{data:je,error:tt}=await T.from("daily_food_templates").delete().eq("id",ce.id).eq("user_id",k?.id).select();if(tt)throw tt;if(!je||je.length===0){S({variant:"destructive",title:"Error",description:"Template item not found or already deleted"});return}await te(),S({title:"Template item deleted",description:`${ce.name} removed from daily template`})}catch(je){S({variant:"destructive",title:"Error",description:`Failed to delete template item: ${je.message||"Unknown error"}`})}},className:"py-2.5 px-3 text-destructive focus:text-destructive",children:[t.jsx(Je,{className:"w-4 h-4 mr-2"}),"Delete Entry"]})]})]}),t.jsx("div",{className:"w-10 h-10 bg-muted rounded-lg flex items-center justify-center flex-shrink-0",children:O.image_url?t.jsx("img",{src:O.image_url,alt:O.name,className:"w-10 h-10 object-cover rounded-lg"}):t.jsx(ps,{className:"w-5 h-5 text-muted-foreground"})}),t.jsxs("div",{className:"flex-1 min-w-0 relative",children:[t.jsxs("div",{className:"mb-0 flex items-center gap-2 min-w-0",children:[t.jsx("h3",{className:"text-sm font-semibold truncate max-w-[180px] text-foreground",children:O.name}),R(O.name)&&t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full shrink-0",title:"Saved to library"})]}),t.jsx("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:t.jsxs("span",{className:"font-medium",children:[O.calories," cal, ",O.carbs,"g carbs  ",O.serving_size,"g"]})})]})]})},O.id)})})]}):t.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[t.jsx(Mt,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No daily template saved"}),t.jsx("p",{className:"text-sm mt-2",children:"Add foods to today's plan and save as template"})]})})})]})})]}),t.jsx(na,{isOpen:i,onClose:()=>c(!1),title:"Food Tracking Guide",children:t.jsx("div",{children:"Food tracking onboarding content"})}),t.jsx(it,{isOpen:n,onClose:()=>o(!1),title:"Food History",size:"lg",children:t.jsx(ZC,{onClose:()=>o(!1)})}),t.jsx(it,{isOpen:r,onClose:()=>a(!1),title:"",size:"xl",variant:"fullscreen",children:t.jsx(YC,{onSelectFood:async(O,ue=!1)=>{const ce={name:O.name,calories:O.calories_per_100g||O.calories,carbs:O.carbs_per_100g||O.carbs,serving_size:100,consumed:ue,image_url:O.image_url},je=await z(ce);!je||"error"in je?S({variant:"destructive",title:"Error",description:"Failed to add food to your plan"}):S({title:"Food Added",description:`${O.name} has been added to your plan`})},onBack:()=>a(!1)})}),e&&t.jsx(e2,{isOpen:!!e,onClose:()=>s(null),entry:e,onUpdate:async O=>{if($.some(ce=>ce.id===e.id))try{const{error:ce}=await T.from("daily_food_templates").update({name:O.name,calories:O.calories,carbs:O.carbs,serving_size:O.serving_size,image_url:O.image_url,updated_at:new Date().toISOString()}).eq("id",e.id).eq("user_id",k?.id);if(ce)throw ce;await ae(),S({title:"Template Updated",description:"Template item has been updated successfully"})}catch(ce){S({variant:"destructive",title:"Error",description:`Failed to update template item: ${ce.message||"Unknown error"}`})}else await Y({id:e.id,updates:O}),S({title:"Food Updated",description:"Food entry has been updated successfully"});s(null)}}),t.jsx(Xh,{isOpen:d,onClose:()=>f(!1),onResult:L,title:"Food Assistant",proactiveMessage:"Hi! What food would you like to add? You can add multiple at once - just tell me the name and the quantity"}),t.jsx(a2,{isOpen:u,onClose:()=>m(!1),onSave:J}),t.jsx(et,{open:x,onOpenChange:g,children:t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Save as Daily Template"}),t.jsx(Ve,{children:"This will save your current food plan as a daily template. You can then apply this template to future days."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:be,children:"Save Template"})]})]})}),t.jsx(et,{open:j,onOpenChange:N,children:t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Confirm Template Save"}),t.jsxs(Ve,{children:["This will replace your existing daily template with ",C.length," food item",C.length!==1?"s":"","."]})]}),t.jsxs(We,{children:[t.jsx(Qe,{onClick:()=>_([]),children:"Cancel"}),t.jsx(He,{onClick:ke,children:"Confirm Save"})]})]})}),t.jsx(et,{open:v,onOpenChange:w,children:t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Clear All Foods"}),t.jsx(Ve,{children:"This will remove all food entries from today's plan. This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:le,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear All"})]})]})}),t.jsx(et,{open:y,onOpenChange:b,children:t.jsxs(qe,{children:[t.jsxs(Be,{children:[t.jsx(Ge,{children:"Clear Daily Template"}),t.jsx(Ve,{children:"This will remove all items from your daily template. This action cannot be undone."})]}),t.jsxs(We,{children:[t.jsx(Qe,{children:"Cancel"}),t.jsx(He,{onClick:ct,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear Template"})]})]})})]})},c2=()=>(l.useEffect(()=>{document.title="Health Check - OK"},[]),t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-green-600",children:"Health Check: OK"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"Application is running normally"}),t.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:[t.jsx("p",{className:"text-sm text-green-700",children:"Status: Healthy"}),t.jsxs("p",{className:"text-sm text-green-700",children:["Timestamp: ",new Date().toISOString()]})]})]})})),d2=()=>{const[e,s]=l.useState(new Set),{profile:r,isProfileComplete:a}=Ie(),{user:n}=ve();l.useEffect(()=>{const x=localStorage.getItem("dismissed_notifications");x&&s(new Set(JSON.parse(x)))},[]);const o=x=>{localStorage.setItem("dismissed_notifications",JSON.stringify([...x]))},i=l.useMemo(()=>{if(!n)return[];const x=[];if(!a()){const g=[];r?.weight||g.push("weight"),r?.height||g.push("height"),r?.age||g.push("age");const v={id:"profile_incomplete",type:"profile_incomplete",priority:"high",title:"Profile Information Needed",message:`I need your ${g.join(", ")} to calculate your daily calorie burn and provide accurate recommendations. This is essential for the app to work properly.`,actions:{primary:{label:"Tell me now",action:"chat_input"},secondary:{label:"Go to Settings",action:"navigate",target:"/settings"}},autoShow:!0,persistent:!0,metadata:{missingFields:g}};e.has(v.id)||x.push(v)}return x},[n,r,a,e]),c=x=>{const g=new Set(e);g.add(x),s(g),o(g)};return{notifications:i,dismissNotification:c,clearNotification:x=>{c(x)},hasActiveNotifications:()=>r&&(!r.weight||!r.height||!r.age)?!0:i.length>0,getHighPriorityNotifications:()=>i.filter(x=>x.priority==="high"),getAutoShowNotifications:()=>i.filter(x=>x.autoShow),getNotificationIcon:x=>{switch(x){case"profile_incomplete":return"exclamation-triangle";case"subscription_upsell":return"crown";case"general":default:return"info"}},getNotificationColor:(x,g)=>x==="profile_incomplete"?"text-amber-500":x==="subscription_upsell"?"text-purple-500":g==="high"?"text-red-500":g==="medium"?"text-orange-500":"text-blue-500"}},u2=({time:e,isEating:s=!1,className:r=""})=>t.jsx("div",{className:`
        absolute -top-1 -right-1 
        text-white text-xs 
        px-1.5 py-0.5 
        rounded-full 
        font-mono
        flex items-center justify-center
        w-[72px] h-6
        whitespace-nowrap
        ${s?"bg-amber-500":"bg-accent"}
        ${r}
      `,children:t.jsx("span",{className:"text-center",children:e})}),m2=({trialEndsAt:e,className:s=""})=>{const a=(()=>{const o=new Date,c=new Date(e).getTime()-o.getTime();if(c<=0)return{text:"0d",urgency:"expired",expired:!0};const d=Math.floor(c/(1e3*60*60*24)),f=Math.floor(c%(1e3*60*60*24)/(1e3*60*60));let u="low";return d<=1?u="critical":d<=3?u="high":d<=7&&(u="medium"),{text:d>0?`${d}d`:`${f}h`,urgency:u,expired:!1}})(),n=(o,i)=>{if(i)return"bg-red-600 animate-pulse";switch(o){case"critical":return"bg-red-500 animate-pulse";case"high":return"bg-red-400";case"medium":return"bg-orange-400";case"low":default:return"bg-green-500"}};return t.jsx("div",{className:`
        absolute -top-1 right-0
        text-white text-xs 
        px-1.5 py-0.5 
        rounded-full 
        font-mono font-semibold
        flex items-center justify-center
        w-[28px] h-4
        whitespace-nowrap
        ${n(a.urgency,a.expired)}
        ${s}
      `,title:a.expired?"Trial expired":`Trial expires in ${a.text}`,children:t.jsx("span",{className:"text-center text-[10px]",children:a.text})})},h2=(e,s)=>{e({title:"Food Tracking Unavailable",description:"Food tracking is only available to premium users. Upgrade now to unlock unlimited food logging!",variant:"default",action:t.jsx(D,{onClick:s,size:"sm",className:"ml-2",children:"Upgrade Now"}),duration:8e3})},f2=()=>{const e=zt(),{timerStatus:s,formatTime:r}=vh();d2(),Ie();const{currentSession:a,refreshActiveSession:n}=Wi(),{todayTotals:o}=Mn(),{currentSession:i}=Sr(),{isAnimationsSuspended:c}=wm(),{isOnline:d}=nr(),{inTrial:f,trialEndsAt:u,invalidate:m,hasPremiumFeatures:h,subscription_tier:p,createSubscription:x}=Es(),[g,v]=l.useState(Date.now()),{toast:w}=he();l.useEffect(()=>{if(c)return;let C;const _=a&&a.status==="active",k=i&&i.status==="active";return(_||k)&&(C=setInterval(()=>{v(Date.now())},1e3)),()=>{C&&clearInterval(C)}},[c,a?.status,i?.status]),l.useEffect(()=>{n()},[n]),l.useEffect(()=>{console.log(" Navigation mounted - refreshing subscription data"),m()},[m]);const y=l.useMemo(()=>{if(!a||a.status!=="active")return null;const C=new Date(a.start_time).getTime(),_=Math.floor((g-C)/1e3),k=a.goal_duration_seconds||0;if(k<=23*3600){const A=k+28800,I=_%A;if(I>=k){const W=I-k,Y=Math.max(0,28800-W);return{time:r(Y),isEating:!0,label:"Eating"}}else return{time:r(I),isEating:!1,label:"Fasting"}}return{time:r(_),isEating:!1,label:"Fasting"}},[a,g,r]),b=l.useMemo(()=>[{icon:Kt,label:"Fast",path:"/",badge:y?.time||null,isEating:y?.isEating||!1},{icon:td,label:"Walk",path:"/walking",badge:i?.status==="active"?(()=>{const C=new Date(i.start_time).getTime();let _=Math.floor((g-C)/1e3);const k=i.total_pause_duration||0;let S=0;i.session_state==="paused"&&i.pause_start_time&&(S=Math.floor((g-new Date(i.pause_start_time).getTime())/1e3));const E=Math.max(0,_-k-S);return r(E)})():null,isEating:!1},{icon:ps,label:"Food",path:"/food-tracking",isEating:!1,caloriesBadge:o.calories>0?Math.round(o.calories):null},{icon:ii,label:"Goals",path:"/motivators",isEating:!1},{icon:ox,label:"Settings",path:"/settings",isEating:!1}],[y,i,r,o.calories,g]),N=d?{color:"bg-green-500",tooltip:"Connected",shouldPulse:!1}:{color:"bg-red-500",tooltip:"Offline - Changes will sync when connected",shouldPulse:!1};return t.jsx(gr,{children:t.jsx("nav",{className:"fixed bottom-0 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md bg-background/90 backdrop-blur supports-[backdrop-filter]:bg-background/80",children:t.jsx("div",{className:"bg-ceramic-plate px-4 py-2",children:t.jsx("div",{className:"flex justify-around gap-1 relative",children:b.map(({icon:C,label:_,path:k,badge:S,isEating:E,caloriesBadge:A})=>{const I=e.pathname===k,z=$=>{switch($){case"Fast":return"Start or manage your fasting sessions";case"Walk":return"Track your walking sessions and burn calories";case"Food":return"Log your meals and track daily intake";case"Goals":return"View and create motivational content";case"Settings":return"Customize your app preferences";default:return $}},W=$=>{if(!(p==="admin"||h)&&_==="Food"){$.preventDefault(),$.stopPropagation(),h2(w,x);return}},G=_==="Food"&&!(p==="admin"||h),te=t.jsxs(aa,{to:k,className:`relative flex flex-col items-center py-2 px-2 rounded-xl transition-all duration-200 flex-1 min-w-0 ${I?"bg-primary text-primary-foreground shadow-lg":"text-muted-foreground hover:text-warm-text hover:bg-ceramic-rim bg-ceramic-base/20 border border-ceramic-rim/30"} ${G?"opacity-50":""}`,onClick:W,children:[t.jsx(C,{className:"w-5 h-5 mb-1"}),t.jsx("span",{className:"text-xs font-medium",children:_}),G&&_==="Food"&&t.jsx("div",{className:"absolute top-1 right-1",children:t.jsx(ur,{className:"w-3 h-3 text-muted-foreground"})}),S&&(_==="Fast"||_==="Walk")&&t.jsx(u2,{time:S,isEating:E}),A&&_==="Food"&&t.jsx("span",{className:"absolute -top-1 -right-1 min-w-[16px] h-4 text-xs rounded-full flex items-center justify-center font-medium bg-amber-500 text-amber-50 px-1",children:A}),_==="Settings"&&f&&u&&t.jsx(m2,{trialEndsAt:u}),_==="Settings"&&t.jsx("div",{className:"absolute -bottom-1 -right-1",children:t.jsx("div",{className:`w-2 h-2 rounded-full ${N.color} ${N.shouldPulse?"animate-pulse":""}`,title:N.tooltip})})]});return t.jsxs(De,{children:[t.jsx(Ae,{asChild:!0,children:te}),t.jsx(Me,{children:t.jsx("p",{children:z(_)})})]},k)})})})})})},p2=({children:e})=>{const{toast:s}=he(),r=wr(o=>o.initialize),a=nr(o=>o.startMonitoring),n=nr(o=>o.stopMonitoring);return l.useEffect(()=>((async()=>{try{window.__initializingApp=!0,a(),await new Promise(i=>setTimeout(i,100)),await r(),window.__initializingApp=!1}catch(i){console.error("App initialization failed:",i),window.__initializingApp=!1,setTimeout(()=>{window.__authInitialized||s({title:"Initialization Failed",description:"There was a problem starting the app. Please refresh the page.",variant:"destructive"})},3e3)}})(),()=>{n();const i=window.__authSubscription;i&&(i.unsubscribe(),delete window.__authSubscription)}),[r,a,n,s]),t.jsx(t.Fragment,{children:e})},g2=()=>{const[e,s]=l.useState({}),[r,a]=l.useState(!0),n=async()=>{try{const{data:c,error:d}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["brand_primary_color","brand_primary_hover","brand_accent_color","brand_ai_color"]);if(d){console.error("Error loading color settings:",d);return}const f={};c?.forEach(u=>{u.setting_key==="brand_primary_color"?f.primary_color=u.setting_value:u.setting_key==="brand_primary_hover"?f.secondary_color=u.setting_value:u.setting_key==="brand_accent_color"?f.accent_color=u.setting_value:u.setting_key==="brand_ai_color"&&(f.ai_color=u.setting_value)}),s(f),o(f)}catch(c){console.error("Error in loadColors:",c)}finally{a(!1)}},o=c=>{const d=document.documentElement;c.primary_color&&(d.style.setProperty("--primary",c.primary_color),d.style.setProperty("--ring",c.primary_color)),c.secondary_color&&d.style.setProperty("--secondary",c.secondary_color),c.accent_color&&d.style.setProperty("--accent",c.accent_color),c.ai_color&&d.style.setProperty("--ai",c.ai_color)},i=()=>{const c=document.documentElement;c.style.setProperty("--primary","220 35% 45%"),c.style.setProperty("--ring","220 35% 45%")};return l.useEffect(()=>{i(),n()},[]),{colorSettings:e,loading:r,loadColors:n,applyColors:o}},Np=()=>(l.useEffect(()=>{(async()=>{try{const{data:s}=await T.from("shared_settings").select("setting_value").eq("setting_key","app_favicon").maybeSingle();if(s?.setting_value){const r=document.getElementById("dynamic-favicon"),a=document.getElementById("dynamic-shortcut-icon");r&&(r.href=s.setting_value),a&&(a.href=s.setting_value)}}catch(s){console.error("Error loading dynamic favicon:",s)}})()},[]),null),x2=()=>{l.useEffect(()=>{(async()=>{try{const{data:s}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["app_logo","app_favicon"]),r={};if(s?.forEach(o=>{r[o.setting_key]=o.setting_value}),r.app_favicon){const o=document.getElementById("dynamic-favicon"),i=document.getElementById("dynamic-shortcut-icon");o&&(o.href=r.app_favicon,console.log("Updated favicon link to:",r.app_favicon)),i&&(i.href=r.app_favicon,console.log("Updated shortcut icon link to:",r.app_favicon))}r.app_logo&&document.querySelectorAll('link[rel="apple-touch-icon"]').forEach(i=>{i.href=r.app_logo,console.log("Updated apple touch icon to:",r.app_logo)}),r.app_favicon&&document.querySelectorAll('link[rel="icon"]').forEach(i=>{i.href=r.app_favicon,console.log("Updated icon link to:",r.app_favicon)});const a=document.querySelector('link[rel="manifest"]');if(a){const o=new URL(a.href,window.location.origin);o.searchParams.set("v",Date.now().toString()),o.searchParams.set("bust",Math.random().toString(36)),o.searchParams.set("mobile",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"1":"0"),a.href=o.toString()}if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"caches"in window){const o=await caches.keys();await Promise.all(o.map(i=>caches.delete(i))),console.log("Cleared all caches for mobile device")}console.log("PWA assets updated with dynamic values")}catch(s){console.error("Error updating PWA assets:",s)}})()},[])},v2=()=>{l.useEffect(()=>{(async()=>{try{const{data:s}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["pwa_app_name","pwa_short_name","pwa_description","app_logo","app_favicon","pwa_theme_color"]),r={};if(s?.forEach(n=>{r[n.setting_key]=n.setting_value}),r.pwa_app_name&&(document.title=r.pwa_app_name),r.pwa_description){const n=document.querySelector('meta[name="description"]');n&&n.setAttribute("content",r.pwa_description)}if(r.pwa_app_name){const n=document.querySelector('meta[property="og:title"]');n&&n.setAttribute("content",r.pwa_app_name)}if(r.pwa_description){const n=document.querySelector('meta[property="og:description"]');n&&n.setAttribute("content",r.pwa_description)}if(r.pwa_short_name){const n=document.querySelector('meta[name="apple-mobile-web-app-title"]');n&&n.setAttribute("content",r.pwa_short_name)}if(r.pwa_theme_color){const n=document.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",r.pwa_theme_color);const o=document.querySelector('meta[name="msapplication-TileColor"]');o&&o.setAttribute("content",r.pwa_theme_color)}const a=r.app_favicon||r.app_logo;if(a){const n=document.getElementById("dynamic-favicon"),o=document.getElementById("dynamic-shortcut-icon");n&&(n.href=a),o&&(o.href=a),document.querySelectorAll('link[rel="apple-touch-icon"]').forEach(d=>{d.href=a}),document.querySelectorAll('link[rel="icon"]').forEach(d=>{d.id!=="dynamic-favicon"&&(d.href=a)})}console.log("HTML meta tags updated with dynamic values")}catch(s){console.error("Error updating HTML meta tags:",s)}})()},[])},Rt=({children:e})=>{const{user:s,loading:r}=ve(),a=qt(),[n,o]=l.useState(!1);return l.useEffect(()=>{const i=setTimeout(()=>{o(!0)},200);return()=>clearTimeout(i)},[]),l.useEffect(()=>{const c=setTimeout(()=>{!r&&!s&&!window.__initializingApp&&a("/auth")},100);return()=>clearTimeout(c)},[s,r,a]),(r||!s)&&n?t.jsx(Ka,{}):r||!s?null:t.jsx(t.Fragment,{children:e})},Or=({children:e})=>{const{user:s,loading:r}=ve(),a=qt(),[n,o]=l.useState(!0),[i,c]=l.useState(!1),{toast:d}=he();return l.useEffect(()=>{(async()=>{if(!r&&s)try{const{data:u,error:m}=await T.rpc("has_role",{_user_id:s.id,_role:"admin"});if(m){console.warn("Admin role check via RPC failed, falling back to user_roles query:",m);const{data:h,error:p}=await T.from("user_roles").select("role").eq("user_id",s.id).eq("role","admin").maybeSingle();c(p?!1:!!h)}else c(!!u)}finally{o(!1)}else!r&&!s&&o(!1)})()},[s,r]),l.useEffect(()=>{!r&&!n&&(s?i||(d({title:"Admins only",description:"You dont have access to this section.",variant:"destructive"}),a("/")):a("/auth"))},[r,n,i,s,a,d]),r||n?t.jsx(Ka,{}):!s||!i?t.jsx(Ka,{}):t.jsx(t.Fragment,{children:e})},y2=({onCalorieAdded:e})=>{const[s,r]=l.useState(!1),[a,n]=l.useState(""),[o,i]=l.useState(""),[c,d]=l.useState(!1),{toast:f}=he(),{user:u}=ve(),m=async()=>{if(!a.trim()||!o.trim()||!u){f({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}const h=parseInt(o);if(h<=0||h>2e3){f({title:"Error",description:"Please enter a valid calorie amount (1-2000)",variant:"destructive"});return}d(!0);try{const{error:p}=await T.from("manual_calorie_burns").insert({user_id:u.id,activity_name:a.trim(),calories_burned:h});if(p)throw p;f({title:"Success",description:`Added ${h} calories burned from ${a}`}),n(""),i(""),r(!1),e()}catch(p){console.error("Error saving manual calorie burn:",p),f({title:"Error",description:"Failed to save calorie burn",variant:"destructive"})}finally{d(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs(D,{variant:"action-secondary",size:"action-secondary",className:"w-full",onClick:()=>r(!0),children:[t.jsx(ze,{className:"w-3 h-3 mr-1"}),"Add External Activity"]}),t.jsx(it,{isOpen:s,onClose:()=>r(!1),title:"Add External Activity",variant:"standard",size:"sm",showCloseButton:!0,footer:t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"outline",onClick:()=>r(!1),className:"w-full h-10",size:"default",children:"Cancel"}),t.jsx(D,{onClick:m,disabled:c||!a.trim()||!o,className:"w-full h-10",size:"default",children:c?"Saving...":"Add Activity"})]}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"activity-name",children:"Activity Name"}),t.jsx(ge,{id:"activity-name",value:a,onChange:h=>n(h.target.value),placeholder:"e.g., Weight Training",maxLength:100,onClick:h=>h.stopPropagation(),onFocus:h=>h.stopPropagation()})]}),t.jsxs("div",{children:[t.jsx(fe,{htmlFor:"calories",children:"Calories Burned"}),t.jsx(ge,{id:"calories",type:"number",value:o,onChange:h=>i(h.target.value),placeholder:"e.g., 300",min:"1",max:"2000",onClick:h=>h.stopPropagation(),onFocus:h=>h.stopPropagation()})]})]})})]})},w2=({icon:e,label:s,value:r,subtitle:a,tooltip:n,className:o=""})=>t.jsxs(oe,{className:`p-3 bg-card border-border relative ${o}`,children:[t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx(Ze,{content:n,children:t.jsx(at,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"flex items-center space-x-2 mb-1 pr-6",children:[e,t.jsx("span",{className:"text-xs font-medium text-warm-text",children:s})]}),t.jsxs("div",{className:"text-lg font-bold text-primary",children:[typeof r=="number"?Math.round(r).toLocaleString():r," cal"]}),a&&t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:a})]}),b2=({deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o="metric"})=>{const{color:i,icon:c}=l.useMemo(()=>{const f=e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-muted-foreground",u=e>0?vx:nn;return{color:f,icon:u}},[e]),d=l.useMemo(()=>s&&e===0&&r===0?"...":`${Math.round(Math.abs(e)).toLocaleString()} cal`,[e,s,r]);return t.jsxs(oe,{className:"p-4 bg-card border-border relative",children:[t.jsx("div",{className:"absolute top-3 right-3",children:t.jsx(Ze,{content:"Your calorie deficit for today. A positive number means you're burning more than you consume (weight loss). This includes your base metabolism, activity level, walking, and any manual activities you've logged.",children:t.jsx(at,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"text-center space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 pr-6",children:[t.jsx(c,{className:`w-6 h-6 ${i}`}),t.jsx("h3",{className:"text-lg font-semibold text-warm-text",children:"Today's Deficit"})]}),t.jsx("div",{className:`text-3xl font-bold ${i}`,children:d}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e>0?"Calorie deficit (weight loss)":"Calorie surplus (weight gain)"}),a!==void 0&&n!==void 0&&e>0&&t.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3 pt-2 border-t border-ceramic-rim/50",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[t.jsx(bg,{className:"w-3 h-3 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"Today's Fat Loss"}),t.jsx(Ze,{content:"Fat burned today based on your current calorie deficit",children:t.jsx(at,{className:"w-3 h-3 text-muted-foreground"})})]}),t.jsxs("div",{className:"text-sm font-semibold text-primary",children:[Math.round(a),"g"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[t.jsx(rn,{className:"w-3 h-3 text-primary"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:"30d Projection"}),t.jsx(Ze,{content:"Projected weight loss if you maintain today's deficit for 30 days",children:t.jsx(at,{className:"w-3 h-3 text-muted-foreground"})})]}),t.jsx("div",{className:"text-sm font-semibold text-primary",children:o==="metric"?`${Math.round(n/1e3)}kg`:`${Math.round(n/453.592)}lbs`})]})]})]})]})},j2=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(!0),n=async()=>{try{const{data:o,error:i}=await T.from("shared_settings").select("setting_value").eq("setting_key","app_logo").maybeSingle();if(i)throw i;s(o?.setting_value||null)}catch(o){console.error("Error fetching app logo:",o),s(null)}finally{a(!1)}};return l.useEffect(()=>{n()},[]),{appLogo:e,loading:r,refetch:n}},N2=({value:e,formatNumber:s,getDeficitColor:r,loading:a,tdee:n})=>{const{hasPremiumFeatures:o,subscription_tier:i}=Es();return i==="admin"||o?t.jsx("span",{className:`text-sm font-bold ${r(e)}`,children:a&&e===0&&n===0?"...":`${s(e)} cal`}):t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(ur,{className:"w-3 h-3 text-muted-foreground"}),t.jsx("span",{className:"text-sm font-bold text-muted-foreground",children:"Premium"})]})},S2=({calories:e,carbs:s})=>{const{subscription_tier:r,hasPremiumFeatures:a}=Es(),n=r==="admin"||a;return t.jsx(yt,{feature:"Food Tracking",grayOutForFree:!0,showUpgrade:!1,children:t.jsxs(oe,{className:"p-3 bg-card border-border relative",children:[!n&&t.jsx("div",{className:"absolute top-1 left-1 z-10",children:t.jsx(ur,{className:"w-3 h-3 text-muted-foreground"})}),t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx(Ze,{content:"Total calories consumed from food today",children:t.jsx(at,{className:"w-5 h-5 text-muted-foreground"})})}),t.jsxs("div",{className:"flex items-center space-x-2 mb-1 pr-6",children:[t.jsx(ps,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-xs font-medium text-warm-text",children:"Calories In"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-lg font-bold text-primary",children:[Math.round(e)," cal"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-px h-6 bg-border"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsxs("span",{className:"text-sm font-medium text-primary",children:[Math.round(s),"g"]}),t.jsx(Ze,{content:"Total carbs consumed from food today",children:t.jsx(at,{className:"w-3 h-3 text-muted-foreground"})})]})]})]})]})})},_2=()=>{const{profile:e}=Ie(),{weeksToGoal:s,currentWeight:r,goalWeight:a,weightToLose:n,fatInGrams:o,thirtyDayProjection:i}=Zi();if(!r||!a)return null;const c=e?.units==="metric"?"kg":"lbs";return t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs(oe,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ho,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Goal Progress"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-primary",children:[n?.toFixed(1)||0," ",c]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:[r,"  ",a," ",c]})]})]}),t.jsxs(oe,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(rn,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Time to Goal"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-lg font-bold text-primary",children:s?`${s}w`:"N/A"}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"at current deficit"})]})]}),t.jsxs(oe,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gt,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"Fat Burned"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-primary",children:[o,"g"]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"today's deficit"})]})]}),t.jsxs(oe,{className:"p-3 relative overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between mb-2",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(nn,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium",children:"30-Day Loss"})]})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-lg font-bold text-primary",children:[i,"g"]}),t.jsx("div",{className:"text-xs text-muted-foreground",children:"projected fat loss"})]})]})]})},C2=()=>t.jsx(yt,{feature:"Goal Metrics",grayOutForFree:!0,showUpgrade:!1,children:t.jsx(_2,{})}),k2=({deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o})=>{const{hasPremiumFeatures:i,subscription_tier:c}=Es();return c==="admin"||i?t.jsx(b2,{deficit:e,loading:s,tdee:r,fatInGrams:a,thirtyDayProjection:n,userUnits:o}):t.jsx(oe,{className:"p-4 bg-card border-border relative",children:t.jsxs("div",{className:"text-center space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[t.jsx(ur,{className:"w-6 h-6 text-muted-foreground"}),t.jsx("h3",{className:"text-lg font-semibold text-muted-foreground",children:"Today's Deficit"})]}),t.jsx("div",{className:"text-3xl font-bold text-muted-foreground",children:" Premium"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Deficit tracking requires premium"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Unlock detailed calorie deficit analysis, fat loss projections, and more"})]})]})})},E2=()=>{const[e,s]=l.useState(null),[r,a]=l.useState(!1),{user:n}=ve(),{toast:o}=he(),i=l.useCallback(async()=>{if(n)try{const f=new Date().toISOString().split("T")[0],{data:u,error:m}=await T.from("daily_activity_overrides").select("*").eq("user_id",n.id).eq("date",f).maybeSingle();if(m){console.error("Error fetching today's activity override:",m);return}s(u)}catch(f){console.error("Error in getTodayOverride:",f)}},[n]),c=l.useCallback(async(f,u=!1)=>{if(n){a(!0);try{const m=new Date().toISOString().split("T")[0];console.log("Setting activity override:",{activityLevel:f,isPermanent:u,userId:n.id,date:m});const{data:h,error:p}=await T.from("daily_activity_overrides").upsert({user_id:n.id,date:m,activity_level:f},{onConflict:"user_id,date"}).select().single();if(p)throw console.error("Database error setting activity override:",p),p;if(console.log("Successfully set activity override:",h),s(h),u){const{error:x}=await T.from("profiles").update({activity_level:f}).eq("user_id",n.id);x?(console.error("Error updating profile activity level:",x),o({variant:"destructive",title:"Profile Update Failed",description:"Today's override saved, but couldn't update your default activity level."})):o({title:"Activity Level Updated",description:"Your default activity level has been updated permanently."})}else o({title:"Activity Override Set",description:"Activity level changed for today only."})}catch(m){console.error("Error setting activity override:",m);let h="Unable to set activity override. Please try again.";m?.message?.includes("Failed to fetch")?h="Network connection issue. Please check your connection and try again.":m?.code&&(h=`Database error (${m.code}). Please try again.`),o({variant:"destructive",title:"Update Failed",description:h})}finally{a(!1)}}},[n,o]),d=l.useCallback(async()=>{if(!(!n||!e)){a(!0);try{const{error:f}=await T.from("daily_activity_overrides").delete().eq("id",e.id);if(f)throw f;s(null),o({title:"Override Cleared",description:"Reverted to your default activity level for today."})}catch(f){console.error("Error clearing activity override:",f),o({variant:"destructive",title:"Clear Failed",description:"Unable to clear override. Please try again."})}finally{a(!1)}}},[n,e,o]);return l.useEffect(()=>{n?i():s(null)},[n,i]),{todayOverride:e,loading:r,setActivityOverride:c,clearTodayOverride:d,refreshOverride:i}},Mc={sedentary:"Low",moderately_active:"Medium",very_active:"High"},T2=({currentDisplayLevel:e})=>{const[s,r]=l.useState(!1),{todayOverride:a,loading:n,setActivityOverride:o,clearTodayOverride:i}=E2(),{profile:c}=Ie(),{refreshDeficit:d}=Pn(),f=async h=>{try{h==="clear-override"&&a?await i():h!==u()&&await o(h,!1),await d(),setTimeout(()=>r(!1),300)}catch(p){console.error("Error handling activity level change:",p)}},u=()=>a?a.activity_level:c?.activity_level||"sedentary",m=h=>Mc[h]||h;return t.jsx("div",{className:"space-y-2",children:t.jsxs(Vt,{value:u(),onValueChange:f,open:s,onOpenChange:r,disabled:n,children:[t.jsx(Ft,{className:"h-7 text-xs bg-ceramic-base border-ceramic-rim hover:bg-ceramic-plate transition-colors",children:t.jsx(Ht,{children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:m(u())}),a&&t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]})})}),t.jsxs(Ot,{className:"bg-ceramic-plate border-ceramic-rim z-50",children:[Object.entries(Mc).map(([h,p])=>t.jsx(Ue,{value:h,className:"text-xs hover:bg-ceramic-base focus:bg-ceramic-base",children:t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsx("span",{children:p}),h===c?.activity_level&&!a&&t.jsx(vs,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 ml-2",children:"Default"})]})},h)),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"border-t border-ceramic-rim my-1"}),t.jsxs("div",{className:"px-2 py-1 text-[10px] text-muted-foreground flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),t.jsx("span",{children:"Active for today only"})]}),t.jsx(Ue,{value:"clear-override",className:"text-xs text-muted-foreground hover:bg-ceramic-base focus:bg-ceramic-base",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Zg,{className:"w-3 h-3"}),t.jsx("span",{children:"Clear Override"})]})})]})]})]})})},M2=l.createContext(void 0),P2=()=>{const e=l.useContext(M2);return e===void 0?{walkingStats:{realTimeCalories:0,realTimeDistance:0,realTimeSteps:0,timeElapsed:0,isActive:!1,isPaused:!1,currentSessionId:null}}:e},D2=({totalCalories:e,walkingCalories:s,manualCalories:r,onRefresh:a})=>{const[n,o]=l.useState(!1),[i,c]=l.useState([]),[d,f]=l.useState(!1),[u,m]=l.useState(null),{user:h}=ve(),{walkingStats:p}=P2(),{profile:x}=Ie(),{manualBurns:g,todayTotal:v,deleteManualBurn:w}=Yh(),y=async()=>{if(h){f(!0);try{const E=new Date,A=new Date(E.getFullYear(),E.getMonth(),E.getDate()),{data:I}=await T.from("walking_sessions").select("*").eq("user_id",h.id).eq("session_state","completed").gte("start_time",A.toISOString()).lt("start_time",new Date(A.getTime()+24*60*60*1e3).toISOString()).order("start_time",{ascending:!1});c(I||[])}catch(E){console.error("Error fetching walking sessions:",E)}finally{f(!1)}}};l.useEffect(()=>{y()},[h]),l.useEffect(()=>{!p.isActive&&p.currentSessionId===null&&setTimeout(()=>y(),1e3)},[p.isActive,p.currentSessionId]);const b=E=>new Date(E).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),j=(E,A)=>{const I=new Date(E),W=(A?new Date(A):new Date).getTime()-I.getTime();return Math.floor(W/1e3/60)},N=E=>{if(!E)return"0";const A=x?.units==="metric"?"km":"mi";return`${E.toFixed(2)} ${A}`},C=i.length>0||p.isActive||g.length>0,_=i.length+(p.isActive?1:0)+g.length,k=async E=>{try{await w(E),a&&a()}catch(A){console.error("Failed to delete manual calorie burn:",A)}},S=()=>{y(),a&&a()};return C?t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Br,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Activity Burn"}),t.jsx(Ze,{content:"Calories burned from walking and external activities today",children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-sm font-bold text-warm-text",children:[Math.round(e)," cal"]}),_>1&&t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>o(!n),className:"h-6 w-6 p-0",children:n?t.jsx(ci,{className:"w-4 h-4"}):t.jsx(bt,{className:"w-4 h-4"})})]})]}),(s>0||r>0)&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:[s>0&&t.jsxs("span",{children:["Walking: ",s," cal"]}),s>0&&r>0&&t.jsx("span",{children:"  "}),r>0&&t.jsxs("span",{children:["External: ",r," cal"]})]}),n&&_>1&&t.jsxs("div",{className:"ml-6 space-y-2",children:[p.isActive&&t.jsxs(oe,{className:"p-2 bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-xs font-medium text-green-700 dark:text-green-300",children:"Active Session"}),t.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[Math.floor(p.timeElapsed/60),"m ",p.timeElapsed%60,"s",p.isPaused&&" (Paused)"]})]}),t.jsxs("div",{className:"text-xs font-bold text-green-700 dark:text-green-300",children:[Math.round(p.realTimeCalories)," cal"]})]}),t.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[p.realTimeDistance.toFixed(2)," ",x?.units==="metric"?"km":"mi"," ",p.realTimeSteps.toLocaleString()," steps"]})]}),i.map((E,A)=>t.jsxs(oe,{className:"p-2 bg-ceramic-base border-ceramic-rim",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Kt,{className:"w-3 h-3 text-muted-foreground"}),t.jsxs("span",{className:"text-xs font-medium text-warm-text",children:["Session ",i.length-A]}),E.is_edited&&t.jsx("span",{className:"text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 px-1.5 py-0.5 rounded",children:"Edited"}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[b(E.start_time)," - ",E.end_time?b(E.end_time):"Active"]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",j(E.start_time,E.end_time),"m)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-xs font-bold text-warm-text",children:[E.calories_burned||0," cal"]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>m(E),className:"h-4 w-4 p-0 text-muted-foreground hover:text-foreground",children:t.jsx(mt,{className:"w-3 h-3"})})]})]}),E.is_edited?t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Data removed due to edit"}):E.distance?t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[N(E.distance),"  ",E.estimated_steps?.toLocaleString()||0," steps"]}):null]},E.id)),g.map((E,A)=>t.jsx(oe,{className:"p-2 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ze,{className:"w-3 h-3 text-blue-600"}),t.jsx("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:E.activity_name}),t.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400",children:new Date(E.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[E.calories_burned," cal"]}),t.jsx(D,{variant:"ghost",size:"sm",onClick:()=>k(E.id),className:"h-4 w-4 p-0 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:t.jsx(Pe,{className:"w-3 h-3"})})]})]})},E.id))]}),!n&&_===1&&t.jsx("div",{className:"text-xs text-muted-foreground text-right",children:p.isActive?"Active session":g.length>0?"External activity":"Single session today"}),u&&t.jsx(Ef,{session:u,isOpen:!0,onClose:()=>m(null),onSessionEdited:S})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Br,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Activity Burn"})]}),t.jsx("div",{className:"text-sm font-bold text-warm-text",children:"0 cal"})]})},Sp=l.memo(()=>{const[e,s]=l.useState(!1),[r,a]=l.useState(null),{deficitData:n,loading:o,refreshDeficit:i}=Pn(),{fatInGrams:c,thirtyDayProjection:d}=Zi(),{profile:f}=Ie(),{todayEntries:u,todayTotals:m}=Mn(),{appLogo:h}=j2(),p=l.useRef(null),x=zt(),g=x.pathname==="/admin"||x.pathname==="/auth"||x.pathname==="/reset-password"||x.pathname==="/update-password",v=N=>Math.round(Math.abs(N)).toLocaleString(),w=l.useMemo(()=>N=>N>0?"text-green-600 dark:text-green-400":N<0?"text-red-600 dark:text-red-400":"text-muted-foreground",[]),y=l.useMemo(()=>N=>({sedentary:"Low Activity",lightly_active:"Light Activity",moderately_active:"Moderate Activity",very_active:"High Activity",extremely_active:"Very High Activity"})[N]||N,[]),b=N=>{a(N.touches[0].clientY)},j=N=>{if(!r)return;const C=N.changedTouches[0].clientY,_=r-C;Math.abs(_)>50&&(_<0&&!e?s(!0):_>0&&e&&s(!1)),a(null)};return l.useEffect(()=>{const N=_=>{const k=_.target;p.current&&!p.current.contains(k)&&(k.closest('[role="dialog"]')||k.closest(".dialog-content")||k.closest("[data-radix-portal]")||k.closest("[data-radix-popper-content-wrapper]")||k.closest('[role="listbox"]')||s(!1))},C=_=>{_.key==="Escape"&&s(!1)};if(e){const _=setTimeout(()=>{document.addEventListener("mousedown",N),document.addEventListener("keydown",C)},100);return()=>{clearTimeout(_),document.removeEventListener("mousedown",N),document.removeEventListener("keydown",C)}}},[e]),g?null:t.jsx(gr,{children:t.jsxs("div",{ref:p,className:"fixed top-0 left-0 right-0 z-30",children:[t.jsx("div",{className:"cursor-pointer transition-colors select-none",onClick:()=>s(!e),onTouchStart:b,onTouchEnd:j,children:t.jsxs("div",{className:`max-w-md mx-auto px-8 py-3 flex items-center justify-between bg-card hover:bg-card/95 transition-colors ${e?"border-l border-r border-muted-foreground":""}`,children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[h?t.jsx("img",{src:h,alt:"App Logo",className:"w-5 h-5 object-contain"}):t.jsx(Gt,{className:"w-5 h-5 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Today's Deficit:"}),t.jsx(Ze,{content:"Updates every 15 minutes when walking, hourly when idle - optimized for performance",children:t.jsx(at,{className:"w-3 h-3 text-muted-foreground"})}),t.jsx(N2,{value:n.todayDeficit,formatNumber:v,getDeficitColor:w,loading:o,tdee:n.tdee})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-muted-foreground hidden sm:inline",children:"Tap to expand"}),t.jsx(bt,{className:`w-5 h-5 text-muted-foreground transition-transform duration-200 ${e?"rotate-180":""}`})]})]})}),e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/20 z-[-1]",onClick:()=>s(!1)}),t.jsx("div",{className:"bg-card max-w-md mx-auto z-50 rounded-b-lg border-l border-r border-b border-muted-foreground",children:t.jsxs("div",{className:"px-8 py-4 space-y-4",children:[t.jsx(k2,{deficit:n.todayDeficit,loading:o,tdee:n.tdee,fatInGrams:c,thirtyDayProjection:d,userUnits:f?.units}),t.jsxs("div",{className:"grid grid-cols-2 gap-1 px-0.5",children:[t.jsx(S2,{calories:n.caloriesConsumed,carbs:m.carbs}),t.jsx(w2,{icon:t.jsx(Br,{className:"w-4 h-4 text-primary"}),label:"Calories Out",value:n.totalCaloriesBurned,tooltip:`Total calories burned today: Base (${v(n.tdee)}) + Walking (${v(n.walkingCalories)}) + Manual (${v(n.manualCalories)}) = ${v(n.totalCaloriesBurned)}`})]}),t.jsxs(oe,{className:"p-3 bg-card border-border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Gt,{className:"w-4 h-4 text-primary"}),t.jsx("span",{className:"text-sm font-medium text-warm-text",children:"Base Daily Burn"}),t.jsx(Ze,{content:`Your Total Daily Energy Expenditure (TDEE) based on BMR (${v(n.bmr)})  activity multiplier for ${y(n.activityLevel)}. This already includes your selected activity level.`,children:t.jsx(at,{className:"w-4 h-4 text-muted-foreground"})})]}),t.jsxs("div",{className:"text-sm font-bold text-warm-text",children:[v(n.tdee)," cal"]})]}),t.jsx("div",{className:"mb-3",children:t.jsx(T2,{currentDisplayLevel:n.activityLevel})}),t.jsx("div",{className:"border-t border-border my-3"}),t.jsx(D2,{totalCalories:n.walkingCalories+n.manualCalories,walkingCalories:n.walkingCalories,manualCalories:n.manualCalories,onRefresh:i})]}),t.jsx(C2,{}),t.jsx("div",{className:"mt-4",children:t.jsx(y2,{onCalorieAdded:i})}),t.jsx("div",{className:"flex justify-center pt-4",children:t.jsx("button",{onClick:()=>s(!1),className:"flex items-center justify-center p-2 rounded-full bg-card hover:bg-card/80 transition-colors","aria-label":"Close expanded view",children:t.jsx(bt,{className:"w-5 h-5 text-muted-foreground rotate-180"})})})]})})]})]})})});Sp.displayName="DailyStatsPanel";const A2=()=>{const[e,s]=l.useState({indexHomepage:!1,indexOtherPages:!1}),r=zt();return l.useEffect(()=>{(async()=>{try{const{data:n}=await T.from("shared_settings").select("setting_key, setting_value").in("setting_key",["seo_index_homepage","seo_index_other_pages"]);if(n){const o=n.reduce((i,c)=>(i[c.setting_key]=c.setting_value==="true",i),{});s({indexHomepage:o.seo_index_homepage||!1,indexOtherPages:o.seo_index_other_pages||!1})}}catch(n){console.warn("Failed to fetch SEO settings:",n)}})()},[]),l.useEffect(()=>{const n=r.pathname==="/"?e.indexHomepage:e.indexOtherPages,o=document.querySelector('meta[name="robots"]');o&&o.remove();const i=document.createElement("meta");return i.name="robots",i.content=n?"index, follow":"noindex, nofollow",document.head.appendChild(i),()=>{const c=document.querySelector('meta[name="robots"]');c&&c.remove()}},[e,r.pathname]),null};l.lazy(()=>cr(()=>import("./AdminOverview-B4IWcpIM.js"),__vite__mapDeps([0,1,2,3,4,5])));const R2=l.lazy(()=>cr(()=>import("./Operations-CK0g1Pgi.js"),__vite__mapDeps([6,1,2,7,8,3,9,10,11,12]))),I2=l.lazy(()=>cr(()=>import("./Content-D4_P9vij.js"),__vite__mapDeps([13,1,2,7,14,3,5,15]))),F2=l.lazy(()=>cr(()=>import("./Branding-C0c2ntYP.js"),__vite__mapDeps([16,1,2,7,17,18,3,19,20,21]))),O2=l.lazy(()=>cr(()=>import("./Payments-Bv3gsP7P.js"),__vite__mapDeps([22,1,2,7,23,18,3]))),L2=l.lazy(()=>cr(()=>import("./Dev-UgvawLyk.js"),__vite__mapDeps([24,1,2,7,4,21,3])));if(typeof window<"u"){const e=Zw({storage:window.localStorage,throttleTime:1e3});Jw({queryClient:Rs,persister:e,maxAge:1e3*60*60*24})}const $2=()=>{g2(),Np(),x2(),v2();const e=zt(),s=wr(d=>d.user),{profile:r,isProfileComplete:a}=Ie(),[n,o]=l.useState(!1),{isOnline:i}=nr(),c=e.pathname==="/auth"||e.pathname==="/reset-password"||e.pathname==="/update-password";return l.useEffect(()=>{setTimeout(async()=>{try{await MN()}catch(f){console.warn("Analytics initialization failed (non-critical):",f)}},1e3)},[]),l.useEffect(()=>{PN(e.pathname)},[e.pathname]),l.useEffect(()=>{if(s&&r!==null){const d=a();console.log("Profile onboarding check:",{user:!!s,profileComplete:d,weight:r?.weight,height:r?.height,age:r?.age}),o(!d)}else o(!1)},[s,r,a]),l.useEffect(()=>{const d=f=>{i||console.log("Offline navigation detected, using cached app shell")};return window.addEventListener("popstate",d),()=>window.removeEventListener("popstate",d)},[i]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"min-h-screen bg-frame-background overflow-x-hidden",children:t.jsxs("div",{className:`mx-auto max-w-md min-h-screen bg-background relative shadow-2xl overflow-x-hidden ${c?"":"px-4"}`,children:[t.jsx(A2,{}),!c&&t.jsx(Sp,{}),t.jsxs(qb,{children:[t.jsx(rt,{path:"/auth",element:t.jsx(ot,{children:t.jsx(sS,{})})}),t.jsx(rt,{path:"/reset-password",element:t.jsx(ot,{children:t.jsx(rS,{})})}),t.jsx(rt,{path:"/update-password",element:t.jsx(ot,{children:t.jsx(aS,{})})}),t.jsx(rt,{path:"/",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx(WN,{})})})}),t.jsx(rt,{path:"/motivators",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx(_1,{})})})}),t.jsx(rt,{path:"/motivator-ideas",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx($1,{})})})}),t.jsx(rt,{path:"/settings",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx(Q1,{})})})}),t.jsx(rt,{path:"/walking",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx(A_,{})})})}),t.jsx(rt,{path:"/food-tracking",element:t.jsx(Rt,{children:t.jsx(ot,{children:t.jsx(l2,{})})})}),t.jsx(rt,{path:"/admin",element:t.jsx(Ub,{to:"/admin/operations",replace:!0})}),t.jsx(rt,{path:"/admin/operations",element:t.jsx(Rt,{children:t.jsx(Or,{children:t.jsx(ot,{children:t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(R2,{})})})})})}),t.jsx(rt,{path:"/admin/content",element:t.jsx(Rt,{children:t.jsx(Or,{children:t.jsx(ot,{children:t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(I2,{})})})})})}),t.jsx(rt,{path:"/admin/branding",element:t.jsx(Rt,{children:t.jsx(Or,{children:t.jsx(ot,{children:t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(F2,{})})})})})}),t.jsx(rt,{path:"/admin/payments",element:t.jsx(Rt,{children:t.jsx(Or,{children:t.jsx(ot,{children:t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(O2,{})})})})})}),t.jsx(rt,{path:"/admin/dev",element:t.jsx(Rt,{children:t.jsx(Or,{children:t.jsx(ot,{children:t.jsx(l.Suspense,{fallback:t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"})}),children:t.jsx(L2,{})})})})})}),t.jsx(rt,{path:"/health",element:t.jsx(ot,{children:t.jsx(c2,{})})}),t.jsx(rt,{path:"*",element:t.jsx(ot,{children:t.jsx(nS,{})})})]}),!c&&t.jsx(f2,{})]})}),t.jsx(pf,{isOpen:n,onClose:()=>o(!1)})]})},U2=()=>t.jsx(r0,{onError:(e,s)=>{console.error("App-level error:",e,s)},children:t.jsx(Ow,{client:Rs,children:t.jsxs(gr,{children:[t.jsx(dv,{}),t.jsx($v,{}),t.jsx(Yb,{children:t.jsx(a0,{children:t.jsx(G1,{children:t.jsx(p2,{children:t.jsx(T_,{children:t.jsx($2,{})})})})})})]})})});console.debug=()=>{},console.info=()=>{};b0();const z2=()=>(Np(),t.jsx(U2,{}));Qc(document.getElementById("root")).render(t.jsx(p0,{children:t.jsx(wj,{children:t.jsx(z2,{})})}));export{Or as $,Ie as A,D as B,oe as C,Xs as D,px as E,K as F,sn as G,nr as H,ge as I,ga as J,P_ as K,Ka as L,Kt as M,Qt as N,Br as O,ze as P,ve as Q,hs as R,Sn as S,jr as T,ps as U,ba as V,TN as W,Qs as X,gh as Y,Ta as Z,zi as _,dt as a,at as a0,pu as a1,Vt as a2,Ft as a3,Ht as a4,Ot as a5,Ue as a6,Zg as a7,co as a8,_l as a9,zt as aa,Q2 as ab,Mi as ac,Z2 as ad,gr as ae,De as af,Ae as ag,Me as ah,rx as ai,qr as aj,Og as ak,yj as al,g2 as am,ft as an,RN as ao,mt as ap,Jr as aq,ir as ar,_n as as,lr as at,Vm as au,Mt as av,Tt as aw,as as b,Ua as c,Le as d,Yt as e,fe as f,Z1 as g,eS as h,ox as i,ci as j,bt as k,tS as l,H1 as m,C1 as n,ie as o,jh as p,Je as q,Ha as r,T as s,En as t,he as u,ys as v,zg as w,ws as x,Zc as y,vs as z};
