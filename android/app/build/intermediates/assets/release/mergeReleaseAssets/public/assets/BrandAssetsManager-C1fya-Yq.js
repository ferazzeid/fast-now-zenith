import{j as e}from"./ui-4JzjGctU.js";import{r as c}from"./vendor-D63tyEUO.js";import{u as Z,s as r,C as b,a as _,b as w,d as y,f as p,B as g,ab as k,ac as ee,w as ae,a0 as se,ad as H,I as Y,ae as J}from"./index-D6Zlv4TB.js";import{S as te}from"./smartphone-Cfc1d1T-.js";import"./supabase-DmvLFwnu.js";const ce=()=>{const[x,$]=c.useState(null),[v,D]=c.useState(null),[j,T]=c.useState(null),[C,L]=c.useState(""),[S,M]=c.useState(""),[A,B]=c.useState(""),[n,h]=c.useState(!1),{toast:l}=Z(),[N,I]=c.useState({image:"/src/assets/motivator-placeholder.jpg",name:"Admin",title:"Personal Insight"}),[f,R]=c.useState({name:"Admin",title:"Personal Insight"}),[P,F]=c.useState(!1);c.useEffect(()=>{W(),K()},[]);const W=async()=>{try{const{data:a,error:s}=await r.from("shared_settings").select("setting_key, setting_value").in("setting_key",["app_logo","app_favicon","app_icon_url"]);if(s){console.error("Error fetching brand assets:",s);return}a&&a.forEach(t=>{t.setting_key==="app_favicon"?M(t.setting_value||""):t.setting_key==="app_logo"?B(t.setting_value||""):t.setting_key==="app_icon_url"&&L(t.setting_value||"")})}catch(a){console.error("Error fetching current assets:",a)}},K=async()=>{try{const{data:a}=await r.from("shared_settings").select("setting_key, setting_value").in("setting_key",["author_tooltip_image","author_tooltip_name","author_tooltip_title"]);if(a){const s=a.reduce((t,o)=>(t[o.setting_key]=o.setting_value,t),{});I({image:s.author_tooltip_image||"/src/assets/motivator-placeholder.jpg",name:s.author_tooltip_name||"Admin",title:s.author_tooltip_title||"Personal Insight"}),R({name:s.author_tooltip_name||"Admin",title:s.author_tooltip_title||"Personal Insight"}),F(!1)}}catch(a){console.error("Failed to load author settings:",a)}},U=(a,s)=>{if(!a.type.startsWith("image/")){l({title:"Invalid file type",description:"Please select a valid image file (PNG, JPG, etc.)",variant:"destructive"});return}if(a.size>2*1024*1024){l({title:"File too large",description:"Please select an image smaller than 2MB",variant:"destructive"});return}s==="appIcon"?$(a):s==="favicon"?D(a):T(a)},O=async(a,s)=>{let t="";if(s==="appIcon"?t=C:s==="favicon"?t=S:t=A,t){const q=await J(t,"website-images",r);q.success||console.warn(`Failed to delete old ${s} (continuing with upload):`,q.error)}const o=a.name.split(".").pop(),d=`${s}-${Date.now()}.${o}`,i=`brand-assets/${d}`;console.log(`Uploading ${s}:`,{fileName:d,filePath:i,fileSize:a.size,fileType:a.type});const{data:u,error:m}=await r.storage.from("website-images").upload(i,a,{cacheControl:"3600",upsert:!1});if(m)throw console.error(`Upload error for ${s}:`,m),new Error(`Upload failed: ${m.message}`);console.log(`Upload successful for ${s}:`,u);const{data:G}=r.storage.from("website-images").getPublicUrl(i);return console.log(`Public URL generated for ${s}:`,G.publicUrl),G.publicUrl},V=async a=>{if(!a.type.startsWith("image/")){l({title:"Invalid file type",description:"Please select an image file.",variant:"destructive"});return}if(a.size>5*1024*1024){l({title:"File too large",description:"Please select an image under 5MB.",variant:"destructive"});return}h(!0);try{if(N.image&&N.image!=="/src/assets/motivator-placeholder.jpg"){const u=await J(N.image,"website-images",r);u.success||console.warn("Failed to delete old author image (continuing with upload):",u.error)}const s=a.name.split(".").pop(),o=`author/${`author-${Math.random()}.${s}`}`,{error:d}=await r.storage.from("website-images").upload(o,a);if(d)throw d;const{data:{publicUrl:i}}=r.storage.from("website-images").getPublicUrl(o);await r.from("shared_settings").upsert({setting_key:"author_tooltip_image",setting_value:i},{onConflict:"setting_key"}),I(u=>({...u,image:i})),l({title:"Author image updated",description:"The author tooltip image has been updated successfully."})}catch(s){console.error("Error uploading author image:",s),l({title:"Upload failed",description:"Failed to upload the author image. Please try again.",variant:"destructive"})}finally{h(!1)}},Q=async()=>{if(P){h(!0);try{await Promise.all([r.from("shared_settings").upsert({setting_key:"author_tooltip_name",setting_value:f.name},{onConflict:"setting_key"}),r.from("shared_settings").upsert({setting_key:"author_tooltip_title",setting_value:f.title},{onConflict:"setting_key"})]),I(a=>({...a,name:f.name,title:f.title})),F(!1),l({title:"Author info saved",description:"Author information has been updated successfully."})}catch(a){console.error("Error saving author info:",a),l({title:"Save failed",description:"Failed to save author information. Please try again.",variant:"destructive"})}finally{h(!1)}}},z=(a,s)=>{R(t=>({...t,[a]:s})),F(!0)},X=async()=>{if("serviceWorker"in navigator)try{const s=await navigator.serviceWorker.ready;s&&s.update()}catch(s){console.log("Service worker update failed (non-critical):",s)}const a=document.querySelector('link[rel="manifest"]');if(a){const s=new URL(a.href);s.searchParams.set("v",Date.now().toString()),a.href=s.toString()}console.log("Manifest and PWA cache updated")},E=async(a,s)=>{if(!a){l({title:"No file selected",description:`Please select a ${s} image first`,variant:"destructive"});return}h(!0);try{console.log(`Starting ${s} upload:`,a.name);const t=await O(a,s);console.log(`${s} uploaded successfully:`,t);let o="";s==="appIcon"?o="app_icon_url":s==="favicon"?o="app_favicon":o="app_logo";const{data:d}=await r.from("shared_settings").select("setting_key").eq("setting_key",o).maybeSingle();let i;if(d){const{error:m}=await r.from("shared_settings").update({setting_value:t,updated_at:new Date().toISOString()}).eq("setting_key",o);i=m}else{const{error:m}=await r.from("shared_settings").insert({setting_key:o,setting_value:t});i=m}if(i)throw console.error("Database update error:",i),new Error(`Failed to save ${s} URL: ${i.message}`);s==="appIcon"?(L(t),$(null)):s==="favicon"?(M(t),D(null)):(B(t),T(null)),await X(),l({title:"Success",description:{appIcon:"App icon updated successfully! This will be used for PWA installation and home screen icons.",favicon:"Favicon uploaded successfully! The new favicon will appear on browser tabs.",logo:"Logo updated successfully! This will be used for app branding and headers."}[s]}),await W()}catch(t){console.error(`Error uploading ${s}:`,t),l({title:"Upload Failed",description:t?.message||`Failed to upload ${s}. Please try again.`,variant:"destructive"})}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"App Icon · 192x192/512x512"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Main app icon for home screen and app stores (used for PWA)"})]}),e.jsxs(y,{className:"space-y-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:C,alt:"Current app icon",className:"w-12 h-12 object-contain rounded",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current app icon"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"app-icon-upload",className:"text-sm font-medium",children:"Select App Icon (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"app-icon-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&U(a.target.files[0],"appIcon"),className:"hidden"}),e.jsxs(g,{variant:"outline",onClick:()=>document.getElementById("app-icon-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Choose File"]}),x&&e.jsx("span",{className:"text-sm text-muted-foreground",children:x.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{onClick:()=>E(x,"appIcon"),disabled:!x||n,className:"flex-1 sm:flex-none",children:n?"Uploading...":"Save"})})]})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Favicon · 32x32"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Small icon shown in browser tabs and bookmarks"})]}),e.jsxs(y,{className:"space-y-4",children:[S&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:S,alt:"Current favicon",className:"w-8 h-8 object-contain",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current favicon"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"favicon-upload",className:"text-sm font-medium",children:"Select Favicon (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"favicon-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&U(a.target.files[0],"favicon"),className:"hidden"}),e.jsxs(g,{variant:"outline",onClick:()=>document.getElementById("favicon-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Choose File"]}),v&&e.jsx("span",{className:"text-sm text-muted-foreground",children:v.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{onClick:()=>E(v,"favicon"),disabled:!v||n,className:"flex-1 sm:flex-none",children:n?"Uploading...":"Save"})})]})]}),e.jsxs(b,{children:[e.jsxs(_,{children:[e.jsxs(w,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Logo · Variable Size"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Main brand logo for headers, splash screens, and general branding"})]}),e.jsxs(y,{className:"space-y-4",children:[A&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-background",children:[e.jsx("img",{src:A,alt:"Current logo",className:"w-12 h-12 object-contain rounded",style:{backgroundColor:"transparent"}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Current logo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"logo-upload",className:"text-sm font-medium",children:"Select Logo (PNG with transparent background recommended)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"logo-upload",type:"file",accept:"image/*",onChange:a=>a.target.files?.[0]&&U(a.target.files[0],"logo"),className:"hidden"}),e.jsxs(g,{variant:"outline",onClick:()=>document.getElementById("logo-upload")?.click(),className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Choose File"]}),j&&e.jsx("span",{className:"text-sm text-muted-foreground",children:j.name})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{onClick:()=>E(j,"logo"),disabled:!j||n,className:"flex-1 sm:flex-none",children:n?"Uploading...":"Save"})})]})]}),e.jsxs(b,{className:"mt-6",children:[e.jsx(_,{children:e.jsxs(w,{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"Author Profile"}),e.jsx(H,{content:"This configures the author information shown in tooltips throughout the app where you can leave personal insights for users."})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{children:"Author Image"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:N.image,alt:"Author",className:"w-16 h-16 rounded-full object-cover border-2 border-border"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:a=>{const s=a.target.files?.[0];s&&V(s)},className:"hidden",id:"author-image-upload",disabled:n}),e.jsxs("label",{htmlFor:"author-image-upload",className:`flex items-center space-x-2 px-4 py-2 border border-dashed border-border rounded-lg cursor-pointer hover:bg-accent transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Upload author image"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Recommended: Square image, max 5MB"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"author-name",children:"Author Name"}),e.jsx(Y,{id:"author-name",value:f.name,onChange:a=>z("name",a.target.value),placeholder:"Enter author name",disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"author-title",children:"Tooltip Title"}),e.jsx(Y,{id:"author-title",value:f.title,onChange:a=>z("title",a.target.value),placeholder:"e.g., Personal Insight, Author Note",disabled:n})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{onClick:Q,disabled:!P||n,className:"flex-1 sm:flex-none",children:n?"Saving...":"Save Author Info"}),P&&e.jsx("p",{className:"text-xs text-muted-foreground self-center",children:"You have unsaved changes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Preview"}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-border rounded-lg bg-muted/30",children:[e.jsx(H,{content:"This is how your tooltips will appear throughout the app. You can customize the image, name, and title above."}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hover or click the icon to see your tooltip"})]})]})]})]})]})};export{ce as default};
//# sourceMappingURL=BrandAssetsManager-C1fya-Yq.js.map
