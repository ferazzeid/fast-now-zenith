{"version":3,"file":"Operations-D9KA41dV.js","sources":["../../src/components/GoogleAnalyticsSettings.tsx","../../src/components/ClearSubscriptionCacheButton.tsx","../../src/pages/admin/Operations.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport const GoogleAnalyticsSettings = () => {\r\n  const [propertyId, setPropertyId] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const loadSettings = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('shared_settings')\r\n        .select('setting_key, setting_value')\r\n        .eq('setting_key', 'google_analytics_property_id');\r\n\r\n      if (error) throw error;\r\n      const propertyIdSetting = data?.[0];\r\n      setPropertyId(propertyIdSetting?.setting_value || '');\r\n    } catch (error) {\r\n      console.error('Error loading Google Analytics settings:', error);\r\n      toast({ title: 'Error', description: 'Failed to load settings', variant: 'destructive' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const saveSettings = async () => {\r\n    setSaving(true);\r\n    try {\r\n      const { error } = await supabase\r\n        .from('shared_settings')\r\n        .upsert({ setting_key: 'google_analytics_property_id', setting_value: propertyId.trim() });\r\n\r\n      if (error) throw error;\r\n      toast({ title: 'Saved', description: 'Google Analytics property ID updated' });\r\n    } catch (error) {\r\n      console.error('Error saving Google Analytics settings:', error);\r\n      toast({ title: 'Error', description: 'Failed to save settings', variant: 'destructive' });\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadSettings();\r\n  }, []);\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"text-base\">Google Analytics</CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Label htmlFor=\"propertyId\" className=\"sr-only\">Property ID</Label>\r\n          <Input\r\n            id=\"propertyId\"\r\n            value={propertyId}\r\n            onChange={(e) => setPropertyId(e.target.value)}\r\n            placeholder=\"GA4 Property ID\"\r\n            disabled={loading}\r\n            className=\"h-9\"\r\n          />\r\n          <Button onClick={saveSettings} disabled={saving || loading || !propertyId.trim()} className=\"h-9 px-4\">\r\n            {saving ? 'Saving...' : 'Save'}\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { RefreshCw } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useCacheManager } from '@/hooks/useCacheManager';\r\n\r\nexport const ClearSubscriptionCacheButton: React.FC = () => {\r\n  const { clearSubscriptionCache } = useCacheManager();\r\n\r\n  const handleClearCache = () => {\r\n    clearSubscriptionCache({ showToast: true, delay: 0 });\r\n  };\r\n\r\n  return (\r\n    <Button \r\n      onClick={handleClearCache}\r\n      variant=\"outline\"\r\n      size=\"sm\"\r\n      className=\"flex items-center gap-2\"\r\n    >\r\n      <RefreshCw className=\"w-4 h-4\" />\r\n      Clear Subscription Cache\r\n    </Button>\r\n  );\r\n};","import React, { useEffect, useState } from \"react\";\r\nimport { AdminSubnav } from \"@/components/AdminSubnav\";\r\nimport { usePageSEO } from \"@/hooks/usePageSEO\";\r\nimport { AdminRoleTester } from \"@/components/AdminRoleTester\";\r\nimport { SimpleAnalyticsWidget } from \"@/components/SimpleAnalyticsWidget\";\r\nimport { CancellationTracker } from \"@/components/CancellationTracker\";\r\nimport { AdminTierStats } from \"@/components/AdminTierStats\";\r\nimport { UserRequestLimits } from \"@/components/UserRequestLimits\";\r\nimport { OpenAIApiStats } from \"@/components/OpenAIApiStats\";\r\nimport { GoogleAnalyticsSettings } from \"@/components/GoogleAnalyticsSettings\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ClearSubscriptionCacheButton } from \"@/components/ClearSubscriptionCacheButton\";\r\n\r\nfunction SharedKeySettings() {\r\n  const [sharedKey, setSharedKey] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const { toast } = useToast();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from('shared_settings')\r\n          .select('setting_value')\r\n          .eq('setting_key', 'shared_api_key')\r\n          .maybeSingle();\r\n        if (!error && data?.setting_value) setSharedKey(data.setting_value);\r\n      } catch (e) {\r\n        console.warn('Failed to load shared key');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  const save = async () => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('shared_settings')\r\n        .upsert({ setting_key: 'shared_api_key', setting_value: sharedKey });\r\n      if (error) throw error;\r\n      toast({ title: 'Saved', description: 'Shared OpenAI API key updated.' });\r\n    } catch (e: any) {\r\n      toast({ title: 'Error', description: e.message || 'Failed to save key', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"text-base\">Shared OpenAI API Key</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-3\">\r\n        <div className=\"space-y-1\">\r\n          <Label htmlFor=\"sharedKey\" className=\"text-sm\">Shared Key (used for Paid users in trial or subscribed)</Label>\r\n          <Input\r\n            id=\"sharedKey\"\r\n            type=\"password\"\r\n            value={sharedKey}\r\n            onChange={(e) => setSharedKey(e.target.value)}\r\n            placeholder=\"sk-...\"\r\n            disabled={loading}\r\n            className=\"font-mono\"\r\n          />\r\n        </div>\r\n        <Button onClick={save} className=\"w-full sm:w-auto\">Save</Button>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default function AdminOperations() {\r\n  usePageSEO({\r\n    title: \"Admin Operations â€“ Engagement & Monitoring\",\r\n    description: \"Monitor engagement, usage, and manage operational thresholds.\",\r\n    canonicalPath: \"/admin/operations\",\r\n  });\r\n\r\n  return (\r\n    <main className=\"container mx-auto p-6 space-y-8 overflow-x-hidden bg-background min-h-[calc(100vh-80px)]\" role=\"main\">\r\n      <h1 className=\"sr-only\">Admin Operations</h1>\r\n      <AdminSubnav />\r\n\r\n\r\n      <section aria-label=\"Real-time analytics\">\r\n        <SimpleAnalyticsWidget />\r\n      </section>\r\n\r\n      <section aria-label=\"Cancellation tracking\">\r\n        <CancellationTracker />\r\n      </section>\r\n\r\n      <section aria-label=\"User request limits\">\r\n        <UserRequestLimits />\r\n      </section>\r\n\r\n      <section aria-label=\"User tiers overview\">\r\n        <AdminTierStats />\r\n      </section>\r\n\r\n      <section aria-label=\"OpenAI API statistics\">\r\n        <OpenAIApiStats />\r\n      </section>\r\n\r\n      <section aria-label=\"Google Analytics settings\">\r\n        <GoogleAnalyticsSettings />\r\n      </section>\r\n\r\n      <section aria-label=\"Shared OpenAI key\">\r\n        <SharedKeySettings />\r\n      </section>\r\n      \r\n      <section aria-label=\"Cache management\" className=\"pb-24\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"text-base\">Cache Management</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-3\">\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Clear subscription cache if users are experiencing incorrect premium access on mobile devices.\r\n              </p>\r\n              <ClearSubscriptionCacheButton />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <div className=\"h-8\" />\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":["GoogleAnalyticsSettings","propertyId","setPropertyId","useState","loading","setLoading","saving","setSaving","toast","useToast","loadSettings","data","error","supabase","propertyIdSetting","saveSettings","useEffect","Card","jsx","CardHeader","CardTitle","CardContent","jsxs","Label","Input","e","Button","ClearSubscriptionCacheButton","clearSubscriptionCache","useCacheManager","handleClearCache","RefreshCw","SharedKeySettings","sharedKey","setSharedKey","save","AdminOperations","usePageSEO","AdminSubnav","SimpleAnalyticsWidget","CancellationTracker","UserRequestLimits","AdminTierStats","OpenAIApiStats"],"mappings":"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"}