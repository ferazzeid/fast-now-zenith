import{j as e}from"./ui-4JzjGctU.js";import{r as p}from"./vendor-D63tyEUO.js";import{u as I,an as F,ao as M,C as q,a as P,b as A,M as $,c as H,d as K,B as f,P as S,ap as Q,q as B,aq as z,ar as V,as as G,at as L,au as O,I as v,a2 as D,a3 as k,a4 as E,a5 as T,a6 as u,T as y,av as R,s as C,aw as N}from"./index-CNtalSg2.js";import"./supabase-CG8ZnHQM.js";const Y=({fastingHour:o,isOpen:m,onSave:_,onClose:h})=>{const[i,n]=p.useState({hour:1,day:1,title:"",body_state:"",encouragement:"",tips:[],phase:"preparation",difficulty:"easy",common_feelings:[],scientific_info:"",autophagy_milestone:!1,ketosis_milestone:!1,fat_burning_milestone:!1}),[c,g]=p.useState(""),[j,d]=p.useState("");p.useEffect(()=>{o?(n(o),g(o.tips?.join(`
`)||""),d(o.common_feelings?.join(", ")||"")):(n({hour:1,day:1,title:"",body_state:"",encouragement:"",tips:[],phase:"preparation",difficulty:"easy",common_feelings:[],scientific_info:"",autophagy_milestone:!1,ketosis_milestone:!1,fat_burning_milestone:!1}),g(""),d(""))},[o,m]);const b=()=>{const a=c.split(`
`).filter(l=>l.trim()!==""),t=j.split(",").map(l=>l.trim()).filter(l=>l!=="");_({...i,tips:a,common_feelings:t})};return m?e.jsx(z,{open:m,onOpenChange:h,children:e.jsxs(V,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsx(L,{children:o?"Edit Hour Timeline":"Create Hour Timeline"}),e.jsx(O,{children:"Customize the information shown for each hour of fasting."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Hour"}),e.jsx(v,{type:"number",min:1,max:72,value:i.hour,onChange:a=>{const t=parseInt(a.target.value)||1;n(l=>({...l,hour:t,day:Math.ceil(t/24)}))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Day"}),e.jsx(v,{type:"number",min:1,max:3,value:i.day,onChange:a=>n(t=>({...t,day:parseInt(a.target.value)||1}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Phase"}),e.jsxs(D,{value:i.phase,onValueChange:a=>n(t=>({...t,phase:a})),children:[e.jsx(k,{children:e.jsx(E,{})}),e.jsxs(T,{children:[e.jsx(u,{value:"preparation",children:"Preparation"}),e.jsx(u,{value:"adaptation",children:"Adaptation"}),e.jsx(u,{value:"fat_burning",children:"Fat Burning"}),e.jsx(u,{value:"deep_ketosis",children:"Deep Ketosis"}),e.jsx(u,{value:"autophagy",children:"Autophagy"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Difficulty"}),e.jsxs(D,{value:i.difficulty,onValueChange:a=>n(t=>({...t,difficulty:a})),children:[e.jsx(k,{children:e.jsx(E,{})}),e.jsxs(T,{children:[e.jsx(u,{value:"easy",children:"Easy"}),e.jsx(u,{value:"moderate",children:"Moderate"}),e.jsx(u,{value:"hard",children:"Hard"})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Title"}),e.jsx(v,{value:i.title,onChange:a=>n(t=>({...t,title:a.target.value})),placeholder:"e.g., Initial Hunger Pangs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Body State"}),e.jsx(y,{value:i.body_state,onChange:a=>n(t=>({...t,body_state:a.target.value})),placeholder:"Describe what's happening in the body...",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Encouragement"}),e.jsx(y,{value:i.encouragement||"",onChange:a=>n(t=>({...t,encouragement:a.target.value})),placeholder:"Motivational message for this hour...",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tips (one per line)"}),e.jsx(y,{value:c,onChange:a=>g(a.target.value),placeholder:`Drink water
Go for a walk
Practice deep breathing`,rows:4})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Common Feelings (comma separated)"}),e.jsx(v,{value:j,onChange:a=>d(a.target.value),placeholder:"hunger, fatigue, clarity"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Scientific Info (optional)"}),e.jsx(y,{value:i.scientific_info||"",onChange:a=>n(t=>({...t,scientific_info:a.target.value})),placeholder:"Scientific explanation of what's happening...",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(f,{variant:"outline",onClick:h,children:"Cancel"}),e.jsxs(f,{onClick:b,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Save"]})]})]})}):null},Z=()=>{const[o,m]=p.useState(),[_,h]=p.useState(!1),{toast:i}=I(),n=F(),{data:c=[],isLoading:g}=M(),j=new Set(c.map(s=>s.hour)),d=Array.from({length:72},(s,r)=>r+1).filter(s=>!j.has(s)),b=async s=>{try{if(c.some(w=>w.hour===s.hour&&w.id!==s.id)){i({title:"Duplicate hour",description:`Hour ${s.hour} already exists. Please choose a different hour or edit the existing one.`,variant:"destructive"});return}const{error:x}=await C.from("fasting_hours").upsert({id:s.id,hour:s.hour,day:s.day,title:s.title,body_state:s.body_state,encouragement:s.encouragement,tips:s.tips,phase:s.phase,difficulty:s.difficulty,common_feelings:s.common_feelings,scientific_info:s.scientific_info,autophagy_milestone:s.autophagy_milestone,ketosis_milestone:s.ketosis_milestone,fat_burning_milestone:s.fat_burning_milestone});if(x)throw x;i({title:"Success",description:`Hour ${s.hour} timeline updated successfully`}),n.invalidateQueries({queryKey:N}),h(!1),m(void 0)}catch(r){console.error("Error saving fasting hour:",r),i({title:"Error",description:"Failed to save timeline data",variant:"destructive"})}},a=async s=>{try{const{error:r}=await C.from("fasting_hours").delete().eq("id",s);if(r)throw r;i({title:"Success",description:"Timeline hour deleted successfully"}),n.invalidateQueries({queryKey:N})}catch(r){console.error("Error deleting fasting hour:",r),i({title:"Error",description:"Failed to delete timeline hour",variant:"destructive"})}},t=async()=>{if(d.length!==0)try{const s=d.map(x=>({hour:x,day:Math.ceil(x/24),title:`Hour ${x}`,body_state:"Details coming soon",encouragement:"You're doing great â€” keep going!",tips:[],phase:"preparation",difficulty:"easy",common_feelings:[],scientific_info:"",autophagy_milestone:!1,ketosis_milestone:!1,fat_burning_milestone:!1})),{error:r}=await C.from("fasting_hours").upsert(s);if(r)throw r;i({title:"Hours generated",description:`Added ${s.length} placeholder entr${s.length===1?"y":"ies"}.`}),n.invalidateQueries({queryKey:N})}catch(s){console.error("Error generating hours:",s),i({title:"Error",description:"Failed to generate missing hours",variant:"destructive"})}},l=s=>{m(s),h(!0)};return g?e.jsx("div",{className:"text-center py-8",children:"Loading timeline settings..."}):e.jsxs(q,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Timeline Hours (",c.length,"/72)"]}),e.jsx(H,{children:"Configure motivational content for each hour of fasting"})]}),e.jsxs(K,{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[d.length>0&&e.jsxs(f,{variant:"secondary",onClick:t,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Generate Missing (",d.length,")"]}),e.jsxs(f,{onClick:()=>l(),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add"]})]})}),e.jsx("div",{className:"divide-y rounded-md border max-h-96 overflow-y-auto",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3",children:[e.jsxs("span",{className:"text-sm",children:["Hour ",s.hour]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>l(s),"aria-label":`Edit Hour ${s.hour}`,children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>s.id&&a(s.id),"aria-label":`Delete Hour ${s.hour}`,children:e.jsx(B,{className:"w-4 h-4"})})]})]},s.id||s.hour))}),c.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No timeline hours configured yet. Add your first hour to get started."}),e.jsx(Y,{fastingHour:o,isOpen:_,onSave:b,onClose:()=>{h(!1),m(void 0)}})]})]})};export{Z as AdminTimelineSettings};
