import{s as l}from"./index-D6Zlv4TB.js";import"./ui-4JzjGctU.js";import"./vendor-D63tyEUO.js";import"./supabase-DmvLFwnu.js";const u=async()=>{try{console.log("Starting PWA cache refresh (preserving uploaded icons)...");const{data:i}=await l.from("shared_settings").select("setting_key, setting_value").in("setting_key",["app_favicon","app_logo","app_icon_url"]),r={};i?.forEach(e=>{r[e.setting_key]=e.setting_value}),console.log("Preserving existing PWA settings:",r);const t=`?v=${Date.now()}&refresh=${Date.now()}`;if(r.app_favicon){const e=document.getElementById("dynamic-favicon"),o=document.getElementById("dynamic-shortcut-icon"),a=document.querySelectorAll('link[rel="icon"]');e&&(e.href=r.app_favicon+t,console.log("Updated dynamic favicon:",e.href)),o&&(o.href=r.app_favicon+t,console.log("Updated shortcut icon:",o.href)),a.forEach(s=>{s.href=r.app_favicon+t,console.log("Updated icon link:",s.href)})}const c=r.app_icon_url||r.app_logo;if(c&&document.querySelectorAll('link[rel="apple-touch-icon"]').forEach(o=>{o.href=c+t,console.log("Updated apple touch icon:",o.href)}),"caches"in window){const e=await caches.keys();console.log("Clearing ALL caches:",e),await Promise.all(e.map(o=>(console.log("Deleting cache:",o),caches.delete(o))))}if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();for(const o of e)await o.unregister(),console.log("Unregistered service worker")}const n=document.querySelector('link[rel="manifest"]');if(n){const e=new URL(n.href,window.location.origin);e.searchParams.set("v",Date.now().toString()),e.searchParams.set("bust",Math.random().toString(36)),e.searchParams.set("refresh",Date.now().toString()),n.href=e.toString(),console.log("Manifest URL updated:",n.href)}return setTimeout(async()=>{try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Re-registered service worker:",e)}catch(e){console.error("Failed to re-register service worker:",e)}},1e3),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(console.log("Mobile device detected, forcing page reload in 2 seconds..."),setTimeout(()=>{console.log("Reloading page for mobile cache clear..."),location.reload()},2e3)),console.log("PWA cache refresh completed (icons preserved)"),!0}catch(i){return console.error("Error refreshing PWA cache:",i),!1}};export{u as forcePWARefresh};
//# sourceMappingURL=pwaCache-DJK29_KK.js.map
