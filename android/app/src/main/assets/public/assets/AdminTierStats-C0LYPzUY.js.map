{"version":3,"file":"AdminTierStats-C0LYPzUY.js","sources":["../../src/components/AdminTierStats.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { LoadingSpinner } from '@/components/LoadingSpinner';\r\n\r\ninterface TierStats {\r\n  tier: string;\r\n  total: number;\r\n  active: number;\r\n  inactive: number;\r\n}\r\n\r\nexport const AdminTierStats = () => {\r\n  const [stats, setStats] = useState<TierStats[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchTierStats();\r\n  }, []);\r\n\r\n  const fetchTierStats = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Get tier counts with activity status\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select(`\r\n          user_tier,\r\n          last_activity_at\r\n        `);\r\n\r\n      if (error) throw error;\r\n\r\n      const sevenDaysAgo = new Date();\r\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\r\n\r\n      // Process data to calculate stats\r\n      const tierCounts: Record<string, { total: number; active: number; inactive: number }> = {\r\n        paid_user: { total: 0, active: 0, inactive: 0 },\r\n        free_user: { total: 0, active: 0, inactive: 0 }\r\n      };\r\n\r\n      data?.forEach(profile => {\r\n        const tier = profile.user_tier || 'free_user';\r\n        if (tierCounts[tier]) {\r\n          tierCounts[tier].total++;\r\n          \r\n          // Check if user was active in last 7 days\r\n          if (profile.last_activity_at && new Date(profile.last_activity_at) > sevenDaysAgo) {\r\n            tierCounts[tier].active++;\r\n          } else {\r\n            tierCounts[tier].inactive++;\r\n          }\r\n        }\r\n      });\r\n\r\n      const statsArray: TierStats[] = [\r\n        { \r\n          tier: 'Paid Users (Trial + Subscribed)', \r\n          total: tierCounts.paid_user.total, \r\n          active: tierCounts.paid_user.active,\r\n          inactive: tierCounts.paid_user.inactive\r\n        },\r\n        { \r\n          tier: 'Free Users (Trial Ended)', \r\n          total: tierCounts.free_user.total, \r\n          active: tierCounts.free_user.active,\r\n          inactive: tierCounts.free_user.inactive\r\n        }\r\n      ];\r\n\r\n      setStats(statsArray);\r\n    } catch (error) {\r\n      console.error('Error fetching tier stats:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Card className=\"p-6\">\r\n        <div className=\"flex items-center justify-center\">\r\n          <LoadingSpinner />\r\n        </div>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"text-lg\">\r\n          User Tiers Overview\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          {stats.map((stat) => (\r\n            <div key={stat.tier} className=\"space-y-3\">\r\n              <h4 className=\"text-sm font-medium text-foreground mb-3 text-center\">\r\n                {stat.tier}\r\n              </h4>\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded-lg\">\r\n                  <span className=\"text-xs text-muted-foreground\">Active Users</span>\r\n                  <span className=\"text-sm font-semibold text-foreground\">{stat.active}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded-lg\">\r\n                  <span className=\"text-xs text-muted-foreground\">Inactive Users</span>\r\n                  <span className=\"text-sm font-semibold text-foreground\">{stat.inactive}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-2 bg-muted/50 rounded-lg\">\r\n                  <span className=\"text-xs text-muted-foreground\">Total</span>\r\n                  <span className=\"text-sm font-semibold text-foreground\">{stat.total}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};"],"names":["AdminTierStats","stats","setStats","useState","loading","setLoading","useEffect","fetchTierStats","data","error","supabase","sevenDaysAgo","tierCounts","profile","tier","statsArray","jsx","Card","LoadingSpinner","CardHeader","CardTitle","CardContent","stat","jsxs"],"mappings":"wLAYO,MAAMA,EAAiB,IAAM,CAClC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAA,SAAsB,CAAE,CAAA,EAC5C,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EAE3CG,EAAAA,UAAU,IAAM,CACCC,GACjB,EAAG,CAAE,CAAA,EAEL,MAAMA,EAAiB,SAAY,CAC7B,GAAA,CACFF,EAAW,EAAI,EAGT,KAAA,CAAE,KAAAG,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,UAAU,EACf,OAAO;AAAA;AAAA;AAAA,SAGP,EAEH,GAAID,EAAa,MAAAA,EAEX,MAAAE,MAAmB,KACzBA,EAAa,QAAQA,EAAa,QAAQ,EAAI,CAAC,EAG/C,MAAMC,EAAkF,CACtF,UAAW,CAAE,MAAO,EAAG,OAAQ,EAAG,SAAU,CAAE,EAC9C,UAAW,CAAE,MAAO,EAAG,OAAQ,EAAG,SAAU,CAAE,CAAA,EAGhDJ,GAAM,QAAmBK,GAAA,CACjB,MAAAC,EAAOD,EAAQ,WAAa,YAC9BD,EAAWE,CAAI,IACjBF,EAAWE,CAAI,EAAE,QAGbD,EAAQ,kBAAoB,IAAI,KAAKA,EAAQ,gBAAgB,EAAIF,EACnEC,EAAWE,CAAI,EAAE,SAEjBF,EAAWE,CAAI,EAAE,WAErB,CACD,EAED,MAAMC,EAA0B,CAC9B,CACE,KAAM,kCACN,MAAOH,EAAW,UAAU,MAC5B,OAAQA,EAAW,UAAU,OAC7B,SAAUA,EAAW,UAAU,QACjC,EACA,CACE,KAAM,2BACN,MAAOA,EAAW,UAAU,MAC5B,OAAQA,EAAW,UAAU,OAC7B,SAAUA,EAAW,UAAU,QACjC,CAAA,EAGFV,EAASa,CAAU,QACZN,EAAO,CACN,QAAA,MAAM,6BAA8BA,CAAK,CAAA,QACjD,CACAJ,EAAW,EAAK,CAClB,CAAA,EAGF,OAAID,EAEAY,EAAAA,IAACC,EAAK,CAAA,UAAU,MACd,SAAAD,EAAAA,IAAC,MAAI,CAAA,UAAU,mCACb,SAAAA,EAAA,IAACE,EAAe,EAAA,CAAA,CAClB,CACF,CAAA,SAKDD,EACC,CAAA,SAAA,CAAAD,EAAAA,IAACG,GACC,SAACH,EAAA,IAAAI,EAAA,CAAU,UAAU,UAAU,+BAE/B,CACF,CAAA,EACCJ,EAAA,IAAAK,EAAA,CACC,SAACL,EAAA,IAAA,MAAA,CAAI,UAAU,wCACZ,SAAMf,EAAA,IAAKqB,GACTC,EAAA,KAAA,MAAA,CAAoB,UAAU,YAC7B,SAAA,CAAAP,EAAA,IAAC,KAAG,CAAA,UAAU,uDACX,SAAAM,EAAK,KACR,EACAC,EAAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,+DACb,SAAA,CAACP,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAY,eAAA,EAC3DA,EAAA,IAAA,OAAA,CAAK,UAAU,wCAAyC,WAAK,OAAO,CAAA,EACvE,EACAO,EAAAA,KAAC,MAAI,CAAA,UAAU,+DACb,SAAA,CAACP,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAc,iBAAA,EAC7DA,EAAA,IAAA,OAAA,CAAK,UAAU,wCAAyC,WAAK,SAAS,CAAA,EACzE,EACAO,EAAAA,KAAC,MAAI,CAAA,UAAU,+DACb,SAAA,CAACP,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAK,QAAA,EACpDA,EAAA,IAAA,OAAA,CAAK,UAAU,wCAAyC,WAAK,MAAM,CAAA,EACtE,CAAA,EACF,CAAA,CAAA,EAjBQM,EAAK,IAkBf,CACD,CAAA,CACH,CACF,CAAA,CACF,CAAA,CAAA,CAEJ"}